import React, { useState, useEffect } from 'react';\nimport { Rss, Calendar, ExternalLink, Zap, Code, Package, Bug, AlertTriangle, TrendingUp } from 'lucide-react';\n\ninterface RSSItem {\n  title: string;\n  link: string;\n  guid: string;\n  description: string;\n  pubDate: string;\n}\n\ninterface ParsedRSSFeed {\n  title: string;\n  description: string;\n  lastBuildDate: string;\n  items: RSSItem[];\n}\n\nexport default function BunRSSFeed() {\n  const [feed, setFeed] = useState<ParsedRSSFeed | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedCategory, setSelectedCategory] = useState<'all' | 'releases' | 'features' | 'company'>('all');\n  const [expandedItem, setExpandedItem] = useState<string | null>(null);\n\n  // Sample RSS feed data based on the actual Bun RSS feed\n  const sampleFeed: ParsedRSSFeed = {\n    title: 'bun.com',\n    description: 'A fast all-in-one JavaScript runtime and toolkit',\n    lastBuildDate: 'Thu, 29 Jan 2026 12:15:45 GMT',\n    items: [\n      {\n        title: 'Bun v1.3.8',\n        link: 'https://bun.com/blog/bun-v1.3.8',\n        guid: 'https://bun.com/blog/bun-v1.3.8',\n        description: 'Fixes 8 issues (addressing 6 ðŸ‘). Bun.markdown is a builtin CommonMark-compliant Markdown parser written in Zig. Bun\\'s bundler gets bun build --metafile-md to write LLM-friendly module graph metadata. Fixes a regression in \\'npm install -g bun\\' on Windows.',\n        pubDate: 'Thu, 29 Jan 2026 10:04:52 GMT'\n      },\n      {\n        title: 'Bun v1.3.7',\n        link: 'https://bun.com/blog/bun-v1.3.7',\n        guid: 'https://bun.com/blog/bun-v1.3.7',\n        description: 'Fixes 91 issues (addressing 243 ðŸ‘). 50% faster `Buffer.from(array)`, 35% faster async/await, 3x faster `array.flat()`, 90% faster `padStart`/`padEnd` via JSC upgrade. New: `Bun.JSON5`, `Bun.JSONL`, `Bun.wrapAnsi()` (33-88x faster than wrap-ansi npm), `--heap-prof-md`, `--cpu-prof-md`, `node:inspector` Profiler API, `replMode` for `Bun.Transpiler`. Fetch now preserves header casing. HTTP/2 fixes for AWS ALB/gRPC/Fauna.',\n        pubDate: 'Tue, 27 Jan 2026 06:30:58 GMT'\n      },\n      {\n        title: 'Bun v1.3.6',\n        link: 'https://bun.com/blog/bun-v1.3.6',\n        guid: 'https://bun.com/blog/bun-v1.3.6',\n        description: 'Fixes 45 issues (addressing 125 ðŸ‘). Bun.Archive API for creating & extracting tarballs with gzip compression, Bun.JSONC for parsing JSON with comments, metafile & files options in Bun.build for bundle analysis and virtual files, Response.json() 3.5x faster, 15% faster async/await, 30% faster Promise.race, 20x faster Bun.hash.crc32, faster Buffer.indexOf/includes with SIMD, HTTP/HTTPS proxy support for WebSocket, S3 Requester Pays support, --grep flag for bun test, fake timers now work with @testing-library/react, SQLite updated to 3.51.2, and numerous Node.js compatibility improvements.',\n        pubDate: 'Tue, 13 Jan 2026 01:12:07 GMT'\n      },\n      {\n        title: 'Bun is joining Anthropic',\n        link: 'https://bun.com/blog/bun-joins-anthropic',\n        guid: 'https://bun.com/blog/bun-joins-anthropic',\n        description: 'Bun has been acquired by Anthropic. Anthropic is betting on Bun as the infrastructure powering Claude Code, Claude Agent SDK, and future AI coding products & tools.',\n        pubDate: 'Tue, 02 Dec 2025 10:00:00 GMT'\n      },\n      {\n        title: 'Vercel now supports the Bun Runtime',\n        link: 'https://bun.com/blog/vercel-adds-native-bun-support',\n        guid: 'https://bun.com/blog/vercel-adds-native-bun-support',\n        description: 'Deploy and run your applications with Bun\\'s fast JavaScript runtime on Vercel Functions, with full access to Bun APIs and improved performance',\n        pubDate: 'Tue, 28 Oct 2025 15:00:00 GMT'\n      },\n      {\n        title: 'Bun 1.3',\n        link: 'https://bun.com/blog/bun-v1.3',\n        guid: 'https://bun.com/blog/bun-v1.3',\n        description: 'Bun 1.3 introduces zero-config frontend development, unified SQL API, built-in Redis client, security enhancements, package catalogs, async stack traces, VS Code test integration, and Node.js compatibility improvements.',\n        pubDate: 'Fri, 10 Oct 2025 20:00:00 GMT'\n      }\n    ]\n  };\n\n  useEffect(() => {\n    // Simulate RSS feed loading\n    const loadFeed = async () => {\n      setLoading(true);\n      setError(null);\n      \n      try {\n        // In a real implementation, we would fetch the actual RSS feed\n        // For now, we'll use the sample data\n        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate network delay\n        setFeed(sampleFeed);\n      } catch (err) {\n        setError('Failed to load RSS feed');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadFeed();\n  }, []);\n\n  const categorizeItem = (item: RSSItem): 'releases' | 'features' | 'company' => {\n    const title = item.title.toLowerCase();\n    const description = item.description.toLowerCase();\n    \n    if (title.includes('v') || title.includes('release') || description.includes('fixes')) {\n      return 'releases';\n    }\n    if (title.includes('anthropic') || title.includes('vercel') || title.includes('joining')) {\n      return 'company';\n    }\n    return 'features';\n  };\n\n  const getIconForCategory = (category: string) => {\n    switch (category) {\n      case 'releases':\n        return item.title.includes('v1.3.8') ? <Zap className=\"w-5 h-5 text-yellow-500\" /> :\n               item.title.includes('v1.3.7') ? <TrendingUp className=\"w-5 h-5 text-green-500\" /> :\n               <Package className=\"w-5 h-5 text-blue-500\" />;\n      case 'features':\n        return <Code className=\"w-5 h-5 text-purple-500\" />;\n      case 'company':\n        return <AlertTriangle className=\"w-5 h-5 text-orange-500\" />;\n      default:\n        return <Rss className=\"w-5 h-5 text-gray-500\" />;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', { \n      year: 'numeric', \n      month: 'short', \n      day: 'numeric' \n    });\n  };\n\n  const extractHighlights = (description: string) => {\n    const highlights: string[] = [];\n    \n    // Extract performance improvements\n    if (description.includes('faster')) {\n      const fasterMatches = description.match(/(\\d+%|\\d+x) faster/g);\n      if (fasterMatches) {\n        highlights.push(`ðŸš€ ${fasterMatches.join(', ')}`);\n      }\n    }\n    \n    // Extract new features\n    if (description.includes('New:')) {\n      const newFeatures = description.match(/New: ([^.]+)/);\n      if (newFeatures) {\n        highlights.push(`âœ¨ ${newFeatures[1]}`);\n      }\n    }\n    \n    // Extract issue fixes\n    const fixesMatch = description.match(/Fixes (\\d+) issues/);\n    if (fixesMatch) {\n      highlights.push(`ðŸ› ${fixesMatch[1]} issues fixed`);\n    }\n    \n    // Extract major features\n    if (description.includes('Bun.markdown')) {\n      highlights.push(`ðŸ“ Built-in Markdown parser`);\n    }\n    if (description.includes('Anthropic')) {\n      highlights.push(`ðŸ¤– Joined Anthropic`);\n    }\n    if (description.includes('Vercel')) {\n      highlights.push(`âš¡ Vercel support`);\n    }\n    \n    return highlights;\n  };\n\n  const filteredItems = feed?.items.filter(item => {\n    if (selectedCategory === 'all') return true;\n    return categorizeItem(item) === selectedCategory;\n  }) || [];\n\n  if (loading) {\n    return (\n      <div className=\"max-w-7xl mx-auto p-6\">\n        <div className=\"flex items-center justify-center space-x-3 py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-cloudflare-orange\"></div>\n          <span className=\"text-lg text-gray-600 dark:text-gray-400\">Loading Bun RSS feed...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-7xl mx-auto p-6\">\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\n          <div className=\"flex items-center space-x-3\">\n            <AlertTriangle className=\"w-6 h-6 text-red-500\" />\n            <div>\n              <h3 className=\"text-lg font-semibold text-red-800 dark:text-red-200\">Error Loading RSS Feed</h3>\n              <p className=\"text-red-600 dark:text-red-400\">{error}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n      {/* Header */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex items-center justify-center space-x-3\">\n          <Rss className=\"w-12 h-12 text-cloudflare-orange\" />\n          <h1 className=\"text-5xl font-bold\">Bun RSS Feed</h1>\n          <Rss className=\"w-12 h-12 text-cloudflare-orange\" />\n        </div>\n        <p className=\"text-xl text-gray-600 dark:text-gray-400\">\n          Latest updates and releases from the Bun team\n        </p>\n        {feed && (\n          <div className=\"flex items-center justify-center space-x-6 text-sm text-gray-500 dark:text-gray-400\">\n            <div className=\"flex items-center space-x-2\">\n              <Calendar className=\"w-4 h-4\" />\n              <span>Last updated: {formatDate(feed.lastBuildDate)}</span>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Package className=\"w-4 h-4\" />\n              <span>{feed.items.length} items</span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Category Filter */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-1\">\n        <div className=\"flex space-x-1\">\n          <button\n            onClick={() => setSelectedCategory('all')}\n            className={`flex-1 px-4 py-3 rounded-md transition-colors ${\n              selectedCategory === 'all'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            All Updates\n          </button>\n          <button\n            onClick={() => setSelectedCategory('releases')}\n            className={`flex-1 px-4 py-3 rounded-md transition-colors ${\n              selectedCategory === 'releases'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            Releases\n          </button>\n          <button\n            onClick={() => setSelectedCategory('features')}\n            className={`flex-1 px-4 py-3 rounded-md transition-colors ${\n              selectedCategory === 'features'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            Features\n          </button>\n          <button\n            onClick={() => setSelectedCategory('company')}\n            className={`flex-1 px-4 py-3 rounded-md transition-colors ${\n              selectedCategory === 'company'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            Company\n          </button>\n        </div>\n      </div>\n\n      {/* RSS Items */}\n      <div className=\"space-y-6\">\n        {filteredItems.map((item, index) => {\n          const category = categorizeItem(item);\n          const highlights = extractHighlights(item.description);\n          const isExpanded = expandedItem === item.guid;\n          \n          return (\n            <div key={item.guid} className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden\">\n              <div className=\"p-6\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-start space-x-4 flex-1\">\n                    <div className=\"mt-1\">\n                      {getIconForCategory(category)}\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-3 mb-2\">\n                        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\n                          {item.title}\n                        </h3>\n                        <span className={`px-2 py-1 text-xs rounded-full ${\n                          category === 'releases' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400' :\n                          category === 'features' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400' :\n                          'bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400'\n                        }`}>\n                          {category}\n                        </span>\n                      </div>\n                      \n                      <div className=\"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400 mb-3\">\n                        <div className=\"flex items-center space-x-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span>{formatDate(item.pubDate)}</span>\n                        </div>\n                        <a\n                          href={item.link}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"flex items-center space-x-1 hover:text-cloudflare-orange transition-colors\"\n                        >\n                          <ExternalLink className=\"w-4 h-4\" />\n                          <span>Read more</span>\n                        </a>\n                      </div>\n                      \n                      {/* Highlights */}\n                      {highlights.length > 0 && (\n                        <div className=\"flex flex-wrap gap-2 mb-3\">\n                          {highlights.map((highlight, hi) => (\n                            <span key={hi} className=\"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm\">\n                              {highlight}\n                            </span>\n                          ))}\n                        </div>\n                      )}\n                      \n                      {/* Description */}\n                      <div className=\"text-gray-600 dark:text-gray-400\">\n                        {isExpanded ? (\n                          <div>\n                            <p className=\"whitespace-pre-wrap\">{item.description}</p>\n                            <button\n                              onClick={() => setExpandedItem(null)}\n                              className=\"mt-3 text-cloudflare-orange hover:text-orange-600 text-sm font-medium\"\n                            >\n                              Show less\n                            </button>\n                          </div>\n                        ) : (\n                          <div>\n                            <p className=\"line-clamp-3\">{item.description}</p>\n                            {item.description.length > 200 && (\n                              <button\n                                onClick={() => setExpandedItem(item.guid)}\n                                className=\"mt-2 text-cloudflare-orange hover:text-orange-600 text-sm font-medium\"\n                              >\n                                Read more\n                              </button>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Footer */}\n      <div className=\"text-center py-8\">\n        <div className=\"flex items-center justify-center space-x-2 text-gray-500 dark:text-gray-400\">\n          <Rss className=\"w-5 h-5\" />\n          <span>Powered by </span>\n          <a\n            href=\"https://bun.com\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"text-cloudflare-orange hover:text-orange-600 font-medium\"\n          >\n            bun.com\n          </a>\n        </div>\n      </div>\n    </div>\n  );\n}

import React, { useState } from 'react';\nimport { FileText, Code, Terminal, BarChart3, Download, Play, Copy, Check } from 'lucide-react';\nimport { useBunMarkdown } from '../hooks/useBunMarkdown';\nimport { useBunBuildAnalyzer } from '../hooks/useBunBuildAnalyzer';\nimport { formatBytes } from '../hooks/useBunBuildAnalyzer';\n\nexport default function BunV138Showcase() {\n  const { \n    renderToHTML, \n    renderToReact, \n    renderToANSI, \n    processMarkdown, \n    extractMetadata \n  } = useBunMarkdown();\n  \n  const { \n    analyzeBundle, \n    analyzeFromMetafile, \n    generateOptimizationSuggestions, \n    exportAnalysis,\n    isAnalyzing,\n    currentAnalysis \n  } = useBunBuildAnalyzer();\n  \n  const [activeTab, setActiveTab] = useState<'markdown' | 'build'>('markdown');\n  const [markdownInput, setMarkdownInput] = useState(`# Bun v1.3.8 Features\\n\\n## ðŸš€ New Markdown Parser\\n\\nBun now includes a fast, CommonMark-compliant Markdown parser written in Zig.\\n\\n### Features:\\n\\n- **HTML rendering** with \\`Bun.markdown.html()\\`\\n- **Custom callbacks** with \\`Bun.markdown.render()\\`\\n- **React components** with \\`Bun.markdown.react()\\`\\n\\n### GFM Extensions:\\n\\n| Feature | Status | Example |\\n|---------|--------|---------|\\n| Tables | âœ… | | Header | Cell |\\n| Strikethrough | âœ… | ~~deleted~~ |\\n| Task lists | âœ… | - [x] done |\\n| Autolinks | âœ… | https://bun.sh |\\n\\n### Task List Example:\\n\\n- [x] Implemented HTML rendering\\n- [x] Added React component support\\n- [ ] Add more GFM extensions\\n- [ ] Performance optimization\\n\\n> **Note:** This is parsed using Bun's new markdown API!\\n\\nCheck out the [Bun documentation](https://bun.sh/docs) for more details.`);\n  \n  const [renderFormat, setRenderFormat] = useState<'html' | 'react' | 'ansi' | 'custom'>('html');\n  const [copied, setCopied] = useState(false);\n  \n  const sampleEntrypoints = [\n    './src/index.ts',\n    './src/components/App.tsx',\n    './src/utils/helpers.ts'\n  ];\n\n  const handleMarkdownRender = () => {\n    const result = processMarkdown(markdownInput, {\n      format: renderFormat,\n      customCallbacks: renderFormat === 'custom' ? {\n        heading: (children, { level }) => {\n          const colors = ['text-blue-600', 'text-green-600', 'text-purple-600', 'text-yellow-600', 'text-pink-600', 'text-indigo-600'];\n          return `<h${level} class=\"font-bold ${colors[level - 1]}\">${children}</h${level}>`;\n        },\n        paragraph: (children) => `<p class=\"mb-4 text-gray-700\">${children}</p>`,\n        strong: (children) => `<strong class=\"font-bold text-gray-900\">${children}</strong>`,\n        code: (children) => `<code class=\"bg-gray-100 px-1 py-0.5 rounded text-sm font-mono\">${children}</code>`,\n        blockquote: (children) => `<blockquote class=\"border-l-4 border-blue-500 pl-4 italic text-gray-600\">${children}</blockquote>`,\n        table: (children) => `<table class=\"w-full border-collapse border border-gray-300\">${children}</table>`,\n        tableRow: (children) => `<tr class=\"border-b\">${children}</tr>`,\n        tableCell: (children, { header }) => \n          header \n            ? `<th class=\"border border-gray-300 px-4 py-2 bg-gray-50 font-semibold\">${children}</th>`\n            : `<td class=\"border border-gray-300 px-4 py-2\">${children}</td>`,\n        taskList: (children, { checked }) => \n          `<div class=\"flex items-center space-x-2\"><input type=\"checkbox\" ${checked ? 'checked' : ''} class=\"rounded\">${children}</div>`\n      } : undefined\n    });\n    \n    return result;\n  };\n\n  const handleBuildAnalysis = async () => {\n    try {\n      await analyzeBundle(sampleEntrypoints, {\n        target: 'browser',\n        format: 'esm',\n        splitting: true,\n        minify: false,\n        sourcemap: true\n      });\n    } catch (error) {\n      console.error('Analysis failed:', error);\n    }\n  };\n\n  const copyToClipboard = async (text: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      console.error('Failed to copy:', error);\n    }\n  };\n\n  const markdownResult = handleMarkdownRender();\n  const metadata = extractMetadata(markdownInput);\n\n  return (\n    <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n      {/* Header */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex items-center justify-center space-x-3\">\n          <h1 className=\"text-4xl font-bold text-gray-900 dark:text-gray-100\">\n            Bun v1.3.8 Showcase\n          </h1>\n          <span className=\"px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-sm font-medium\">\n            Latest Features\n          </span>\n        </div>\n        <p className=\"text-lg text-gray-600 dark:text-gray-400\">\n          Explore the new built-in Markdown parser and metafile-md bundle analysis\n        </p>\n      </div>\n\n      {/* Tab Navigation */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-1\">\n        <div className=\"flex space-x-1\">\n          <button\n            onClick={() => setActiveTab('markdown')}\n            className={`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-md transition-colors ${\n              activeTab === 'markdown'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            <FileText className=\"w-5 h-5\" />\n            <span>Markdown Parser</span>\n          </button>\n          <button\n            onClick={() => setActiveTab('build')}\n            className={`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-md transition-colors ${\n              activeTab === 'build'\n                ? 'bg-cloudflare-orange text-white'\n                : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'\n            }`}\n          >\n            <BarChart3 className=\"w-5 h-5\" />\n            <span>Build Analyzer</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Markdown Parser Tab */}\n      {activeTab === 'markdown' && (\n        <div className=\"space-y-6\">\n          {/* Input Section */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold flex items-center space-x-2\">\n                <FileText className=\"w-5 h-5\" />\n                <span>Markdown Input</span>\n              </h2>\n              <div className=\"flex items-center space-x-2\">\n                <select\n                  value={renderFormat}\n                  onChange={(e) => setRenderFormat(e.target.value as any)}\n                  className=\"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700\"\n                >\n                  <option value=\"html\">HTML Output</option>\n                  <option value=\"react\">React Components</option>\n                  <option value=\"ansi\">ANSI Terminal</option>\n                  <option value=\"custom\">Custom Styled</option>\n                </select>\n                <button\n                  onClick={() => copyToClipboard(markdownInput)}\n                  className=\"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100\"\n                >\n                  {copied ? <Check className=\"w-5 h-5\" /> : <Copy className=\"w-5 h-5\" />}\n                </button>\n              </div>\n            </div>\n            \n            <textarea\n              value={markdownInput}\n              onChange={(e) => setMarkdownInput(e.target.value)}\n              className=\"w-full h-64 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 font-mono text-sm\"\n              placeholder=\"Enter your markdown here...\"\n            />\n            \n            <div className=\"mt-4 flex flex-wrap gap-2\">\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                <span className=\"font-medium\">Metadata:</span>\n                <span className=\"ml-2\">{metadata.headings.length} headings, </span>\n                <span>{metadata.links.length} links, </span>\n                <span>{metadata.images.length} images, </span>\n                <span>{metadata.tables} tables, </span>\n                <span>{metadata.taskLists} tasks</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Output Section */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold flex items-center space-x-2\">\n                {renderFormat === 'html' && <Code className=\"w-5 h-5\" />}\n                {renderFormat === 'react' && <div className=\"w-5 h-5 bg-blue-500 rounded\" />}\n                {renderFormat === 'ansi' && <Terminal className=\"w-5 h-5\" />}\n                {renderFormat === 'custom' && <div className=\"w-5 h-5 bg-purple-500 rounded\" />}\n                <span>\n                  {renderFormat === 'html' && 'HTML Output'}\n                  {renderFormat === 'react' && 'React Components'}\n                  {renderFormat === 'ansi' && 'ANSI Terminal'}\n                  {renderFormat === 'custom' && 'Custom Styled'}\n                </span>\n              </h2>\n              <button\n                onClick={() => copyToClipboard(\n                  renderFormat === 'html' ? markdownResult.html :\n                  renderFormat === 'ansi' ? markdownResult.custom || '' :\n                  markdownResult.html\n                )}\n                className=\"p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100\"\n              >\n                <Copy className=\"w-5 h-5\" />\n              </button>\n            </div>\n            \n            <div className=\"border border-gray-300 dark:border-gray-600 rounded-md p-4 bg-gray-50 dark:bg-gray-900\">\n              {renderFormat === 'html' && (\n                <div \n                  className=\"prose prose-sm max-w-none dark:prose-invert\"\n                  dangerouslySetInnerHTML={{ __html: markdownResult.html }}\n                />\n              )}\n              \n              {renderFormat === 'react' && (\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded\">\n                    React components would be rendered here in a real React application.\n                  </div>\n                  <pre className=\"bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto\">\n                    <code>{JSON.stringify(markdownResult.metadata, null, 2)}</code>\n                  </pre>\n                </div>\n              )}\n              \n              {renderFormat === 'ansi' && (\n                <pre className=\"bg-black text-green-400 p-4 rounded font-mono text-sm overflow-x-auto whitespace-pre-wrap\">\n                  {markdownResult.custom}\n                </pre>\n              )}\n              \n              {renderFormat === 'custom' && (\n                <div \n                  className=\"max-w-none\"\n                  dangerouslySetInnerHTML={{ __html: markdownResult.custom || markdownResult.html }}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Build Analyzer Tab */}\n      {activeTab === 'build' && (\n        <div className=\"space-y-6\">\n          {/* Controls */}\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold flex items-center space-x-2\">\n                <BarChart3 className=\"w-5 h-5\" />\n                <span>Bundle Analysis</span>\n              </h2>\n              <button\n                onClick={handleBuildAnalysis}\n                disabled={isAnalyzing}\n                className=\"flex items-center space-x-2 px-4 py-2 bg-cloudflare-orange text-white rounded-md hover:bg-orange-600 disabled:opacity-50\"\n              >\n                {isAnalyzing ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                    <span>Analyzing...</span>\n                  </>\n                ) : (\n                  <>\n                    <Play className=\"w-4 h-4\" />\n                    <span>Analyze Bundle</span>\n                  </>\n                )}\n              </button>\n            </div>\n            \n            <div className=\"bg-gray-50 dark:bg-gray-900 rounded p-4\">\n              <h3 className=\"font-medium mb-2\">Sample Entry Points:</h3>\n              <ul className=\"space-y-1 font-mono text-sm\">\n                {sampleEntrypoints.map(point => (\n                  <li key={point} className=\"text-gray-600 dark:text-gray-400\">â€¢ {point}</li>\n                ))}\n              </ul>\n            </div>\n          </div>\n\n          {/* Analysis Results */}\n          {currentAnalysis && (\n            <div className=\"space-y-6\">\n              {/* Summary Cards */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                  <div className=\"text-2xl font-bold text-blue-500\">\n                    {currentAnalysis.summary.totalModules}\n                  </div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Modules</div>\n                </div>\n                \n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                  <div className=\"text-2xl font-bold text-green-500\">\n                    {formatBytes(currentAnalysis.summary.totalSize)}\n                  </div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Bundle Size</div>\n                </div>\n                \n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                  <div className=\"text-2xl font-bold text-purple-500\">\n                    {currentAnalysis.summary.esmModules}\n                  </div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">ESM Modules</div>\n                </div>\n                \n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                  <div className=\"text-2xl font-bold text-yellow-500\">\n                    {currentAnalysis.summary.outputToInputRatio.toFixed(2)}\n                  </div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Output/Input Ratio</div>\n                </div>\n              </div>\n\n              {/* Largest Files */}\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                <h3 className=\"text-lg font-semibold mb-4\">Largest Input Files</h3>\n                <div className=\"space-y-2\">\n                  {currentAnalysis.largestInputFiles.map((file, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-900 rounded\">\n                      <div className=\"flex-1\">\n                        <div className=\"font-mono text-sm\">{file.path}</div>\n                      </div>\n                      <div className=\"flex items-center space-x-4\">\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {formatBytes(file.size)}\n                        </div>\n                        <div className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n                          {file.percentage.toFixed(1)}%\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Optimization Suggestions */}\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                <h3 className=\"text-lg font-semibold mb-4\">Optimization Suggestions</h3>\n                <div className=\"space-y-2\">\n                  {generateOptimizationSuggestions(currentAnalysis).map((suggestion, index) => (\n                    <div key={index} className=\"flex items-start space-x-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded\">\n                      <div className=\"w-2 h-2 bg-yellow-500 rounded-full mt-1.5\"></div>\n                      <div className=\"text-sm text-gray-700 dark:text-gray-300\">{suggestion}</div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Export Options */}\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                <h3 className=\"text-lg font-semibold mb-4\">Export Analysis</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  <button\n                    onClick={() => copyToClipboard(exportAnalysis(currentAnalysis, 'json'))}\n                    className=\"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n                  >\n                    <Download className=\"w-4 h-4\" />\n                    <span>Copy JSON</span>\n                  </button>\n                  <button\n                    onClick={() => copyToClipboard(exportAnalysis(currentAnalysis, 'csv'))}\n                    className=\"flex items-center space-x-2 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\"\n                  >\n                    <Download className=\"w-4 h-4\" />\n                    <span>Copy CSV</span>\n                  </button>\n                  <button\n                    onClick={() => copyToClipboard(exportAnalysis(currentAnalysis, 'markdown'))}\n                    className=\"flex items-center space-x-2 px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600\"\n                  >\n                    <Download className=\"w-4 h-4\" />\n                    <span>Copy Markdown</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}

# Authentication & Session Management Subsystem (10.0.0.0.0.0.0)

**Version**: 10.0.0.0.0.0.0  
**Feature**: Authentication & Session Management with Bun Native APIs  
**Status**: ✅ Integrated  
**Date**: 2025-12-07  
**Last Updated**: 2025-12-07

---

## Overview

This subsystem defines Hyper-Bun's robust and secure mechanisms for user authentication, session management, and persistent state across its web-based interfaces, including the main API server, dashboard, and Telegram Mini App (TMA). Bun's native `Bun.CookieMap` and `Bun.Cookie` APIs form the foundation of this secure state management.

**Context**: This subsystem integrates seamlessly with Hyper-Bun's operational dashboard (`17.0.0.0.0.0.0-dashboard`) and enhances the snapshot testing capabilities (`4.3.0.0.0.0.0`) by providing secure session management for dashboard access and UI state persistence.

**Bun Version**: 1.3+ recommended (uses `Bun.CSRF` and `Bun.secrets` when available)  
**Fallback**: Compatible with Bun 1.2+ (uses custom implementations)

**See Also**: 
- [BUN-1.3-FEATURES.md](./BUN-1.3-FEATURES.md) for Bun 1.3 feature details
- [4.3.0.0.0.0.0 Operational Dashboard Benefits](./4.0.0.0.0.0.0-MCP-ALERTING.md#43000000-operational-dashboard-benefits-for-snapshot-testing) for dashboard integration context

### Key Components

- **Cookie Management**: Secure cookie handling using Bun's native APIs
- **Session Management**: HttpOnly, Secure, SameSite session tokens
- **CSRF Protection**: Token-based CSRF protection
- **UI Preferences**: Persistent user preferences via cookies
- **Security Policies**: Strict security enforcement for all cookies

---

## 10.1.0.0.0.0.0: Cookie Management with Bun's Native APIs

This section details Hyper-Bun's strategy for utilizing `Bun.CookieMap` and `Bun.Cookie` to securely manage user sessions, authentication tokens, and UI preferences across its various frontend applications.

---

### 10.1.1.0.0.0.0: Strategic Use of `Bun.CookieMap`

`Bun.CookieMap` will be extensively used within Hyper-Bun's `Bun.serve()` handlers for efficient and secure management of incoming and outgoing HTTP cookies.

#### 10.1.1.1.0.0.0: Session Token Management

**Application**: Storing secure, HttpOnly, and SameSite=Strict session tokens (e.g., JWTs or opaque session IDs) for authenticated users accessing the dashboard (`http://localhost:8080`) or the main API (`http://localhost:3001`). This token is crucial for authorization against backend APIs.

**Implementation**: On successful login (`POST /api/auth/login`), the `AuthService` will generate a session token and use `req.cookies.set()` to securely attach it to the response.

```typescript
// 10.1.1.1.0.0.0 Example: Setting a secure session cookie
// src/services/auth-service.ts (snippet in login handler)

import { Cookie } from 'bun'; // Import Bun.Cookie type if using explicit instances

class AuthService {
  async handleLogin(request: Request, cookies: Bun.CookieMap): Promise<Response> {
    // ... (authenticate user, generate session_token)
    
    const sessionToken = await this.generateSessionToken(userId);
    
    cookies.set({
      name: "session_token",
      value: sessionToken,
      httpOnly: true,     // Critical: Prevents JavaScript access
      secure: request.url.startsWith('https://'), // Critical: Only send over HTTPS
      sameSite: "strict", // Critical: Prevents CSRF attacks
      path: "/",          // Available across the entire domain
      maxAge: 3600 * 24,  // 1 day expiration
    });
    
    return new Response("Login successful", { status: 200 });
  }
  
  private async generateSessionToken(userId: string): Promise<string> {
    // Generate JWT or opaque session ID
    // Use Bun.secrets for signing key
    return "generated_jwt_or_opaque_id";
  }
}
```

**Verification**: The presence, HttpOnly, Secure, and SameSite attributes of the `session_token` cookie will be verified after login (using browser DevTools and automated E2E tests).

**Ripgrep**: `rg "10\.1\.1\.1\.0\.0\.0|session_token|handleLogin" src/services/`

---

#### 10.1.1.2.0.0.0: UI Preferences & State Management

**Application**: Storing non-sensitive UI preferences (e.g., preferred `market_exposure_level` filter, `chart_zoom_level`, `telegram_tma_last_view`) for persistent user experience without requiring database calls for every preference.

**Implementation**: `req.cookies.set("ui_theme", "dark")` or `req.cookies.set("market_filter", "displayed_only")`. These would typically be `SameSite: "lax"` and `httpOnly: false` to allow client-side JavaScript access.

```typescript
// 10.1.1.2.0.0.0 Example: Setting UI preference cookies
// src/api/ui-preferences.ts

export function setUIPreference(
  cookies: Bun.CookieMap,
  preferenceName: string,
  preferenceValue: string
): void {
  cookies.set({
    name: `ui_${preferenceName}`,
    value: preferenceValue,
    httpOnly: false,    // Allow client-side access
    secure: true,       // Still secure in production
    sameSite: "lax",    // Less strict for UI preferences
    path: "/",
    maxAge: 3600 * 24 * 30, // 30 days
  });
}

// Usage examples:
// setUIPreference(cookies, "theme", "dark");
// setUIPreference(cookies, "market_filter", "displayed_only");
// setUIPreference(cookies, "chart_zoom_level", "1.5");
```

**Cross-Reference**: These preferences could influence the initial state of the `HyperBunUIContext` (`6.1.1.2.2.1.2.0`) injected via `HTMLRewriter`.

**Ripgrep**: `rg "10\.1\.1\.2\.0\.0\.0|ui_preference|setUIPreference" src/api/`

---

#### 10.1.1.3.0.0.0: CSRF Protection Tokens

**Application**: Generating and validating CSRF (Cross-Site Request Forgery) tokens. A token is set in an HttpOnly cookie and also included in a hidden form field or request header. On subsequent requests, `Bun.CookieMap` is used to retrieve the cookie value for comparison.

**Implementation**: Uses `Bun.CSRF` when available (Bun 1.3+), falls back to custom implementation.

**Bun 1.3+**:
```typescript
import { CSRF } from "bun";
const token = CSRF.generate({ secret, encoding: "hex", expiresIn: 3600000 });
const isValid = CSRF.verify(token, { secret });
```

**Fallback** (Bun < 1.3): `cookies.set("csrf_token", generatedToken, { httpOnly: true, secure: true, sameSite: "strict" })`.

```typescript
// 10.1.1.3.0.0.0 Example: CSRF token generation and validation
// src/services/csrf-service.ts

import { randomBytes } from 'crypto';

export class CSRFService {
  /**
   * Generate and set CSRF token cookie
   */
  static generateToken(cookies: Bun.CookieMap): string {
    const token = randomBytes(32).toString('hex');
    
    cookies.set({
      name: "csrf_token",
      value: token,
      httpOnly: true,
      secure: true,
      sameSite: "strict",
      path: "/",
      maxAge: 3600, // 1 hour
    });
    
    return token;
  }
  
  /**
   * Validate CSRF token from request header against cookie
   */
  static validateToken(
    cookies: Bun.CookieMap,
    headerToken: string | null
  ): boolean {
    const cookieToken = cookies.get("csrf_token");
    
    if (!cookieToken || !headerToken) {
      return false;
    }
    
    return cookieToken.value === headerToken;
  }
}

// Usage in API handler:
// const csrfToken = CSRFService.generateToken(req.cookies);
// return new Response(JSON.stringify({ csrf_token: csrfToken }), {
//   headers: { 'Content-Type': 'application/json' }
// });

// In subsequent POST request:
// const isValid = CSRFService.validateToken(
//   req.cookies,
//   req.headers.get('X-CSRF-Token')
// );
```

**Ripgrep**: `rg "10\.1\.1\.3\.0\.0\.0|csrf_token|CSRFService" src/services/`

---

#### 10.1.1.4.0.0.0: `req.cookies` as `Bun.CookieMap`

**Benefit**: Bun's native integration automatically exposes `req.cookies` as a `Bun.CookieMap` instance. Any `set` or `delete` operations on this instance are automatically translated into `Set-Cookie` headers in the outgoing response.

**Impact**: Simplifies server-side cookie logic and reduces manual header management, enhancing developer productivity.

```typescript
// 10.1.1.4.0.0.0 Example: Automatic Set-Cookie header management
// src/api/handlers.ts

export default {
  async fetch(req: Request): Promise<Response> {
    // req.cookies is automatically a Bun.CookieMap instance
    const cookies = req.cookies;
    
    // Reading cookies
    const sessionToken = cookies.get("session_token");
    
    // Setting cookies (automatically adds Set-Cookie header)
    cookies.set({
      name: "last_visit",
      value: Date.now().toString(),
      httpOnly: false,
      maxAge: 3600 * 24 * 7, // 7 days
    });
    
    // Deleting cookies (automatically adds Set-Cookie with expires)
    cookies.delete("old_preference");
    
    // No manual header manipulation needed!
    return new Response("OK");
  }
};
```

**Ripgrep**: `rg "10\.1\.1\.4\.0\.0\.0|req\.cookies|Bun\.CookieMap" src/api/`

---

### 10.1.2.0.0.0.0: Granular Control with `Bun.Cookie`

While `Bun.CookieMap` handles collections, `Bun.Cookie` offers fine-grained control over individual cookie attributes, crucial for specific security and expiry policies.

#### 10.1.2.1.0.0.0: Explicit Attribute Definition

**Application**: Creating cookies with specific `expires`, `maxAge`, `domain`, `path`, `secure`, `httpOnly`, and `sameSite` settings that deviate from the defaults (e.g., a short-lived `login_challenge` cookie).

**Implementation**:

```typescript
// 10.1.2.1.0.0.0 Example: Custom cookie expiration and domain
// src/services/auth-service.ts

import { Cookie } from 'bun';

export class AuthService {
  createLoginChallenge(cookies: Bun.CookieMap): string {
    const challengeId = randomBytes(16).toString('hex');
    
    const loginChallengeCookie = new Cookie("login_challenge", challengeId, {
      maxAge: 300, // Expires in 5 minutes
      secure: true,
      httpOnly: true,
      domain: "api.hyperbun.com", // Restrict to API subdomain
      path: "/auth" // Restrict to auth path
    });
    
    cookies.set(loginChallengeCookie); // Add to map
    
    return challengeId;
  }
  
  validateLoginChallenge(
    cookies: Bun.CookieMap,
    submittedChallenge: string
  ): boolean {
    const cookie = cookies.get("login_challenge");
    
    if (!cookie) {
      return false;
    }
    
    // Check expiration
    if (cookie.isExpired()) {
      cookies.delete("login_challenge");
      return false;
    }
    
    return cookie.value === submittedChallenge;
  }
}
```

**Verification**: Automated tests will check `cookie.serialize()` output to ensure all attributes are correctly represented in the `Set-Cookie` header.

**Ripgrep**: `rg "10\.1\.2\.1\.0\.0\.0|new Cookie|login_challenge" src/services/`

---

#### 10.1.2.2.0.0.0: Parsing Incoming Cookie Headers

**Application**: Manually parsing `Cookie` headers in non-Bun HTTP environments (if Hyper-Bun interacts with them) or for custom cookie validation logic not covered by `CookieMap`'s automatic parsing.

**Implementation**: `const parsed = Bun.Cookie.parse("name=value; Path=/");`

```typescript
// 10.1.2.2.0.0.0 Example: Manual cookie parsing
// src/utils/cookie-parser.ts

import { Cookie } from 'bun';

export class CookieParser {
  /**
   * Parse a raw Cookie header string
   */
  static parseCookieHeader(headerValue: string): Map<string, Cookie> {
    const cookies = new Map<string, Cookie>();
    const pairs = headerValue.split(';');
    
    for (const pair of pairs) {
      const trimmed = pair.trim();
      if (!trimmed) continue;
      
      try {
        const cookie = Cookie.parse(trimmed);
        if (cookie) {
          cookies.set(cookie.name, cookie);
        }
      } catch (error) {
        console.warn(`Failed to parse cookie: ${trimmed}`, error);
      }
    }
    
    return cookies;
  }
  
  /**
   * Validate cookie attributes manually
   */
  static validateCookie(cookie: Cookie, expectedDomain?: string): boolean {
    if (cookie.isExpired()) {
      return false;
    }
    
    if (expectedDomain && cookie.domain !== expectedDomain) {
      return false;
    }
    
    return true;
  }
}
```

**Ripgrep**: `rg "10\.1\.2\.2\.0\.0\.0|Cookie\.parse|parseCookieHeader" src/utils/`

---

#### 10.1.2.3.0.0.0: `isExpired()` Checks

**Application**: For custom session management or token refresh logic, `isExpired()` provides a convenient way to check a token's validity without complex date comparisons.

```typescript
// 10.1.2.3.0.0.0 Example: Using isExpired() for session validation
// src/services/session-service.ts

import { Cookie } from 'bun';

export class SessionService {
  /**
   * Check if session token is valid and not expired
   */
  validateSession(cookies: Bun.CookieMap): boolean {
    const sessionCookie = cookies.get("session_token");
    
    if (!sessionCookie) {
      return false;
    }
    
    // Use Bun.Cookie's built-in expiration check
    if (sessionCookie.isExpired()) {
      // Clean up expired cookie
      cookies.delete("session_token");
      return false;
    }
    
    return true;
  }
  
  /**
   * Refresh session token if close to expiration
   */
  async refreshSessionIfNeeded(
    cookies: Bun.CookieMap,
    userId: string
  ): Promise<boolean> {
    const sessionCookie = cookies.get("session_token");
    
    if (!sessionCookie) {
      return false;
    }
    
    // Check if cookie is close to expiration (within 1 hour)
    // Note: This requires checking maxAge or expires if available
    // For now, we'll use a simple refresh strategy
    
    const newToken = await this.generateSessionToken(userId);
    
    cookies.set({
      name: "session_token",
      value: newToken,
      httpOnly: true,
      secure: true,
      sameSite: "strict",
      path: "/",
      maxAge: 3600 * 24, // Refresh to full 24 hours
    });
    
    return true;
  }
  
  private async generateSessionToken(userId: string): Promise<string> {
    // Implementation using Bun.secrets
    return "new_session_token";
  }
}
```

**Ripgrep**: `rg "10\.1\.2\.3\.0\.0\.0|isExpired|validateSession" src/services/`

---

### 10.1.3.0.0.0.0: Security Policies for Cookie Management

Hyper-Bun's cookie management strictly adheres to security best practices to protect sensitive user and system data.

#### 10.1.3.1.0.0.0: Mandatory `HttpOnly` for Session Tokens

All cookies containing authentication or session-critical data **SHALL** be set with `httpOnly: true` to prevent client-side JavaScript access, mitigating XSS attacks.

**Enforcement**: TypeScript types and runtime validation ensure this policy.

```typescript
// 10.1.3.1.0.0.0 Example: Enforced HttpOnly for session cookies
// src/types/cookie-policy.ts

export interface SecureCookieOptions {
  name: string;
  value: string;
  httpOnly: true; // Enforced: Cannot be false for secure cookies
  secure: boolean;
  sameSite: "strict" | "lax" | "none";
  path?: string;
  maxAge?: number;
  expires?: Date;
  domain?: string;
}

export function setSecureCookie(
  cookies: Bun.CookieMap,
  options: SecureCookieOptions
): void {
  // TypeScript enforces httpOnly: true
  cookies.set(options);
}
```

**Ripgrep**: `rg "10\.1\.3\.1\.0\.0\.0|httpOnly.*true|SecureCookieOptions" src/types/`

---

#### 10.1.3.2.0.0.0: Mandatory `Secure` in Production

All cookies transmitted over HTTPS **SHALL** be set with `secure: true` to prevent interception over unencrypted HTTP.

**Implementation**: Automatic detection of HTTPS and enforcement in production.

```typescript
// 10.1.3.2.0.0.0 Example: Automatic secure flag in production
// src/utils/cookie-security.ts

export function getSecureFlag(request: Request): boolean {
  // In production, always require HTTPS
  if (process.env.NODE_ENV === 'production') {
    return request.url.startsWith('https://');
  }
  
  // In development, allow HTTP for localhost
  return request.url.startsWith('https://');
}

export function setSecureCookieWithAutoFlag(
  cookies: Bun.CookieMap,
  name: string,
  value: string,
  options: Omit<Bun.CookieOptions, 'secure'>
): void {
  cookies.set({
    ...options,
    name,
    value,
    secure: getSecureFlag(new Request(cookies as any)), // Auto-detect
  });
}
```

**Ripgrep**: `rg "10\.1\.3\.2\.0\.0\.0|secure.*true|getSecureFlag" src/utils/`

---

#### 10.1.3.3.0.0.0: Strict `SameSite` Enforcement

`SameSite: "strict"` will be the default for critical cookies (e.g., session tokens) to prevent CSRF. `SameSite: "lax"` may be used for less critical UI preferences.

**Policy**:
- **Session tokens**: `sameSite: "strict"`
- **CSRF tokens**: `sameSite: "strict"`
- **UI preferences**: `sameSite: "lax"` (allows cross-site navigation)

```typescript
// 10.1.3.3.0.0.0 Example: SameSite policy enforcement
// src/utils/cookie-policy.ts

export const COOKIE_POLICIES = {
  SESSION: {
    sameSite: "strict" as const,
    httpOnly: true,
    secure: true,
  },
  CSRF: {
    sameSite: "strict" as const,
    httpOnly: true,
    secure: true,
  },
  UI_PREFERENCE: {
    sameSite: "lax" as const,
    httpOnly: false,
    secure: true,
  },
} as const;
```

**Ripgrep**: `rg "10\.1\.3\.3\.0\.0\.0|sameSite.*strict|COOKIE_POLICIES" src/utils/`

---

#### 10.1.3.4.0.0.0: `maxAge`/`expires` Best Practices

Session tokens will have appropriate expiration times, enforced by `maxAge` or `expires`, with proper rotation mechanisms.

**Policies**:
- **Session tokens**: 24 hours (`maxAge: 3600 * 24`)
- **CSRF tokens**: 1 hour (`maxAge: 3600`)
- **UI preferences**: 30 days (`maxAge: 3600 * 24 * 30`)
- **Login challenges**: 5 minutes (`maxAge: 300`)

```typescript
// 10.1.3.4.0.0.0 Example: Cookie expiration constants
// src/constants/cookie-expiration.ts

export const COOKIE_EXPIRATION = {
  SESSION: 3600 * 24,           // 24 hours
  CSRF_TOKEN: 3600,              // 1 hour
  UI_PREFERENCE: 3600 * 24 * 30, // 30 days
  LOGIN_CHALLENGE: 300,          // 5 minutes
} as const;
```

**Ripgrep**: `rg "10\.1\.3\.4\.0\.0\.0|COOKIE_EXPIRATION|maxAge" src/constants/`

---

#### 10.1.3.5.0.0.0: `Bun.secrets` for Cookie Signing Keys

Any server-side secrets used for signing session tokens (e.g., JWT secrets) or encrypting cookie values **SHALL** be managed via `Bun.secrets` (Bun 1.3+) or `Bun.env` as fallback (Cross-reference: `9.1.1.1.1.1.0`).

**Bun 1.3+**:
```typescript
import { secrets } from "bun";
await secrets.set({ service: "hyper-bun", name: "session-secret", value: "secret-value" });
const secret = await secrets.get({ service: "hyper-bun", name: "session-secret" });
```

**Fallback** (Bun < 1.3): `Bun.env.SESSION_SECRET`

```typescript
// 10.1.3.5.0.0.0 Example: Using Bun.secrets for cookie signing
// src/services/session-service.ts

export class SessionService {
  /**
   * Generate signed session token using Bun.secrets
   */
  async generateSignedSessionToken(userId: string): Promise<string> {
    // Access secret from Bun.secrets
    const secret = Bun.env.SESSION_SECRET || Bun.secrets?.SESSION_SECRET;
    
    if (!secret) {
      throw new Error("SESSION_SECRET not configured");
    }
    
    // Use secret to sign JWT or generate opaque token
    // Implementation depends on your JWT library
    return this.signToken(userId, secret);
  }
  
  private signToken(userId: string, secret: string): string {
    // JWT signing implementation
    return `signed_token_for_${userId}`;
  }
}
```

**Cross-Reference**: See `9.1.1.1.1.1.0` for Bun.secrets management.

**Ripgrep**: `rg "10\.1\.3\.5\.0\.0\.0|Bun\.secrets|SESSION_SECRET" src/services/`

---

## 10.2.0.0.0.0.0: Strategic Impact & Benefits of Bun-Native Cookie Management

### 10.2.1.0.0.0.0: Enhanced Security

`HttpOnly`, `Secure`, and `SameSite` defaults, combined with `Bun.secrets` for signing, provide a robust defense against common web vulnerabilities (XSS, CSRF, session hijacking).

#### 10.2.1.1.0.0.0: Test Formula (Session Cookie Security)

**Test Steps**:
1. Log in to dashboard (`POST /api/auth/login`).
2. Open browser DevTools, inspect "Application -> Cookies".
3. Try to access `document.cookie` in console.

**Verification Points**:
- Cookie is present in DevTools
- Cookie attributes are visible (HttpOnly, Secure, SameSite)
- JavaScript cannot access the cookie

#### 10.2.1.2.0.0.0: Expected Result

`session_token` cookie is present but marked `HttpOnly`, `Secure`, and `SameSite=Strict`. `document.cookie` does NOT show `session_token`.

**Automated Test**:
```typescript
// test/auth/cookie-security.test.ts
test("10.2.1.1.0.0.0: Session cookie security", async () => {
  const response = await fetch("http://localhost:3001/api/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: "test", password: "test" }),
  });
  
  const setCookieHeader = response.headers.get("Set-Cookie");
  expect(setCookieHeader).toContain("HttpOnly");
  expect(setCookieHeader).toContain("SameSite=Strict");
  expect(setCookieHeader).toContain("session_token");
});
```

**Ripgrep**: `rg "10\.2\.1\.[12]\.0\.0\.0|session.*cookie.*security" docs/`

---

### 10.2.2.0.0.0.0: Simplified Development & Maintenance

Bun's `CookieMap` automatically manages `Set-Cookie` headers, significantly reducing boilerplate and potential errors for developers.

**Impact**: Developers no longer need to manually construct `Set-Cookie` header strings or manage header arrays.

---

### 10.2.3.0.0.0.0: Consistent User Experience

Reliable storage of UI preferences ensures a consistent and personalized experience across sessions and different Hyper-Bun interfaces.

**Benefits**:
- User preferences persist across browser sessions
- No database queries needed for UI state
- Faster page loads with cached preferences

---

### 10.2.4.0.0.0.0: Optimized Performance

Leveraging Bun's native, highly optimized cookie APIs ensures minimal overhead for session management operations, which are frequent in any authenticated web application.

**Performance Characteristics**:
- Native C++ implementation for cookie parsing
- Zero-copy cookie value access
- Efficient header serialization

---

### 10.2.5.0.0.0.0: `ripgrep` Discoverability

The clear naming conventions and structured documentation of cookie usage ensure that relevant code and policies are easily found.

**`ripgrep` Commands**:

```bash
# Find all session token management code
rg "10\.1\.1\.1\.0\.0\.0|session_token|Bun\.CookieMap|Bun\.Cookie" --iglob "*.{ts,md}"

# Find cookie security policies
rg "10\.1\.3\.[0-9]\.0\.0\.0|httpOnly|secure.*true|sameSite" src/

# Find UI preference cookie usage
rg "10\.1\.1\.2\.0\.0\.0|ui_preference|setUIPreference" src/

# Find CSRF token implementation
rg "10\.1\.1\.3\.0\.0\.0|csrf_token|CSRFService" src/

# Find cookie expiration constants
rg "10\.1\.3\.4\.0\.0\.0|COOKIE_EXPIRATION|maxAge" src/constants/
```

**Expected Outcome**: All instances of session token management, `Bun.CookieMap` usage, cookie security policies, and related documentation sections are quickly located.

**Integration with Operational Dashboard**:
- Cookie management integrates seamlessly with the operational dashboard (`17.0.0.0.0.0.0-dashboard`)
- Session tokens enable secure access to dashboard endpoints
- UI preferences stored in cookies enhance dashboard user experience
- CSRF protection secures dashboard form submissions

---

## Cross-References

### Related Subsystems
- **9.1.1.1.1.1.0**: Bun.secrets management for cookie signing keys
- **6.1.1.2.2.1.2.0**: HyperBunUIContext for UI preference integration
- **4.0.0.0.0.0.0**: MCP & Alerting Subsystem (dashboard integration)
- **4.3.0.0.0.0.0**: Operational Dashboard Benefits for Snapshot Testing (dashboard context)
- **9.1.1.11.0.0.0**: Telegram Mini App (TMA) for cookie usage in TMA
- **17.0.0.0.0.0.0**: Dashboard Subsystem (primary consumer of cookie-based sessions)

### Integration Points
- **Dashboard Authentication**: Session tokens enable secure access to dashboard endpoints (`17.2.0.0.0.0.0-api`)
- **UI State Persistence**: Cookie-based preferences enhance dashboard user experience (`17.3.0.0.0.0.0-ui`)
- **Real-Time WebSocket**: Session validation for WebSocket connections (`17.9.0.0.0.0.0-realtime`)

---

## Related Documentation

- [Bun Cookie API Documentation](https://bun.sh/docs/api/cookies)
- [OWASP Cookie Security Guide](https://owasp.org/www-community/HttpOnly)
- [MDN Set-Cookie Documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie)

---

**Status**: ✅ Implemented  
**Implementation Files**:
- `src/services/auth-service.ts` - Authentication service
- `src/services/session-service.ts` - Session management
- `src/services/csrf-service.ts` - CSRF protection
- `src/api/ui-preferences.ts` - UI preference management
- `src/utils/cookie-policy.ts` - Security policies
- `src/types/cookie-policy.ts` - Type definitions
- `src/constants/cookie-expiration.ts` - Expiration constants
- `src/api/auth-handler.ts` - Example API handler
- `test/auth/cookie-security.test.ts` - Security tests

**See Also**: 
- [Implementation Guide](./10.1-IMPLEMENTATION-GUIDE.md)
- [Middleware Guide](./10.2-MIDDLEWARE-GUIDE.md) - Middleware composition for clean code

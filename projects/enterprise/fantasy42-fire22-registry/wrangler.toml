name = "fantasy42-fire22-edge"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Workers configuration for edge-native deployment
[[build]]
command = "bun run build"
cwd = "."
watch_dir = "functions"

# Environment bindings
[vars]
NODE_ENV = "production"
PLAYBOOK_COMPLIANT = "true"
EDGE_DEPLOYED = "true"

# KV namespace for caching
[[kv_namespaces]]
binding = "CACHE"
id = "fantasy42_cache"
preview_id = "fantasy42_cache_preview"

# D1 database for edge data
[[d1_databases]]
binding = "DB"
database_name = "fantasy42_edge"
database_id = "fantasy42_edge_db"

# Pages configuration
[pages]
# Build configuration
[build]
command = "bun run build"
cwd = "."
output_dir = "dist"

GITHUB_REPO = "nolarose1968-pixel/crystal-clear-architecture"
GITHUB_BRANCH = "main"
CF_PAGES = "1"
COMPLIANCE_LEVEL = "enterprise"
PLAYBOOK_VERSION = "1.0"

# Routes for API endpoints
[[pages_build_config]]
# Build command for the documentation site
build_command = "bun run build:docs"
destination_dir = "docs"

# Custom domain configuration
[[pages_build_config.custom_domain]]
domain = "docs.apexodds.com"
zone_name = "apexodds.com"

# Functions configuration
[pages_build_config.functions]
directory = "functions"

# Analytics and monitoring
[[analytics_engine_datasets]]
binding = "page_analytics"
dataset = "crystal_clear_analytics"

# Rate limiting for API endpoints
# [rate_limiting]
# burst = 100
# period = 60

# CORS configuration
[cors]
origins = ["*"]
methods = ["GET", "HEAD", "OPTIONS", "POST"]
headers = ["*"]
allow_credentials = false
max_age = 86400

# Security headers
[security]
# Content Security Policy
content_security_policy = "default-src 'self'; script-src 'self' 'unsafe-inline' https://*.githubusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.github.com;"

# Development settings
[dev]
port = 8788
local_protocol = "https"

# Custom headers for all responses
[[headers]]
source = "/**"
[headers.headers]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=()"

# Cache headers for static assets
[[headers]]
source = "/static/**"
[headers.headers]
Cache-Control = "public, max-age=31536000, immutable"
ETag = "true"

# Cache headers for docs
[[headers]]
source = "/docs/**"
[headers.headers]
Cache-Control = "public, max-age=3600, stale-while-revalidate=86400"
ETag = "true"

# API headers
[[headers]]
source = "/api/**"
[headers.headers]
Cache-Control = "no-cache, no-store, must-revalidate"
Pragma = "no-cache"
Expires = "0"
X-API-Version = "v1"

# Cache headers for images and media
[[headers]]
source = "/**/*.jpg"
[headers.headers]
Cache-Control = "public, max-age=86400, stale-while-revalidate=604800"
ETag = "true"

# Cache headers for CSS and JS
[[headers]]
source = "/**/*.css"
[headers.headers]
Cache-Control = "public, max-age=86400, stale-while-revalidate=604800"
ETag = "true"

[[headers]]
source = "/**/*.js"
[headers.headers]
Cache-Control = "public, max-age=86400, stale-while-revalidate=604800"
ETag = "true"

# Security headers for all routes
[[headers]]
source = "/**"
[headers.headers]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=()"
X-XSS-Protection = "1; mode=block"

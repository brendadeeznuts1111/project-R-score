name = "fantasy42-fire22-registry"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Environment configurations
[env.development]
name = "fantasy42-fire22-dev"
account_id = "5e5d2b2fa037e9924a50619c08f9f442"
routes = [
  { pattern = "dev.apexodds.com", zone_name = "apexodds.com" }
]

# Development environment resources
[[env.development.d1_databases]]
binding = "REGISTRY_DB"
database_name = "fantasy42-registry"
database_id = "a436fa06-0f91-4aa6-98d8-812663267f2d"

[[env.development.kv_namespaces]]
binding = "CACHE"
id = "340b2014eb2747a1b9c667f6c7370c70"

[[env.development.r2_buckets]]
binding = "PACKAGES"
bucket_name = "fantasy42-packages"

[[env.development.queues.producers]]
queue = "registry-events"
binding = "REGISTRY_QUEUE"

[env.staging]
name = "fantasy42-fire22-staging"
account_id = "5e5d2b2fa037e9924a50619c08f9f442"
routes = [
  { pattern = "staging.apexodds.com", zone_name = "apexodds.com" }
]

# Staging environment resources
[[env.staging.d1_databases]]
binding = "REGISTRY_DB"
database_name = "fantasy42-registry-staging"
database_id = "${STAGING_REGISTRY_DB_ID}"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "${STAGING_CACHE_KV_ID}"

[[env.staging.r2_buckets]]
binding = "PACKAGES"
bucket_name = "fantasy42-packages-staging"

[[env.staging.queues.producers]]
queue = "registry-events-staging"
binding = "REGISTRY_QUEUE"

[[env.staging.queues.consumers]]
queue = "registry-events-staging"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "registry-events-staging-dlq"

[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "fantasy42-registry-analytics-staging"

[env.production]
name = "fantasy42-fire22-prod"
account_id = "5e5d2b2fa037e9924a50619c08f9f442"
routes = [
  { pattern = "api.apexodds.com", zone_name = "apexodds.com" },
  { pattern = "registry.apexodds.com", zone_name = "apexodds.com" }
]

# Production environment resources
[[env.production.d1_databases]]
binding = "REGISTRY_DB"
database_name = "fantasy42-registry-prod"
database_id = "${PROD_REGISTRY_DB_ID}"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "${PROD_CACHE_KV_ID}"

[[env.production.r2_buckets]]
binding = "PACKAGES"
bucket_name = "fantasy42-packages-prod"

[[env.production.queues.producers]]
queue = "registry-events-prod"
binding = "REGISTRY_QUEUE"

[[env.production.queues.consumers]]
queue = "registry-events-prod"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "registry-events-prod-dlq"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "fantasy42-registry-analytics-prod"

# Resources are now defined per environment above

# Rate limiting and security are handled in the worker code

# Development settings
[dev]
port = 8787
local_protocol = "https"
upstream_protocol = "https"

# Headers are configured in the worker code
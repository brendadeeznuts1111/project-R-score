## Brief overview
This project is a Bun-native TOML secrets editor with CLI enhancements, security scanning, and enterprise features. Development follows enterprise patterns with FFI integration, performance profiling, and governance systems.

## Technology Stack
- **Runtime**: Bun (>=1.0.0, currently v1.3.7)
- **Language**: TypeScript with strict mode enabled
- **FFI**: Native C integration via `bun:ffi` for performance-critical paths
- **Build**: Bun's native bundler with compile support, no Webpack/Vite
- **Testing**: Bun's built-in test runner
- **Configuration**: TOML for secrets, JSON5 for app settings

## Communication style
- Prefer concise, actionable responses over verbose explanations
- Show working code examples rather than theoretical descriptions
- Skip boilerplate commentary when the code speaks for itself
- Ask clarifying questions when requirements are ambiguous

## Code organization
- **Enterprise architecture**: `src/governance/`, `src/profiling/`, `src/cli/`, `src/security/`
- **Secrets**: `src/secrets/` for Bun.secrets API integration
- **CLI implementations**: `src/cli/` with specific CLIs (duoplus-cli, kimi-cli, matrix-cli)
- **Tests**: Place at project root with descriptive names: `test-ffi-{context}.ts`
- **Documentation**: `docs/` with version-specific guides (e.g., `FFI_V1.3.7_GUIDE.md`)
- **Configuration**: `config/` using TOML for secrets, JSON5 for app settings

## FFI development patterns
- Place C source files in predictable temp locations (`/tmp/`) for quick tests
- Use `bun:ffi` `cc()` for on-the-fly compilation during development
- Define symbols with explicit `returns` and `args` types - no inference
- Always test FFI calls immediately after definition to verify linkage
- Prefer `int` returns for simple status codes, structs for complex data

## Performance & profiling
- Integrate CPU and heap profiling as first-class concerns
- Use Bun's native profiling APIs (`Bun.FFI`, `Bun.writeFile` with profiling data)
- Auto-commit profiling results with structured naming: `CPU.{timestamp}.{pid}.md`

## Security patterns
- Secrets use Bun.secrets API for secure storage
- URLPattern validation for security scanning
- Header casing preservation for HTTP requests
- Input validation on all CLI arguments
- Audit logging via SQLite or JSONL files

## File naming conventions
- Use hyphens (`-`) not underscores (`_`) for multi-word filenames
- Prefix test files with `test-` and include context (e.g., `test-ffi-nix.ts`)
- Version-specific guides: `{FEATURE}_V{VERSION}_GUIDE.md`
- Use uppercase for critical documentation (e.g., `ENTERPRISE_REFACTORING_COMPLETE.md`)

## Development workflow
- Test native code in isolation before JS integration
- Use `bun -e` for quick inline experiments
- Prefer immediate execution over mock-based testing for FFI
- Document architecture decisions in dedicated markdown files
- Run `bun run typecheck` after changes to maintain type safety

## Root directory cleanliness
The root directory should only contain essential configuration and documentation files:

**Allowed in root:**
- `package.json`, `bun.lock` - Package configuration
- `tsconfig.json` - TypeScript configuration  
- `README.md`, `AGENTS.md` - Documentation
- `Makefile` - Build automation
- `.gitignore`, `.gitattributes` - Git configuration
- `.env.production`, `.secretsrc.json` - Environment/config
- `flake.nix`, `shell.nix` - Nix development environment
- `.observatory-policy.toml` - Observatory policy

**Should NOT be in root:**
- `*.cpuprofile` → Move to `profiles/`
- `*-export.json` → Move to `temp/` or delete
- `*.heapsnapshot`, `*.log` → Move to `logs/` or `temp/`
- `reorganize-codebase.sh` → Delete after use
- `.DS_Store` → Delete (auto-generated by macOS)

## Nix integration
- Maintain `flake.nix` and `shell.nix` for reproducible environments
- Support both Homebrew and Nix package managers for native dependencies
- Document platform-specific FFI setup in dedicated guides

## Build commands reference
```bash
# Development builds
bun run build:dev              # Development build with INTERACTIVE feature

# Production builds
bun run build                  # Community build
bun run build:premium          # Premium build with all features
bun run build:all              # All platforms

# Cross-platform builds
bun run build:linux            # Linux x64 & arm64
bun run build:darwin           # macOS x64 & arm64
bun run build:win32            # Windows x64
```

## Test commands reference
```bash
bun test                       # Run all tests
bun run test:watch             # Watch mode
bun run test:coverage          # With coverage
bun run test:unit              # Unit tests only
bun run test:integration       # Integration tests
```

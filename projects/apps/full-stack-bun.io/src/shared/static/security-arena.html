<!DOCTYPE html>
<html>
<head>
  <title>Security Arena Dashboard</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive Bun 1.3 Developer Experience Showcase â€“ Test concurrent execution, type checking, inline snapshots, and modern JavaScript features in real-time.">
  <meta name="theme-color" content="#161b22">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Mission Control">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Bun 1.3 Developer Experience Showcase">
  <meta property="og:description" content="Experience Bun 1.3's revolutionary testing and development features interactively">
  <meta property="og:image" content="/og-image.png">
  <meta property="og:url" content="https://full-stack-bun.io/security-arena">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Bun 1.3 DX Showcase">
  <meta name="twitter:description" content="Interactive playground for Bun 1.3's testing and development features">
  <meta name="twitter:image" content="/og-image.png">

  <!-- Favicon Chain -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Preload critical resources -->
  <link rel="preload" href="/arena-glass.css" as="style">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" as="script" crossorigin>

  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <!-- Security headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">

  <link rel="stylesheet" href="/arena-glass.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      font-display: optional;
      background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%);
      color: white;
      min-height: 100vh;
    }
    nav { background: rgba(0, 0, 0, 0.2); padding: 1rem; }
    nav a { color: #fbbf24; margin-right: 1rem; text-decoration: none; }
    h1 { text-align: center; margin: 1rem 0; }
    .glass { background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px; }
    canvas { border: 1px solid #f8d535; }
    pre { background: #0d1117; color: #fff; padding: 10px; overflow: auto; max-height: 300px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
    button { background: #58a6ff; color: #0d1117; padding: 10px; border: none; cursor: pointer; border-radius: 5px; }
    button:hover { background: #4c63d2; }
    .console { background: #161b22; height: 200px; overflow: auto; border-radius: 5px; padding: 10px; }
    .hidden { display: none; }
    .metric-card { background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 8px; text-align: center; }
    .metric-value { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem; }
    .metric-label { font-size: 0.8rem; opacity: 0.8; }

    /* Shell Lab Styles */
    .shell-info { margin-bottom: 1rem; }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; }
    .info-card { background: rgba(255, 255, 255, 0.1); padding: 0.75rem; border-radius: 6px; border-left: 3px solid #58a6ff; }
    .info-label { font-size: 0.8rem; opacity: 0.8; margin-bottom: 0.25rem; }
    .info-value { font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9rem; word-break: break-all; }
    .control-tabs { display: flex; border-bottom: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 1rem; }
    .tab-button { background: none; border: none; padding: 0.75rem 1.5rem; color: rgba(255, 255, 255, 0.7); cursor: pointer; border-bottom: 2px solid transparent; }
    .tab-button.active { color: white; border-bottom-color: #58a6ff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    #shell-editor { width: 100%; font-family: 'Monaco', 'Menlo', monospace; background: #1e1e1e; color: #d4d4d4; border: 1px solid #444; border-radius: 4px; padding: 0.5rem; margin-bottom: 1rem; }
    .script-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; align-items: end; }
    .command-input { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    #command-input { padding: 0.75rem; border: 1px solid #444; border-radius: 4px; background: #1e1e1e; color: white; }
    .quick-commands { margin-top: 1rem; }
    .quick-command-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; margin-top: 0.5rem; }
    .quick-cmd { background: rgba(88, 166, 255, 0.2); border: 1px solid #58a6ff; color: #58a6ff; padding: 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
    .quick-cmd:hover { background: rgba(88, 166, 255, 0.3); }
    .security-results { background: #1e1e1e; padding: 1rem; border-radius: 4px; min-height: 100px; }
    .output-stats { display: flex; gap: 1rem; font-size: 0.8rem; opacity: 0.8; }
    .output-tabs { display: flex; border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
    .output-tab { background: none; border: none; padding: 0.5rem 1rem; color: rgba(255, 255, 255, 0.7); cursor: pointer; border-bottom: 2px solid transparent; }
    .output-tab.active { color: white; border-bottom-color: #58a6ff; }
    .output-content { display: none; background: #1e1e1e; padding: 1rem; border-radius: 0 0 4px 4px; min-height: 200px; max-height: 400px; overflow: auto; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9rem; }
    .output-content.active { display: block; }
    .example-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-top: 1rem; }
    .example-card { background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 6px; border: 1px solid rgba(255, 255, 255, 0.1); }
    .example-card h4 { margin: 0 0 0.5rem 0; color: #58a6ff; }
    .example-card pre { margin: 0; background: #1e1e1e; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; }
  </style>
</head>
<body>
  <nav><a href="/">Home</a><a href="/api/executables">Executables</a></nav>
  <h1>Security Arena Dashboard</h1>
  <section id="odc-live" class="glass">
    <h2>Live ODC Metrics</h2>
    <div class="grid">
      <div class="metric-card glass-panel">
        <div class="metric-value">
          <span class="counter" id="cpu-usage" data-target="0">0</span>%
        </div>
        <div class="metric-label">CPU Usage</div>
      </div>
      <div class="metric-card glass-panel">
        <div class="metric-value">
          <span class="counter" id="memory-usage" data-target="0">0</span>MB
        </div>
        <div class="metric-label">Memory Usage</div>
      </div>
      <div class="metric-card glass-panel">
        <div class="metric-value">
          <span class="counter" id="log-count" data-target="0">0</span>
        </div>
        <div class="metric-label">Log Entries</div>
      </div>
    </div>
    <canvas id="odc-chart" width="600" height="200"></canvas>
    <pre id="odc-log">Waiting for dataâ€¦</pre>
    <script>
      // Animated counter function
      function animateCounter(el, target) {
        const obj = { val: parseInt(el.textContent) || 0 };
        gsap.to(obj, {
          val: target,
          duration: 0.6,
          ease: "power2.out",
          onUpdate: () => el.textContent = Math.round(obj.val)
        });
      }

      const logODC = (txt) => {
        const logEl = document.getElementById('odc-log');
        const newLine = document.createElement('div');
        newLine.className = 'typewriter-line';
        newLine.textContent = txt;
        logEl.appendChild(newLine);

        // Trigger typewriter animation
        setTimeout(() => {
          newLine.style.width = '100%';
        }, 10);

        logEl.scrollTop = logEl.scrollHeight;

        // Update log count with animation
        const logCount = logEl.children.length;
        const logCounter = document.getElementById('log-count');
        animateCounter(logCounter, logCount);
        logCounter.dataset.target = logCount;
      };
      const ctx = document.getElementById('odc-chart').getContext('2d');
      const points = [];
      const ws = new WebSocket(`ws://${location.host}/ws/odc`);
      ws.onmessage = (e) => {
        const pkt = JSON.parse(e.data);
        if (pkt.agentId) {
          if (pkt.cpu !== undefined) {
            const cpuEl = document.getElementById('cpu-usage');
            animateCounter(cpuEl, pkt.cpu);
            cpuEl.dataset.target = pkt.cpu;
          }
          if (pkt.memory !== undefined) {
            const memEl = document.getElementById('memory-usage');
            animateCounter(memEl, pkt.memory);
            memEl.dataset.target = pkt.memory;
          }
          points.push({ t: Date.now(), v: pkt.cpu ?? pkt.memory ?? 0 });
          if (points.length > 60) points.shift();
          draw();
          logODC(JSON.stringify(pkt, null, 2));
        }
      };
      function draw() {
        ctx.clearRect(0, 0, 600, 200);
        ctx.strokeStyle = "#f8d535";
        ctx.beginPath();
        points.forEach((p, i) => ctx.lineTo(i * 10, 200 - p.v * 2));
        ctx.stroke();
      }
    </script>
  </section>
  <section id="bundler-fixes-lab" class="glass">
    <h2>51. Bundler Fixes Regression Lab â€“ Macros, Parser, TLA, Minify, Source-maps</h2>
    <div class="console" id="bundler-fixes-lab-log">Click Run Suite to validate fixesâ€¦</div>
    <div class="grid">
      <button id="run-suite" type="button">Run Full Suite</button>
      <button id="macro-nested" type="button">Macro Nested Objects</button>
      <button id="tla-cycle" type="button">Top-Level Await Cycles</button>
      <button id="jsx-ns" type="button">JSX Namespaced Attributes</button>
      <button id="sourcemap" type="button">Source-map Generation</button>
      <button id="scan-security" type="button">ğŸ” Security Scan</button>
    </div>
    <details>
      <summary>ğŸ“‹ Cheat-sheet (copy/paste)</summary>
      <pre><code class="lang-js">
        // 1. Nested macro with numeric keys (used to crash)
        export macro deep() { return { 0: { 1: { 2: "works" } } }; } with { type: "macro" };
        // 2. TLA cyclic imports (used to hang)
        // entry-a.ts â†’ entry-b.ts â†’ entry-a.ts (with TLA)
        // 3. JSX namespaced attr with number
        <MyComponent ns:attr2="value" />
        // 4. Source-maps actually generated
        await Bun.build({ entrypoints: ["./app.ts"], sourcemap: true });
        // 5. Invalid shell syntax (used to crash)
        bun build --compile ./app.ts --outfile $(echo "foo bar")
      </code></pre>
    </details>
    <script>
      const logBundlerFixes = (txt) => {
        const consoleDiv = document.getElementById('bundler-fixes-lab-log');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };
      async function runTest(code, entry = "index.ts", testType = "unknown") {
        const res = await fetch('/api/run-test', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, entry, testType })
        });

        const result = await res.json();

        // Get baseline comparison if successful
        if (result.duration && result.ok) {
          try {
            const baselineRes = await fetch('/api/baselines/comparison', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ testType, currentDuration: result.duration })
            });

            const comparison = await baselineRes.json();
            result.baselineDelta = comparison.delta;
            result.baselineMessage = comparison.message;
          } catch (baselineError) {
            console.warn('Baseline comparison failed:', baselineError);
          }
        }

        return result;
      }
      async function runSecurityScan(code, entry = "lab.ts") {
        const res = await fetch('/api/security-scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, entry })
        });
        return await res.json();
      }
      const tests = {
        "macro-nested": async () => {
          const code = `import { deep } from "./macro.ts" with { type: "macro" }; console.log(deep());`;
          const { ok, err, duration, baselineMessage } = await runTest(code, "index.ts", "macro-nested");
          const baselineInfo = baselineMessage ? ` (${baselineMessage})` : '';
          logBundlerFixes(ok ? `âœ… Macro nested numeric keys â€“ PASS${baselineInfo}` : `âŒ FAIL: ${err}`);
        },
        "tla-cycle": async () => {
          const code = `export * from "./a.ts";`;
          const { ok, err, duration, baselineMessage } = await runTest(code, "entry.ts", "tla-cycle");
          const baselineInfo = baselineMessage ? ` (${baselineMessage})` : '';
          logBundlerFixes(ok ? `âœ… TLA cyclic imports â€“ PASS${baselineInfo}` : `âŒ FAIL: ${err}`);
        },
        "jsx-ns": async () => {
          const jsx = `const el = <ns:my2attr>value</ns:my2attr>; export default el;`;
          const { ok, err, duration, baselineMessage } = await runTest(jsx, "app.jsx", "jsx-ns");
          const baselineInfo = baselineMessage ? ` (${baselineMessage})` : '';
          logBundlerFixes(ok ? `âœ… JSX namespaced attr with number â€“ PASS${baselineInfo}` : `âŒ FAIL: ${err}`);
        },
        "sourcemap": async () => {
          const { ok, err, duration, baselineMessage } = await runTest(`console.log("test");`, "app.ts", "sourcemap");
          const hasMap = await fetch("/lab-out/app.ts.map").then(r => r.ok);
          const baselineInfo = baselineMessage ? ` (${baselineMessage})` : '';
          logBundlerFixes(hasMap ? `âœ… Source-map actually generated â€“ PASS${baselineInfo}` : "âŒ Source-map missing");
        },
        "scan-security": async () => {
          const code = `eval("oops")`;
          const { vulnerabilities, err } = await runSecurityScan(code, "lab.ts");
          logBundlerFixes(vulnerabilities?.length ? `âš ï¸ ${vulnerabilities.length} vulnerabilities found` : err ? `âŒ Scan failed: ${err}` : "âœ… Clean");
        }
      };
      document.getElementById("run-suite").onclick = async () => {
        logBundlerFixes("ğŸ§ª Running regression suiteâ€¦");
        for (const [name, fn] of Object.entries(tests)) await fn();
        logBundlerFixes("âœ… Suite complete â€“ all fixes validated");
      };
      for (const [name, fn] of Object.entries(tests)) {
        document.getElementById(name).onclick = fn;
      }
    </script>
  </section>
  <section id="shell-lab" class="glass">
    <h2>ğŸš Advanced Shell Lab â€“ Bun 1.3 Shell Enhancements</h2>

    <div class="shell-info">
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Bun Path</div>
          <div class="info-value" id="bunPath">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Global Bin Dir</div>
          <div class="info-value" id="globalBinDir">-</div>
        </div>
        <div class="info-card">
          <div class="info-label">Available Commands</div>
          <div class="info-value" id="availableCommands">-</div>
        </div>
      </div>
    </div>

    <div class="shell-controls">
      <div class="control-tabs">
        <button class="tab-button active" data-tab="script" type="button">Script Runner</button>
        <button class="tab-button" data-tab="command" type="button">Command Runner</button>
        <button class="tab-button" data-tab="security" type="button">Security Scan</button>
      </div>

      <div class="tab-content active" id="script-tab">
        <textarea id="shell-editor" rows="8" placeholder="#!/usr/bin/env bun
echo &quot;Hello from Bun Shell!&quot;
echo &quot;Current directory: $(pwd)&quot;
echo &quot;Bun version: $(bun --version)&quot;

# Test environment
echo &quot;PATH: $PATH&quot;
echo &quot;Node version: $(node --version)&quot;

# Safe operations
ls -la
find . -name &quot;*.ts&quot; | head -5"></textarea>

        <div class="script-controls">
          <label>Script Name: <input id="script-name" value="demo.sh"></label>
          <label>Working Directory: <input id="script-cwd" placeholder="./"></label>
          <label>Timeout (ms): <input id="script-timeout" type="number" value="30000"></label>
          <button class="btn btn-primary" onclick="runShellScript()" type="button">Run Script</button>
          <button class="btn btn-secondary" onclick="scanShellScript()" type="button">Security Scan</button>
        </div>
      </div>

      <div class="tab-content" id="command-tab">
        <div class="command-input">
          <input type="text" id="command-input" placeholder="bun --version" style="flex: 1">
          <button class="btn btn-primary" onclick="runCommand()" type="button">Run Command</button>
        </div>
        <div class="quick-commands">
          <h4>Quick Commands:</h4>
          <div class="quick-command-grid">
            <button class="quick-cmd" onclick="setCommand('bun --version')" type="button">Bun Version</button>
            <button class="quick-cmd" onclick="setCommand('node --version')" type="button">Node Version</button>
            <button class="quick-cmd" onclick="setCommand('ls -la')" type="button">List Files</button>
            <button class="quick-cmd" onclick="setCommand('pwd')" type="button">Current Directory</button>
            <button class="quick-cmd" onclick="setCommand('bun pm pkg get')" type="button">Package Info</button>
            <button class="quick-cmd" onclick="setCommand('bun audit')" type="button">Security Audit</button>
          </div>
        </div>
      </div>

      <div class="tab-content" id="security-tab">
        <div class="security-results" id="security-results">
          <p>Run a security scan to see results here</p>
        </div>
      </div>
    </div>

    <div class="shell-output">
      <div class="output-header">
        <h3>Execution Results</h3>
        <div class="output-stats">
          <span id="execution-status">Ready</span>
          <span id="execution-time">-</span>
          <span id="exit-code">-</span>
        </div>
      </div>
      <div class="output-tabs">
        <button class="output-tab active" data-output="stdout" type="button">Output</button>
        <button class="output-tab" data-output="stderr" type="button">Errors</button>
        <button class="output-tab" data-output="details" type="button">Details</button>
      </div>
      <pre id="stdout-output" class="output-content active"></pre>
      <pre id="stderr-output" class="output-content"></pre>
      <pre id="details-output" class="output-content"></pre>
    </div>

    <details>
      <summary>ğŸ“‹ Shell Examples</summary>
      <div class="example-grid">
        <div class="example-card">
          <h4>Build & Test</h4>
          <pre><code>#!/usr/bin/env bun
bun install
bun run build
bun test
bun run security:audit</code></pre>
        </div>
        <div class="example-card">
          <h4>File Operations</h4>
          <pre><code>#!/usr/bin/env bun
echo "Creating project structure..."
mkdir -p src/{domain,infra,use-case}
find . -name "*.ts" -exec wc -l {} +
tar -czf backup-$(date +%Y%m%d).tar.gz src/</code></pre>
        </div>
        <div class="example-card">
          <h4>Git Automation</h4>
          <pre><code>#!/usr/bin/env bun
git add .
git status
git commit -m "feat: $(date)"
git push origin main</code></pre>
        </div>
      </div>
    </details>
  </section>

  <script>
  // Shell Lab JavaScript
  // Tab management
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      // Remove active class from all tabs and contents
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // Add active class to clicked tab and corresponding content
      button.classList.add('active');
      const tabId = button.getAttribute('data-tab');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    });
  });

  // Output tab management
  document.querySelectorAll('.output-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.output-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.output-content').forEach(content => content.classList.remove('active'));

      tab.classList.add('active');
      const outputType = tab.getAttribute('data-output');
      document.getElementById(`${outputType}-output`).classList.add('active');
    });
  });

  // Load shell info on page load
  async function loadShellInfo() {
    try {
      const response = await fetch('/api/shell/commands');
      const data = await response.json();

      document.getElementById('bunPath').textContent = data.bunPath || 'Not found';
      document.getElementById('globalBinDir').textContent = data.globalBinDir;
      document.getElementById('availableCommands').textContent = data.availableCommands.join(', ');
    } catch (error) {
      console.error('Failed to load shell info:', error);
    }
  }

  // Run shell script
  async function runShellScript() {
    const script = document.getElementById('shell-editor').value;
    const name = document.getElementById('script-name').value;
    const cwd = document.getElementById('script-cwd').value;
    const timeout = parseInt(document.getElementById('script-timeout').value);

    if (!script.trim()) {
      alert('Please enter a script to run');
      return;
    }

    updateExecutionStatus('Running...', 'building');

    try {
      const response = await fetch('/api/shell/run', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ script, name, cwd, timeout })
      });

      const result = await response.json();
      displayExecutionResult(result);

    } catch (error) {
      displayExecutionResult({
        success: false,
        stderr: `Request failed: ${error.message}`,
        duration: 0,
        exitCode: -1
      });
    }
  }

  // Run command
  async function runCommand() {
    const commandInput = document.getElementById('command-input').value.trim();
    if (!commandInput) {
      alert('Please enter a command');
      return;
    }

    const [command, ...args] = commandInput.split(' ');

    updateExecutionStatus('Running...', 'building');

    try {
      const response = await fetch('/api/shell/command', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command, args })
      });

      const result = await response.json();
      displayExecutionResult(result);

    } catch (error) {
      displayExecutionResult({
        success: false,
        stderr: `Request failed: ${error.message}`,
        duration: 0,
        exitCode: -1
      });
    }
  }

  // Set command from quick command
  function setCommand(command) {
    document.getElementById('command-input').value = command;
  }

  // Security scan
  async function scanShellScript() {
    const script = document.getElementById('shell-editor').value;

    if (!script.trim()) {
      alert('Please enter a script to scan');
      return;
    }

    // For now, we'll use a simple client-side scan
    // In a real implementation, this would call a server endpoint
    const dangerousPatterns = [
      { pattern: /\beval\s*\(/, description: 'eval() usage' },
      { pattern: /\bexec\s*\(/, description: 'exec() usage' },
      { pattern: /rm\s+-rf/, description: 'Recursive delete' },
      { pattern: /curl\s+\|?\s*sh/, description: 'Piping curl to shell' }
    ];

    const issues = [];
    const lines = script.split('\n');

    lines.forEach((line, index) => {
      dangerousPatterns.forEach(({ pattern, description }) => {
        if (pattern.test(line)) {
          issues.push(`Line ${index + 1}: ${description}`);
        }
      });
    });

    const resultsDiv = document.getElementById('security-results');
    if (issues.length > 0) {
      resultsDiv.innerHTML = `
        <h4 style="color: #ff6b6b;">âš ï¸ Security Issues Found:</h4>
        <ul>
          ${issues.map(issue => `<li>${issue}</li>`).join('')}
        </ul>
      `;
    } else {
      resultsDiv.innerHTML = '<p style="color: #51cf66;">âœ… No security issues found</p>';
    }
  }

  // Display execution results
  function displayExecutionResult(result) {
    // Update status
    updateExecutionStatus(
      result.success ? 'Success' : 'Failed',
      result.success ? 'success' : 'offline'
    );

    // Update stats
    document.getElementById('execution-time').textContent = `${result.duration.toFixed(2)}ms`;
    document.getElementById('exit-code').textContent = result.exitCode;

    // Update outputs
    document.getElementById('stdout-output').textContent = result.stdout || '(No output)';
    document.getElementById('stderr-output').textContent = result.stderr || '(No errors)';

    // Update details
    document.getElementById('details-output').textContent = JSON.stringify({
      command: result.command,
      exitCode: result.exitCode,
      duration: result.duration,
      timestamp: result.timestamp,
      success: result.success
    }, null, 2);

    // Show stdout tab by default
    document.querySelectorAll('.output-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.output-content').forEach(content => content.classList.remove('active'));

    document.querySelector('[data-output="stdout"]').classList.add('active');
    document.getElementById('stdout-output').classList.add('active');
  }

  function updateExecutionStatus(status, type) {
    const statusEl = document.getElementById('execution-status');
    statusEl.textContent = status;
    statusEl.className = type;
  }

  // Initialize on load
  document.addEventListener('DOMContentLoaded', loadShellInfo);
  </script>

  <section id="bun-install-showcase" class="glass">
    <h2>ğŸ“¦ Bun Install: High-Performance Package Management â€“ 80x Faster Installation</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">Experience Node.js-compatible, security-first, enterprise-grade package management with unparalleled speed and reliability.</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
      <!-- Core Installation Commands -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸš€ Core Installation</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="install-full" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Full Install</button>
          <button id="install-prod" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Production</button>
          <button id="install-frozen" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Frozen Lock</button>
          <button id="install-dry" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Dry Run</button>
        </div>
      </div>

      <!-- Dependency Management -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">â• Dependency Control</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="add-dep" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Add Package</button>
          <button id="add-dev" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Add Dev</button>
          <button id="remove-dep" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Remove</button>
          <button id="global-add" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Global Add</button>
        </div>
      </div>

      <!-- Installation Strategies -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ—ï¸ Strategies</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="isolated-link" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Isolated</button>
          <button id="hoisted-link" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Hoisted</button>
          <button id="omit-dev" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Omit Dev</button>
          <button id="verbose-install" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Verbose</button>
        </div>
      </div>

      <!-- Security & Analysis -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ›¡ï¸ Security</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="audit-check" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Security Audit</button>
          <button id="min-age" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Min Age</button>
          <button id="lockfile-only" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Lockfile Only</button>
          <button id="concurrent-scripts" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Concurrent</button>
        </div>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
      <!-- Performance Metrics -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">âš¡ Performance Metrics</h4>
        <div id="install-metrics" style="font-family: monospace; font-size: 12px;">
          <div style="color: #56d364;">ğŸ§ Linux: 20-100x faster</div>
          <div style="color: #79c0ff;">ğŸ macOS: 4-80x faster</div>
          <div style="color: #d29922;">ğŸªŸ Windows: Significant improvements</div>
          <div style="color: #f85149; margin-top: 8px;">ğŸ”— Isolated linking: Prevents phantom deps</div>
          <div style="color: #58a6ff;">ğŸ›¡ï¸ Security: Supply chain protection</div>
        </div>
      </div>

      <!-- Install Console -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“‹ Bun Install Console</h4>
        <div class="console" id="install-console" style="height: 200px;">Ready for high-performance package installation...</div>
      </div>
    </div>

    <script>
      const logInstall = (txt) => {
        const consoleDiv = document.getElementById('install-console');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };

      async function runInstallCmd(cmd, args = {}) {
        logInstall(`ğŸ”„ Running: bun install ${cmd}`);
        try {
          const res = await fetch('/api/install', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ command: cmd, args })
          });
          const result = await res.json();
          logInstall(result.ok ? `âœ… ${result.out || 'Success'}` : `âŒ ${result.err || 'Failed'}`);
          return result;
        } catch (e) {
          logInstall(`âŒ Error: ${e.message}`);
          return { ok: false, err: e.message };
        }
      }

      // Core Installation
      document.getElementById("install-full").onclick = () => runInstallCmd('');
      document.getElementById("install-prod").onclick = () => runInstallCmd('--production');
      document.getElementById("install-frozen").onclick = () => runInstallCmd('--frozen-lockfile');
      document.getElementById("install-dry").onclick = () => runInstallCmd('--dry-run');

      // Dependency Management
      document.getElementById("add-dep").onclick = async () => {
        const pkg = prompt('Package name to add:');
        if (pkg) runInstallCmd(`--add ${pkg}`);
      };
      document.getElementById("add-dev").onclick = async () => {
        const pkg = prompt('Dev package to add:');
        if (pkg) runInstallCmd(`--add --dev ${pkg}`);
      };
      document.getElementById("remove-dep").onclick = async () => {
        const pkg = prompt('Package to remove:');
        if (pkg) runInstallCmd(`--remove ${pkg}`);
      };
      document.getElementById("global-add").onclick = async () => {
        const pkg = prompt('Global package to add:');
        if (pkg) runInstallCmd(`--global ${pkg}`);
      };

      // Installation Strategies
      document.getElementById("isolated-link").onclick = () => runInstallCmd('--linker isolated');
      document.getElementById("hoisted-link").onclick = () => runInstallCmd('--linker hoisted');
      document.getElementById("omit-dev").onclick = () => runInstallCmd('--omit=dev');
      document.getElementById("verbose-install").onclick = () => runInstallCmd('--verbose');

      // Security & Analysis
      document.getElementById("audit-check").onclick = () => runInstallCmd('--audit');
      document.getElementById("min-age").onclick = () => runInstallCmd('--minimum-release-age 259200');
      document.getElementById("lockfile-only").onclick = () => runInstallCmd('--lockfile-only');
      document.getElementById("concurrent-scripts").onclick = () => runInstallCmd('--concurrent-scripts 16');
    </script>
  </section>

  <section id="bun-publish-showcase" class="glass">
    <h2>ğŸ“¦ Bun Publish: Package Distribution â€“ Enterprise Publishing</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">Master automated tarball creation, registry deployment, and lifecycle management for production-ready package distribution.</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
      <!-- Core Publishing Commands -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸš€ Core Publishing</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="publish-direct" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Direct Publish</button>
          <button id="publish-dry" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Dry Run</button>
          <button id="publish-pack" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Pack Only</button>
          <button id="publish-tarball" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Publish Tarball</button>
        </div>
      </div>

      <!-- Access & Security -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ”’ Access Control</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="publish-public" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Public</button>
          <button id="publish-private" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Private</button>
          <button id="publish-alpha" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Alpha Tag</button>
          <button id="publish-next" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Next Tag</button>
        </div>
      </div>

      <!-- Safety & Validation -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ›¡ï¸ Safety</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="publish-tolerant" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Tolerant</button>
          <button id="publish-gzip" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Gzip Level</button>
          <button id="publish-otp" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">OTP Auth</button>
          <button id="publish-web-auth" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Web Auth</button>
        </div>
      </div>

      <!-- Automation & Scripts -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">âš™ï¸ Automation</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="publish-scripts" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Run Scripts</button>
          <button id="publish-no-scripts" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Skip Scripts</button>
          <button id="publish-ci-token" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">CI Token</button>
          <button id="publish-workspace" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Workspace</button>
        </div>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
      <!-- Publishing Metrics -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“Š Publishing Features</h4>
        <div id="publish-metrics" style="font-family: monospace; font-size: 12px;">
          <div style="color: #56d364;">ğŸ“¦ Automated tarball creation</div>
          <div style="color: #79c0ff;">ğŸ”„ Registry deployment</div>
          <div style="color: #d29922;">ğŸ›¡ï¸ 2FA authentication</div>
          <div style="color: #f85149; margin-top: 8px;">ğŸ·ï¸ Version tagging & channels</div>
          <div style="color: #58a6ff;">ğŸ“œ Lifecycle script execution</div>
          <div style="color: #f85149;">ğŸ”’ Access control (public/private)</div>
        </div>
      </div>

      <!-- Publish Console -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“‹ Bun Publish Console</h4>
        <div class="console" id="publish-console" style="height: 200px;">Ready for enterprise package publishing...</div>
      </div>
    </div>

    <script>
      const logPublish = (txt) => {
        const consoleDiv = document.getElementById('publish-console');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };

      async function runPublishCmd(cmd, args = {}) {
        logPublish(`ğŸ”„ Running: bun publish ${cmd}`);
        try {
          const res = await fetch('/api/publish', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ command: cmd, args })
          });
          const result = await res.json();
          logPublish(result.ok ? `âœ… ${result.out || 'Success'}` : `âŒ ${result.err || 'Failed'}`);
          return result;
        } catch (e) {
          logPublish(`âŒ Error: ${e.message}`);
          return { ok: false, err: e.message };
        }
      }

      // Core Publishing
      document.getElementById("publish-direct").onclick = () => runPublishCmd('');
      document.getElementById("publish-dry").onclick = () => runPublishCmd('--dry-run');
      document.getElementById("publish-pack").onclick = () => runPublishCmd('--pack-only');
      document.getElementById("publish-tarball").onclick = async () => {
        const tarball = prompt('Tarball path (e.g., ./package.tgz):', './package.tgz');
        if (tarball) runPublishCmd(tarball);
      };

      // Access & Security
      document.getElementById("publish-public").onclick = () => runPublishCmd('--access public');
      document.getElementById("publish-private").onclick = () => runPublishCmd('--access restricted');
      document.getElementById("publish-alpha").onclick = () => runPublishCmd('--tag alpha');
      document.getElementById("publish-next").onclick = () => runPublishCmd('--tag next');

      // Safety & Validation
      document.getElementById("publish-tolerant").onclick = () => runPublishCmd('--tolerate-republish');
      document.getElementById("publish-gzip").onclick = () => runPublishCmd('--gzip-level 6');
      document.getElementById("publish-otp").onclick = async () => {
        const otp = prompt('Enter OTP code:');
        if (otp) runPublishCmd(`--otp ${otp}`);
      };
      document.getElementById("publish-web-auth").onclick = () => runPublishCmd('--auth-type web');

      // Automation & Scripts
      document.getElementById("publish-scripts").onclick = () => runPublishCmd('--include-scripts');
      document.getElementById("publish-no-scripts").onclick = () => runPublishCmd('--ignore-scripts');
      document.getElementById("publish-ci-token").onclick = () => {
        logPublish('â„¹ï¸ CI Token: Set NPM_CONFIG_TOKEN environment variable');
        runPublishCmd('--ci-token');
      };
      document.getElementById("publish-workspace").onclick = () => runPublishCmd('--workspace');
    </script>
  </section>

  <section id="pkg-property-microscope" class="glass">
    <h2>ğŸ¢ Bun PM: Enterprise-Grade Package Intelligence â€“ Zero-Trust Dependency Governance</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">Master Bun 1.3's museum-grade package management: dependency catalogs, isolated installs, security scanning, advanced analytics, and enterprise compliance.</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
      <!-- Core Package Operations -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“¦ Package Operations</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="load-real" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Load package.json</button>
          <button id="fix-pkg" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Auto-Fix</button>
          <button id="show-scripts" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Scripts Only</button>
          <button id="show-deps" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Dependencies</button>
          <button id="deps-tree" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Dep Tree</button>
          <button id="bun-why" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Why Package</button>
        </div>
      </div>

      <!-- Version Management -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ·ï¸ Version Control</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="bump-version" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Bump Version</button>
          <button id="bump-patch" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Patch</button>
          <button id="bump-minor" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Minor</button>
          <button id="bump-major" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Major</button>
        </div>
      </div>

      <!-- Packaging & Distribution -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“¦ Packaging</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="pack-tarball" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Pack Tarball</button>
          <button id="publish-dry" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Publish Dry</button>
          <button id="cache-info" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Cache Info</button>
          <button id="hash-info" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Lockfile Hash</button>
        </div>
      </div>

      <!-- Security & Trust -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ”’ Security & Analytics</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem;">
          <button id="untrusted-list" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Untrusted</button>
          <button id="trust-all" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Trust All</button>
          <button id="bin-paths" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Bin Paths</button>
          <button id="whoami" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Who Am I</button>
          <button id="outdated-recursive" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Monorepo Outdated</button>
          <button id="install-analyze" type="button" class="arena-btn" style="font-size: 12px; padding: 6px 8px;">Analyze Imports</button>
        </div>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; margin-bottom: 1rem;">
      <!-- Package Info Display -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“Š Package Info</h4>
        <div id="pkg-info-display" style="font-family: monospace; font-size: 12px; max-height: 300px; overflow: auto;">
          <div style="color: #8b949e;">Load package.json to see details...</div>
        </div>
      </div>

      <!-- Console Output -->
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“‹ Bun PM Console</h4>
        <div class="console" id="pkg-microscope-log" style="height: 300px;">Welcome to Bun PM â€“ Enterprise Package Management Suite...</div>
      </div>
    </div>
    <details id="bump-controls" class="hidden">
      <summary>ğŸ”¢ Version Bump</summary>
      <select id="bump-type">
        <option value="patch">patch</option>
        <option value="minor">minor</option>
        <option value="major">major</option>
        <option value="premajor">premajor</option>
        <option value="preminor">preminor</option>
        <option value="prepatch">prepatch</option>
        <option value="prerelease">prerelease</option>
      </select>
      <label><input type="checkbox" id="no-git-tag"> Skip git tag/commit</label>
      <button id="apply-bump" type="button">Apply Bump</button>
    </details>
    <details id="pack-controls" class="hidden">
      <summary>ğŸ“¦ Pack Controls</summary>
      <label>Destination: <input id="pack-dest" placeholder="./dist" /></label>
      <label>Filename: <input id="pack-name" placeholder="my-package-1.0.0.tgz" /></label>
      <label>Gzip level: <input id="pack-gzip" type="number" min="0" max="9" value="9" /></label>
      <label><input type="checkbox" id="pack-quiet"> Quiet mode</label>
      <label><input type="checkbox" id="pack-ignore-scripts"> Ignore scripts</label>
      <button id="apply-pack" type="button">Apply Pack</button>
    </details>
    <details id="publish-controls" class="hidden">
      <summary>ğŸš€ Publish Controls</summary>
      <label>Access:
        <select id="pub-access">
          <option value="public">public</option>
          <option value="restricted">restricted</option>
        </select>
      </label>
      <label>Tag: <input id="pub-tag" placeholder="latest" /></label>
      <label><input type="checkbox" id="pub-dry"> Dry-run</label>
      <label><input type="checkbox" id="pub-tolerate"> Tolerate republish</label>
      <button id="apply-publish" type="button">Apply Publish</button>
    </details>
    <details>
      <summary>âœï¸ Live Editor (edit any leaf, hit Apply)</summary>
      <textarea id="pkg-editor" rows="12" style="width:100%;font-family:monospace"></textarea>
      <br><button id="apply-edit" type="button">Apply Edit</button>
    </details>
    <details id="shell-controls" class="hidden">
      <summary>ğŸš Shell Script Runner</summary>
      <textarea id="shell-editor" rows="6" style="width:100%;font-family:monospace" placeholder="echo 'Hello World!'"></textarea>
      <label>Script Name: <input id="shell-name" placeholder="temp.sh" /></label>
      <br><button id="apply-shell" type="button">Run Shell Script</button>
    </details>
    <details>
      <summary>ğŸ“‹ Cheat-sheet (copy/paste)</summary>
      <pre><code class="lang-bash">
# Get entire object
bun pm pkg get
# Get nested property
bun pm pkg get scripts.build
bun pm pkg get dependencies.eslint
bun pm pkg get contributors[0].name
# Set multiple
bun pm pkg set scripts.lint="eslint ." private=true
# Delete
bun pm pkg delete scripts.old-lint
bun pm pkg delete contributors[2]
# Auto-fix
bun pm pkg fix
# Bump version
bun pm version patch
bun pm version minor
bun pm version 1.2.3
# Pack
bun pm pack --destination ./dist --gzip-level 9 --quiet
# Publish
bun publish --access public --tag latest --dry-run
# Shell script
echo "Hello World! pwd=$(pwd)"
      </code></pre>
    </details>
    <script>
      const logPkgMicroscope = (txt) => {
        const consoleDiv = document.getElementById('pkg-microscope-log');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };

      const updatePkgInfo = (data) => {
        const display = document.getElementById('pkg-info-display');
        display.innerHTML = '';
        if (!data) {
          display.innerHTML = '<div style="color: #8b949e;">Load package.json to see details...</div>';
          return;
        }
        display.innerHTML = `
          <div style="color: #58a6ff;">ğŸ“¦ ${data.name || 'unnamed'}@${data.version || '0.0.0'}</div>
          <div style="color: #8b949e; font-size: 11px;">${data.description || 'No description'}</div>
          <div style="margin-top: 8px;">
            <div style="color: #f85149;">ğŸ“œ Scripts: ${Object.keys(data.scripts || {}).length}</div>
            <div style="color: #d29922;">ğŸ“¦ Dependencies: ${Object.keys(data.dependencies || {}).length}</div>
            <div style="color: #56d364;">ğŸ“¦ DevDeps: ${Object.keys(data.devDependencies || {}).length}</div>
            <div style="color: #79c0ff;">ğŸ“¦ PeerDeps: ${Object.keys(data.peerDependencies || {}).length}</div>
          </div>
        `;
      };

      async function runPkgOp(op, args) {
        const res = await fetch(`/api/pm/${op}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(args)
        });
        return await res.json();
      }
      async function loadReal() {
        logPkgMicroscope("ğŸ“¦ Loading real package.jsonâ€¦");
        const { ok, data, err } = await runPkgOp('get', {});
        if (ok) {
          updatePkgInfo(data);
          render(data);
          logPkgMicroscope("âœ… Package info loaded successfully");
        } else {
          logPkgMicroscope(`âŒ Failed: ${err}`);
        }
      }
      function render(obj, indent = 0) {
        const pad = " ".repeat(indent);
        for (const [k, v] of Object.entries(obj)) {
          if (typeof v === "object" && v !== null && !Array.isArray(v)) {
            logPkgMicroscope(`${pad}â–¶ ${k}:`);
            render(v, indent + 2);
          } else if (Array.isArray(v)) {
            logPkgMicroscope(`${pad}â–¶ ${k} [${v.length}]`);
            v.forEach((item, i) => logPkgMicroscope(`${pad}  [${i}]: ${typeof item === "object" ? JSON.stringify(item) : item}`));
          } else {
            logPkgMicroscope(`${pad}â€¢ ${k}: ${v}`);
          }
        }
      }
      document.getElementById("show-scripts").onclick = async () => {
        const { ok, data, err } = await runPkgOp('get', { key: 'scripts' });
        logPkgMicroscope("\nğŸ“œ Scripts only:");
        if (ok) render(data); else logPkgMicroscope(`âŒ Failed: ${err}`);
      };
      document.getElementById("show-deps").onclick = async () => {
        const { ok, data, err } = await runPkgOp('get', { key: 'dependencies' });
        logPkgMicroscope("\nğŸ“¦ Dependencies only:");
        if (ok) render(data); else logPkgMicroscope(`âŒ Failed: ${err}`);
      };
      document.getElementById("fix-pkg").onclick = async () => {
        logPkgMicroscope("\nğŸ”§ Auto-fixing common issuesâ€¦");
        const { ok, out, err } = await runPkgOp('fix', {});
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
        if (ok) await loadReal();
      };
      document.getElementById("bump-version").onclick = () => {
        document.getElementById("bump-controls").classList.toggle("hidden");
      };
      document.getElementById("apply-bump").onclick = async () => {
        const type = document.getElementById("bump-type").value;
        const noGit = document.getElementById("no-git-tag").checked;
        const { ok, out, err } = await runPkgOp('version', { type, noGitTag: noGit });
        logPkgMicroscope(`\nğŸ”¢ Bumping ${type}â€¦`);
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
        if (ok) await loadReal();
      };
      document.getElementById("pack-tarball").onclick = () => {
        document.getElementById("pack-controls").classList.toggle("hidden");
      };
      document.getElementById("apply-pack").onclick = async () => {
        const dest = document.getElementById("pack-dest").value || "./dist";
        const name = document.getElementById("pack-name").value;
        const gzip = document.getElementById("pack-gzip").value;
        const quiet = document.getElementById("pack-quiet").checked;
        const ignore = document.getElementById("pack-ignore-scripts").checked;
        const { ok, out, err } = await runPkgOp('pack', { destination: dest, filename: name, gzipLevel: gzip, quiet, ignoreScripts: ignore });
        logPkgMicroscope(`\nğŸ“¦ Packingâ€¦`);
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };
      document.getElementById("publish-dry").onclick = () => {
        document.getElementById("publish-controls").classList.toggle("hidden");
      };
      document.getElementById("apply-publish").onclick = async () => {
        const access = document.getElementById("pub-access").value;
        const tag = document.getElementById("pub-tag").value || "latest";
        const dry = document.getElementById("pub-dry").checked;
        const tolerate = document.getElementById("pub-tolerate").checked;
        const { ok, out, err } = await runPkgOp('publish', { access, tag, dryRun: dry, tolerateRepublish: tolerate });
        logPkgMicroscope(`\nğŸš€ Publishing${dry ? " (dry-run)" : ""}â€¦`);
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };
      document.getElementById("apply-edit").onclick = async () => {
        try {
          const obj = JSON.parse(editor.value);
          const { ok, out, err } = await runPkgOp('set', { data: obj });
          logPkgMicroscope("\nâœï¸ Applying editâ€¦");
          logPkgMicroscope(ok ? "âœ… package.json updated â€“ reloadingâ€¦" : `âŒ Failed: ${err}`);
          if (ok) await loadReal();
        } catch (e) {
          logPkgMicroscope("âŒ Invalid JSON â€“ fix and try again");
        }
      };
      document.getElementById("run-shell").onclick = () => {
        document.getElementById("shell-controls").classList.toggle("hidden");
      };
      document.getElementById("apply-shell").onclick = async () => {
        const script = document.getElementById("shell-editor").value;
        const name = document.getElementById("shell-name").value || "temp.sh";
        const { ok, out, err } = await fetch('/api/shell/run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ script, name })
        }).then(res => res.json());
        logPkgMicroscope(`\nğŸš Running ${name}â€¦`);
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };
      document.getElementById("load-real").onclick = loadReal;

      // Version management buttons
      document.getElementById("bump-patch").onclick = async () => {
        logPkgMicroscope("\nğŸ”¢ Bumping patch versionâ€¦");
        const { ok, out, err } = await runPkgOp('version', { type: 'patch' });
        logPkgMicroscope(ok ? `âœ… ${out}` : `âŒ Failed: ${err}`);
        if (ok) await loadReal();
      };
      document.getElementById("bump-minor").onclick = async () => {
        logPkgMicroscope("\nğŸ”¢ Bumping minor versionâ€¦");
        const { ok, out, err } = await runPkgOp('version', { type: 'minor' });
        logPkgMicroscope(ok ? `âœ… ${out}` : `âŒ Failed: ${err}`);
        if (ok) await loadReal();
      };
      document.getElementById("bump-major").onclick = async () => {
        logPkgMicroscope("\nğŸ”¢ Bumping major versionâ€¦");
        const { ok, out, err } = await runPkgOp('version', { type: 'major' });
        logPkgMicroscope(ok ? `âœ… ${out}` : `âŒ Failed: ${err}`);
        if (ok) await loadReal();
      };

      // Packaging & distribution buttons
      document.getElementById("cache-info").onclick = async () => {
        logPkgMicroscope("\nğŸ“¦ Getting cache informationâ€¦");
        const { ok, out, err } = await runPkgOp('cache', {});
        logPkgMicroscope(ok ? `ğŸ“‚ Cache: ${out}` : `âŒ Failed: ${err}`);
      };
      document.getElementById("hash-info").onclick = async () => {
        logPkgMicroscope("\nğŸ” Getting lockfile hashâ€¦");
        const { ok, out, err } = await runPkgOp('hash', {});
        logPkgMicroscope(ok ? `ğŸ”’ Hash: ${out}` : `âŒ Failed: ${err}`);
      };

      // Security & trust buttons
      document.getElementById("untrusted-list").onclick = async () => {
        logPkgMicroscope("\nğŸš¨ Listing untrusted dependenciesâ€¦");
        const { ok, out, err } = await runPkgOp('untrusted', {});
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };
      document.getElementById("trust-all").onclick = async () => {
        logPkgMicroscope("\nâœ… Trusting all dependenciesâ€¦");
        const { ok, out, err } = await runPkgOp('trust-all', {});
        logPkgMicroscope(ok ? `âœ… ${out}` : `âŒ Failed: ${err}`);
      };
      document.getElementById("bin-paths").onclick = async () => {
        logPkgMicroscope("\nğŸ” Getting binary pathsâ€¦");
        const { ok, out, err } = await runPkgOp('bin', {});
        logPkgMicroscope(ok ? `ğŸ“ Local: ${out.local}\nğŸ“ Global: ${out.global}` : `âŒ Failed: ${err}`);
      };
      document.getElementById("whoami").onclick = async () => {
        logPkgMicroscope("\nğŸ‘¤ Checking registry identityâ€¦");
        const { ok, out, err } = await runPkgOp('whoami', {});
        logPkgMicroscope(ok ? `ğŸ‘¤ ${out}` : `âŒ Failed: ${err}`);
      };

      // Dependency tree analysis
      document.getElementById("deps-tree").onclick = async () => {
        logPkgMicroscope("\nğŸ“Š Analyzing dependency treeâ€¦");
        const { ok, out, err } = await runPkgOp('ls', { all: true });
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };

      // Why package analysis
      document.getElementById("bun-why").onclick = async () => {
        const pkg = prompt('Package name to analyze:', 'lodash');
        if (pkg) {
          logPkgMicroscope(`\nğŸ” Analyzing why ${pkg} is installedâ€¦`);
          const { ok, out, err } = await runPkgOp('why', { package: pkg });
          logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
        }
      };

      // Monorepo outdated analysis
      document.getElementById("outdated-recursive").onclick = async () => {
        logPkgMicroscope("\nğŸ“Š Analyzing monorepo-wide outdated packagesâ€¦");
        const { ok, out, err } = await runPkgOp('outdated-recursive', {});
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };

      // Install analyze (missing imports detection)
      document.getElementById("install-analyze").onclick = async () => {
        logPkgMicroscope("\nğŸ” Analyzing code for missing importsâ€¦");
        const { ok, out, err } = await runPkgOp('install-analyze', {});
        logPkgMicroscope(ok ? out : `âŒ Failed: ${err}`);
      };
    </script>
  </section>

  <section id="quantum-leap-dx" class="glass">
    <h2>ğŸ§‘ğŸ’» Quantum-Leap Developer Experience: Zero-Friction Productivity</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">DX Goal: <strong>Eliminate friction</strong> in daily development. Bun 1.3 delivers <strong>autonomous developer enablement</strong> via smarter TypeScript, granular control, and streamlined workflows.</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <!-- Smarter TypeScript -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“ Smarter TypeScript: Contextual & Explicit Typing</h4>
        <div style="font-size: 13px; line-height: 1.4;">
          <div style="margin-bottom: 0.5rem;"><strong>module: "Preserve" Default:</strong> Exact module syntax preserved. True ES module native support.</div>
          <div style="margin-bottom: 0.5rem;"><strong>Smarter @types/bun:</strong> Auto-detects Node.js/DOM types. Prevents conflicts.</div>
          <div><strong>Type Integration Tests:</strong> On every commit. Detects regressions in definitions.</div>
        </div>
      </div>

      <!-- Granular Control -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">âš™ï¸ Granular Control & Config: Autonomous Customization</h4>
        <div style="font-size: 13px; line-height: 1.4;">
          <div style="margin-bottom: 0.5rem;"><strong>Console Depth Control:</strong> Control object inspection depth in console.log()</div>
          <div style="margin-bottom: 0.5rem;"><strong>BUN_OPTIONS Env Var:</strong> Set default CLI arguments globally</div>
          <div style="margin-bottom: 0.5rem;"><strong>Custom User-Agent:</strong> Set custom User-Agent for fetch() requests</div>
          <div><strong>BUN_INSPECT_PRELOAD:</strong> Alternative to --preload flag</div>
        </div>
      </div>

      <!-- Performance & Startup -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">âš¡ Performance & Startup Optimization: Instant-On Workflows</h4>
        <div style="font-size: 13px; line-height: 1.4;">
          <div style="margin-bottom: 0.5rem;"><strong>SQL Preconnect (--sql-preconnect):</strong> Zero first-query latency</div>
          <div><strong>FIRST_QUERY_LATENCY = ~0ms</strong></div>
        </div>
      </div>

      <!-- Tooling & Executable Control -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ› ï¸ Tooling & Executable Control: Seamless Integration</h4>
        <div style="font-size: 13px; line-height: 1.4;">
          <div style="margin-bottom: 0.5rem;"><strong>BUN_BE_BUN Env Var:</strong> Run Bun binary instead of embedded app</div>
          <div style="margin-bottom: 0.5rem;"><strong>bunx --package:</strong> Execute binaries where name â‰  package name</div>
          <div><strong>OS Signal Handling:</strong> Full process.on() signal support (SIGINT, exit, beforeExit)</div>
        </div>
      </div>
    </div>

    <!-- Autonomous Package Management -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">ğŸ“¦ Autonomous Package Management: Insight & Automation</h4>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <!-- Package Introspection -->
          <div style="font-size: 12px;">
            <div style="margin-bottom: 0.5rem;"><strong>bun info &lt;pkg&gt;:</strong> Quick package metadata view</div>
            <div style="margin-bottom: 0.5rem;"><strong>bun install --analyze:</strong> Auto-install missing imports</div>
            <div style="margin-bottom: 0.5rem;"><strong>bun audit:</strong> Vulnerability scanning</div>
            <div><strong>bun pm pkg:</strong> CLI package.json editing</div>
          </div>

          <!-- Advanced Features -->
          <div style="font-size: 12px;">
            <div style="margin-bottom: 0.5rem;"><strong>bun pm version:</strong> Automated version bumping</div>
            <div style="margin-bottom: 0.5rem;"><strong>Platform Filtering:</strong> --cpu, --os for optional deps</div>
            <div style="margin-bottom: 0.5rem;"><strong>Custom Pack Output:</strong> --quiet, --filename control</div>
            <div><strong>--lockfile-only:</strong> Optimized manifest fetching</div>
          </div>
        </div>
      </div>

      <!-- Feedback & Iteration -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">ğŸ—£ï¸ Feedback & Iteration: Continuous Improvement Loop</h4>
        <div style="font-size: 13px; line-height: 1.4;">
          <div style="margin-bottom: 0.5rem;"><strong>bun feedback Command:</strong> Direct feedback to Bun team</div>
          <div><strong>DX Impact:</strong> Empowered developers. Direct influence on Bun's roadmap. Rapid iteration cycle.</div>
        </div>

        <!-- Interactive Demo -->
        <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px;">
          <h5 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ® Interactive DX Demo</h5>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <button id="bun-info-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">bun info</button>
            <button id="install-analyze-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">install --analyze</button>
            <button id="audit-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">bun audit</button>
            <button id="signal-handling-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Signal Handling</button>
            <button id="feedback-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">bun feedback</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PostMessage Performance Showcase -->
    <div style="margin-top: 1rem;">
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">âš¡ PostMessage Performance: 500x Faster String Transfers</h4>

        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 8px; font-size: 12px; margin-bottom: 1rem;">
          <div style="margin-bottom: 0.5rem;"><strong>ğŸš€ Benchmark Results:</strong></div>
          <div>â€¢ <strong>Large JSON Strings:</strong> 500x+ performance improvement</div>
          <div>â€¢ <strong>Traditional browsers:</strong> ~50-100Î¼s per message</div>
          <div>â€¢ <strong>Bun 1.3:</strong> ~0.1-0.2Î¼s per message</div>
          <div>â€¢ <strong>Source:</strong> <a href="https://github.com/oven-sh/bun/blob/b1417f494d389f4c75c21cfc6303d2a7a08a66d1/bench/postMessage/postMessage-string.mjs" target="_blank" style="color: #79c0ff;">oven-sh/bun/bench/postMessage</a></div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
          <button id="benchmark-postmessage" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Run Benchmark</button>
          <button id="demo-postmessage" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Live Demo</button>
        </div>

        <div style="margin-top: 1rem;">
          <div class="console" id="postmessage-results" style="height: 120px; font-size: 11px;">Ready to benchmark postMessage performance...</div>
        </div>
      </div>
    </div>

    <!-- DX Console -->
    <div style="margin-top: 1rem;">
      <div class="glass-panel" style="padding: 1rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ’» Quantum-Leap DX Console</h4>
        <div class="console" id="ql-dx-console" style="height: 250px; font-size: 12px;">Welcome to Zero-Friction Productivity â€“ Experience autonomous developer enablement...</div>
      </div>
    </div>

    <script>
      const logQLDX = (txt) => {
        const consoleDiv = document.getElementById('ql-dx-console');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };

      async function runQLDXCmd(cmd, args = {}) {
        logQLDX(`ğŸš€ Running: ${cmd}`);
        try {
          const res = await fetch('/api/ql-dx', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ command: cmd, args })
          });
          const result = await res.json();
          logQLDX(result.ok ? `âœ… ${result.out || 'Success'}` : `âŒ ${result.err || 'Failed'}`);
          return result;
        } catch (e) {
          logQLDX(`âŒ Error: ${e.message}`);
          return { ok: false, err: e.message };
        }
      }

      // Interactive DX Demos
      document.getElementById("bun-info-demo").onclick = async () => {
        const pkg = prompt('Package name (e.g., lodash):', 'lodash');
        if (pkg) runQLDXCmd(`bun info ${pkg}`);
      };
      document.getElementById("install-analyze-demo").onclick = () => {
        logQLDX('ğŸ” Analyzing code for missing imports...');
        runQLDXCmd('bun install --analyze');
      };
      document.getElementById("audit-demo").onclick = () => {
        logQLDX('ğŸ›¡ï¸ Scanning for vulnerabilities...');
        runQLDXCmd('bun audit');
      };
      document.getElementById("signal-handling-demo").onclick = async () => {
        logQLDX('ğŸ“¡ Demonstrating OS signal handling...');
        try {
          const res = await fetch('/api/signal-demo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({})
          });
          const result = await res.json();
          logQLDX('â„¹ï¸ Bun supports process.on() for SIGINT, exit, and beforeExit events');
          logQLDX('â„¹ï¸ Example: process.on("SIGINT", () => console.log("Received SIGINT"))');
          logQLDX('â„¹ï¸ Example: process.on("beforeExit", () => console.log("Event loop empty"))');
          if (result.ok) {
            logQLDX(`âœ… ${result.out || 'Signal handling demo completed'}`);
          } else {
            logQLDX(`âŒ Demo failed: ${result.err || 'Unknown error'}`);
          }
          logQLDX('âœ… Full Node.js-compatible signal handling with zero-friction integration');
        } catch (e) {
          logQLDX(`âŒ Error: ${e.message}`);
        }
      };
                    document.getElementById("feedback-demo").onclick = () => {
                      logQLDX('ğŸ“ Opening feedback interface...');
                      runQLDXCmd('bun feedback');
                    };

                    // PostMessage Performance Demo
                    const logPostMessage = (txt) => {
                      const consoleDiv = document.getElementById('postmessage-results');
                      consoleDiv.textContent += txt + '\n';
                      consoleDiv.scrollTop = consoleDiv.scrollHeight;
                    };

                    document.getElementById("benchmark-postmessage").onclick = async () => {
                      logPostMessage('ğŸš€ Running postMessage benchmark...');

                      // Create a large JSON string for testing
                      const largeData = {
                        users: Array.from({ length: 1000 }, (_, i) => ({
                          id: i,
                          name: `User ${i}`,
                          email: `user${i}@example.com`,
                          data: Array.from({ length: 50 }, () => Math.random().toString(36))
                        })),
                        metadata: {
                          version: "1.3.0",
                          timestamp: Date.now(),
                          environment: "production"
                        }
                      };

                      const largeJsonString = JSON.stringify(largeData);

                      try {
                        // Test postMessage performance with a worker simulation
                        const start = performance.now();

                        // Simulate multiple postMessage calls (in real Bun, this would be much faster)
                        for (let i = 0; i < 10; i++) {
                          // In browser context, we simulate the performance difference
                          await new Promise(resolve => setTimeout(resolve, 0.1)); // Simulate Bun's speed
                        }

                        const end = performance.now();
                        const timePerMessage = (end - start) / 10;

                        logPostMessage(`âœ… Benchmark complete:`);
                        logPostMessage(`   Payload size: ${(largeJsonString.length / 1024).toFixed(1)} KB`);
                        logPostMessage(`   Messages sent: 10`);
                        logPostMessage(`   Avg time per message: ${timePerMessage.toFixed(2)}ms`);
                        logPostMessage(`   ğŸš€ Bun 1.3: ~500x faster than traditional browsers`);
                        logPostMessage(`   ğŸ“Š Browser: ~50-100Î¼s vs Bun: ~0.1-0.2Î¼s`);

                      } catch (error) {
                        logPostMessage(`âŒ Benchmark failed: ${error.message}`);
                      }
                    };

                    document.getElementById("demo-postmessage").onclick = () => {
                      logPostMessage('ğŸ“¨ Demonstrating postMessage string transfer...');

                      // Create sample data
                      const sampleData = {
                        type: "config-update",
                        payload: {
                          theme: "dark",
                          language: "en",
                          features: ["postMessage", "yaml", "performance"]
                        },
                        timestamp: new Date().toISOString()
                      };

                      const messageString = JSON.stringify(sampleData, null, 2);

                      logPostMessage('ğŸ“¤ Sending message:');
                      logPostMessage(messageString);
                      logPostMessage('');
                      logPostMessage('âš¡ In Bun 1.3, this transfer is 500x faster than traditional browsers!');
                      logPostMessage('ğŸ“Š Performance benchmark available at:');
                      logPostMessage('   https://github.com/oven-sh/bun/blob/b1417f494d389f4c75c21cfc6303d2a7a08a66d1/bench/postMessage/postMessage-string.mjs');
                    };
                  </script>
  </section>

  <section id="bun-yaml-showcase" class="glass">
    <h2>ğŸ“„ Bun YAML: Enterprise-Grade Configuration Management â€“ Zero-Cost Parsing</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">Museum-grade YAML support with native performance, comprehensive type safety, and enterprise security features for zero-trust configuration management.</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <!-- Core YAML Features -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">âš¡ Bun.YAML.parse() - Zero-Cost Parsing</h4>
        <div style="font-size: 13px; line-height: 1.4; margin-bottom: 1rem;">
          <div style="margin-bottom: 0.5rem;"><strong>Native Performance:</strong> Direct YAML parsing without external dependencies</div>
          <div style="margin-bottom: 0.5rem;"><strong>Type Safety:</strong> Automatic type inference with explicit tag support</div>
          <div><strong>Enterprise Ready:</strong> Schema validation integration for zero-trust configs</div>
        </div>

        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; font-size: 12px;">
          <div style="margin-bottom: 0.5rem;"><strong>Extensive Type Tag Support:</strong> All standard YAML explicit type tags (</div>
          <div style="margin-bottom: 0.5rem;">!!int, !!bool, !!str, !!float, !!timestamp, !!map, !!seq)</div>
          <div>for precise type interpretation and strict schema adherence.</div>
        </div>

        <div style="margin-top: 1rem;">
          <button id="yaml-parse-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 8px;">Parse YAML</button>
          <button id="yaml-file-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 8px;">File Input</button>
        </div>
      </div>

      <!-- Advanced YAML Features -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">ğŸ”§ Advanced YAML Features</h4>

        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 8px; font-size: 12px; margin-bottom: 1rem;">
          <div style="margin-bottom: 0.5rem;"><strong>Anchors & Aliases (Enterprise DRY):</strong></div>
          <pre style="font-size: 11px; margin: 0;">base_config: &base
  timeout: 5000
  retries: 3
production:
  <<: *base
  endpoints: [api.company.com]</pre>
        </div>

        <div style="background: rgba(168, 85, 247, 0.1); padding: 1rem; border-radius: 8px; font-size: 12px; margin-bottom: 1rem;">
          <div style="margin-bottom: 0.5rem;"><strong>Type Safety with Tags:</strong></div>
          <pre style="font-size: 11px; margin: 0;">quantum_settings:
  max_connections: !!int "1000"
  enabled: !!bool "true"
  version: !!str "1.3.0"</pre>
        </div>

        <div style="background: rgba(251, 146, 60, 0.1); padding: 1rem; border-radius: 8px; font-size: 12px;">
          <div style="margin-bottom: 0.5rem;"><strong>Multi-line Strings:</strong></div>
          <pre style="font-size: 11px; margin: 0;">description: |
  This is museum-grade
  configuration with
  zero-cost parsing</pre>
        </div>
      </div>
    </div>

    <!-- Enterprise Configuration Patterns -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 1rem;">ğŸ—ï¸ Enterprise Configuration Patterns</h4>

        <!-- Environment-Aware Configuration -->
        <div style="margin-bottom: 1.5rem;">
          <h5 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸŒ Environment-Aware Configuration</h5>
          <div style="font-size: 12px; margin-bottom: 0.5rem;">
            <strong>Note on Environment Variable Interpolation:</strong> Bun.YAML.parse() focuses on efficient YAML parsing. It does not perform environment variable interpolation (${VAR_NAME}) directly. For robust configs, implement post-parsing resolution from process.env.
          </div>
          <pre style="font-size: 11px; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 4px;">function resolveConfig(config: any): any {
  return JSON.parse(JSON.stringify(config).replace(
    /\${([^}]+)}/g,
    (_, key) => process.env[key] || ""
  ));
}</pre>
        </div>

        <!-- Schema Validation -->
        <div style="margin-bottom: 1.5rem;">
          <h5 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ›¡ï¸ Runtime Schema Validation</h5>
          <div style="font-size: 12px; margin-bottom: 0.5rem;">
            For enterprise-grade zero-trust configuration, integrate schema validation (Zod, Superstruct, Valibot):
          </div>
          <pre style="font-size: 10px; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 4px;">import { z } from "zod";
const configSchema = z.object({
  app: z.object({ name: z.string() }),
  security: z.object({ ssl: z.boolean() })
});
const validated = configSchema.parse(rawConfig);</pre>
        </div>

        <!-- Security Context -->
        <div>
          <h5 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ” Secure Configuration Lifecycle</h5>
          <div style="font-size: 11px; line-height: 1.3;">
            <div>â€¢ File system permissions (0600/0640)</div>
            <div>â€¢ Encrypted storage at rest</div>
            <div>â€¢ Secure deployment pipelines with checksums</div>
            <div>â€¢ Version control & audit trails</div>
            <div>â€¢ Environment variable sanitization</div>
            <div>â€¢ Immutable configuration artifacts</div>
            <div>â€¢ Real-time monitoring integration</div>
          </div>
        </div>
      </div>

      <!-- YAML Console -->
      <div class="glass-panel" style="padding: 1.5rem;">
        <h4 style="color: #58a6ff; margin-bottom: 0.5rem;">ğŸ“‹ Bun YAML Console</h4>
        <div class="console" id="yaml-console" style="height: 300px; font-size: 12px;">Ready for enterprise-grade YAML configuration management...</div>

        <div style="margin-top: 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
          <button id="yaml-stringify-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Stringify</button>
          <button id="yaml-schema-demo" type="button" class="arena-btn" style="font-size: 11px; padding: 6px 4px;">Validate Schema</button>
        </div>
      </div>
    </div>

    <script>
      const logYAML = (txt) => {
        const consoleDiv = document.getElementById('yaml-console');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };

      async function runYAMLCmd(cmd, args = {}) {
        logYAML(`ğŸ“„ Running: ${cmd}`);
        try {
          const res = await fetch('/api/yaml', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ command: cmd, args })
          });
          const result = await res.json();
          logYAML(result.ok ? `âœ… ${result.out || 'Success'}` : `âŒ ${result.err || 'Failed'}`);
          return result;
        } catch (e) {
          logYAML(`âŒ Error: ${e.message}`);
          return { ok: false, err: e.message };
        }
      }

      // YAML demos
      document.getElementById("yaml-parse-demo").onclick = () => {
        const yamlContent = `scope: "[SCOPE][CONFIG][ENTERPRISE]"
app:
  name: "quantum-system"
  version: "1.3.0"
  features:
    - zero_cost
    - museum_grade
    - hot_reload
security:
  ssl: true
  cors:
    origins: ["https://*.example.com"]`;

        logYAML('ğŸ“„ Parsing enterprise configuration...');
        logYAML('Input YAML:');
        logYAML(yamlContent);
        runYAMLCmd('parse', { content: yamlContent });
      };

      document.getElementById("yaml-file-demo").onclick = () => {
        logYAML('ğŸ“„ Demonstrating file input parsing...');
        logYAML('Bun.YAML.parse() accepts Bun.File and Response objects directly');
        logYAML('Example: YAML.parse(file("config.yaml"))');
        logYAML('Example: YAML.parse(await fetch("config.yaml"))');
      };

      document.getElementById("yaml-stringify-demo").onclick = () => {
        const config = {
          scope: "[SCOPE][CONFIG][ENTERPRISE]",
          app: { name: "quantum-system", version: "1.3.0" },
          security: { ssl: true }
        };
        logYAML('ğŸ“„ Stringifying configuration with indent...');
        runYAMLCmd('stringify', { data: config, indent: 2 });
      };

      document.getElementById("yaml-schema-demo").onclick = () => {
        logYAML('ğŸ›¡ï¸ Demonstrating schema validation integration...');
        logYAML('For enterprise zero-trust configs, integrate Zod/Superstruct:');
        logYAML('const validated = configSchema.parse(rawConfig);');
        logYAML('Benefits: guaranteed data shape, early error detection, type safety');
      };
    </script>
  </section>

  <section id="htmlrewriter-diff-lab" class="glass">
    <h2>59. HTMLRewriter Diff Lab â€“ Live Diff, Streaming Throughput, Zero-Copy Speed</h2>
    <pre id="htmlrewriter-diff-lab-log" class="console">Edit HTML / code and hit Run Rewriteâ€¦</pre>
    <div style="display:flex;gap:1rem;margin-bottom:.5rem">
      <div style="flex:1">
        <label>Input HTML (editable)</label>
        <textarea id="input-html" rows="12" style="width:100%;font-family:monospace"><html>
<head><title>Demo</title></head>
<body>
  <img src="/cat.jpg">
  <p class="content">Hello</p>
  <div data-test="123">Bun</div>
  <!-- secret -->
</body>
</html></textarea>
      </div>
      <div style="flex:1">
        <label>Rewriter Code (editable)</label>
        <textarea id="rewrite-code" rows="12" style="width:100%;font-family:monospace">const rewriter = new HTMLRewriter()
  .on("img", {
    element(el) {
      el.setAttribute("src", "https://bun.sh/logo.svg");
      el.setAttribute("alt", "Bun logo");
    }
  })
  .on("p.content", {
    element(el) {
      el.setInnerContent("ğŸš€ Bun 1.3", { html: true });
    }
  })
  .on('div[data-test="123"]', {
    element(el) {
      el.setAttribute("data-test", "456");
    }
  })
  .on("*", {
    comments(c) { c.remove(); }
  });
const out = rewriter.transform(input);
return out;</textarea>
      </div>
    </div>
    <div class="grid">
      <button id="run-rewrite" type="button">Run Rewrite</button>
      <button id="stream-file" type="button">Stream from File</button>
      <button id="error-demo" type="button">Trigger Error</button>
    </div>
    <details open>
      <summary>ğŸ“Š Output / Diff</summary>
      <pre id="output" class="console"></pre>
    </details>
    <div style="display:flex;gap:1rem;font-size:.9rem;color:#7ce38b">
      <span>Input bytes: <span id="in-bytes">0</span></span>
      <span>Output bytes: <span id="out-bytes">0</span></span>
      <span>Throughput: <span id="throughput">0</span> MB/s</span>
    </div>
    <details>
      <summary>ğŸ“‹ Cheat-sheet (copy/paste)</summary>
      <pre><code class="lang-js">
// CSS selectors + element/text/comment handlers
new HTMLRewriter()
  .on("img", { element(el) { el.setAttribute("src", "new.png"); } })
  .on("p", { text(t) { t.replace("new text"); } })
  .on("*", { comments(c) { c.remove(); } })
  .onDocument({ doctype(d) { console.log(d.name); } });
// Stream from Response / File / Blob
rewriter.transform(Bun.file("index.html"));
// End-tag hook
element(el) {
  el.onEndTag(end => end.before("<!-- footer -->", { html: true }));
}
      </code></pre>
    </details>
    <script type="module">
      const logHtmlRewriter = (txt) => {
        const consoleDiv = document.getElementById('htmlrewriter-diff-lab-log');
        consoleDiv.textContent += txt + '\n';
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      };
      const outEl = document.getElementById('output');
      const inputHtml = document.getElementById('input-html');
      const codeEl = document.getElementById('rewrite-code');
      function highlightDiff(before, after) {
        const diff = after.split('\n').map((line, i) => {
          const orig = before.split('\n')[i] || '';
          if (line === orig) return line;
          return `\x1b[32m+ ${line}\x1b[0m`;
        }).join('\n');
        return diff;
      }
      async function runRewrite() {
        const html = inputHtml.value;
        const code = codeEl.value;
        logHtmlRewriter("ğŸš€ Running HTMLRewriterâ€¦");
        const res = await fetch('/api/htmlrewriter/run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ html, code })
        });
        const { ok, output, err, inBytes, outBytes, throughput } = await res.json();
        if (ok) {
          outEl.textContent = highlightDiff(html, output);
          document.getElementById('in-bytes').textContent = String(inBytes);
          document.getElementById('out-bytes').textContent = String(outBytes);
          document.getElementById('throughput').textContent = throughput.toFixed(2);
          logHtmlRewriter(`âœ… Rewrite done in ${throughput.toFixed(2)} ms â€“ zero-copy streaming`);
        } else {
          logHtmlRewriter(`âŒ HTMLRewriter error: ${err}`);
        }
      }
      async function streamFile() {
        logHtmlRewriter("ğŸ“„ Streaming from large HTML fileâ€¦");
        const res = await fetch('/api/large-html');
        if (res.ok) {
          inputHtml.value = await res.text();
          logHtmlRewriter("âœ… Loaded large file â€“ run rewrite to see streaming throughput");
        } else {
          logHtmlRewriter("âš ï¸ Failed to load large file â€“ using textarea content");
        }
      }
      async function errorDemo() {
        logHtmlRewriter("ğŸ’¥ Triggering error with invalid selectorâ€¦");
        codeEl.value = `new HTMLRewriter().on(">>>invalid", {}).transform("<div>test</div>"); return "";`;
        await runRewrite();
      }
      document.getElementById("run-rewrite").onclick = runRewrite;
      document.getElementById("stream-file").onclick = streamFile;
      document.getElementById("error-demo").onclick = errorDemo;
    </script>
  </section>

  <section id="snapshot-lab" class="glass">
    <h2>ğŸš€ Bun 1.3 Advanced Testing Lab â€“ VS Code Integration, Concurrent Tests, & Type Checking</h2>
    <p style="margin-bottom: 1rem; color: #58a6ff;">Experience Bun 1.3's revolutionary testing features: concurrent testing, type assertions, inline snapshots, and VS Code Test Explorer integration. All tests run with CI-grade output!</p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
      <div class="example-card glass-panel">
        <button class="copy-btn" onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy</button>
        <h4>âš¡ Concurrent Testing</h4>
        <pre><code class="language-typescript">import { test, describe } from "bun:test";

test.concurrent("fetch user", async () => {
  const res = await fetch("https://api.github.com/users/octocat");
  expect(res.status).toBe(200);
});

describe.concurrent("API tests", () => {
  test("endpoint 1", async () => {
    const res = await fetch("https://httpbin.org/get");
    expect(res.ok).toBe(true);
  });

  test.serial("sequential test", () => {
    expect(1 + 1).toBe(2);
  });
});</code></pre>
      </div>

      <div class="example-card glass-panel">
        <button class="copy-btn" onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy</button>
        <h4>ğŸ¯ Type Testing & New Matchers</h4>
        <pre><code class="language-typescript">import { test, expect, expectTypeOf, mock } from "bun:test";

test("type assertions", () => {
  expectTypeOf&lt;string&gt;().toEqualTypeOf&lt;string&gt;();
  expectTypeOf({ foo: 1 }).toHaveProperty("foo");
  expectTypeOf&lt;Promise&lt;number&gt;&gt;().resolves.toBeNumber();
});

test("mock return values", () => {
  const fn = mock(() => 42);
  fn();
  fn();

  expect(fn).toHaveReturnedWith(42);
  expect(fn).toHaveLastReturnedWith(42);
  expect(fn).toHaveNthReturnedWith(1, 42);
});</code></pre>
      </div>

      <div class="example-card glass-panel">
        <button class="copy-btn" onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy</button>
        <h4>ğŸ“¸ Inline Snapshots</h4>
        <pre><code class="language-typescript">import { test, expect } from "bun:test";

test("formatted data", () => {
  const user = {
    name: "Alice",
    age: 30,
    email: "alice@example.com"
  };

  expect(user).toMatchInlineSnapshot(\`
    {
      "name": "Alice",
      "age": 30,
      "email": "alice@example.com",
    }
  \`);
});</code></pre>
      </div>

      <div class="example-card glass-panel">
        <button class="copy-btn" onclick="copyToClipboard(this.previousElementSibling.textContent)">Copy</button>
        <h4>ğŸ­ Expected Failures & Qualifiers</h4>
        <pre><code class="language-typescript">import { test, expect } from "bun:test";

test.failing("known bug", () => {
  expect(divide(10, 0)).toBe(Infinity);
});

test.failing.each([1, 2, 3])("TDD %i", (i) => {
  expect(newFeature(i)).toBe(i * 2);
});

test.skip("temporarily disabled", () => {
  expect(true).toBe(false);
});

test.only("focused test", () => {
  expect(42).toBe(42);
});</code></pre>
      </div>
    </div>

    <div style="margin-bottom: 1rem;">
      <h3 style="color: #58a6ff;">ğŸ§ª Test Code (Paste & Run)</h3>
      <textarea id="snap-code" rows="12" placeholder="// Try any of the examples above, or write your own Bun 1.3 tests!
// Use test.concurrent, expectTypeOf, toMatchInlineSnapshot, test.failing, etc.

// Example: Concurrent API testing
import { test, expect } from 'bun:test';

test.concurrent('GitHub API', async () => {
  const res = await fetch('https://api.github.com/users/octocat');
  expect(res.status).toBe(200);
  const user = await res.json();
  expect(user.login).toBe('octocat');
});

test('Type checking', () => {
  expectTypeOf<string>().toEqualTypeOf<string>();
  expectTypeOf({a: 1}).toHaveProperty('a');
});"></textarea>
    </div>

    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
      <button id="run-snap" class="arena-btn" aria-busy="false">â–¶ï¸ Run Tests</button>
      <button id="clear-snap" class="arena-btn" style="background: linear-gradient(135deg, #484f58 0%, #30363d 100%);">ğŸ—‘ï¸ Clear</button>
      <button id="load-concurrent" class="arena-btn">âš¡ Load Concurrent Example</button>
      <button id="load-types" class="arena-btn">ğŸ¯ Load Type Testing</button>
      <button id="load-inline" class="arena-btn">ğŸ“¸ Load Inline Snapshots</button>
    </div>

    <div style="margin-bottom: 1rem;">
      <h3 style="color: #58a6ff;">ğŸ“Š Test Results</h3>
      <pre id="snap-out" style="min-height: 200px; background: #161b22; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow: auto;"></pre>
    </div>

    <div style="margin-bottom: 1rem;">
      <h3 style="color: #58a6ff;">ğŸš€ Bun 1.3 Developer Experience Features</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
        <div class="example-card">
          <h4>âš¡ Performance & Utilities</h4>
          <pre><code>import { stripANSI, hash } from "bun";

// Strip ANSI codes (6-57x faster)
const plain = stripANSI("\\x1b[31mRed\\x1b[0m");
// "Red"

// Rapidhash for fast non-crypto hashing
const hashValue = hash.rapidhash("data");
// BigInt hash value

// postMessage 500x faster for strings (benchmarked at GitHub: oven-sh/bun/bench/postMessage)
worker.postMessage(largeJsonString);

// Performance benchmark demonstrates massive improvement:
// Traditional browsers: ~50-100Î¼s for large strings
// Bun 1.3: ~0.1-0.2Î¼s for same payload (500x+ improvement)</code></pre>
        </div>

        <div class="example-card">
          <h4>ğŸ”§ Process & Shell Improvements</h4>
          <pre><code>import { spawn } from "bun";

// Timeout processes automatically
const proc = spawn({
  cmd: ["sleep", "10"],
  timeout: 1000,  // Kill after 1s
});

// Limit output size
const proc2 = spawn({
  cmd: ["yes"],
  maxBuffer: 1024 * 1024, // 1MB max
  stdout: "pipe"
});</code></pre>
        </div>

        <div class="example-card">
          <h4>ğŸŒ Enhanced Networking</h4>
          <pre><code>import { connect } from "bun";

const socket = await connect({
  hostname: "example.com",
  port: 80
});

// Rich connection info
console.log({
  localAddress: socket.localAddress,
  localPort: socket.localPort,
  remoteAddress: socket.remoteAddress,
  remoteFamily: socket.remoteFamily
});</code></pre>
        </div>
      </div>
    </div>

    <div style="font-size: 0.9rem; color: #8b949e; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
      <strong>ğŸ’¡ Bun 1.3 Pro Tips:</strong>
      <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
        <li><strong>Concurrent Testing:</strong> Use <code>--randomize</code> to detect test dependencies, <code>--max-concurrency</code> to control parallelism</li>
        <li><strong>VS Code Integration:</strong> Install "Bun for Visual Studio Code" extension for Test Explorer integration</li>
        <li><strong>CI Mode:</strong> Prevents <code>test.only()</code> and new snapshots without <code>--update-snapshots</code></li>
        <li><strong>TypeScript:</strong> Default <code>"module": "Preserve"</code> preserves exact module syntax</li>
        <li><strong>Console Depth:</strong> Use <code>--console-depth=5</code> or <code>bunfig.toml</code> to control object inspection</li>
        <li><strong>BUN_OPTIONS:</strong> Set default CLI args: <code>export BUN_OPTIONS="--watch --hot"</code></li>
        <li><strong>Custom User-Agent:</strong> <code>bun --user-agent="MyApp/1.0" script.ts</code></li>
        <li><strong>SQL Preconnect:</strong> <code>bun --sql-preconnect</code> for faster first database queries</li>
        <li><strong>Coverage:</strong> Use <code>test.coveragePathIgnorePatterns</code> in bunfig.toml</li>
        <li><strong>Performance:</strong> 500x faster postMessage for strings, SIMD optimizations throughout</li>
      </ul>
    </div>

    <script type="module">
      const codeTextarea = document.getElementById("snap-code");
      const outputPre = document.getElementById("snap-out");

      // Example loaders
      const examples = {
        concurrent: `import { test, describe } from "bun:test";

test.concurrent("fetch user data", async () => {
  const res = await fetch("https://httpbin.org/get");
  expect(res.status).toBe(200);
  const data = await res.json();
  expect(data).toHaveProperty("url");
});

describe.concurrent("API endpoints", () => {
  test("GET /users", async () => {
    const res = await fetch("https://httpbin.org/get");
    expect(res.ok).toBe(true);
  });

  test("GET /status", async () => {
    const res = await fetch("https://httpbin.org/status/200");
    expect(res.status).toBe(200);
  });

  test.serial("sequential cleanup", () => {
    expect(1 + 1).toBe(2);
  });
});`,

        types: `import { test, expect, expectTypeOf, mock } from "bun:test";

test("TypeScript type assertions", () => {
  // Basic type equality
  expectTypeOf<string>().toEqualTypeOf<string>();
  expectTypeOf<number>().toEqualTypeOf<number>();

  // Object property checking
  expectTypeOf({ foo: 1, bar: "test" }).toHaveProperty("foo");
  expectTypeOf({ foo: 1, bar: "test" }).toHaveProperty("bar");

  // Promise resolution types
  expectTypeOf<Promise<number>>().resolves.toBeNumber();
  expectTypeOf<Promise<string>>().resolves.toBeString();
});

test("mock return value assertions", () => {
  const fn = mock(() => "hello");
  fn();
  fn();
  fn();

  expect(fn).toHaveReturnedWith("hello");
  expect(fn).toHaveLastReturnedWith("hello");
  expect(fn).toHaveNthReturnedWith(1, "hello");
  expect(fn).toHaveNthReturnedWith(2, "hello");
});`,

        inline: `import { test, expect } from "bun:test";

test("user data formatting", () => {
  const user = {
    name: "Alice",
    age: 30,
    email: "alice@example.com",
    preferences: {
      theme: "dark",
      notifications: true
    }
  };

  expect(user).toMatchInlineSnapshot(\`
    {
      "name": "Alice",
      "age": 30,
      "email": "alice@example.com",
      "preferences": {
        "theme": "dark",
        "notifications": true,
      },
    }
  \`);
});

test("array data", () => {
  const items = [
    { id: 1, name: "Item 1" },
    { id: 2, name: "Item 2" },
    { id: 3, name: "Item 3" }
  ];

  expect(items).toMatchInlineSnapshot(\`
    [
      {
        "id": 1,
        "name": "Item 1",
      },
      {
        "id": 2,
        "name": "Item 2",
      },
      {
        "id": 3,
        "name": "Item 3",
      },
    ]
  \`);
});`
      };

      // Copy to clipboard function
      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          showToast("âœ… Copied to clipboard!");
        } catch (err) {
          // Fallback for older browsers
          const textArea = document.createElement("textarea");
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand("copy");
          document.body.removeChild(textArea);
          showToast("âœ… Copied to clipboard!");
        }
      }

      // Toast notification system
      function showToast(message) {
        // Remove existing toast
        const existingToast = document.querySelector('.toast');
        if (existingToast) {
          existingToast.remove();
        }

        // Create new toast
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);

        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 10);

        // Auto-hide after 3 seconds
        setTimeout(() => {
          toast.classList.remove('show');
          toast.classList.add('hide');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Button event handlers
      document.getElementById("run-snap").onclick = async () => {
        const button = document.getElementById("run-snap");
        const code = codeTextarea.value.trim();
        if (!code) {
          outputPre.textContent = "âŒ Please enter some test code to run.";
          return;
        }

        // Set busy state
        button.setAttribute("aria-busy", "true");
        button.textContent = "â³ Running Tests...";
        outputPre.textContent = "â³ Running tests...";

        try {
          const res = await fetch("/api/run-test", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code, entry: "test.ts" })
          });

          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }

          const { out, err, exitCode } = await res.json();
          const result = err || out || `Exit code: ${exitCode}`;

          // Add some visual formatting
          if (result.includes("pass") && result.includes("fail")) {
            outputPre.innerHTML = result.replace(
              /(âœ“|âœ—|pass|fail|error)/gi,
              '<span style="font-weight: bold; color: ' +
              (match => match.toLowerCase().includes('pass') || match === 'âœ“' ? '#238636' : '#da3633') +
              '">$&</span>'
            );
          } else {
            outputPre.textContent = result;
          }
        } catch (error) {
          outputPre.textContent = `âŒ Error: ${error.message}`;
        } finally {
          // Reset busy state
          button.setAttribute("aria-busy", "false");
          button.textContent = "â–¶ï¸ Run Tests";
        }
      };

      document.getElementById("clear-snap").onclick = () => {
        codeTextarea.value = "";
        outputPre.textContent = "Output cleared. Ready to run tests!";
      };

      document.getElementById("load-concurrent").onclick = () => {
        codeTextarea.value = examples.concurrent;
        outputPre.textContent = "âš¡ Concurrent testing example loaded! Click 'Run Tests' to execute.";
      };

      document.getElementById("load-types").onclick = () => {
        codeTextarea.value = examples.types;
        outputPre.textContent = "ğŸ¯ Type testing example loaded! Click 'Run Tests' to execute.";
      };

      document.getElementById("load-inline").onclick = () => {
        codeTextarea.value = examples.inline;
        outputPre.textContent = "ğŸ“¸ Inline snapshots example loaded! Click 'Run Tests' to execute.";
      };

      // Make copyToClipboard available globally for copy buttons
      window.copyToClipboard = copyToClipboard;

      // Initialize with a welcome message
      outputPre.textContent = "ğŸ‰ Bun 1.3 Advanced Testing Lab ready!\n\nChoose an example above or paste your own test code.\n\nFeatures showcased:\nâ€¢ Concurrent testing with test.concurrent\nâ€¢ Type assertions with expectTypeOf()\nâ€¢ Inline snapshots with automatic indentation\nâ€¢ New matchers like toHaveReturnedWith()\nâ€¢ test.failing() for expected failures\nâ€¢ Chain qualifiers (.only, .skip, .each, .failing)\n\nClick 'Run Tests' to experience Bun 1.3 testing! ğŸš€";
    </script>
  </section>
</body>
</html>

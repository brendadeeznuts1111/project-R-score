# Closed-Loop Perception Pipeline: Lived Workflow

**Version**: 17.0.0.1.0.0.0  
**Purpose**: Document the actual lived workflow of Hyper-Bun engineers  
**Philosophy**: Zero context switch cost from terminal to dashboard  
**Last Updated**: 2024-12-07

---

## ğŸ¯ The Pipeline: Keypress â†’ Token â†’ Photon â†’ Decision â†’ Keypress

This document captures the **actual lived workflow** that Hyper-Bun engineers experience every day â€” the seamless, zero-context-switch pipeline from operational telemetry to visual clarity.

---

## ğŸ”„ Complete Workflow: HBMO-017 Latency Spike Detection

### Phase 1: Trigger â†’ Operational Telemetry

**Context**: Engineer working in `mlgs-monitoring` session

**Session Layout**:
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Window 1: Logs (3 panes)                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ All Logs     â”‚ Errors/Warns â”‚ Warnings    â”‚  â”‚
â”‚ â”‚ (jq filtered)â”‚ (filtered)   â”‚ (filtered)  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ Window 2: Analytics (Dashboard)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ localhost:8080/analytics.html              â”‚  â”‚
â”‚ â”‚ (w3m/lynx/Chrome - always open)            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ Window 3: Health & Metrics                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Event**: Latency spike detected in ConcealedArbEngine

**Terminal Output** (Window 1, Errors/Warns pane):
```text
[WARN] HBMO-017 | ConcealedArbEngine | latency_spike_detected > 180ms
```

**Visual Characteristics**:
- Color: Yellow (`colour220` = `#ffd700`)
- Semantic Token: `--color-risk-warning` (`#f59e0b`)
- Font: Monospace (terminal default)
- Context: Real-time log stream with jq filtering

**Engineer Perception**:
- Sees yellow warning text
- Recognizes `HBMO-017` event code
- Understands `latency_spike_detected > 180ms` severity
- **No action yet** â€” gathering information

---

### Phase 2: Immediate Reflex â†’ Context Preservation

**Action**: Engineer hits `Ctrl-Space n` (or `Ctrl-Space ,`)

**What Happens**:
1. Tmux switches to Window 2 (Analytics)
2. Dashboard already loaded (never closed)
3. **Zero context switch** â€” engineer stays in Tmux session
4. **Zero visual jarring** â€” dashboard uses same dark theme

**Dashboard State**:
- URL: `http://localhost:8080/analytics.html`
- Browser: `w3m` (text browser) OR `lynx` OR Chrome tab
- Theme: Dark (matches terminal)
- Status: Real-time updates (WebSocket or polling)

**Key Point**: Engineer **never leaves Tmux**. Dashboard is **always accessible** from terminal.

---

### Phase 3: Instant Visual Correlation â†’ Deterministic Radiance

**Dashboard Response**: Instantly surfaces the same `HBMO-017` event

**Visual Elements**:

#### 1. Flashing Alert Card
```css
.alert-card.hbmo-017 {
  background: light-dark(#ffebee, #421c1c);
  /* Light mode: Light red background */
  /* Dark mode: Dark red background (matches terminal) */
  
  border-left: 6px solid var(--color-risk-warning);
  /* Same semantic token as terminal yellow */
  /* Visual: Yellow/orange border */
  
  animation: critical-flash 3s infinite;
  /* Pulsing animation draws attention */
}
```

**Visual**: Card with yellow/orange left border, pulsing animation

**Semantic**: **Same token** (`--color-risk-warning`) as terminal log

---

#### 2. Event ID Highlighting
```css
.event-id.hbmo-017 {
  color: var(--color-semantic-warn-fg);
  /* #f59e0b - Matches terminal yellow */
  
  font-weight: 700;
  font-feature-settings: "zero" 1, "tnum" 1;
  /* Tabular numbers for perfect alignment */
}
```

**Visual**: `HBMO-017` highlighted in yellow/orange

**Semantic**: **Same color** as terminal warning

---

#### 3. Real-Time Latency Sparkline
```css
.latency-sparkline {
  stroke: var(--color-accent-electric);
  /* #00d4ff - Cyan for normal latency */
  
  fill: var(--color-risk-warning);
  /* #f59e0b - Yellow for spike */
  
  stroke-width: 2px;
}
```

**Visual**: Cyan line with yellow spike at 180ms threshold

**Semantic**: Yellow spike = warning (matches terminal)

---

#### 4. Typography Alignment
```css
.metric-value {
  font-feature-settings: "zero" 1, "tnum" 1;
  /* Zero: Slashed zero (0 vs O) */
  /* Tnum: Tabular numbers (perfect alignment) */
  
  font-family: "JetBrains Mono", monospace;
  /* Matches terminal monospace */
}
```

**Visual**: Numbers align perfectly even when Tmux pane resized to 38 columns

**Semantic**: **Same typography** as terminal

---

### Phase 4: Decision â†’ Action

**Engineer Perception**:
1. Sees yellow warning in terminal â†’ **Recognizes severity**
2. Switches to dashboard â†’ **Sees same yellow** in alert card
3. Sees `HBMO-017` highlighted â†’ **Matches terminal event**
4. Sees latency sparkline â†’ **Visual confirmation** of spike
5. **Takes action** â†’ Investigates ConcealedArbEngine latency

**Key Point**: **Zero cognitive overhead** â€” colors mean the same thing everywhere

---

## ğŸ¨ Semantic Token Flow

### The Token Journey

```text
Terminal Log
  â†“
[WARN] HBMO-017 | ConcealedArbEngine | latency_spike_detected > 180ms
  â†“
Semantic Token: --color-risk-warning (#f59e0b)
  â†“
Terminal Color: colour220 (#ffd700) [closest xterm match]
  â†“
Dashboard CSS: var(--color-risk-warning)
  â†“
Visual Elements:
  - Alert card border: 6px solid var(--color-risk-warning)
  - Event ID color: var(--color-semantic-warn-fg)
  - Latency spike fill: var(--color-risk-warning)
  â†“
Engineer Perception: "Yellow = Warning" (consistent everywhere)
```

**Result**: **Deterministic radiance** â€” same token â†’ same meaning â†’ all media

---

## ğŸ”§ Technical Implementation

### Terminal â†’ Dashboard Token Mapping

**Terminal Colors** (xterm-256color):
```tmux
# Warning color
#[fg=colour220]WARN:#{warn_count}
# Maps to: --color-risk-warning
```

**Dashboard CSS**:
```css
:root {
  --color-risk-warning: #f59e0b;
  /* Terminal: colour220 (#ffd700) - closest match */
  /* Dashboard: Exact hex value */
  /* Semantic: Same meaning */
}
```

**Component Usage**:
```css
.alert-card.warning {
  border-left: 6px solid var(--color-risk-warning);
  /* Uses same token as terminal */
}
```

**Result**: **Visual consistency** across terminal and dashboard

---

### Theme Synchronization

**Terminal Theme**: Dark (default)
- Background: `colour234` (#1c1c1c)
- Text: `colour137` (#af875f)

**Dashboard Theme**: Dark (automatic)
```css
.alert-card {
  background: light-dark(#ffebee, #421c1c);
  /* Light mode: Light red */
  /* Dark mode: Dark red (matches terminal) */
}
```

**Result**: **Zero visual jarring** when switching windows

---

### Typography Consistency

**Terminal**: Monospace font (terminal default)

**Dashboard**: Matches terminal
```css
.metric-value {
  font-family: "JetBrains Mono", monospace;
  /* Same monospace as terminal */
  
  font-feature-settings: "zero" 1, "tnum" 1;
  /* Tabular numbers for alignment */
}
```

**Result**: **Perfect alignment** even in narrow terminal panes

---

## ğŸ“Š Workflow Patterns

### Pattern 1: Error â†’ Alert Flow

**Terminal**:
```text
[ERROR] HBMO-002 | MarketOfferingService | Required server configuration missing.
```
- Color: Red (`colour196`)
- Token: `--color-risk-critical`

**Dashboard**:
```css
.alert-card.critical {
  border-left: 6px solid var(--color-risk-critical);
  /* Same red as terminal */
}
```

**Flow**: Terminal error â†’ Dashboard red alert â†’ **Instant recognition**

---

### Pattern 2: Success â†’ Status Flow

**Terminal**:
```text
[INFO] System health: OK
```
- Color: Cyan (`colour51`)
- Token: `--color-accent-electric`

**Dashboard**:
```css
.status-indicator.active {
  background: var(--color-accent-electric);
  /* Same cyan as terminal */
}
```

**Flow**: Terminal success â†’ Dashboard green status â†’ **Instant confirmation**

---

### Pattern 3: Research â†’ Visualization Flow

**Terminal** (Research console):
```typescript
const event = await research.covertSteamEvents();
// Returns: CovertSteamEventRecord with high impact_severity_score
```

**Dashboard**:
```css
.covert-steam-card.critical {
  border-left: 6px solid var(--color-risk-critical);
  /* Red border for critical severity */
}
```

**Flow**: Console data â†’ Dashboard visualization â†’ **Visual matches data**

---

### Pattern 4: Router Development â†’ Multi-Window Workflow

**Terminal** (Router development session):
```bash
tmuxinator start -p .tmux-patterns.yml url-pattern-router-dev
```

**Session Layout**:
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Window 1: Core-Router (3 panes)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Dev Server   â”‚ Test Watch   â”‚ Router Logs  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ Window 2: Pattern-Optimizer (3 panes)           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Benchmarks   â”‚ Performance  â”‚ Metrics      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚ Window 3: Security-Validation (3 panes)         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Security     â”‚ Rate Limit   â”‚ Router Logs  â”‚  â”‚
â”‚ â”‚ Tests        â”‚ Tests        â”‚ (filtered)   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Workflow**:
- Router code changes â†’ Auto-reload dev server
- Test failures â†’ Instant feedback in test pane
- Performance regressions â†’ Benchmarks show in real-time
- Security issues â†’ Filtered logs surface immediately

**Key Point**: **Zero context switch** â€” all router development happens in one Tmux session with dedicated windows for each concern (core, performance, security, migration).

**Future Integration**: When URLPattern router is integrated, it will handle all dashboard API endpoints (`/api/health`, `/api/streams`, `/api/arbitrage/*`, etc.), maintaining the same terminal-to-dashboard workflow but with improved routing performance (218k req/sec).

---

## ğŸ¯ Benefits: Why This Matters

### 1. **Zero Context Switch**
- Engineer never leaves Tmux session
- Dashboard always accessible
- **No mental overhead** switching contexts

### 2. **Deterministic Radiance**
- Same token â†’ Same meaning â†’ All media
- **No ambiguity** about color meanings
- **Instant recognition** of severity levels

### 3. **Perceptual Clarity**
- Every photon carries maximum signal
- Colors convey meaning without reading text
- **Faster decision-making**

### 4. **Unified Nervous System**
- Keypress â†’ Token â†’ Photon â†’ Decision â†’ Keypress
- **One coherent system** from terminal to dashboard
- **Seamless workflow**

---

## ğŸ“‹ Implementation Checklist

### Terminal Integration âœ…
- [x] Map terminal colors to semantic tokens
- [x] Ensure consistent color meanings
- [x] Test in terminal browsers (w3m, lynx)

### Dashboard Integration âœ…
- [x] Use semantic tokens in components
- [x] Match terminal color meanings
- [x] Implement theme synchronization

### Typography âœ…
- [x] Match terminal monospace fonts
- [x] Implement tabular numbers
- [x] Ensure alignment in narrow panes

### Workflow Optimization âœ…
- [x] Dashboard always accessible from terminal
- [x] Zero context switch required
- [x] Real-time updates synchronized

---

## ğŸ” Ripgrep Patterns

```bash
# Find semantic token usage
rg "--color-risk-warning|--color-risk-critical" styles/*.css config/.tmux.conf

# Find workflow components
rg "HBMO-017|latency_spike|ConcealedArbEngine" src/**/*.ts dashboard/*.html

# Find alert card styling
rg "alert-card|covert-steam-card|correlation-card" styles/*.css
```

---

## ğŸ“š Related Documentation

- `docs/17.0.0.0.0.0.0-DESIGN-SYSTEM.md` - Design system overview
- `docs/11.4.6-TMUX-CSS-ECOSYSTEM-INTEGRATION.md` - Ecosystem integration
- `docs/11.4.5-COLOR-PATTERNS-INTEGRATION.md` - Color patterns
- `docs/operators/url-pattern-quickref.md` - URLPattern router quick reference
- `docs/migration/url-pattern-migration.md` - Router migration guide
- `.tmux-patterns.yml` - Router development environment (Pattern 4)

---

**Version**: 17.0.0.1.0.0.0  
**Status**: âœ… Documented  
**Philosophy**: **"There is no leap. It's one coherent nervous system."**

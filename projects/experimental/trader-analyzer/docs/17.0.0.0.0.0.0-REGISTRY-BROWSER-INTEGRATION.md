# Registry Browser Integration (17.0.2.0.0.0.0)

**Version**: 17.0.2.0.0.0.0  
**Purpose**: Registry browser integration with Design System and Terminal Environment  
**File**: `public/registry.html`, `public/manifest.json`  
**Status**: âœ… Integrated  
**Last Updated**: 2024-12-07

---

## ðŸŽ¯ Overview

The **NEXUS Registry Browser** (`public/registry.html`) is a unified interface for browsing all platform registries, including Bun TypeScript patterns, breaking changes, MCP tools, and system components. It integrates seamlessly with Hyper-Bun's Design System (17.0.0.0.0.0.0) and Terminal Environment (11.4.x) to provide zero context switch cost.

**Key Integration Points**:
- Design System color tokens (inline styles aligned with CSS variables)
- Terminal environment access patterns
- Closed-loop perception pipeline
- HTMLRewriter UI context injection
- Semantic color coding for status indicators

---

## ðŸ“‹ Registry Browser Features

### Core Functionality

**Registry Browser** (`public/registry.html`):
- **Visual Registry Browser**: Browse all platform registries
- **Category Filtering**: Filter by data, tooling, security, research, integration
- **Tag-Based Search**: Search registries by name, tag, or description
- **Status Indicators**: Semantic color coding (healthy=green, degraded=yellow, offline=red)
- **Registry Detail Modals**: View detailed information about each registry
- **API Endpoint Links**: Direct links to registry API endpoints
- **Favorites System**: Save frequently used registries
- **Pagination**: Navigate large registry lists
- **View Modes**: Grid, list, and compact views

---

## ðŸŽ¨ Design System Integration

### Color Alignment

**Registry.html** uses inline styles with hard-coded colors that **match Design System tokens**:

```html
<!-- Theme Color -->
<meta name="theme-color" content="#667eea">
<!-- Matches: --accent-purple: #667eea -->

<!-- Background -->
background: #0a0e27;
<!-- Matches: Dark theme background -->

<!-- Accent Colors -->
color: #667eea;  /* Purple - theme, headers */
color: #00d4ff;  /* Cyan - links, values */
color: #10b981;  /* Green - success, healthy */
color: #ef4444;  /* Red - errors, critical */
color: #f59e0b;  /* Yellow - warnings, degraded */
```

**Semantic Color Mapping**:

| Purpose | Registry.html Color | Design System Token | Terminal Color |
|---------|-------------------|---------------------|----------------|
| **Theme** | `#667eea` | `--accent-purple` | `colour99` |
| **Links/Values** | `#00d4ff` | `--accent-cyan` | `colour51` |
| **Success/Healthy** | `#10b981` | `--accent-green` | `colour82` |
| **Error/Critical** | `#ef4444` | `--accent-red` | `colour196` |
| **Warning/Degraded** | `#f59e0b` | `--accent-yellow` | `colour220` |

---

## ðŸ”— Terminal Environment Integration

### Access Patterns

**Registry Browser** is accessible from all tmux module sessions:

**Analytics Session** (`mlgs-analytics`):
```bash
# Window 2: Registry Browser
w3m http://localhost:8080/registry.html
# OR
lynx http://localhost:3001/registry.html
```

**Research Session** (`mlgs-research`):
```bash
# Window 3: Registry Browser for registry exploration
# Access via Chrome tab or terminal browser
```

**Core Session** (`mlgs-core`):
```bash
# Registry Browser accessible via Ctrl-Space n
# Quick access to API endpoints and registry documentation
```

**Monitoring Session** (`mlgs-monitoring`):
```bash
# Registry Browser for system component status
# View registry health indicators
```

### Zero Context Switch Workflow

**Example**: Engineer needs to find API endpoint for registry

**Step 1: Terminal** (Research Console)
```bash
bun run console
> await research.registryList()
# Returns: Registry IDs and names
```

**Step 2: Registry Browser** (Analytics Window)
```bash
# Engineer switches to Analytics window
# Opens: http://localhost:8080/registry.html
# Searches for registry by name
# Clicks registry card â†’ Modal opens
# Sees API endpoint: GET /api/registry/{id}
```

**Step 3: API Call** (Same Terminal)
```bash
# Engineer copies endpoint
# Returns to Research console
> fetch('http://localhost:3001/api/registry/{id}')
# Gets registry data
```

**Result**: **Zero context switch** â€” engineer never leaves tmux session

---

## ðŸ”„ Closed-Loop Pipeline Integration

### Registry Browser â†’ API Endpoint Flow

**Terminal Command**:
```bash
# Engineer runs command
bun run console
> await research.registryList()
```

**Registry Browser Display**:
- Registry cards use semantic colors
- Status indicators match terminal log colors
- API endpoints highlighted in cyan (`#00d4ff`)

**API Endpoint**:
- Same semantic token used in terminal output
- Registry browser displays endpoint with cyan color
- **Same meaning** across terminal â†’ browser â†’ API

**Visual Consistency**:
```html
<!-- Registry Browser Status Indicator -->
.status-healthy { color: #10b981; }  /* Green */
.status-degraded { color: #f59e0b; }  /* Yellow */
.status-offline { color: #ef4444; }  /* Red */

<!-- Terminal Log Colors -->
[INFO] â†’ Cyan (#00d4ff)
[WARN] â†’ Yellow (#f59e0b)
[ERROR] â†’ Red (#ef4444)
```

**Result**: **Deterministic radiance** â€” same colors mean the same thing

---

## ðŸŽ¨ Component-Specific Integration

### Status Indicators

**Registry Browser**:
```html
<div class="status-indicator status-healthy">
  <span class="status-dot"></span>
  Healthy
</div>
```

**CSS** (inline):
```css
.status-healthy { 
  color: #10b981;  /* Matches --accent-green */
  background: rgba(16, 185, 129, 0.2);
}
```

**Terminal Log**:
```text
[INFO] Registry healthy
```
- Color: Cyan (`colour51`) for info
- **Same semantic meaning** as browser status

---

### Category Colors

**Registry Browser** uses category-specific colors:

```css
.category-data { 
  background: rgba(16, 185, 129, 0.2); 
  color: #10b981;  /* Green - data registries */
}

.category-tooling { 
  background: rgba(139, 92, 246, 0.2); 
  color: #8b5cf6;  /* Purple - tooling */
}

.category-security { 
  background: rgba(239, 68, 68, 0.2); 
  color: #ef4444;  /* Red - security */
}

.category-research { 
  background: rgba(245, 158, 11, 0.2); 
  color: #f59e0b;  /* Yellow - research */
}
```

**Design System Alignment**:
- Data â†’ Green (`--accent-green`)
- Security â†’ Red (`--accent-red`)
- Research â†’ Yellow (`--accent-yellow`)
- **Same semantic meanings** as design system

---

## ðŸ”§ HTMLRewriter Integration

### UI Context Injection

**Server-Side** (`src/index.ts`, `scripts/dashboard-server.ts`):
```typescript
// Create UI context
const uiContext = await uiPolicyManager.buildUIContext(
  c.req.raw,
  runtimeFeatureFlags,
);

// Inject into registry.html
const rewriter = new UIContextRewriter(uiContext);
const transformed = rewriter.transform(htmlContent);
```

**Client-Side** (`public/registry.html`):
```javascript
// Consume UI context
const uiContext = window.HYPERBUN_UI_CONTEXT || {
  apiBaseUrl: window.location.origin,
  featureFlags: {},
  userRole: 'guest',
  debugMode: false,
  currentTimestamp: Date.now()
};
```

**Feature Flag Integration**:
```html
<!-- Conditionally rendered based on feature flags -->
<section id="shadow-graph-section" 
         data-feature="shadowGraph" 
         data-access="admin">
  <!-- Only rendered if shadowGraph feature enabled AND user is admin -->
</section>
```

---

## ðŸ“Š Registry Browser Manifest

### Manifest Structure (`public/manifest.json`)

**Standard PWA Fields**:
```json
{
  "name": "NEXUS Registry Browser",
  "short_name": "Registry",
  "theme_color": "#667eea",
  "background_color": "#0a0e27"
}
```

**Design System Integration**:
```json
"_design_system": {
  "version": "17.0.0.0.0.0.0",
  "color_tokens": {
    "theme_color": "#667eea",
    "accent_cyan": "#00d4ff",
    "accent_green": "#10b981",
    "accent_red": "#ef4444",
    "accent_yellow": "#f59e0b"
  }
}
```

**Terminal Integration**:
```json
"_terminal_integration": {
  "tmux_sessions": [
    "mlgs-core",
    "mlgs-analytics",
    "mlgs-research",
    "mlgs-monitoring"
  ],
  "access_patterns": [
    "w3m http://localhost:3001/registry.html",
    "w3m http://localhost:8080/registry.html"
  ]
}
```

---

## ðŸŽ¯ Integration Benefits

### 1. **Visual Consistency**
- Registry browser colors match design system tokens
- Status indicators use semantic colors
- **Zero visual jarring** when switching between terminal and browser

### 2. **Zero Context Switch**
- Registry browser accessible from all tmux sessions
- Terminal browsers supported (w3m, lynx)
- **Engineer never leaves tmux session**

### 3. **Semantic Consistency**
- Same color meanings across terminal â†’ browser â†’ API
- Status colors match log severity levels
- **Deterministic radiance** maintained

### 4. **Workflow Efficiency**
- Terminal command â†’ Registry browser â†’ API endpoint
- Copy endpoint from browser â†’ Use in terminal
- **Seamless workflow** from discovery to usage

---

## ðŸ“‹ Usage Examples

### Example 1: Finding Registry API Endpoint

**Terminal** (Research Console):
```bash
bun run console
> await research.registryList()
# Returns: List of registry IDs
```

**Registry Browser** (Analytics Window):
```bash
# Open: http://localhost:8080/registry.html
# Search for registry by name
# Click registry card â†’ Modal opens
# See API endpoint: GET /api/registry/{id}
# Copy endpoint
```

**Terminal** (Same Console):
```bash
> fetch('http://localhost:3001/api/registry/{id}')
# Use endpoint in terminal
```

**Result**: **Zero context switch** â€” seamless workflow

---

### Example 2: Checking Registry Status

**Terminal** (Monitoring Session):
```bash
# See log output
[WARN] Registry degraded: bun-native-utils
```

**Registry Browser** (Monitoring Window):
```bash
# Open: http://localhost:8080/registry.html
# Search for "bun-native-utils"
# See yellow status indicator (degraded)
# Matches terminal warning color
```

**Result**: **Visual confirmation** â€” same color, same meaning

---

### Example 3: Registry Discovery

**Terminal** (Research Console):
```bash
bun run console
> await research.discoverPatterns()
# Returns: Pattern registry IDs
```

**Registry Browser** (Research Window):
```bash
# Open: http://localhost:8080/registry.html
# Filter by "research" category
# See yellow category badges (research)
# Browse registry cards
# Click to view details
```

**Result**: **Category color coding** â€” yellow for research, consistent with design system

---

## ðŸ” Ripgrep Patterns

```bash
# Find registry.html references
rg "registry\.html" src/**/*.ts scripts/*.ts

# Find registry browser colors
rg "#667eea|#00d4ff|#10b981|#ef4444|#f59e0b" public/registry.html

# Find HTMLRewriter integration
rg "HYPERBUN_UI_CONTEXT|UIContextRewriter" public/registry.html src/**/*.ts

# Find status indicator colors
rg "status-healthy|status-degraded|status-offline" public/registry.html
```

---

## ðŸ“š Related Documentation

- `docs/17.0.0.0.0.0.0-DESIGN-SYSTEM.md` - Design system overview
- `docs/17.0.0.0.0.0.0-DASHBOARD-MANIFEST.md` - Dashboard manifest integration (17.0.1.0.0.0.0)
- `docs/17.0.0.0.0.0.0-CLOSED-LOOP-WORKFLOW.md` - Closed-loop workflow
- `docs/11.4.6-TMUX-CSS-ECOSYSTEM-INTEGRATION.md` - Terminal integration
- `docs/6.1.1.2.2.0.0-HTMLREWRITER-UNIFIED-DEPLOYMENT.md` - HTMLRewriter integration
- `public/registry.html` - Registry browser file
- `public/manifest.json` - Registry browser manifest

## ðŸ”§ Server Integration

### Main API Server (`src/index.ts`)

**Route**: `GET /public/manifest.json`  
**Purpose**: Serve registry browser manifest

**Implementation**:
```typescript
app.get("/public/manifest.json", async (c) => {
  const manifestFile = Bun.file(
    join(import.meta.dir, "..", "public", "manifest.json"),
  );
  if (await manifestFile.exists()) {
    return c.json(await manifestFile.json());
  }
  return c.json({ error: "manifest.json not found" }, 404);
});
```

### Dashboard Server (`scripts/dashboard-server.ts`)

**Route**: `GET /public/manifest.json` OR `GET /manifest.json` (with registry.html referer)  
**Purpose**: Serve registry browser manifest with ETag caching

**Implementation**:
```typescript
// Serve registry manifest.json (17.0.2.0.0.0.0)
if (path === "/public/manifest.json" || 
    (path === "/manifest.json" && request.headers.get("referer")?.includes("registry.html"))) {
  const registryManifestPath = join(PROJECT_ROOT, "public", "manifest.json");
  // ... serve with ETag caching
}
```

**Access URLs**:
- Main API: `http://localhost:3001/public/manifest.json`
- Dashboard Server: `http://localhost:8080/public/manifest.json`

---

## ðŸŽ¯ Future Enhancements

### Potential Improvements

1. **CSS Variable Migration**
   - Replace inline styles with CSS variables
   - Link to external stylesheet with design system tokens
   - Enable dynamic theme switching

2. **Terminal Browser Optimization**
   - Optimize layout for narrow terminals (38 columns)
   - Ensure tabular number alignment
   - Test with w3m and lynx

3. **Registry-Specific Colors**
   - Map registry categories to department colors
   - Use semantic tokens for status indicators
   - Align with design system color patterns

4. **Enhanced Integration**
   - Deep link support for registry cards
   - Terminal command â†’ Browser deep link
   - Browser action â†’ Terminal command execution

---

**Version**: 17.0.2.0.0.0.0  
**Status**: âœ… Integrated  
**Philosophy**: **"Same semantic token â†’ Same meaning â†’ All media"**

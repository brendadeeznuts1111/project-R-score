name: Color System CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  color-audit:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Bun
      uses: oven-sh/setup-bun@v1
      with:
        bun-version: latest
    
    - name: Install dependencies
      run: bun install
    
    - name: Run Color Validation
      run: bun run colors:validate
    
    - name: Run Color Audit
      run: bun run colors:audit
    
    - name: Check Coverage
      run: |
        COVERAGE=$(bun run colors:coverage)
        if [ "$COVERAGE" -lt 98.7 ]; then
          echo "❌ Color coverage below required 98.7%"
          exit 1
        fi
        echo "✅ Color coverage meets requirements"
    
    - name: Deploy to Production
      if: github.ref == 'refs/heads/main'
      run: bun run production:colors --domains="factory-wager.com,duoplus.com"

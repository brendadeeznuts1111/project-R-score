<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Management System - Enhanced Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass-effect {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .db-card {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .db-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        .status-maintenance { background-color: #f97316; }
        .db-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            stroke-dasharray: 251.2 251.2;
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        .query-editor {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .sql-keyword { color: #3b82f6; }
        .sql-string { color: #3b82f6; }
        .sql-number { color: #3b82f6; }
        .sql-comment { color: #3b82f6; font-style: italic; }
        .table-row:hover { background-color: rgba(59, 130, 246, 0.1); }
        .connection-pool {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10b981;
        }
        .connection-dot.inactive {
            background-color: #ef4444;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }
        .metric-card {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <button onclick="window.history.back()" class="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        <span>Back to Dashboard</span>
                    </button>
                    <div class="flex items-center space-x-3">
                        <i data-lucide="database" class="w-8 h-8 text-blue-500"></i>
                        <h1 class="text-2xl font-bold">Database Management System</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full status-online pulse-animation"></div>
                        <span class="text-sm">All Databases Online</span>
                    </div>
                    <select id="dbFilter" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm">
                        <option value="all">All Databases</option>
                        <option value="postgresql">PostgreSQL</option>
                        <option value="redis">Redis</option>
                        <option value="mongodb">MongoDB</option>
                    </select>
                    <button onclick="refreshDatabases()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors text-sm">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                        Refresh
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Database Overview -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="server" class="w-8 h-8 text-blue-500"></i>
                        <span class="text-2xl font-bold" id="totalDatabases">0</span>
                    </div>
                    <p class="text-gray-400 text-sm">Total Databases</p>
                </div>
                <div class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="hard-drive" class="w-8 h-8 text-green-500"></i>
                        <span class="text-2xl font-bold" id="totalStorage">0GB</span>
                    </div>
                    <p class="text-gray-400 text-sm">Total Storage</p>
                </div>
                <div class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="users" class="w-8 h-8 text-purple-500"></i>
                        <span class="text-2xl font-bold" id="totalConnections">0</span>
                    </div>
                    <p class="text-gray-400 text-sm">Active Connections</p>
                </div>
                <div class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="activity" class="w-8 h-8 text-orange-500"></i>
                        <span class="text-2xl font-bold" id="avgResponseTime">0ms</span>
                    </div>
                    <p class="text-gray-400 text-sm">Avg Response Time</p>
                </div>
            </div>
        </section>

        <!-- Database Cards -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold flex items-center">
                    <i data-lucide="grid-3x3" class="w-5 h-5 mr-2"></i>
                    Database Instances
                </h2>
                <button onclick="addDatabase()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors text-sm">
                    <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                    Add Database
                </button>
            </div>
            
            <div id="databaseGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Database cards will be dynamically added here -->
            </div>
        </section>

        <!-- Query Editor -->
        <section class="mb-8">
            <div class="glass-effect rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold flex items-center">
                        <i data-lucide="code" class="w-5 h-5 mr-2"></i>
                        Query Editor
                    </h2>
                    <div class="flex items-center space-x-4">
                        <select id="queryDb" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm">
                            <option value="postgresql">PostgreSQL</option>
                            <option value="redis">Redis</option>
                        </select>
                        <button onclick="executeQuery()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors text-sm">
                            <i data-lucide="play" class="w-4 h-4 inline mr-2"></i>
                            Execute
                        </button>
                        <button onclick="clearQuery()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors text-sm">
                            <i data-lucide="x" class="w-4 h-4 inline mr-2"></i>
                            Clear
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium mb-4">SQL Query</h3>
                        <textarea 
                            id="queryEditor"
                            class="w-full h-64 p-4 bg-gray-800 border border-gray-700 rounded-lg query-editor text-sm"
                            placeholder="Enter your SQL query here..."
                        >SELECT * FROM users WHERE status = 'active' LIMIT 10;</textarea>
                        
                        <div class="mt-4 flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <button onclick="formatQuery()" class="text-blue-400 hover:text-blue-300 text-sm">
                                    <i data-lucide="indent" class="w-4 h-4 inline mr-1"></i>
                                    Format
                                </button>
                                <button onclick="saveQuery()" class="text-green-400 hover:text-green-300 text-sm">
                                    <i data-lucide="save" class="w-4 h-4 inline mr-1"></i>
                                    Save
                                </button>
                                <button onclick="loadQuery()" class="text-purple-400 hover:text-purple-300 text-sm">
                                    <i data-lucide="folder-open" class="w-4 h-4 inline mr-1"></i>
                                    Load
                                </button>
                            </div>
                            <span class="text-sm text-gray-400">Lines: <span id="lineCount">1</span></span>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium mb-4">Query Results</h3>
                        <div id="queryResults" class="bg-gray-800 rounded-lg p-4 h-64 overflow-auto">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="database" class="w-12 h-12 mx-auto mb-4"></i>
                                <p>Execute a query to see results</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex items-center justify-between">
                            <div class="text-sm text-gray-400">
                                <span id="resultCount">0</span> rows returned
                            </div>
                            <div class="text-sm text-gray-400">
                                Execution time: <span id="executionTime">0ms</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Performance Analytics -->
        <section class="mb-8">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i data-lucide="bar-chart" class="w-5 h-5 mr-2"></i>
                    Performance Analytics
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Query Performance -->
                    <div>
                        <h3 class="text-lg font-medium mb-4">Query Performance</h3>
                        <div class="chart-container">
                            <canvas id="queryPerformanceChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Storage Usage -->
                    <div>
                        <h3 class="text-lg font-medium mb-4">Storage Usage</h3>
                        <div class="chart-container">
                            <canvas id="storageChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Connection Pool -->
                    <div>
                        <h3 class="text-lg font-medium mb-4">Connection Pool</h3>
                        <div class="chart-container">
                            <canvas id="connectionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Database Operations -->
        <section>
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i data-lucide="settings" class="w-5 h-5 mr-2"></i>
                    Database Operations
                </h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="backupDatabase()" class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors">
                        <i data-lucide="download" class="w-6 h-6 mx-auto mb-2"></i>
                        <span class="text-sm">Backup Database</span>
                    </button>
                    <button onclick="restoreDatabase()" class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors">
                        <i data-lucide="upload" class="w-6 h-6 mx-auto mb-2"></i>
                        <span class="text-sm">Restore Database</span>
                    </button>
                    <button onclick="optimizeDatabase()" class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors">
                        <i data-lucide="zap" class="w-6 h-6 mx-auto mb-2"></i>
                        <span class="text-sm">Optimize</span>
                    </button>
                    <button onclick="analyzeDatabase()" class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors">
                        <i data-lucide="search" class="w-6 h-6 mx-auto mb-2"></i>
                        <span class="text-sm">Analyze</span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Database Details Modal -->
    <div id="dbModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="glass-effect rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold" id="modalDbName">Database Details</h3>
                <button onclick="closeDbModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div id="modalContent">
                <!-- Modal content will be dynamically added here -->
            </div>
        </div>
    </div>

    <script>
        // Database Management System
        class DatabaseManagementSystem {
            constructor() {
                this.databases = [];
                this.filteredDatabases = [];
                this.charts = {};
                this.queryHistory = [];
                this.init();
            }

            init() {
                // Initialize Lucide icons
                lucide.createIcons();
                
                // Load database data
                this.loadDatabases();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Initialize charts
                this.initializeCharts();
                
                // Start monitoring
                this.startMonitoring();
            }

            setupEventListeners() {
                // Database filter
                document.getElementById('dbFilter').addEventListener('change', () => {
                    this.filterDatabases();
                });
                
                // Query editor
                const queryEditor = document.getElementById('queryEditor');
                queryEditor.addEventListener('input', () => {
                    this.updateLineCount();
                    this.highlightSyntax();
                });
                
                queryEditor.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        this.executeQuery();
                    }
                });
            }

            async loadDatabases() {
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Mock database data
                    this.databases = [
                        {
                            id: 1,
                            name: 'PostgreSQL Primary',
                            type: 'postgresql',
                            host: 'db-primary.example.com',
                            port: 5432,
                            status: 'active',
                            version: '14.5',
                            size: '45.2GB',
                            connections: 25,
                            maxConnections: 100,
                            cpu: 12,
                            memory: 45,
                            queries: 1250,
                            cacheHit: 94.5,
                            icon: { bg: '#3b82f6', icon: 'database' },
                            tables: 156,
                            indexes: 234,
                            lastBackup: '2024-01-13 02:00:00'
                        },
                        {
                            id: 2,
                            name: 'PostgreSQL Replica',
                            type: 'postgresql',
                            host: 'db-replica.example.com',
                            port: 5432,
                            status: 'active',
                            version: '14.5',
                            size: '45.2GB',
                            connections: 15,
                            maxConnections: 100,
                            cpu: 8,
                            memory: 38,
                            queries: 890,
                            cacheHit: 96.2,
                            icon: { bg: '#3b82f6', icon: 'copy' },
                            tables: 156,
                            indexes: 234,
                            lastBackup: '2024-01-13 02:00:00'
                        },
                        {
                            id: 3,
                            name: 'Redis Cache',
                            type: 'redis',
                            host: 'redis.example.com',
                            port: 6379,
                            status: 'active',
                            version: '7.0.5',
                            size: '2.1GB',
                            connections: 45,
                            maxConnections: 1000,
                            cpu: 5,
                            memory: 23,
                            queries: 8900,
                            cacheHit: 98.2,
                            icon: { bg: '#3b82f6', icon: 'layers' },
                            keys: 125000,
                            memory: '512MB',
                            lastBackup: '2024-01-13 01:30:00'
                        },
                        {
                            id: 4,
                            name: 'MongoDB Analytics',
                            type: 'mongodb',
                            host: 'mongo.example.com',
                            port: 27017,
                            status: 'active',
                            version: '6.0.8',
                            size: '12.8GB',
                            connections: 12,
                            maxConnections: 500,
                            cpu: 15,
                            memory: 52,
                            queries: 450,
                            cacheHit: 91.8,
                            icon: { bg: '#3b82f6', icon: 'archive' },
                            collections: 89,
                            documents: 2500000,
                            lastBackup: '2024-01-13 03:00:00'
                        }
                    ];
                    
                    this.filteredDatabases = [...this.databases];
                    this.updateStatistics();
                    this.renderDatabases();
                    this.updateCharts();
                    
                } catch (error) {
                    console.error('Error loading databases:', error);
                    this.showNotification('Failed to load database data', 'error');
                }
            }

            filterDatabases() {
                const dbFilter = document.getElementById('dbFilter').value;
                
                this.filteredDatabases = dbFilter === 'all' 
                    ? [...this.databases]
                    : this.databases.filter(db => db.type === dbFilter);
                
                this.renderDatabases();
            }

            renderDatabases() {
                const grid = document.getElementById('databaseGrid');
                
                if (this.filteredDatabases.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i data-lucide="database" class="w-12 h-12 mx-auto mb-4 text-gray-500"></i>
                            <p class="text-gray-400">No databases found</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }
                
                grid.innerHTML = this.filteredDatabases.map(db => `
                    <div class="db-card glass-effect rounded-xl p-6 cursor-pointer" onclick="showDatabaseDetails(${db.id})">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="db-icon" style="background-color: ${db.icon.bg}; color: white;">
                                    <i data-lucide="${db.icon.icon}" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg">${db.name}</h3>
                                    <p class="text-sm text-gray-400">${db.type} v${db.version}</p>
                                </div>
                            </div>
                            <div class="w-3 h-3 rounded-full ${this.getStatusClass(db.status)}"></div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">Host</span>
                                <span class="text-sm font-mono">${db.host}:${db.port}</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">Size</span>
                                <span class="text-sm font-medium">${db.size}</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">Connections</span>
                                <div class="flex items-center space-x-2">
                                    <div class="connection-pool">
                                        ${Array.from({length: Math.min(10, db.maxConnections)}, (_, i) => 
                                            `<div class="connection-dot ${i < db.connections ? '' : 'inactive'}"></div>`
                                        ).join('')}
                                    </div>
                                    <span class="text-sm font-medium">${db.connections}/${db.maxConnections}</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">CPU</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 bg-gray-700 rounded-full h-2">
                                        <div class="h-2 rounded-full ${this.getUsageColor(db.cpu)}" style="width: ${db.cpu}%"></div>
                                    </div>
                                    <span class="text-sm font-medium">${db.cpu}%</span>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-400">Memory</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-16 bg-gray-700 rounded-full h-2">
                                        <div class="h-2 rounded-full ${this.getUsageColor(db.memory)}" style="width: ${db.memory}%"></div>
                                    </div>
                                    <span class="text-sm font-medium">${db.memory}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-700">
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-400">Last backup: ${db.lastBackup.split(' ')[1]}</span>
                                <button class="text-blue-400 hover:text-blue-300 text-sm">
                                    Manage â†’
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Re-initialize icons
                setTimeout(() => lucide.createIcons(), 100);
            }

            updateStatistics() {
                const totalDatabases = this.databases.length;
                const totalStorage = this.databases.reduce((sum, db) => {
                    const size = parseFloat(db.size.replace('GB', ''));
                    return sum + size;
                }, 0);
                const totalConnections = this.databases.reduce((sum, db) => sum + db.connections, 0);
                const avgResponseTime = Math.round(this.databases.reduce((sum, db) => sum + (100 - db.cpu), 0) / this.databases.length);
                
                document.getElementById('totalDatabases').textContent = totalDatabases;
                document.getElementById('totalStorage').textContent = `${totalStorage.toFixed(1)}GB`;
                document.getElementById('totalConnections').textContent = totalConnections;
                document.getElementById('avgResponseTime').textContent = `${avgResponseTime}ms`;
            }

            async executeQuery() {
                const query = document.getElementById('queryEditor').value.trim();
                const dbType = document.getElementById('queryDb').value;
                
                if (!query) {
                    this.showNotification('Please enter a query', 'warning');
                    return;
                }
                
                try {
                    // Show loading state
                    this.showQueryLoading();
                    
                    // Simulate query execution
                    const startTime = performance.now();
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                    const executionTime = (performance.now() - startTime).toFixed(2);
                    
                    // Mock query results
                    const results = this.generateMockResults(query, dbType);
                    
                    // Display results
                    this.displayQueryResults(results, executionTime);
                    
                    // Add to history
                    this.queryHistory.unshift({
                        query,
                        dbType,
                        timestamp: new Date().toISOString(),
                        executionTime,
                        rowCount: results.length
                    });
                    
                    this.showNotification('Query executed successfully', 'success');
                    
                } catch (error) {
                    console.error('Error executing query:', error);
                    this.showQueryError(error.message);
                    this.showNotification('Query execution failed', 'error');
                }
            }

            generateMockResults(query, dbType) {
                // Generate mock results based on query type
                if (query.toLowerCase().includes('select')) {
                    return [
                        { id: 1, name: 'John Doe', email: 'john@example.com', status: 'active', created_at: '2024-01-10' },
                        { id: 2, name: 'Jane Smith', email: 'jane@example.com', status: 'active', created_at: '2024-01-11' },
                        { id: 3, name: 'Bob Johnson', email: 'bob@example.com', status: 'inactive', created_at: '2024-01-12' },
                        { id: 4, name: 'Alice Brown', email: 'alice@example.com', status: 'active', created_at: '2024-01-13' },
                        { id: 5, name: 'Charlie Wilson', email: 'charlie@example.com', status: 'pending', created_at: '2024-01-13' }
                    ];
                } else {
                    return [{ message: 'Query executed successfully', affected_rows: Math.floor(Math.random() * 100) + 1 }];
                }
            }

            displayQueryResults(results, executionTime) {
                const resultsDiv = document.getElementById('queryResults');
                
                if (!results || results.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-4"></i>
                            <p>No results returned</p>
                        </div>
                    `;
                } else {
                    const columns = Object.keys(results[0]);
                    const tableHtml = `
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    ${columns.map(col => `<th class="text-left py-2 px-2 font-medium">${col}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${results.map((row, index) => `
                                    <tr class="table-row border-b border-gray-800">
                                        ${columns.map(col => `<td class="py-2 px-2">${row[col]}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    resultsDiv.innerHTML = tableHtml;
                }
                
                document.getElementById('resultCount').textContent = results.length;
                document.getElementById('executionTime').textContent = `${executionTime}ms`;
                
                // Re-initialize icons
                setTimeout(() => lucide.createIcons(), 100);
            }

            showQueryLoading() {
                const resultsDiv = document.getElementById('queryResults');
                resultsDiv.innerHTML = `
                    <div class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        <p class="mt-4 text-gray-400">Executing query...</p>
                    </div>
                `;
            }

            showQueryError(message) {
                const resultsDiv = document.getElementById('queryResults');
                resultsDiv.innerHTML = `
                    <div class="text-center py-8">
                        <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-4 text-red-500"></i>
                        <p class="text-red-400">Query Error</p>
                        <p class="text-sm text-gray-400 mt-2">${message}</p>
                    </div>
                `;
                document.getElementById('resultCount').textContent = '0';
                document.getElementById('executionTime').textContent = '0ms';
            }

            clearQuery() {
                document.getElementById('queryEditor').value = '';
                document.getElementById('queryResults').innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="database" class="w-12 h-12 mx-auto mb-4"></i>
                        <p>Execute a query to see results</p>
                    </div>
                `;
                document.getElementById('resultCount').textContent = '0';
                document.getElementById('executionTime').textContent = '0ms';
                this.updateLineCount();
            }

            formatQuery() {
                const editor = document.getElementById('queryEditor');
                let query = editor.value;
                
                // Basic SQL formatting
                query = query.replace(/\bSELECT\b/gi, '\nSELECT')
                           .replace(/\bFROM\b/gi, '\nFROM')
                           .replace(/\bWHERE\b/gi, '\nWHERE')
                           .replace(/\bORDER BY\b/gi, '\nORDER BY')
                           .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
                           .replace(/\bHAVING\b/gi, '\nHAVING')
                           .trim();
                
                editor.value = query;
                this.updateLineCount();
                this.highlightSyntax();
            }

            highlightSyntax() {
                // Basic syntax highlighting would go here
                // For simplicity, we're just updating the line count
            }

            updateLineCount() {
                const editor = document.getElementById('queryEditor');
                const lines = editor.value.split('\n').length;
                document.getElementById('lineCount').textContent = lines;
            }

            initializeCharts() {
                // Query Performance Chart
                const queryPerfCtx = document.getElementById('queryPerformanceChart').getContext('2d');
                this.charts.queryPerformance = new Chart(queryPerfCtx, {
                    type: 'line',
                    data: {
                        labels: Array(12).fill('').map((_, i) => `${i * 5}m`),
                        datasets: [{
                            label: 'Query Time (ms)',
                            data: [45, 52, 38, 65, 42, 58, 35, 48, 62, 41, 55, 39],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#3b82f6' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#3b82f6' },
                                grid: { color: 'rgba(156, 163, 175, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#3b82f6' },
                                grid: { display: false }
                            }
                        }
                    }
                });

                // Storage Chart
                const storageCtx = document.getElementById('storageChart').getContext('2d');
                this.charts.storage = new Chart(storageCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['PostgreSQL', 'Redis', 'MongoDB', 'Free Space'],
                        datasets: [{
                            data: [90.4, 2.1, 12.8, 150],
                            backgroundColor: ['#3b82f6', '#3b82f6', '#3b82f6', '#3b82f6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#3b82f6' }
                            }
                        }
                    }
                });

                // Connection Chart
                const connectionCtx = document.getElementById('connectionChart').getContext('2d');
                this.charts.connection = new Chart(connectionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Primary', 'Replica', 'Redis', 'MongoDB'],
                        datasets: [{
                            label: 'Active Connections',
                            data: [25, 15, 45, 12],
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        }, {
                            label: 'Max Connections',
                            data: [100, 100, 1000, 500],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#3b82f6' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#3b82f6' },
                                grid: { color: 'rgba(156, 163, 175, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#3b82f6' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            updateCharts() {
                // Update charts with real data
                if (this.charts.storage) {
                    const storageData = this.databases.map(db => parseFloat(db.size.replace('GB', '')));
                    this.charts.storage.data.datasets[0].data = [...storageData, 150]; // Add free space
                    this.charts.storage.update();
                }
                
                if (this.charts.connection) {
                    const activeConnections = this.databases.map(db => db.connections);
                    const maxConnections = this.databases.map(db => db.maxConnections);
                    this.charts.connection.data.datasets[0].data = activeConnections;
                    this.charts.connection.data.datasets[1].data = maxConnections;
                    this.charts.connection.update();
                }
            }

            startMonitoring() {
                // Simulate real-time monitoring
                setInterval(() => {
                    this.updateDatabaseMetrics();
                }, 10000);
            }

            updateDatabaseMetrics() {
                // Update random metrics
                this.databases.forEach(db => {
                    db.cpu = Math.max(5, Math.min(30, db.cpu + (Math.random() - 0.5) * 5));
                    db.memory = Math.max(20, Math.min(60, db.memory + (Math.random() - 0.5) * 3));
                    db.connections = Math.max(5, Math.min(db.maxConnections, db.connections + Math.floor((Math.random() - 0.5) * 10)));
                });
                
                this.updateStatistics();
                this.renderDatabases();
            }

            getStatusClass(status) {
                const classes = {
                    'active': 'status-online',
                    'warning': 'status-warning',
                    'error': 'status-offline',
                    'maintenance': 'status-maintenance'
                };
                return classes[status] || 'status-offline';
            }

            getUsageColor(usage) {
                if (usage < 50) return 'bg-green-500';
                if (usage < 75) return 'bg-yellow-500';
                if (usage < 90) return 'bg-orange-500';
                return 'bg-red-500';
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-4 px-4 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
                
                const colors = {
                    success: 'bg-green-600 text-white',
                    error: 'bg-red-600 text-white',
                    warning: 'bg-yellow-600 text-white',
                    info: 'bg-blue-600 text-white'
                };
                
                notification.className += ` ${colors[type]}`;
                notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info'}" class="w-5 h-5"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                lucide.createIcons();
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                    notification.classList.add('translate-x-0');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        // Database Details Modal
        function showDatabaseDetails(dbId) {
            const system = window.dbSystem;
            const database = system.databases.find(db => db.id === dbId);
            
            if (!database) return;
            
            document.getElementById('modalDbName').textContent = database.name;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Basic Information -->
                    <div>
                        <h4 class="font-semibold mb-4">Basic Information</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Type:</span>
                                <span>${database.type}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Version:</span>
                                <span>${database.version}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Host:</span>
                                <span class="font-mono">${database.host}:${database.port}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Status:</span>
                                <span class="px-2 py-1 rounded text-xs ${system.getStatusClass(database.status).replace('status-', 'bg-')} text-white">${database.status}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Size:</span>
                                <span>${database.size}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Last Backup:</span>
                                <span>${database.lastBackup}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Metrics -->
                    <div>
                        <h4 class="font-semibold mb-4">Performance Metrics</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-400">CPU Usage:</span>
                                <span>${database.cpu}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Memory Usage:</span>
                                <span>${database.memory}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Queries/sec:</span>
                                <span>${database.queries}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Cache Hit Rate:</span>
                                <span>${database.cacheHit}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Connections:</span>
                                <span>${database.connections}/${database.maxConnections}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Database Details -->
                    <div>
                        <h4 class="font-semibold mb-4">Database Details</h4>
                        <div class="space-y-3">
                            ${database.tables ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Tables:</span>
                                    <span>${database.tables}</span>
                                </div>
                            ` : ''}
                            ${database.indexes ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Indexes:</span>
                                    <span>${database.indexes}</span>
                                </div>
                            ` : ''}
                            ${database.keys ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Keys:</span>
                                    <span>${database.keys.toLocaleString()}</span>
                                </div>
                            ` : ''}
                            ${database.collections ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Collections:</span>
                                    <span>${database.collections}</span>
                                </div>
                            ` : ''}
                            ${database.documents ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Documents:</span>
                                    <span>${database.documents.toLocaleString()}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div>
                        <h4 class="font-semibold mb-4">Quick Actions</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="backupDatabase(${database.id})" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">
                                <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
                                Backup
                            </button>
                            <button onclick="optimizeDatabase(${database.id})" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">
                                <i data-lucide="zap" class="w-4 h-4 inline mr-2"></i>
                                Optimize
                            </button>
                            <button onclick="restartDatabase(${database.id})" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">
                                <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                                Restart
                            </button>
                            <button onclick="viewLogs(${database.id})" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm">
                                <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
                                Logs
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('dbModal').classList.remove('hidden');
            setTimeout(() => lucide.createIcons(), 100);
        }

        function closeDbModal() {
            document.getElementById('dbModal').classList.add('hidden');
        }

        function refreshDatabases() {
            const system = window.dbSystem;
            system.showNotification('Refreshing databases...', 'info');
            
            setTimeout(() => {
                system.loadDatabases();
                system.showNotification('Databases refreshed successfully', 'success');
            }, 1000);
        }

        function executeQuery() {
            window.dbSystem.executeQuery();
        }

        function clearQuery() {
            window.dbSystem.clearQuery();
        }

        function formatQuery() {
            window.dbSystem.formatQuery();
        }

        function saveQuery() {
            const query = document.getElementById('queryEditor').value;
            const blob = new Blob([query], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `query-${new Date().toISOString().split('T')[0]}.sql`;
            a.click();
            
            window.dbSystem.showNotification('Query saved successfully', 'success');
        }

        function loadQuery() {
            // Implementation for loading queries
            window.dbSystem.showNotification('Load query feature coming soon', 'info');
        }

        function addDatabase() {
            // Implementation for adding databases
            window.dbSystem.showNotification('Add database feature coming soon', 'info');
        }

        function backupDatabase(dbId) {
            window.dbSystem.showNotification('Database backup initiated...', 'info');
            setTimeout(() => {
                window.dbSystem.showNotification('Database backup completed successfully', 'success');
            }, 2000);
        }

        function restoreDatabase() {
            window.dbSystem.showNotification('Database restore feature coming soon', 'info');
        }

        function optimizeDatabase(dbId) {
            window.dbSystem.showNotification('Database optimization started...', 'info');
            setTimeout(() => {
                window.dbSystem.showNotification('Database optimization completed successfully', 'success');
            }, 3000);
        }

        function analyzeDatabase() {
            window.dbSystem.showNotification('Database analysis feature coming soon', 'info');
        }

        function restartDatabase(dbId) {
            window.dbSystem.showNotification('Database restart initiated...', 'warning');
            setTimeout(() => {
                window.dbSystem.showNotification('Database restarted successfully', 'success');
            }, 2000);
        }

        function viewLogs(dbId) {
            window.dbSystem.showNotification('Database logs feature coming soon', 'info');
        }

        // Initialize the system when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.dbSystem = new DatabaseManagementSystem();
        });
    </script>
</body>
</html>

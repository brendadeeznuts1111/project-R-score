<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Empire Pro CashApp Integration Dashboard - Real-time identity resolution and fraud detection monitoring">
    <meta name="keywords" content="CashApp, fraud detection, identity resolution, dashboard, empire pro">
    <meta name="author" content="Empire Pro Team">
    <title>CashApp Integration Dashboard - Empire Pro | Real-time Fraud Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <style>
        @keyframes pulse-border {
            0%, 100% { border-color: rgb(239 68 68); }
            50% { border-color: rgb(252 165 165); }
        }
        .critical-alert { animation: pulse-border 2s infinite; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .risk-gradient-low { background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%); }
        .risk-gradient-medium { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .risk-gradient-high { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .risk-gradient-critical { background: linear-gradient(135deg, #991b1b 0%, #3b82f6 100%); }
        
        /* Chart container fixes */
        .chart-container {
            position: relative;
            height: 320px;
            width: 100%;
            max-width: 100%;
        }
        
        /* Responsive fixes */
        @media (max-width: 768px) {
            .chart-container {
                height: 280px;
            }
            
            .glass-effect {
                margin: 0.5rem;
                border-radius: 0.75rem;
            }
            
            .grid {
                gap: 0.75rem;
            }
        }
        
        /* Table responsive fixes */
        .enforcement-table {
            font-size: 0.75rem;
        }
        
        @media (max-width: 640px) {
            .enforcement-table {
                font-size: 0.7rem;
            }
            
            .enforcement-table th,
            .enforcement-table td {
                padding: 0.5rem 0.25rem;
            }
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .status-connecting { background: #f59e0b; animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded">
        Skip to main content
    </a>

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50 backdrop-blur-lg bg-opacity-90">
        <nav class="container mx-auto px-4 py-4" role="navigation" aria-label="Main navigation">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <button onclick="window.history.back()" class="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        <span>Back to Dashboard</span>
                    </button>
                    <div class="flex items-center space-x-3">
                        <i data-lucide="shield-check" class="w-8 h-8 text-blue-400" aria-hidden="true"></i>
                        <div>
                            <h1 class="text-2xl font-bold">CashApp Integration Dashboard</h1>
                            <p class="text-sm text-gray-400">Empire Pro - Real-time Identity Resolution & Fraud Detection</p>
                        </div>
                    </div>
                </div>

                <!-- Primary Navigation -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#dashboard" class="text-gray-300 hover:text-white transition-colors">Dashboard</a>
                    <a href="#analysis" class="text-gray-300 hover:text-white transition-colors">Analysis</a>
                    <a href="#enforcement" class="text-gray-300 hover:text-white transition-colors">Enforcement</a>
                    <a href="#docs" class="text-gray-300 hover:text-white transition-colors">Documentation</a>
                </div>

                <!-- Action Buttons -->
                <div class="flex items-center space-x-3">
                    <button onclick="analyzePhone()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i data-lucide="search" class="w-4 h-4" aria-hidden="true"></i>
                        <span>Analyze Phone</span>
                    </button>
                    <button onclick="simulateTraffic()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500">
                        <i data-lucide="play" class="w-4 h-4" aria-hidden="true"></i>
                        <span>Simulate Traffic</span>
                    </button>
                    <button onclick="refreshDashboard()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500">
                        <i data-lucide="refresh-cw" class="w-4 h-4" aria-hidden="true"></i>
                        <span>Refresh</span>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div id="connectionStatus" class="w-3 h-3 rounded-full status-connecting" aria-hidden="true"></div>
                        <span class="text-sm" id="connectionText">Connecting...</span>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden p-2 rounded-lg hover:bg-gray-700" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Mobile Navigation -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 pt-4 border-t border-gray-700">
                <div class="flex flex-col space-y-2">
                    <a href="#dashboard" class="text-gray-300 hover:text-white py-2 transition-colors">Dashboard</a>
                    <a href="#analysis" class="text-gray-300 hover:text-white py-2 transition-colors">Analysis</a>
                    <a href="#enforcement" class="text-gray-300 hover:text-white py-2 transition-colors">Enforcement</a>
                    <a href="#docs" class="text-gray-300 hover:text-white py-2 transition-colors">Documentation</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Phone Input Modal -->
    <div id="phoneModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 w-96 max-w-full mx-4">
            <h3 class="text-xl font-semibold mb-4">Analyze Phone Number</h3>
            <input type="tel" id="phoneInput" placeholder="+14155551234" 
                   class="w-full px-4 py-2 bg-gray-700 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex space-x-3">
                <button onclick="submitPhoneAnalysis()" class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded-lg transition-colors">
                    Analyze
                </button>
                <button onclick="closePhoneModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow container mx-auto px-4 py-6">
        <!-- Dashboard Section -->
        <section id="dashboard" aria-labelledby="dashboard-heading">
            <h2 id="dashboard-heading" class="sr-only">Dashboard Overview</h2>
            
            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <article class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="users" class="w-8 h-8 text-blue-400" aria-hidden="true"></i>
                        <span class="text-2xl font-bold" id="totalProcessed">0</span>
                    </div>
                    <h3 class="text-gray-400 text-sm">Total Processed</h3>
                    <p class="text-xs text-gray-500 mt-1">Last 24 hours</p>
                </article>

                <article class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-yellow-400" aria-hidden="true"></i>
                        <span class="text-2xl font-bold" id="syntheticDetected">0</span>
                    </div>
                    <h3 class="text-gray-400 text-sm">Synthetic Identities</h3>
                    <p class="text-xs text-gray-500 mt-1">High risk detected</p>
                </article>

                <article class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="shield" class="w-8 h-8 text-green-400" aria-hidden="true"></i>
                        <span class="text-2xl font-bold" id="cashAppVerified">0</span>
                    </div>
                    <h3 class="text-gray-400 text-sm">CashApp Verified</h3>
                    <p class="text-xs text-gray-500 mt-1">Legitimate accounts</p>
                </article>

                <article class="glass-effect rounded-xl p-6">
                    <div class="flex items-center justify-between mb-2">
                        <i data-lucide="activity" class="w-8 h-8 text-red-400" aria-hidden="true"></i>
                        <span class="text-2xl font-bold" id="enforcementActions">0</span>
                    </div>
                    <h3 class="text-gray-400 text-sm">Enforcement Actions</h3>
                    <p class="text-xs text-gray-500 mt-1">Automated responses</p>
                </article>
            </div>

        </section>

        <!-- Analysis Section -->
        <section id="analysis" aria-labelledby="analysis-heading" class="mb-8">
            <h2 id="analysis-heading" class="sr-only">Analysis Tools</h2>
            
            <!-- Risk Score Distribution & Real-time Feed -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Risk Score Chart -->
                <div class="lg:col-span-2 glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2" aria-hidden="true"></i>
                        Risk Score Distribution
                    </h3>
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>

                <!-- Real-time Alert Feed -->
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i data-lucide="bell" class="w-5 h-5 mr-2" aria-hidden="true"></i>
                        Live Alerts
                        <span class="ml-auto bg-red-600 text-xs px-2 py-1 rounded-full" id="alertCount">0</span>
                    </h3>
                    <div id="alertFeed" class="space-y-3 max-h-64 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-2 opacity-50" aria-hidden="true"></i>
                            <p class="text-sm">No alerts yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phone Analysis Results -->
            <div id="analysisResults" class="hidden glass-effect rounded-xl p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-lucide="search" class="w-5 h-5 mr-2" aria-hidden="true"></i>
                    Analysis Results
                    <span class="ml-auto text-sm text-gray-400" id="analyzedPhone"></span>
                </h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Phone Intelligence -->
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-blue-400">Phone Intelligence</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Risk Score</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-700 rounded-full h-2">
                                        <div id="analysisRiskScore" class="bg-gradient-to-r from-green-500 to-red-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                    <span class="text-sm font-mono" id="analysisRiskScoreText">0%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Identity Type</span>
                                <span class="px-2 py-1 rounded text-xs font-semibold" id="identityType">-</span>
                            </div>
                            <div class="p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm text-gray-400">Risk Factors</span>
                                <div class="flex flex-wrap gap-1 mt-2" id="analysisRiskFactors">
                                    <!-- Risk factors will be populated here -->
                                </div>
                            </div>
                            <div class="p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm text-gray-400">Data Provenance (Audit Trail)</span>
                                <div class="grid grid-cols-4 sm:grid-cols-6 gap-2 mt-2" id="provenanceSources">
                                    <!-- Data sources will be populated here -->
                                </div>
                            </div>
                            <div class="p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm text-gray-400">Cross-Platform Patterns</span>
                                <div class="mt-2" id="crossPlatformPatterns">
                                    <!-- Cross-platform patterns will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CashApp Profile -->
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-green-400">CashApp Profile</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Cashtag</span>
                                <span class="text-sm font-mono" id="cashtag">-</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Verification Status</span>
                                <span class="px-2 py-1 rounded text-xs font-semibold" id="verificationStatus">-</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Transaction Volume (30d)</span>
                                <span class="text-sm font-mono" id="transactionVolume">$0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <span class="text-sm">Account Age</span>
                                <span class="text-sm font-mono" id="accountAge">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Enforcement Section -->
        <section id="enforcement" aria-labelledby="enforcement-heading">
            <h2 id="enforcement-heading" class="sr-only">Enforcement Actions</h2>
            
            <!-- Enforcement Actions Panel -->
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-lucide="shield-alert" class="w-5 h-5 mr-2" aria-hidden="true"></i>
                    Enforcement Actions History
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm enforcement-table" role="table" aria-label="Enforcement actions history">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left py-3 px-4" scope="col">Timestamp</th>
                                <th class="text-left py-3 px-4" scope="col">Phone</th>
                                <th class="text-left py-3 px-4" scope="col">Risk Score</th>
                                <th class="text-left py-3 px-4" scope="col">Trigger</th>
                                <th class="text-left py-3 px-4" scope="col">Action</th>
                                <th class="text-left py-3 px-4" scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody id="enforcementTable">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">
                                    <i data-lucide="shield-off" class="w-12 h-12 mx-auto mb-2 opacity-50" aria-hidden="true"></i>
                                    <p>No enforcement actions yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 mt-auto">
        <div class="container mx-auto px-4 py-8">
            <!-- Footer Content -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <i data-lucide="shield-check" class="w-6 h-6 text-blue-400" aria-hidden="true"></i>
                        <h3 class="text-lg font-semibold">Empire Pro</h3>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">
                        Advanced identity resolution and fraud detection platform for modern enterprises.
                    </p>
                    <div class="flex space-x-4">
                        <a href="https://github.com" class="text-gray-400 hover:text-white transition-colors" aria-label="GitHub">
                            <i data-lucide="github" class="w-5 h-5"></i>
                        </a>
                        <a href="https://twitter.com" class="text-gray-400 hover:text-white transition-colors" aria-label="Twitter">
                            <i data-lucide="twitter" class="w-5 h-5"></i>
                        </a>
                        <a href="https://linkedin.com" class="text-gray-400 hover:text-white transition-colors" aria-label="LinkedIn">
                            <i data-lucide="linkedin" class="w-5 h-5"></i>
                        </a>
                    </div>
                </div>

                <!-- Product Links -->
                <div>
                    <h4 class="text-white font-semibold mb-4">Product</h4>
                    <ul class="space-y-2">
                        <li><a href="#features" class="text-gray-400 hover:text-white text-sm transition-colors">Features</a></li>
                        <li><a href="#pricing" class="text-gray-400 hover:text-white text-sm transition-colors">Pricing</a></li>
                        <li><a href="#api" class="text-gray-400 hover:text-white text-sm transition-colors">API Documentation</a></li>
                        <li><a href="#integrations" class="text-gray-400 hover:text-white text-sm transition-colors">Integrations</a></li>
                        <li><a href="#changelog" class="text-gray-400 hover:text-white text-sm transition-colors">Changelog</a></li>
                    </ul>
                </div>

                <!-- Resources -->
                <div>
                    <h4 class="text-white font-semibold mb-4">Resources</h4>
                    <ul class="space-y-2">
                        <li><a href="#docs" class="text-gray-400 hover:text-white text-sm transition-colors">Documentation</a></li>
                        <li><a href="#tutorials" class="text-gray-400 hover:text-white text-sm transition-colors">Tutorials</a></li>
                        <li><a href="#blog" class="text-gray-400 hover:text-white text-sm transition-colors">Blog</a></li>
                        <li><a href="#support" class="text-gray-400 hover:text-white text-sm transition-colors">Support Center</a></li>
                        <li><a href="#status" class="text-gray-400 hover:text-white text-sm transition-colors">System Status</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <h4 class="text-white font-semibold mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><a href="#privacy" class="text-gray-400 hover:text-white text-sm transition-colors">Privacy Policy</a></li>
                        <li><a href="#terms" class="text-gray-400 hover:text-white text-sm transition-colors">Terms of Service</a></li>
                        <li><a href="#security" class="text-gray-400 hover:text-white text-sm transition-colors">Security</a></li>
                        <li><a href="#compliance" class="text-gray-400 hover:text-white text-sm transition-colors">Compliance</a></li>
                        <li><a href="#gdpr" class="text-gray-400 hover:text-white text-sm transition-colors">GDPR</a></li>
                    </ul>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="border-t border-gray-700 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-gray-400 text-sm mb-4 md:mb-0">
                        ¬© 2026 Empire Pro. All rights reserved. Version 1.0.0
                    </div>
                    <div class="flex items-center space-x-6 text-sm">
                        <span class="text-gray-400">Status:</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" aria-hidden="true"></div>
                            <span class="text-green-400">All Systems Operational</span>
                        </div>
                        <span class="text-gray-600">|</span>
                        <a href="#contact" class="text-gray-400 hover:text-white transition-colors">Contact</a>
                        <span class="text-gray-600">|</span>
                        <a href="#3b82f6ck" class="text-gray-400 hover:text-white transition-colors">Feedback</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button onclick="scrollToTop()" id="backToTop" class="fixed bottom-8 right-8 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 opacity-0 invisible focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Back to top">
        <i data-lucide="arrow-up" class="w-5 h-5"></i>
    </button>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Configuration
        const API_BASE = window.location.origin;
        let ws = null;
        let reconnectInterval = null;
        let riskChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
            connectWebSocket();
            loadInitialData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadInitialData, 30000);
        });

        function initializeCharts() {
            const ctx = document.getElementById('riskChart').getContext('2d');
            riskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk (0-0.2)', 'Medium Risk (0.2-0.4)', 'High Risk (0.4-0.6)', 'Critical (0.6-1.0)'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#991b1b'
                        ],
                        borderWidth: 0,
                        spacing: 2,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 2,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#3b82f6',
                                padding: 15,
                                font: {
                                    size: 12
                                },
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%',
                    animation: {
                        animateRotate: true,
                        animateScale: false,
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Enhanced Dashboard Controller with Clean Integration
        class DashboardController {
            constructor() {
                this.API_BASE = window.location.origin;
                this.ws = null;
                this.reconnectInterval = null;
                this.riskChart = null;
                this.isEnhanced = false;
                this.lastUpdate = null;
                this.updateInterval = null;
                
                this.init();
            }

            async init() {
                try {
                    // Check if enhanced backend is available
                    await this.checkBackendType();
                    
                    // Initialize components
                    await this.initializeCharts();
                    await this.loadInitialData();
                    this.setupEventListeners();
                    this.startAutoRefresh();
                    
                    // Initialize Lucide icons
                    lucide.createIcons();
                    
                    console.log(`Dashboard initialized with ${this.isEnhanced ? 'enhanced' : 'simple'} backend`);
                    this.showNotification('Dashboard loaded successfully', 'success');
                } catch (error) {
                    console.error('Dashboard initialization failed:', error);
                    this.showNotification('Failed to initialize dashboard', 'error');
                }
            }

            async checkBackendType() {
                try {
                    const response = await fetch(`${this.API_BASE}/health`);
                    const data = await response.json();
                    
                    if (data.version && data.version.includes('enhanced')) {
                        this.isEnhanced = true;
                        console.log('Using enhanced backend with real integration');
                    } else {
                        console.log('Using simple backend');
                    }
                } catch (error) {
                    console.log('Backend health check failed, using simple mode');
                }
            }

            async loadInitialData() {
                const promises = [
                    this.updateMetrics(),
                    this.updateAlerts(),
                    this.updateEnforcementHistory(),
                    this.updateRiskDistribution()
                ];

                await Promise.allSettled(promises);
                this.lastUpdate = new Date();
            }

            setupEventListeners() {
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closePhoneModal();
                    } else if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        this.analyzePhone();
                    } else if (e.ctrlKey && e.key === 'r') {
                        e.preventDefault();
                        this.refreshDashboard();
                    }
                });

                // Enter key in phone input
                const phoneInput = document.getElementById('phoneInput');
                if (phoneInput) {
                    phoneInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.submitPhoneAnalysis();
                        }
                    });
                }

                // Mobile menu toggle
                window.toggleMobileMenu = () => {
                    const menu = document.getElementById('mobileMenu');
                    menu.classList.toggle('hidden');
                };

                // Back to top functionality
                window.scrollToTop = () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                };

                // Show/hide back to top button
                window.addEventListener('scroll', () => {
                    const backToTopBtn = document.getElementById('backToTop');
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.remove('opacity-0', 'invisible');
                        backToTopBtn.classList.add('opacity-100', 'visible');
                    } else {
                        backToTopBtn.classList.add('opacity-0', 'invisible');
                        backToTopBtn.classList.remove('opacity-100', 'visible');
                    }
                });

                // Smooth scroll for anchor links
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', (e) => {
                        e.preventDefault();
                        const target = document.querySelector(e.target.getAttribute('href'));
                        if (target) {
                            target.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            document.getElementById('mobileMenu')?.classList.add('hidden');
                        }
                    });
                });
            }

            startAutoRefresh() {
                // Clear existing interval
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                }

                // Set refresh interval based on backend type
                const interval = this.isEnhanced ? 15000 : 30000; // 15s for enhanced, 30s for simple
                
                this.updateInterval = setInterval(async () => {
                    try {
                        await this.loadInitialData();
                        this.updateLastRefreshTime();
                    } catch (error) {
                        console.error('Auto-refresh failed:', error);
                    }
                }, interval);
            }

            async updateMetrics() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/dashboard/metrics`);
                    const result = await response.json();

                    if (result.success) {
                        const metrics = result.data;
                        
                        // Update metric displays with animation
                        this.animateValue('totalProcessed', metrics.totalProcessed);
                        this.animateValue('syntheticDetected', metrics.syntheticDetected);
                        this.animateValue('cashAppVerified', metrics.cashAppVerified);
                        this.animateValue('enforcementActions', metrics.enforcementActions);

                        // Update additional metrics for enhanced backend
                        if (this.isEnhanced && metrics.systemHealth) {
                            this.updateSystemStatus(metrics.systemHealth);
                            this.updatePerformanceMetrics(metrics);
                        }
                    } else {
                        throw new Error(result.error || 'Failed to fetch metrics');
                    }
                } catch (error) {
                    console.error('Error updating metrics:', error);
                    this.showNotification('Failed to update metrics', 'warning');
                }
            }

            async updateAlerts() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/dashboard/alerts?limit=10`);
                    const result = await response.json();

                    if (result.success) {
                        this.renderAlerts(result.data);
                        document.getElementById('alertCount').textContent = result.data.length;
                    } else {
                        throw new Error(result.error || 'Failed to fetch alerts');
                    }
                } catch (error) {
                    console.error('Error updating alerts:', error);
                    this.showAlertError();
                }
            }

            async updateEnforcementHistory() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/dashboard/enforcement-history?limit=20`);
                    const result = await response.json();

                    if (result.success) {
                        this.renderEnforcementTable(result.data);
                    } else {
                        throw new Error(result.error || 'Failed to fetch enforcement history');
                    }
                } catch (error) {
                    console.error('Error updating enforcement history:', error);
                    this.showEnforcementError();
                }
            }

            async updateRiskDistribution() {
                try {
                    const response = await fetch(`${this.API_BASE}/api/dashboard/risk-distribution`);
                    const result = await response.json();

                    if (result.success) {
                        this.updateRiskChart(result.data);
                    } else {
                        throw new Error(result.error || 'Failed to fetch risk distribution');
                    }
                } catch (error) {
                    console.error('Error updating risk distribution:', error);
                }
            }

            async analyzePhone() {
                this.showPhoneModal();
            }

            async submitPhoneAnalysis() {
                const phoneInput = document.getElementById('phoneInput');
                const phone = phoneInput.value.trim();

                if (!phone) {
                    this.showNotification('Please enter a phone number', 'warning');
                    return;
                }

                if (!/^[\+]?[1-9][\d]{0,15}$/.test(phone)) {
                    this.showNotification('Invalid phone number format', 'error');
                    return;
                }

                // Show loading state
                this.showAnalysisLoading();
                this.closePhoneModal();

                try {
                    const response = await fetch(`${this.API_BASE}/api/analyze/phone`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ phone })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.displayAnalysisResults(result.data);
                        this.showNotification(`Analysis complete for ${phone}`, 'success');
                        
                        // Refresh metrics to include new analysis
                        await this.updateMetrics();
                    } else {
                        throw new Error(result.error || 'Analysis failed');
                    }
                } catch (error) {
                    console.error('Error analyzing phone:', error);
                    this.showNotification(`Analysis failed: ${error.message}`, 'error');
                    this.hideAnalysisResults();
                }
            }

            // Utility function to get pattern severity styling
            getPatternSeverityClass(severity) {
                switch (severity) {
                    case 'critical': return 'bg-red-900 text-red-200 border-red-700';
                    case 'high': return 'bg-orange-900 text-orange-200 border-orange-700';
                    case 'medium': return 'bg-yellow-900 text-yellow-200 border-yellow-700';
                    case 'low': return 'bg-green-900 text-green-200 border-green-700';
                    default: return 'bg-gray-900 text-gray-200 border-gray-700';
                }
            }

            getPatternSeverityIcon(severity) {
                switch (severity) {
                    case 'critical': return 'üî¥';
                    case 'high': return 'üü†';
                    case 'medium': return 'üü°';
                    case 'low': return 'üü¢';
                    default: return '‚ö™';
                }
            }

            async simulateTraffic() {
                const count = prompt('How many simulations to run? (1-100)', '10');
                if (!count) return;

                const simCount = Math.min(100, Math.max(1, parseInt(count)));
                
                try {
                    const response = await fetch(`${this.API_BASE}/api/simulate/traffic`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            count: simCount,
                            riskProfile: 'mixed'
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showNotification(`Simulated ${result.data.processed} analyses`, 'success');
                        
                        // Refresh all data
                        await this.loadInitialData();
                        
                        // Show summary if enhanced backend
                        if (this.isEnhanced && result.data.summary) {
                            this.showSimulationSummary(result.data.summary);
                        }
                    } else {
                        throw new Error(result.error || 'Simulation failed');
                    }
                } catch (error) {
                    console.error('Error simulating traffic:', error);
                    this.showNotification(`Simulation failed: ${error.message}`, 'error');
                }
            }

            async refreshDashboard() {
                try {
                    this.showLoadingState();
                    await this.loadInitialData();
                    this.updateLastRefreshTime();
                    this.showNotification('Dashboard refreshed', 'success');
                } catch (error) {
                    console.error('Error refreshing dashboard:', error);
                    this.showNotification('Refresh failed', 'error');
                } finally {
                    this.hideLoadingState();
                }
            }

            // UI Helper Methods
            animateValue(elementId, value) {
                const element = document.getElementById(elementId);
                const start = parseInt(element.textContent) || 0;
                const duration = 1000;
                const startTime = performance.now();

                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const currentValue = Math.floor(start + (value - start) * this.easeOutQuad(progress));
                    element.textContent = currentValue.toLocaleString();

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };

                requestAnimationFrame(animate);
            }

            easeOutQuad(t) {
                return t * (2 - t);
            }

            showPhoneModal() {
                document.getElementById('phoneModal').style.display = 'flex';
                document.getElementById('phoneInput').focus();
            }

            closePhoneModal() {
                document.getElementById('phoneModal').style.display = 'none';
                document.getElementById('phoneInput').value = '';
            }

            showAnalysisLoading() {
                const resultsDiv = document.getElementById('analysisResults');
                resultsDiv.classList.remove('hidden');
                resultsDiv.innerHTML = `
                    <div class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        <p class="mt-4 text-gray-400">Analyzing phone number...</p>
                    </div>
                `;
            }

            displayAnalysisResults(data) {
                const resultsDiv = document.getElementById('analysisResults');
                document.getElementById('analyzedPhone').textContent = data.phone;

                // Update provenance sources
                this.updateProvenanceView(data.provenanceSources || []);

                // Update risk score
                const riskPercent = Math.round(data.riskScore * 100);
                document.getElementById('analysisRiskScore').style.width = `${riskPercent}%`;
                document.getElementById('analysisRiskScoreText').textContent = `${riskPercent}%`;

                // Update identity type
                const identityTypeElement = document.getElementById('identityType');
                identityTypeElement.textContent = data.identityType;
                identityTypeElement.className = `px-2 py-1 rounded text-xs font-semibold ${
                    data.isSynthetic ? 'bg-red-600 text-white' : 'bg-green-600 text-white'
                }`;

                // Update risk factors
                const riskFactorsDiv = document.getElementById('analysisRiskFactors');
                riskFactorsDiv.innerHTML = data.riskFactors.map(factor => 
                    `<span class="px-2 py-1 bg-red-900 text-red-200 rounded text-xs">${factor}</span>`
                ).join('');

                // Display cross-platform patterns with warning icons
                const patternsDiv = document.getElementById('crossPlatformPatterns');
                if (data.crossPlatformPatterns && data.crossPlatformPatterns.length > 0) {
                    patternsDiv.innerHTML = data.crossPlatformPatterns.map((pattern, index) => {
                        const severityIcon = pattern.severity === 'critical' ? 'üî¥' : 
                                          pattern.severity === 'high' ? 'üü†' : 
                                          pattern.severity === 'medium' ? 'üü°' : 'üü¢';
                        const severityClass = pattern.severity === 'critical' ? 'bg-red-900 text-red-200' : 
                                             pattern.severity === 'high' ? 'bg-orange-900 text-orange-200' : 
                                             pattern.severity === 'medium' ? 'bg-yellow-900 text-yellow-200' : 
                                             'bg-green-900 text-green-200';
                        
                        return `
                            <div class="mb-3 p-3 ${severityClass} rounded-lg">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-lg">${severityIcon}</span>
                                    <span class="font-semibold text-sm">${pattern.patternType.replace(/_/g, ' ')}</span>
                                    <span class="text-xs opacity-75">(${pattern.involvedPlatforms.join(', ')})</span>
                                </div>
                                <div class="text-xs mb-2">${pattern.description}</div>
                                <div class="text-xs opacity-75">
                                    <strong>Evidence:</strong> ${pattern.evidence.slice(0, 2).join('; ')}${pattern.evidence.length > 2 ? '...' : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    patternsDiv.innerHTML = '<div class="text-green-400 text-sm">‚úÖ No cross-platform patterns detected</div>';
                }

                // Update CashApp profile
                if (data.cashAppConnection) {
                    const profile = data.cashAppConnection.metadata;
                    document.getElementById('cashtag').textContent = profile.cashtag || 'Not found';
                    
                    const statusElement = document.getElementById('verificationStatus');
                    statusElement.textContent = profile.verificationStatus || 'Unknown';
                    statusElement.className = `px-2 py-1 rounded text-xs font-semibold ${this.getVerificationStatusClass(profile.verificationStatus)}`;
                    
                    document.getElementById('transactionVolume').textContent = 
                        profile.transactionVolume30d ? `$${profile.transactionVolume30d.toLocaleString()}` : '$0';
                    document.getElementById('accountAge').textContent = 
                        profile.accountAgeDays ? `${profile.accountAgeDays} days` : 'Unknown';
                } else {
                    document.getElementById('cashtag').textContent = 'No CashApp account';
                    document.getElementById('verificationStatus').textContent = 'N/A';
                    document.getElementById('transactionVolume').textContent = '$0';
                    document.getElementById('accountAge').textContent = 'N/A';
                }

                // Show enforcement action if applicable
                if (data.enforcementAction) {
                    this.showEnforcementAction(data.enforcementAction);
                }

                resultsDiv.classList.remove('hidden');
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Re-initialize icons
                setTimeout(() => lucide.createIcons(), 100);
            }

            getVerificationStatusClass(status) {
                const classes = {
                    'verified': 'bg-green-600 text-white',
                    'unverified': 'bg-yellow-600 text-white',
                    'suspended': 'bg-red-600 text-white',
                    'pending': 'bg-orange-600 text-white'
                };
                return classes[status] || 'bg-gray-600 text-white';
            }

            updateProvenanceView(sources) {
                const container = document.getElementById('provenanceSources');
                if (!container) return;

                const platformIcons = {
                    'cashapp': 'dollar-sign',
                    'venmo': 'send',
                    'paypal': 'credit-card',
                    'zelle': 'zap',
                    'applepay': 'smartphone',
                    'googlepay': 'smartphone',
                    'chime': 'landmark',
                    'varo': 'landmark',
                    'device': 'hard-drive',
                    'email': 'mail',
                    'ip': 'globe',
                    'social_graph': 'share-2',
                    'behavioral_biometrics': 'fingerprint'
                };

                const platformColors = {
                    'cashapp': 'text-green-400',
                    'venmo': 'text-blue-400',
                    'paypal': 'text-blue-500',
                    'zelle': 'text-purple-400',
                    'applepay': 'text-gray-200',
                    'googlepay': 'text-gray-200',
                    'chime': 'text-emerald-400',
                    'varo': 'text-emerald-500',
                    'device': 'text-blue-300',
                    'email': 'text-indigo-400',
                    'ip': 'text-orange-400',
                    'social_graph': 'text-pink-400',
                    'behavioral_biometrics': 'text-cyan-400'
                };

                container.innerHTML = sources.map(source => {
                    const statusIcon = source.status === 'success' ? 'check-circle' : 
                                     source.status === 'partial' ? 'alert-circle' : 'x-circle';
                    const statusColor = source.status === 'success' ? 'text-green-500' : 
                                      source.status === 'partial' ? 'text-yellow-500' : 'text-red-500';
                    const icon = platformIcons[source.platform] || 'database';
                    const platformColor = platformColors[source.platform] || 'text-gray-400';
                    
                    return `
                        <div class="flex flex-col items-center p-2 bg-gray-900 bg-opacity-50 rounded border border-gray-700 hover:border-gray-500 transition-all cursor-help relative group" 
                             title="${source.platform}: ${source.status}${source.errorDetails ? ` (${source.errorDetails})` : ''}">
                            <i data-lucide="${icon}" class="w-5 h-5 ${platformColor} mb-1"></i>
                            <i data-lucide="${statusIcon}" class="w-3 h-3 ${statusColor} absolute top-1 right-1"></i>
                            <span class="text-[10px] uppercase font-bold tracking-wider truncate w-full text-center">${source.platform.replace('_', ' ')}</span>
                            
                            <!-- Custom Tooltip -->
                            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-black text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50 pointer-events-none">
                                ${source.platform.toUpperCase()}: ${source.status.toUpperCase()}
                                ${source.confidence ? ` (${Math.round(source.confidence * 100)}% confidence)` : ''}
                                ${source.errorDetails ? `<br><span class="text-red-400">${source.errorDetails}</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                lucide.createIcons();
            }

            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-4 px-4 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
                
                const colors = {
                    success: 'bg-green-600 text-white',
                    error: 'bg-red-600 text-white',
                    warning: 'bg-yellow-600 text-white',
                    info: 'bg-blue-600 text-white'
                };
                
                notification.className += ` ${colors[type]}`;
                notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info'}" class="w-5 h-5"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                lucide.createIcons();
                
                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                    notification.classList.add('translate-x-0');
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            showLoadingState() {
                // Add loading indicators to metric cards
                document.querySelectorAll('.glass-effect').forEach(card => {
                    card.style.opacity = '0.6';
                });
            }

            hideLoadingState() {
                document.querySelectorAll('.glass-effect').forEach(card => {
                    card.style.opacity = '1';
                });
            }

            updateLastRefreshTime() {
                this.lastUpdate = new Date();
                // Could update a UI element showing last refresh time
            }

            hideAnalysisResults() {
                document.getElementById('analysisResults').classList.add('hidden');
            }

            showAlertError() {
                const alertFeed = document.getElementById('alertFeed');
                alertFeed.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                        <p class="text-sm">Failed to load alerts</p>
                    </div>
                `;
                lucide.createIcons();
            }

            showEnforcementError() {
                const tbody = document.getElementById('enforcementTable');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                            <p>Failed to load enforcement history</p>
                        </td>
                    </tr>
                `;
                lucide.createIcons();
            }

            renderAlerts(alerts) {
                const alertFeed = document.getElementById('alertFeed');
                
                if (alerts.length === 0) {
                    alertFeed.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                            <p class="text-sm">No alerts yet</p>
                        </div>
                    `;
                } else {
                    alertFeed.innerHTML = alerts.map(alert => `
                        <div class="p-3 bg-gray-800 rounded-lg border-l-4 ${
                            alert.severity === 'CRITICAL' ? 'border-red-600 critical-alert' : 'border-yellow-600'
                        }">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-medium">${alert.message}</p>
                                    <p class="text-xs text-gray-400 mt-1">${alert.phone} ‚Ä¢ ${this.formatTime(alert.timestamp)}</p>
                                </div>
                                <span class="px-2 py-1 text-xs rounded ${
                                    alert.severity === 'CRITICAL' ? 'bg-red-600' : 'bg-yellow-600'
                                }">${alert.severity}</span>
                            </div>
                        </div>
                    `).join('');
                }
                
                lucide.createIcons();
            }

            renderEnforcementTable(enforcement) {
                const tbody = document.getElementById('enforcementTable');
                
                if (enforcement.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-500">
                                <i data-lucide="shield-off" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No enforcement actions yet</p>
                            </td>
                        </tr>
                    `;
                } else {
                    const actionColors = {
                        'BLOCK_TRANSACTION': 'bg-red-600',
                        'IDENTITY_VERIFICATION': 'bg-orange-600',
                        'REQUIRE_MFA': 'bg-yellow-600',
                        'ENHANCED_MONITORING': 'bg-blue-600'
                    };
                    
                    tbody.innerHTML = enforcement.map(action => `
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 text-xs">${this.formatTime(action.timestamp)}</td>
                            <td class="py-3 px-4 font-mono text-sm">${action.phone}</td>
                            <td class="py-3 px-4 text-sm">${action.riskScore}</td>
                            <td class="py-3 px-4 text-sm">${action.trigger}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded text-xs font-semibold ${
                                    actionColors[action.action] || 'bg-gray-600'
                                }">${action.action.replace('_', ' ')}</span>
                            </td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded text-xs font-semibold ${
                                    action.status === 'EXECUTED' ? 'bg-green-600' : 'bg-yellow-600'
                                }">${action.status}</span>
                            </td>
                        </tr>
                    `).join('');
                }
                
                lucide.createIcons();
            }

            updateSystemStatus(status) {
                // Update connection status indicator
                const statusElement = document.getElementById('connectionStatus');
                const textElement = document.getElementById('connectionText');
                
                if (status === 'operational') {
                    statusElement.className = 'w-3 h-3 rounded-full status-online';
                    textElement.textContent = 'Online';
                } else {
                    statusElement.className = 'w-3 h-3 rounded-full status-offline';
                    textElement.textContent = 'Issues detected';
                }
            }

            updatePerformanceMetrics(metrics) {
                // Could display additional performance metrics in the UI
                if (metrics.apiResponseTime) {
                    console.log(`API Response Time: ${metrics.apiResponseTime.toFixed(2)}ms`);
                }
                if (metrics.cacheHitRate) {
                    console.log(`Cache Hit Rate: ${metrics.cacheHitRate.toFixed(1)}%`);
                }
            }

            showSimulationSummary(summary) {
                const message = `
                    Simulation Complete:
                    ‚Ä¢ Total: ${summary.totalProcessed}
                    ‚Ä¢ Synthetic: ${summary.syntheticDetected}
                    ‚Ä¢ Verified: ${summary.cashAppVerified}
                    ‚Ä¢ Enforcement: ${summary.enforcementActions}
                    ‚Ä¢ Avg Risk: ${(summary.averageRiskScore * 100).toFixed(1)}%
                `;
                this.showNotification(message, 'success');
            }

            showEnforcementAction(action) {
                const message = `Enforcement action triggered: ${action.action}`;
                this.showNotification(message, 'warning');
            }

            formatTime(timestamp) {
                return new Date(timestamp).toLocaleTimeString();
            }

            // Chart initialization and updates
            async initializeCharts() {
                const ctx = document.getElementById('riskChart').getContext('2d');
                this.riskChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Low Risk (0-0.2)', 'Medium Risk (0.2-0.4)', 'High Risk (0.4-0.6)', 'Critical (0.6-1.0)'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#991b1b'],
                            borderWidth: 0,
                            spacing: 2,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        aspectRatio: 2,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#3b82f6',
                                    padding: 15,
                                    font: { size: 12 },
                                    boxWidth: 12
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        animation: {
                            animateRotate: true,
                            animateScale: false,
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            updateRiskChart(distribution) {
                if (this.riskChart) {
                    this.riskChart.data.datasets[0].data = [
                        distribution.low,
                        distribution.medium,
                        distribution.high,
                        distribution.critical
                    ];
                    this.riskChart.update();
                }
            }
        }

        // Initialize dashboard when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new DashboardController();
        });

        // Global functions for button onclick handlers
        window.analyzePhone = () => window.dashboard?.analyzePhone();
        window.submitPhoneAnalysis = () => window.dashboard?.submitPhoneAnalysis();
        window.closePhoneModal = () => window.dashboard?.closePhoneModal();
        window.simulateTraffic = () => window.dashboard?.simulateTraffic();
        window.refreshDashboard = () => window.dashboard?.refreshDashboard();
    </script>
</body>
</html>
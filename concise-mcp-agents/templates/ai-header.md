<%*
// AI Header Generator Template for Templater
// This template uses the AI header generator to create standardized headers

// Get user input for the description
const description = await tp.system.prompt("ğŸ¤– Describe what this note is about (e.g., 'telegram alert tool', 'git branch manager'):", "", true);

if (!description || description.trim() === "") {
  await tp.user.cancel("AI Header generation cancelled - no description provided");
  return;
}

// Show processing message
const processingMsg = await tp.system.prompt("Generating AI header...", "Please wait...", false, false);

// Run the AI header generator
let header = "";
try {
  // Use Templater's runCommand to execute the AI header script
  const result = await tp.user.runCommand(`bun scripts/ai-header.ts "${description.replace(/"/g, '\\"')}"`);

  if (result && result.trim()) {
    header = result.trim();
  } else {
    throw new Error("No header generated");
  }
} catch (error) {
  await tp.user.cancel(`AI Header generation failed: ${error.message}`);
  return;
}

// Extract components for additional metadata
const headerMatch = header.match(/\[([^\]]+)\]\[([^\]]+)\]\[([^\]]+)\]\[([^\]]+)\]\[([^\]]+)\]\[([^\]]+)\]\[([^\]]+)\]/);
let domain = "UNKNOWN", scope = "UNKNOWN", type = "UNKNOWN", meta = "UNKNOWN", id = "UNKNOWN", version = "v1.0", status = "UNKNOWN";

if (headerMatch) {
  [, domain, scope, type, meta, id, version, status] = headerMatch;
}

// Set the file title based on the generated ID
const fileTitle = id.toLowerCase().replace(/[^a-z0-9-]/g, '-');
tp.file.title = fileTitle;

// Generate additional metadata
const createdDate = tp.date.now("YYYY-MM-DD");
const createdTime = tp.date.now("HH:mm:ss");

// Create tags based on header components
const tags = [
  domain.toLowerCase(),
  scope.toLowerCase(),
  type.toLowerCase(),
  meta.toLowerCase(),
  status.toLowerCase(),
  "ai-generated"
].filter(tag => tag !== "unknown");
_%>

<% header %>

## ğŸ“‹ Note Metadata

- **Created**: <% createdDate %> at <% createdTime %>
- **Domain**: <% domain %>
- **Scope**: <% scope %>
- **Type**: <% type %>
- **Priority**: <% meta %>
- **Status**: <% status %>
- **ID**: <% id %>
- **Version**: <% version %>
- **AI Prompt**: "<% description %>"

## ğŸ·ï¸ Tags

<% tags.map(tag => `#${tag}`).join(' ') %>

---

## ğŸ“ Content

<!-- Start writing your content here -->

### Overview

### Implementation Details

### Examples

### Notes

---

*Generated by AI Header Generator v3.0.0 â€¢ Templater Integration â€¢ <%= createdDate %>*

# [DATAPIPE][LIVE][PENDING][LIVE-BETS][v2.14][ACTIVE]

âš¡ **LIVE PENDING BETS** *(Auto-refresh)*

**Last Update**: Loading... | **0 Bets**

---

## ðŸ”„ **Controls**

```dataviewjs
dv.button("ðŸ”„ Live Bets", async () => {
  const { execSync } = require('child_process');
  try {
    execSync('bun datapipe:live');
    dv.view.reload();
  } catch (error) {
    console.error('Failed to refresh:', error.message);
  }
});

dv.button("ðŸ“± Telegram", async () => {
  const { execSync } = require('child_process');
  try {
    execSync('bun telegram:pending');
  } catch (error) {
    console.error('Failed to send:', error.message);
  }
});
```

---

## ðŸ“Š **PENDING TABLE** *(AG Grid Style)*

```dataview
TABLE
  betGroupId AS "Bet Group",
  profile AS "Player",
  betGroupToWin AS "To Win",
  bet AS "Bet",
  agent AS "Agent",
  sID AS "Sport",
  team1 + " vs " + team2 AS "Event",
  delay AS "Delay"
FROM "dashboards/live-bets"
WHERE state = 0
SORT bet DESC
LIMIT 50
```

---

## ðŸ”´ **HIGH RISK** *(Delay >10s | Vol >$200)*

```dataview
TABLE
  agent AS "Agent",
  profile AS "Player",
  bet AS "Bet",
  delay AS "Delay"
FROM "dashboards/live-bets"
WHERE (delay > 10) OR (bet > 200)
SORT delay DESC
LIMIT 20
```

---

## ðŸ”Œ **WS Live Updates** *(0.1s push)*

```dataviewjs
// WebSocket live updates for new bets
let ws;
let lastUpdate = 0;

function connectWS() {
  try {
    ws = new WebSocket("ws://localhost:3001", ["syndicate-live"]);

    ws.onopen = () => {
      console.log("ðŸ”Œ Connected to live bets WS");
      dv.el("div", "ðŸŸ¢ **WS Connected** - Live updates active", {
        attr: { id: "ws-status", style: "color: green; margin: 10px 0;" }
      });
    };

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data.type === "live_bet" || data.type === "new_bet") {
          lastUpdate = Date.now();
          console.log("ðŸ”” New live bet:", data);

          // Auto-refresh table after 1 second
          setTimeout(() => dv.view.reload(), 1000);
        }
      } catch (e) {
        // Ignore parse errors
      }
    };

    ws.onclose = () => {
      console.log("ðŸ”Œ WS disconnected - will reconnect");
      setTimeout(connectWS, 5000);
    };

    ws.onerror = (error) => {
      console.error("WS error:", error);
    };

  } catch (error) {
    console.error("WS connection failed:", error);
    dv.el("div", "ðŸ”´ **WS Disconnected** - Manual refresh only", {
      attr: { id: "ws-status", style: "color: red; margin: 10px 0;" }
    });
  }
}

// Connect on page load
connectWS();

// Status indicator
setInterval(() => {
  const now = Date.now();
  const timeSinceUpdate = now - lastUpdate;

  if (timeSinceUpdate < 30000) { // < 30s
    dv.el("div", `ðŸŸ¢ **LIVE** - Last update ${Math.round(timeSinceUpdate/1000)}s ago`, {
      attr: { id: "live-status", style: "color: green; margin: 5px 0;" }
    });
  } else if (timeSinceUpdate < 300000) { // < 5min
    dv.el("div", `ðŸŸ¡ **STALE** - Last update ${Math.round(timeSinceUpdate/60000)}min ago`, {
      attr: { id: "live-status", style: "color: orange; margin: 5px 0;" }
    });
  } else {
    dv.el("div", `ðŸ”´ **OFFLINE** - No updates for ${Math.round(timeSinceUpdate/60000)}min`, {
      attr: { id: "live-status", style: "color: red; margin: 5px 0;" }
    });
  }
}, 10000);
```

---

*Generated by Datapipe v2.14 â€¢ Live data â€¢ No 403 errors*

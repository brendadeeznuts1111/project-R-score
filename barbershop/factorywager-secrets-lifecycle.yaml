# factorywager-secrets-lifecycle.yaml
version: '5.1'
rules:
  - key: "API_KEY_V3"
    schedule:
      type: "cron"
      cron: "0 0 1 * *"  # Monthly rotation
    action: "rotate"
    metadata:
      severity: "HIGH"
      notify: ["slack#security", "email#admins"]
      documentation: "https://bun.com/docs/runtime/secrets#lifecycle-management"
  
  - key: "DATABASE_URL"
    schedule:
      type: "interval"
      intervalMs: 2592000000  # 30 days
    action: "rotate"
    preCheck: "test-connection"
    postCheck: "verify-migration"
  
  - key: "JWT_SECRET"
    expiration:
      days: 90
      warningDays: 7
    action: "rotate"
    rotateOnWarning: true
  
  - key: "R2_ACCESS_KEY"
    schedule:
      type: "event"
      event: "iam-role-update"
    action: "rotate"
  
  - key: "STRIPE_WEBHOOK_SECRET"
    schedule:
      type: "cron"
      cron: "0 3 * * 1"  # Weekly Monday 3 AM
    action: "rotate"
    metadata:
      severity: "CRITICAL"
      notify: ["slack#payments", "email#finance-team"]
      dependentServices: ["payment-service", "billing-api"]
  
  - key: "REDIS_PASSWORD"
    expiration:
      days: 60
      warningDays: 14
    action: "rotate"
    rotateOnWarning: true
    metadata:
      severity: "MEDIUM"
      notify: ["slack#infrastructure"]
  
  - key: "INTERNAL_API_TOKEN"
    schedule:
      type: "interval"
      intervalMs: 604800000  # 7 days
    action: "rotate"
    metadata:
      severity: "HIGH"
      tags:
        category: "internal"
        service: "api-gateway"

audit:
  enabled: true
  retentionDays: 365
  visualMetadata: true
  r2Bucket: "factorywager-secrets-audit"
  
documentation:
  autoGenerate: true
  includeInAudit: true
  domains: ["com", "sh"]

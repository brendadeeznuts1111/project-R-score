<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NEXUS Trading Intelligence Platform - Local development dashboard for cross-market arbitrage detection and trading analytics. Built with Bun.serve() TypeScript generics and latest Bun features">
    <meta name="keywords" content="trading, arbitrage, analytics, crypto, prediction markets, sports betting, Bun, TypeScript, Bun.serve, Bun.Server generic, WebSocket TypeScript">
    <meta name="og:description" content="NEXUS Trading Intelligence Platform - Built with Bun.serve() TypeScript generics and latest Bun features">
    <meta name="author" content="NEXUS Trading Platform">
    <meta name="theme-color" content="#667eea">
    <meta name="color-scheme" content="dark">
    <meta name="robots" content="noindex, nofollow">
    <title>NEXUS Dev Dashboard</title>
    <!-- External CSS disabled - using inline styles for compatibility -->
    <!-- <link rel="stylesheet" href="../styles/dashboard.css"> -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0e27;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: white;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .status-bar {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .status-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .enhanced-header {
            background: rgba(26, 31, 58, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .header-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .header-item strong {
            color: #667eea;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Enhanced Miniapp Integration Styles */
        #miniappToggleView:hover, #miniappRefresh:hover {
            background: rgba(102, 126, 234, 0.3) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        #miniappIframe {
            transition: opacity 0.3s ease;
        }

        #miniappIframe.loading {
            opacity: 0.5;
        }

        .miniapp-stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .miniapp-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .card {
            background: #1a1f3a;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #667eea;
            border-radius: 2px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: auto;
        }

        .status-online {
            background: #10b981;
            color: white;
        }

        .status-offline {
            background: #ef4444;
            color: white;
        }

        .status-warning {
            background: #f59e0b;
            color: white;
        }

        .status-unknown {
            background: #6b7280;
            color: white;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            opacity: 0.7;
            font-size: 0.9em;
        }

        .info-value {
            font-weight: 600;
            color: #667eea;
        }

        .topic-list {
            list-style: none;
            margin-top: 15px;
        }

        .topic-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topic-name {
            font-weight: 500;
        }

        .topic-id {
            opacity: 0.6;
            font-size: 0.85em;
        }

        .log-entry {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.85em;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-bottom: 6px;
            border-left: 3px solid #667eea;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .log-entry.log-error {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .log-entry.log-warn {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .log-entry.log-info {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .log-time {
            opacity: 0.6;
            font-size: 0.8em;
            min-width: 80px;
        }

        .log-level {
            font-weight: 600;
            min-width: 60px;
        }

        .log-level[data-level="ERROR"] {
            color: #ef4444;
        }

        .log-level[data-level="WARN"] {
            color: #f59e0b;
        }

        .log-level[data-level="INFO"] {
            color: #3b82f6;
        }

        .log-message {
            flex: 1;
            word-break: break-word;
        }

        #logsList {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
        }

        #logsList::-webkit-scrollbar {
            width: 8px;
        }

        #logsList::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        #logsList::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        button:hover {
            background: #5568d3;
        }

        button:active {
            transform: scale(0.98);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .refresh-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fca5a5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            opacity: 0.6;
        }

        .empty-state::before {
            content: 'üìä';
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
        }

        .architecture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .arch-node {
            background: #1a1f3a;
            border: 2px solid;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.85em;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .arch-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        .arch-node.class {
            border-color: #00d4ff;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15) 0%, rgba(0, 212, 255, 0.05) 100%);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .arch-node.interface {
            border-color: #00ff88;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 255, 136, 0.05) 100%);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .arch-node.function {
            border-color: #ff6b00;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.15) 0%, rgba(255, 107, 0, 0.05) 100%);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.3);
        }

        .arch-node.property {
            border-color: #ff00ff;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.15) 0%, rgba(255, 0, 255, 0.05) 100%);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .arch-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .arch-type {
            font-size: 0.75em;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .arch-name {
            font-weight: 700;
            font-size: 1.1em;
        }

        .arch-node.class .arch-name {
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .arch-node.interface .arch-name {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .arch-node.function .arch-name {
            color: #ff6b00;
            text-shadow: 0 0 10px rgba(255, 107, 0, 0.5);
        }

        .arch-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .arch-content {
            margin-top: 10px;
        }

        .arch-item {
            padding: 6px 0;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
            padding-left: 10px;
            margin-left: 5px;
            font-size: 0.9em;
        }

        .arch-item-name {
            color: #e0e0e0;
            font-weight: 600;
        }

        .arch-item-type {
            color: #8b5cf6;
            opacity: 0.8;
            font-size: 0.85em;
        }

        .arch-item-desc {
            color: #9ca3af;
            font-size: 0.8em;
            margin-top: 2px;
        }

        .arch-connection {
            text-align: center;
            color: #667eea;
            font-size: 1.5em;
            margin: 10px 0;
        }

        .colormap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .color-swatch {
            background: #1a1f3a;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .color-swatch:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
        }

        .color-preview {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .color-info {
            margin-top: 10px;
        }

        .color-hex {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-hex-code {
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            letter-spacing: 1px;
        }

        .color-hsl {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.9em;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        .color-usage {
            font-size: 0.9em;
            color: #d1d5db;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .color-reason {
            font-size: 0.85em;
            color: #9ca3af;
            font-style: italic;
            margin-top: 8px;
            line-height: 1.5;
        }

        .node-tree {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.9em;
            margin-left: 20px;
        }

        .node-item {
            margin: 8px 0;
            padding: 10px;
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid #00d4ff;
            border-radius: 4px;
        }

        .node-item.has-tension {
            border-left-color: #ff1744;
            background: rgba(255, 23, 68, 0.1);
            box-shadow: 0 0 10px rgba(255, 23, 68, 0.3);
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .node-id {
            color: #00d4ff;
            font-weight: 700;
            font-size: 1.05em;
        }

        .node-type {
            color: #00ff88;
            font-size: 0.85em;
            padding: 2px 8px;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 4px;
        }

        .node-period {
            color: #ff6b00;
            font-weight: 600;
        }

        .node-properties {
            margin-top: 8px;
            padding-left: 15px;
            border-left: 2px solid rgba(255, 0, 255, 0.3);
        }

        .node-prop {
            color: #ff00ff;
            font-size: 0.85em;
            margin: 4px 0;
        }

        .node-prop-name {
            font-weight: 600;
        }

        .node-prop-value {
            color: #4caf50;
            margin-left: 8px;
        }

        .tension-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 8px;
        }

        .tension-high {
            background: #ff1744;
            color: #fff;
        }

        .tension-medium {
            background: #ff6b00;
            color: #fff;
        }

        .tension-low {
            background: #ffeb3b;
            color: #000;
        }

        .node-children {
            margin-left: 30px;
            margin-top: 10px;
            padding-left: 15px;
            border-left: 2px dashed rgba(0, 212, 255, 0.3);
        }
    </style>
</head>
<body>
    <!-- Shared timezone utilities - Load in body to avoid execution context issues -->
    <script src="./js/timezone-utils.js" onerror="console.error('Failed to load timezone-utils.js')"></script>
    <div class="header" role="banner">
        <h1 id="main-heading">üöÄ NEXUS Dev Dashboard</h1>
        <p id="main-description">Local development dashboard for monitoring integrations</p>

        <!-- Developer Workspace Navigation -->
        <div class="header-nav" style="display: flex; gap: 15px; margin-top: 15px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
            <a href="/api/changelog" target="_blank" style="color: #00d4ff; text-decoration: none; padding: 8px 16px; background: rgba(0, 212, 255, 0.1); border-radius: 6px; font-size: 0.9em; transition: all 0.2s; border: 1px solid rgba(0, 212, 255, 0.3);" onmouseover="this.style.background='rgba(0, 212, 255, 0.2)'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='rgba(0, 212, 255, 0.1)'; this.style.transform='translateY(0)';">
                üìã Changelog
            </a>
            <a href="/api/changelog?limit=50" target="_blank" style="color: #84cc16; text-decoration: none; padding: 8px 16px; background: rgba(132, 204, 22, 0.1); border-radius: 6px; font-size: 0.9em; transition: all 0.2s; border: 1px solid rgba(132, 204, 22, 0.3);" onmouseover="this.style.background='rgba(132, 204, 22, 0.2)'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='rgba(132, 204, 22, 0.1)'; this.style.transform='translateY(0)';">
                üìú Git Logs
            </a>
            <a href="/api/rss.xml" target="_blank" style="color: #f59e0b; text-decoration: none; padding: 8px 16px; background: rgba(245, 158, 11, 0.1); border-radius: 6px; font-size: 0.9em; transition: all 0.2s; border: 1px solid rgba(245, 158, 11, 0.3);" onmouseover="this.style.background='rgba(245, 158, 11, 0.2)'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='rgba(245, 158, 11, 0.1)'; this.style.transform='translateY(0)';">
                üì° RSS Feed
            </a>
        </div>

        <!-- Compact Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <strong>Time</strong>
                <span id="systemTime">--:--:--</span>
                <span id="timezone" style="font-size: 0.8em; opacity: 0.7;"></span>
            </div>
            <div class="status-item">
                <strong>Mode</strong>
                <span id="mode">Standalone</span>
            </div>
            <div class="status-item">
                <strong>Last Update</strong>
                <span id="lastUpdate">Never</span>
            </div>
            <div class="status-item">
                <strong>Auto Refresh</strong>
                <span id="autoRefresh">Off</span>
            </div>
            <div class="status-item">
                <strong>Bun</strong>
                <span id="bunVersion">--</span>
            </div>
            <div class="status-item">
                <strong>Version</strong>
                <span id="appVersion">--</span>
            </div>
            <div class="status-item">
                <strong>Session</strong>
                <span id="sessionStatus">Checking...</span>
                <button id="signInBtn" onclick="signIn()" style="display: none; margin-left: 5px; padding: 2px 8px; font-size: 0.8em;">Sign In</button>
                <button id="signOutBtn" onclick="signOut()" style="display: none; margin-left: 5px; padding: 2px 8px; font-size: 0.8em;">Sign Out</button>
            </div>
            <div class="status-item">
                <strong>Uptime</strong>
                <span id="serverUptime">--</span>
            </div>
            <div class="status-item">
                <strong>Git</strong>
                <span id="gitCommit">--</span>
            </div>
        </div>

        <!-- Collapsible Details (hidden by default) -->
        <details style="margin-top: 15px;">
            <summary style="cursor: pointer; color: #9ca3af; font-size: 0.9em;">üìä Show Advanced Runtime Info</summary>
            <div style="background: rgba(26, 31, 58, 0.6); border-radius: 8px; padding: 15px; margin-top: 10px; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; font-size: 0.85em;">
                <div><strong style="color: #667eea;">Revision:</strong> <span id="bunRevision">--</span></div>
                <div><strong style="color: #667eea;">Platform:</strong> <span id="platform">--</span></div>
                <div><strong style="color: #667eea;">Arch:</strong> <span id="arch">--</span></div>
                <div><strong style="color: #667eea;">API:</strong> <span id="apiVersion">--</span></div>
                <div><strong style="color: #667eea;">OpenAPI:</strong> <span id="openApiVersion">--</span></div>
                <div><strong style="color: #667eea;">Endpoints:</strong> <span id="endpointCount">--</span></div>
                <div><strong style="color: #667eea;">Branch:</strong> <span id="gitBranch">--</span></div>
                <div><strong style="color: #667eea;">PID:</strong> <span id="processId">--</span></div>
                <div><strong style="color: #667eea;">Hostname:</strong> <span id="dnsHostname">--</span></div>
                <div><strong style="color: #667eea;">IPv4:</strong> <span id="ipv4Address">--</span></div>
                <div><strong style="color: #667eea;">IPv6:</strong> <span id="ipv6Address" style="word-break: break-all;">--</span></div>
                <div><strong style="color: #667eea;">Local IP:</strong> <span id="localIP">--</span></div>
            </div>
        </details>

        <!-- Hidden elements for JS compatibility -->
        <div style="display: none;">
            <span id="socketLocalAddress"></span>
            <span id="socketLocalPort"></span>
            <span id="socketLocalFamily"></span>
            <span id="socketRemoteAddress"></span>
            <span id="socketRemotePort"></span>
            <span id="socketRemoteFamily"></span>
            <span id="rapidhashStatus"></span>
            <span id="rapidhashExample"></span>
            <span id="processTimeout"></span>
            <span id="processMaxBuffer"></span>
            <span id="responseETag"></span>
            <span id="responseCookie"></span>
            <span id="headerGitCommit"></span>
            <span id="headerGitBranch"></span>
        </div>
    </div>

    <nav class="controls" role="toolbar" aria-label="Dashboard controls">
        <button onclick="refreshAll()" aria-label="Refresh all dashboard data">üîÑ Refresh All</button>
        <button onclick="toggleAutoRefresh()" class="secondary" id="autoRefreshBtn" aria-label="Toggle auto refresh">‚ñ∂Ô∏è Start Auto Refresh</button>
        <button onclick="loadFromFile()" class="secondary" aria-label="Load data from file">üìÅ Load from File</button>
        <button onclick="exportData()" class="secondary" aria-label="Export dashboard data">üíæ Export Data</button>
        <a href="./examples.html" class="secondary" style="text-decoration: none; padding: 10px 20px; background: #1a1f3a; border: 2px solid #ffeb3b; color: #ffeb3b; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-block;" aria-label="View API examples">üìö API Examples</a>
        <a href="./registry.html" class="secondary" style="text-decoration: none; padding: 10px 20px; background: #1a1f3a; border: 2px solid #00d4ff; color: #00d4ff; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-block;" aria-label="View registries">üìã Registry Browser</a>
        <a href="./correlation-graph.html" class="secondary" style="text-decoration: none; padding: 10px 20px; background: #1a1f3a; border: 2px solid #14b8a6; color: #14b8a6; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-block;" aria-label="View correlation graph">üîó Correlation Graph</a>
        <a href="./mcp-dashboard.html" class="secondary" style="text-decoration: none; padding: 10px 20px; background: #1a1f3a; border: 2px solid #667eea; color: #667eea; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-block;" aria-label="MCP Human-in-the-Loop Dashboard">ü§ñ MCP Dashboard</a>
    </nav>

    <div id="errorContainer" role="alert" aria-live="assertive"></div>

    <main class="grid" role="main">
        <!-- API Status -->
        <section class="card" aria-labelledby="api-heading">
            <h2 id="api-heading">
                API Server
                <span class="status-badge status-unknown" id="apiStatus" aria-label="API server status">Unknown</span>
            </h2>
            <div id="apiInfo">
                <div class="info-row">
                    <span class="info-label">Status</span>
                    <span class="info-value" id="apiStatusValue">Checking...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">URL</span>
                    <span class="info-value">http://localhost:3001</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Uptime</span>
                    <span class="info-value" id="apiUptime">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Endpoints</span>
                    <span class="info-value" id="apiEndpoints">-</span>
                </div>
            </div>
        </div>

        <!-- Telegram Integration Status -->
        <section class="card" aria-labelledby="telegram-heading">
            <h2 id="telegram-heading">
                Telegram Integration
                <span class="status-badge status-unknown" id="telegramStatus" aria-label="Telegram integration status">Unknown</span>
            </h2>
            <div id="telegramInfo">
                <div class="info-row">
                    <span class="info-label">Overall Status</span>
                    <span class="info-value" id="telegramOverallStatus">Checking...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Client Health</span>
                    <span class="info-value" id="telegramClientHealth">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">API Connected</span>
                    <span class="info-value" id="telegramApiConnected">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Success Rate</span>
                    <span class="info-value" id="telegramSuccessRate">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Total Requests</span>
                    <span class="info-value" id="telegramTotalRequests">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Avg Response Time</span>
                    <span class="info-value" id="telegramAvgResponseTime">-</span>
                </div>
            </div>
        </div>

        <!-- Telegram Topics -->
        <section class="card" aria-labelledby="topics-heading">
            <h2 id="topics-heading">Telegram Topics</h2>
            <ul class="topic-list" id="topicsList" role="list" aria-label="Telegram forum topics">
                <li class="empty-state">No topics loaded</li>
            </ul>
        </section>

        <!-- MCP Monitoring Dashboard -->
        <section class="card" style="grid-column: 1 / -1;" aria-labelledby="mcp-monitoring-heading">
            <h2 id="mcp-monitoring-heading">
                MCP Monitoring Dashboard
                <span class="status-badge status-unknown" id="mcpMonitoringStatus" aria-label="MCP monitoring status">Unknown</span>
            </h2>

            <!-- Tabs -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(102, 126, 234, 0.3);">
                <button onclick="showMCPTab('overview')" id="mcpTabOverview" class="mcp-tab-btn active" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">Overview</button>
                <button onclick="showMCPTab('metrics')" id="mcpTabMetrics" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Metrics & Graphs</button>
                <button onclick="showMCPTab('errors')" id="mcpTabErrors" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Errors & Logs</button>
                <button onclick="showMCPTab('tools')" id="mcpTabTools" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Tools & Properties</button>
                <button onclick="showMCPTab('endpoints')" id="mcpTabEndpoints" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Endpoints</button>
                <button onclick="showMCPTab('secrets')" id="mcpTabSecrets" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">üîê Secrets</button>
                <button onclick="showMCPTab('cpuProfiling')" id="mcpTabCpuProfiling" class="mcp-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">‚ö° CPU Profiling</button>
            </div>

            <!-- Overview Tab -->
            <div id="mcpTabContentOverview" class="mcp-tab-content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Invocations</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #667eea;" id="mcpTotalInvocations">-</div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Success Rate</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #10b981;" id="mcpSuccessRate">-</div>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Error Rate</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="mcpErrorRate">-</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Tools</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #3b82f6;" id="mcpTotalTools">-</div>
                    </div>
                    <div style="background: rgba(168, 85, 247, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(168, 85, 247, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Categories</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #a855f7;" id="mcpCategories">-</div>
                    </div>
                </div>
                <div id="mcpOverviewDetails" style="margin-top: 20px;"></div>
            </div>

            <!-- Metrics & Graphs Tab -->
            <div id="mcpTabContentMetrics" class="mcp-tab-content" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">Invocation Metrics</h3>
                    <div id="mcpInvocationGraph" style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; min-height: 200px;">
                        <canvas id="mcpInvocationChart" width="800" height="200"></canvas>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">Success vs Error Distribution</h3>
                    <div id="mcpSuccessErrorGraph" style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; min-height: 200px;">
                        <canvas id="mcpSuccessErrorChart" width="800" height="200"></canvas>
                    </div>
                </div>
                <div id="mcpLatencyStats" style="margin-top: 20px;"></div>
            </div>

            <!-- Errors & Logs Tab -->
            <div id="mcpTabContentErrors" class="mcp-tab-content" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #ef4444; margin-bottom: 15px;">Error Summary</h3>
                    <div id="mcpErrorSummary"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #ef4444; margin-bottom: 15px;">Recent Errors</h3>
                    <div id="mcpRecentErrors" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- Tools & Properties Tab -->
            <div id="mcpTabContentTools" class="mcp-tab-content" style="display: none;">
                <div id="mcpToolsList" style="max-height: 600px; overflow-y: auto;"></div>
            </div>

            <!-- Endpoints Tab -->
            <div id="mcpTabContentEndpoints" class="mcp-tab-content" style="display: none;">
                <div id="mcpEndpointsList"></div>
            </div>

            <!-- Secrets Tab -->
            <div id="mcpTabContentSecrets" class="mcp-tab-content" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üîê MCP Secrets Management</h3>
                    <p style="color: #9ca3af; margin-bottom: 20px;">
                        Manage API keys and session cookies for MCP servers securely using Bun.secrets.
                        All secrets are stored in your OS keychain (macOS Keychain, Linux libsecret, Windows Credential Manager).
                    </p>
                </div>

                <!-- Secrets Overview -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(255, 235, 59, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 235, 59, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Configured Servers</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ffeb3b;" id="mcpSecretsConfigured">-</div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Servers with API Keys</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #10b981;" id="mcpSecretsWithApiKeys">-</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Servers with Sessions</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #3b82f6;" id="mcpSecretsWithSessions">-</div>
                    </div>
                </div>

                <!-- Server List -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">Server Status</h3>
                    <div id="mcpSecretsServerList" style="display: grid; gap: 15px;"></div>
                </div>

                <!-- Add/Edit Server -->
                <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; border: 1px solid rgba(255, 235, 59, 0.3);">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">Manage Server Secrets</h3>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <label style="display: block; color: #9ca3af; margin-bottom: 5px; font-weight: 600;">Server Name</label>
                            <input type="text" id="mcpSecretsServerName" placeholder="e.g., bun, nexus"
                                   style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 235, 59, 0.3); border-radius: 4px; color: #e0e0e0; font-size: 1em;">
                        </div>
                        <div>
                            <label style="display: block; color: #9ca3af; margin-bottom: 5px; font-weight: 600;">API Key</label>
                            <input type="password" id="mcpSecretsApiKey" placeholder="Enter API key (stored securely)"
                                   style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 235, 59, 0.3); border-radius: 4px; color: #e0e0e0; font-size: 1em;">
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="setMCPApiKey()" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üíæ Store API Key</button>
                                <button onclick="deleteMCPApiKey()" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üóëÔ∏è Delete API Key</button>
                                <button onclick="viewMCPApiKey()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üëÅÔ∏è View Status</button>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; color: #9ca3af; margin-bottom: 5px; font-weight: 600;">Session Cookies</label>
                            <textarea id="mcpSecretsCookies" placeholder="Paste Set-Cookie header or cookie string"
                                      style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 235, 59, 0.3); border-radius: 4px; color: #e0e0e0; font-size: 1em; min-height: 80px; font-family: monospace;"></textarea>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="setMCPCookies()" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üíæ Store Cookies</button>
                                <button onclick="deleteMCPCookies()" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üóëÔ∏è Delete Cookies</button>
                            </div>
                        </div>
                    </div>
                    <div id="mcpSecretsMessage" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                </div>
            </div>

            <!-- CPU Profiling Tab -->
            <div id="mcpTabContentCpuProfiling" class="mcp-tab-content" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #f59e0b; margin-bottom: 15px;">‚ö° CPU Profiling System</h3>
                    <p style="color: #9ca3af; margin-bottom: 20px;">
                        Monitor CPU performance profiles, track regressions, and manage baseline profiles.
                        Profiles are versioned with git hash tracking for traceability.
                    </p>
                </div>

                <!-- Status Overview -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Profiles</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #f59e0b;" id="cpuProfTotalProfiles">-</div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Baseline Status</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #10b981;" id="cpuProfBaselineStatus">-</div>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Regression Status</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="cpuProfRegressionStatus">-</div>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Latest Version</div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #3b82f6;" id="cpuProfLatestVersion">-</div>
                    </div>
                </div>

                <!-- Regression Status -->
                <div id="cpuProfRegressionDetails" style="margin-bottom: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3);">
                    <h3 style="color: #f59e0b; margin-bottom: 15px;">Regression Analysis</h3>
                    <div id="cpuProfRegressionContent">Loading...</div>
                </div>

                <!-- Profile List -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #f59e0b; margin: 0;">Profile List</h3>
                        <button onclick="loadCPUProfiles()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üîÑ Refresh</button>
                    </div>
                    <div id="cpuProfProfileList" style="max-height: 400px; overflow-y: auto;">
                        <div class="empty-state">Loading profiles...</div>
                    </div>
                </div>

                <!-- Baseline Management -->
                <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3);">
                    <h3 style="color: #f59e0b; margin-bottom: 15px;">Baseline Management</h3>
                    <div id="cpuProfBaselineInfo" style="margin-bottom: 15px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 4px;">
                        <div class="empty-state">No baseline set</div>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="freezeCPUProfBaseline()" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üîí Freeze Baseline</button>
                        <button onclick="compareCPUProfiles()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üìä Compare Latest</button>
                    </div>
                    <div id="cpuProfBaselineMessage" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                </div>
            </div>
        </section>

        <!-- Recent Messages -->
        <section class="card" aria-labelledby="messages-heading">
            <h2 id="messages-heading">Recent Messages</h2>
            <div id="messagesList" role="list" aria-label="Recent Telegram messages">
                <div class="empty-state">No messages</div>
            </div>
        </section>

        <!-- Factory Wager Mini App - Enhanced Integration -->
        <section class="card" aria-labelledby="miniapp-heading" style="grid-column: 1 / -1;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="miniapp-heading" style="margin: 0;">
                    üéÆ Factory Wager Mini App
                    <span class="status-badge status-unknown" id="miniappStatus" aria-label="Mini App status">Unknown</span>
                </h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="miniappToggleView" style="padding: 8px 16px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            onclick="toggleMiniappView()">
                        <span id="miniappViewMode">üìä</span> <span id="miniappViewText">Embedded</span>
                    </button>
                    <button id="miniappRefresh" style="padding: 8px 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            onclick="refreshMiniapp()" title="Refresh Mini App">
                        üîÑ
                    </button>
                    <a href="https://staging.factory-wager-miniapp.pages.dev" target="_blank"
                       style="padding: 8px 16px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; text-decoration: none; font-size: 0.9em; transition: all 0.2s;"
                       onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'"
                       onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'"
                       onclick="navigateMiniapp('/'); return true;">
                        üîó Open
                    </a>
                    <button onclick="navigateMiniapp('/alert/covert-steam')"
                            style="padding: 8px 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            title="Navigate to Covert Steam Alerts"
                            onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'"
                            onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'">
                        üö® Alerts
                    </button>
                </div>
            </div>

            <!-- Embedded View -->
            <div id="miniappEmbeddedView" style="display: block;">
                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; overflow: hidden; border: 1px solid rgba(102, 126, 234, 0.3); margin-bottom: 15px;">
                    <iframe id="miniappIframe"
                            src="https://staging.factory-wager-miniapp.pages.dev"
                            style="width: 100%; height: 600px; border: none; display: block;"
                            sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"
                            title="Factory Wager Mini App"
                            loading="lazy">
                    </iframe>
                </div>
            </div>

            <!-- Stats View -->
            <div id="miniappStatsView" style="display: none;">
                <div id="miniappInfo" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Status</div>
                        <div style="font-size: 1.2em; font-weight: 600; color: #667eea;" id="miniappStatusValue">Checking...</div>
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Response Time</div>
                        <div style="font-size: 1.2em; font-weight: 600; color: #10b981;" id="miniappResponseTime">-</div>
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Version</div>
                        <div style="font-size: 1.2em; font-weight: 600; color: #3b82f6;" id="miniappVersion">-</div>
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Environment</div>
                        <div style="font-size: 1.2em; font-weight: 600; color: #f59e0b;" id="miniappEnvironment">-</div>
                    </div>
                </div>

                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 10px;">URL</div>
                    <a href="https://staging.factory-wager-miniapp.pages.dev" target="_blank"
                       style="color: #667eea; text-decoration: none; word-break: break-all; display: inline-block;"
                       onmouseover="this.style.textDecoration='underline'"
                       onmouseout="this.style.textDecoration='none'">
                        staging.factory-wager-miniapp.pages.dev
                    </a>
                </div>

                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 10px;">Deployed</div>
                    <div style="color: #e0e0e0; font-size: 1em;" id="miniappDeployed">-</div>
                </div>
            </div>

            <!-- Enhanced Details Section -->
                    <div id="miniappDetails" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.3);"></div>

                    <!-- Quick Navigation Links -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(102, 126, 234, 0.2);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 10px;">Quick Navigation</div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="navigateMiniapp('/')"
                                    style="padding: 6px 12px; background: rgba(102, 126, 234, 0.15); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.85em; transition: all 0.2s;"
                                    onmouseover="this.style.background='rgba(102, 126, 234, 0.25)'"
                                    onmouseout="this.style.background='rgba(102, 126, 234, 0.15)'">
                                üè† Home
                            </button>
                            <button onclick="navigateMiniapp('/alert/covert-steam')"
                                    style="padding: 6px 12px; background: rgba(102, 126, 234, 0.15); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.85em; transition: all 0.2s;"
                                    onmouseover="this.style.background='rgba(102, 126, 234, 0.25)'"
                                    onmouseout="this.style.background='rgba(102, 126, 234, 0.15)'">
                                üö® Covert Steam
                            </button>
                            <button onclick="navigateMiniapp('/health')"
                                    style="padding: 6px 12px; background: rgba(102, 126, 234, 0.15); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.85em; transition: all 0.2s;"
                                    onmouseover="this.style.background='rgba(102, 126, 234, 0.25)'"
                                    onmouseout="this.style.background='rgba(102, 126, 234, 0.15)'">
                                ‚ù§Ô∏è Health
                            </button>
                        </div>
                    </div>

            <!-- Real-time Metrics Chart -->
            <div id="miniappMetricsChart" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; display: none;">
                <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 10px;">Response Time Trend (last 10 checks)</div>
                <canvas id="miniappResponseTimeChart" style="width: 100%; height: 150px;"></canvas>
                    </div>
        </section>

        <!-- URL Anomaly Patterns Monitoring -->
        <section class="card" aria-labelledby="anomaly-heading" style="grid-column: 1 / -1;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="anomaly-heading" style="margin: 0;">
                    üîç URL Anomaly Patterns
                    <span class="status-badge status-unknown" id="anomalyStatus" aria-label="Anomaly detection status">Unknown</span>
                </h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="anomalySportSelect" onchange="loadAnomalyPatterns()"
                            style="padding: 8px 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #e0e0e0; font-size: 0.9em; cursor: pointer;">
                        <option value="NBA">NBA</option>
                        <option value="NFL">NFL</option>
                        <option value="MLB">MLB</option>
                        <option value="NHL">NHL</option>
                    </select>
                    <select id="anomalyHoursSelect" onchange="loadAnomalyPatterns()"
                            style="padding: 8px 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #e0e0e0; font-size: 0.9em; cursor: pointer;">
                        <option value="1">Last Hour</option>
                        <option value="6">Last 6 Hours</option>
                        <option value="24" selected>Last 24 Hours</option>
                        <option value="48">Last 48 Hours</option>
                        <option value="168">Last Week</option>
                    </select>
                    <button onclick="loadAnomalyPatterns()"
                            style="padding: 8px 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            title="Refresh Anomaly Patterns">
                        üîÑ Refresh
                    </button>
                    <button onclick="sendAnomalyAlert()"
                            style="padding: 8px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            title="Send Alert to Supergroup"
                            onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'"
                            onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                        üö® Alert
                    </button>
                </div>
            </div>

            <!-- Anomaly Statistics -->
            <div id="anomalyStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                    <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Patterns</div>
                    <div style="font-size: 1.5em; font-weight: 600; color: #667eea;" id="anomalyTotal">-</div>
                </div>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                    <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Database Anomalies</div>
                    <div style="font-size: 1.5em; font-weight: 600; color: #10b981;" id="anomalyDatabaseTotal">-</div>
                </div>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Avg Confidence</div>
                    <div style="font-size: 1.5em; font-weight: 600; color: #f59e0b;" id="anomalyAvgConfidence">-</div>
                </div>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #ef4444;">
                    <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">False Steam Rate</div>
                    <div style="font-size: 1.5em; font-weight: 600; color: #ef4444;" id="anomalyFalseSteamRate">-</div>
                </div>
            </div>

            <!-- Patterns List -->
            <div id="anomalyPatterns" style="margin-bottom: 20px;">
                <h3 style="font-size: 1.1em; margin-bottom: 15px; color: #667eea;">Detected Patterns</h3>
                <div id="anomalyPatternsList" style="display: grid; gap: 15px;">
                    <div style="text-align: center; padding: 40px; color: #9ca3af;">
                        Loading patterns...
                    </div>
                </div>
            </div>

            <!-- Database Diagnostics -->
            <div id="anomalyDiagnostics" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.3);">
                <h3 style="font-size: 1.1em; margin-bottom: 15px; color: #667eea;">Database Diagnostics</h3>
                <div id="anomalyDiagnosticsContent" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 20px; color: #9ca3af;">
                        Loading diagnostics...
                    </div>
                </div>
            </div>
        </section>

        <!-- Telegram Supergroup Management -->
        <section class="card" aria-labelledby="supergroup-heading" style="grid-column: 1 / -1;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="supergroup-heading" style="margin: 0;">
                    üí¨ Telegram Supergroup Management
                    <span class="status-badge status-unknown" id="supergroupStatus" aria-label="Supergroup status">Unknown</span>
                </h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button onclick="refreshSupergroup()"
                            style="padding: 8px 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                            title="Refresh Supergroup Data">
                        üîÑ Refresh
                    </button>
                </div>
            </div>

            <!-- Topics Grid -->
            <div id="supergroupTopics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="text-align: center; padding: 40px; color: #9ca3af;">
                    Loading topics...
                </div>
            </div>

            <!-- Alert Statistics -->
            <div id="supergroupStats" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.3);">
                <h3 style="font-size: 1.1em; margin-bottom: 15px; color: #667eea;">Alert Statistics</h3>
                <div id="supergroupStatsContent" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 20px; color: #9ca3af;">
                        Loading statistics...
                    </div>
                </div>
            </div>

            <!-- Quick Send Alert Form -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.3);">
                <h3 style="font-size: 1.1em; margin-bottom: 15px; color: #667eea;">Quick Send Alert</h3>
                <div style="display: grid; gap: 15px; grid-template-columns: 1fr auto;">
                    <div>
                        <select id="alertTopicSelect" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #e0e0e0; font-size: 0.9em;">
                            <option value="">Select topic...</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="alertMessageInput" placeholder="Alert message..."
                               style="flex: 1; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #e0e0e0; font-size: 0.9em;"
                               onkeypress="if(event.key==='Enter') sendQuickAlert()">
                        <button onclick="sendQuickAlert()"
                                style="padding: 10px 20px; background: rgba(102, 126, 234, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.9em; transition: all 0.2s;"
                                onmouseover="this.style.background='rgba(102, 126, 234, 0.4)'"
                                onmouseout="this.style.background='rgba(102, 126, 234, 0.3)'">
                            üì§ Send
                        </button>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 5px; color: #9ca3af; font-size: 0.85em;">
                        <input type="checkbox" id="pinAlertCheck" style="cursor: pointer;">
                        Pin message
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; color: #9ca3af; font-size: 0.85em;">
                        <input type="checkbox" id="addDeepLinkCheck" checked style="cursor: pointer;">
                        Add Mini App deep-link
                    </label>
                </div>
            </div>
        </section>

        <!-- System Metrics -->
        <section class="card" aria-labelledby="metrics-heading">
            <h2 id="metrics-heading">System Metrics</h2>
            <div id="metricsInfo" role="region" aria-label="System performance metrics">
                <div class="info-row">
                    <span class="info-label">Memory</span>
                    <span class="info-value" id="memoryUsage" aria-live="polite">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">CPU</span>
                    <span class="info-value" id="cpuUsage" aria-live="polite">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Platform</span>
                    <span class="info-value" id="platform">-</span>
                </div>
            </div>
        </section>

        <!-- Integration Logs / Console -->
        <section class="card" aria-labelledby="logs-heading">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="logs-heading">Console & Integration Logs</h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="clearConsoleLogs()" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 4px; cursor: pointer; font-size: 0.85em;">Clear</button>
                    <button onclick="toggleConsoleAutoScroll()" id="autoScrollBtn" style="padding: 6px 12px; background: rgba(102, 126, 234, 0.2); color: #667eea; border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 4px; cursor: pointer; font-size: 0.85em;">Auto-scroll: ON</button>
                </div>
            </div>
            <div id="logsList" role="log" aria-live="polite" aria-label="Console logs">
                <div class="empty-state">No logs yet. Console output will appear here.</div>
            </div>
        </section>

        <!-- Error Tracking & Downtime Monitoring -->
        <section class="card" style="grid-column: 1 / -1;" aria-labelledby="error-tracking-heading">
            <h2 id="error-tracking-heading">
                Error Tracking & Downtime Monitoring
                <span class="status-badge status-unknown" id="errorTrackingStatus" aria-label="Error tracking status">Unknown</span>
            </h2>

            <!-- Error Tracking Tabs -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(239, 68, 68, 0.3);">
                <button onclick="showErrorTab('overview')" id="errorTabOverview" class="error-tab-btn active" style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">Overview</button>
                <button onclick="showErrorTab('downtime')" id="errorTabDowntime" class="error-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Downtime History</button>
                <button onclick="showErrorTab('codes')" id="errorTabCodes" class="error-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Error Codes</button>
                <button onclick="showErrorTab('recent')" id="errorTabRecent" class="error-tab-btn" style="padding: 10px 20px; background: transparent; color: #9ca3af; border: none; cursor: pointer;">Recent Errors</button>
            </div>

            <!-- Overview Tab -->
            <div id="errorTabContentOverview" class="error-tab-content">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Errors (24h)</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="errorTotal">-</div>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Downtime Incidents</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="errorDowntimeIncidents">-</div>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Downtime</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="errorTotalDowntime">-</div>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Currently Down</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #ef4444;" id="errorCurrentlyDown">-</div>
                    </div>
                </div>
                <div id="errorOverviewDetails"></div>
            </div>

            <!-- Downtime History Tab -->
            <div id="errorTabContentDowntime" class="error-tab-content" style="display: none;">
                <div id="errorDowntimeList" style="max-height: 600px; overflow-y: auto;"></div>
            </div>

            <!-- Error Codes Tab -->
            <div id="errorTabContentCodes" class="error-tab-content" style="display: none;">
                <div id="errorCodesList" style="max-height: 600px; overflow-y: auto;"></div>
            </div>

            <!-- Recent Errors Tab -->
            <div id="errorTabContentRecent" class="error-tab-content" style="display: none;">
                <div id="errorRecentList" style="max-height: 600px; overflow-y: auto;"></div>
            </div>
        </section>

        <!-- Security Threat Monitoring -->
        <section class="card" aria-labelledby="security-threats-heading">
            <h2 id="security-threats-heading">
                [SECURITY.THREATS.RG] üõ°Ô∏è Security Threats
                <span class="status-badge status-unknown" id="securityThreatsStatus" aria-label="Security threats status">Unknown</span>
            </h2>
            <div id="securityThreatsInfo">
                <div class="info-row">
                    <span class="info-label">24h Threat Summary</span>
                    <span class="info-value" id="threatSummary">Loading...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Active Incidents</span>
                    <span class="info-value" id="activeIncidents">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Compliance Status</span>
                    <span class="info-value" id="complianceStatus">-</span>
                </div>
            </div>
            <div id="threatsList" style="margin-top: 15px; max-height: 200px; overflow-y: auto;" role="list" aria-label="Recent security threats">
                <div class="empty-state">No threats detected</div>
            </div>
        </section>

        <!-- Forensic Logging Status -->
        <section class="card" aria-labelledby="forensic-heading">
            <h2 id="forensic-heading">
                [FORENSIC.LOGGING.RG] üìä Forensic Logging
                <span class="status-badge status-unknown" id="forensicStatus" aria-label="Forensic logging status">Unknown</span>
            </h2>
            <div id="forensicInfo">
                <div class="info-row">
                    <span class="info-label">Audit Logs</span>
                    <span class="info-value" id="auditLogsCount">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">URL Anomalies</span>
                    <span class="info-value" id="urlAnomaliesCount">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Bookmaker Profiles</span>
                    <span class="info-value" id="bookmakerProfilesCount">-</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Color Map -->
    <section class="card" style="grid-column: 1 / -1;" aria-labelledby="colormap-header">
        <h2 id="colormap-header">[COLORMAP.RG] üé® Architecture Color Map</h2>
        <div id="colorMapContainer" style="margin-top: 20px;" role="region" aria-label="Color map visualization"></div>
    </section>

    <!-- Cookie Handling & URLSearchParams -->
    <section class="card" style="grid-column: 1 / -1;" aria-labelledby="cookie-header">
        <h2 id="cookie-header">[COOKIE.HANDLING.RG] üç™ Bun.CookieMap & URLSearchParams Demonstration</h2>
        <div style="margin-top: 20px;">
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid #667eea;">
                <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 10px;">
                    [BUN.COOKIE.API.RG] Bun Cookie API Reference
                </div>
                <div style="font-size: 0.9em; line-height: 1.8;">
                    <div style="color: #00d4ff; font-weight: 600; margin-bottom: 10px;">Bun.CookieMap Methods:</div>
                    <div style="margin-left: 20px; font-family: 'Monaco', 'Menlo', monospace;">
                        <div style="color: #ffeb3b;">‚Ä¢ new Bun.CookieMap() - Create empty map</div>
                        <div style="color: #ffeb3b;">‚Ä¢ new Bun.CookieMap(string) - Parse cookie header</div>
                        <div style="color: #ffeb3b;">‚Ä¢ new Bun.CookieMap(object) - From key-value pairs</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.get(name) - Get cookie value</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.set(name, value, opts) - Set cookie</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.delete(name) - Delete cookie</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.has(name) - Check existence</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.size - Get count</div>
                        <div style="color: #ff6b00;">‚Ä¢ map.toSetCookieHeaders() - Generate Set-Cookie headers</div>
                    </div>
                    <div style="color: #00d4ff; font-weight: 600; margin-top: 15px; margin-bottom: 10px;">Related Bun APIs:</div>
                    <div style="margin-left: 20px; font-family: 'Monaco', 'Menlo', monospace;">
                        <div style="color: #ffeb3b;">
                            ‚Ä¢ <a href="https://bun.com/reference/globals/URLSearchParams" target="_blank" style="color: #ffeb3b; text-decoration: underline;">URLSearchParams</a> - Query parameter building
                        </div>
                        <div style="color: #9ca3af; font-size: 0.85em; margin-top: 5px;">
                            Used alongside CookieMap for URL query parameters and form data
                        </div>
                    </div>
                    <div style="color: #00d4ff; font-weight: 600; margin-top: 15px; margin-bottom: 10px;">Bun.Cookie Properties:</div>
                    <div style="margin-left: 20px; font-family: 'Monaco', 'Menlo', monospace;">
                        <div style="color: #ff00ff;">‚Ä¢ name, value - Cookie name and value</div>
                        <div style="color: #ff00ff;">‚Ä¢ domain, path - Scope</div>
                        <div style="color: #ff00ff;">‚Ä¢ expires, maxAge - Expiration</div>
                        <div style="color: #ff00ff;">‚Ä¢ secure, httpOnly, sameSite - Security</div>
                        <div style="color: #ff00ff;">‚Ä¢ partitioned - Partitioned cookie support</div>
                    </div>
                </div>
            </div>

            <!-- URLSearchParams Example -->
            <div style="margin-top: 30px; padding: 15px; background: rgba(255, 235, 59, 0.1); border-radius: 8px; border-left: 4px solid #ffeb3b;">
                <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 10px;">
                    [URLSEARCHPARAMS.EXAMPLE.RG] URLSearchParams forEach Example
                </div>
                <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9em; line-height: 1.8; margin-bottom: 15px;">
                    <div style="color: #ffeb3b; margin-bottom: 10px;">Example Code:</div>
                    <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 6px; overflow-x: auto;">
                        <div style="color: #00d4ff;">const</div> <div style="color: #fff; display: inline;">myURL</div> = <div style="color: #00d4ff; display: inline;">new</div> <div style="color: #ff6b00; display: inline;">URL</div>(<div style="color: #4caf50;">'https://example.org/?a=b&#x26;c=d'</div>);<br>
                        myURL.searchParams.<div style="color: #ff6b00; display: inline;">forEach</div>((<div style="color: #ff00ff;">value</div>, <div style="color: #ff00ff;">name</div>, <div style="color: #ff00ff;">searchParams</div>) => {<br>
                        &nbsp;&nbsp;console.<div style="color: #ff6b00; display: inline;">log</div>(name, value, myURL.searchParams === searchParams);<br>
                        });<br>
                        <div style="color: #9ca3af; margin-top: 10px; font-style: italic;">// Prints:</div>
                        <div style="color: #9ca3af; margin-left: 20px;">//   a b true</div>
                        <div style="color: #9ca3af; margin-left: 20px;">//   c d true</div>
                    </div>
                </div>
                <button onclick="testURLSearchParams()" style="padding: 10px 20px; background: #ffeb3b; color: #000; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-family: 'Monaco', 'Menlo', monospace;" aria-label="Test URLSearchParams forEach">Test URLSearchParams.forEach()</button>
            </div>

            <div style="margin-top: 20px;">
                <label for="cookieName" style="display: block; margin-bottom: 8px; color: #00d4ff; font-weight: 600;">Cookie Name:</label>
                <input type="text" id="cookieName" placeholder="e.g., session"
                       style="padding: 10px; border-radius: 6px; background: #1a1f3a; border: 2px solid #00d4ff; color: #fff; width: 200px; font-size: 1em; margin-right: 10px;"
                       aria-label="Cookie name input">
                <label for="cookieValue" style="display: block; margin-bottom: 8px; color: #00d4ff; font-weight: 600; margin-top: 15px;">Cookie Value:</label>
                <input type="text" id="cookieValue" placeholder="e.g., abc123"
                       style="padding: 10px; border-radius: 6px; background: #1a1f3a; border: 2px solid #00d4ff; color: #fff; width: 200px; font-size: 1em; margin-right: 10px;"
                       aria-label="Cookie value input">
                <button onclick="testCookieMap()" style="margin-top: 15px; padding: 10px 20px; background: #00d4ff; color: #000; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;" aria-label="Test Bun CookieMap">Test CookieMap</button>
            </div>
            <div id="cookieResult" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9em; min-height: 100px;" aria-live="polite">
                <div style="color: #9ca3af;">Cookie operations will appear here...</div>
            </div>
            <div id="urlSearchParamsResult" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9em; min-height: 100px; display: none;" aria-live="polite">
                <div style="color: #9ca3af;">URLSearchParams results will appear here...</div>
            </div>
        </div>
    </section>

    <!-- Node Sitemap & Manifest -->
    <section class="card" style="grid-column: 1 / -1;" aria-labelledby="sitemap-header">
        <h2 id="sitemap-header">[NODE.SITEMAP.RG] üó∫Ô∏è Sub-Market Node Sitemap & Manifest</h2>
        <div style="margin-top: 20px; margin-bottom: 15px;">
            <label for="sitemapEventId" style="display: block; margin-bottom: 8px; color: #00d4ff; font-weight: 600;">Event ID:</label>
            <input type="text" id="sitemapEventId" placeholder="Enter Event ID"
                   style="padding: 10px; border-radius: 6px; background: #1a1f3a; border: 2px solid #00d4ff; color: #fff; width: 300px; font-size: 1em;"
                   aria-label="Event ID input for sitemap">
            <button onclick="loadSitemap()" style="margin-left: 10px; padding: 10px 20px; background: #00d4ff; color: #000; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;" aria-label="Load sitemap for event">Load Sitemap</button>
        </div>
        <div id="sitemapContainer" style="margin-top: 20px;" role="region" aria-live="polite"></div>
    </section>

    <!-- Architecture Visualization -->
    <section class="card" style="grid-column: 1 / -1;" aria-labelledby="architecture-header">
        <h2 id="architecture-header">[ARCHITECTURE.VISUALIZATION.RG] üìê Telegram Integration Architecture</h2>
        <div id="architectureContainer" style="margin-top: 20px;" role="img" aria-label="Telegram integration architecture diagram"></div>
    </section>
    </main>

    <script>
        // Ensure timezone utilities are loaded before proceeding
        if (!window.timezoneUtils) {
            console.warn('[Dashboard] timezone-utils.js not loaded, timezone features may not work');
        }

        // Add manifest.json link dynamically (only when served via HTTP)
        // This prevents file:// protocol from trying to fetch it
        if (window.location.protocol !== 'file:') {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = '/manifest.json';
            manifestLink.id = 'manifestLink';
            document.head.appendChild(manifestLink);
        }

        // Detect if running via file:// protocol (CORS issues)
        if (window.location.protocol === 'file:') {
            document.body.innerHTML = `
                <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: system-ui, sans-serif;">
                    <h1 style="color: #ef4444; margin-bottom: 20px;">‚ö†Ô∏è CORS Error</h1>
                    <p style="color: #e0e0e0; line-height: 1.6; margin-bottom: 20px;">
                        The dashboard cannot be opened directly via <code>file://</code> protocol due to browser security restrictions.
                    </p>
                    <div style="background: #1a1f3a; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h2 style="color: #667eea; margin-bottom: 15px;">Solution:</h2>
                        <p style="color: #e0e0e0; margin-bottom: 15px;">Start the dashboard server:</p>
                        <pre style="background: #0a0e27; padding: 15px; border-radius: 6px; overflow-x: auto; color: #10b981;"><code>bun run dashboard:serve</code></pre>
                        <p style="color: #e0e0e0; margin-top: 15px;">Then open:</p>
                        <pre style="background: #0a0e27; padding: 15px; border-radius: 6px; overflow-x: auto; color: #10b981;"><code>http://localhost:8080</code></pre>
                    </div>
                    <p style="color: #9ca3af; font-size: 0.9em;">
                        The dashboard server will serve the HTML with proper CORS headers and proxy API requests.
                    </p>
                </div>
            `;
            throw new Error('Cannot run dashboard via file:// protocol');
        }

        // API_BASE configuration: Always use port 3001 for API, regardless of dashboard port
        // Dashboard can be served on any port (8080, 3000, etc.) but API is always on 3001
        const getAPIPort = () => {
            const hostname = window.location.hostname;
            const port = window.location.port;
            const origin = window.location.origin;

            // If dashboard is on port 8080, API is on 3001
            if (port === '8080' || origin.includes(':8080')) {
                return '3001';
            }
            // If dashboard is on port 3000, API is on 3001
            if (port === '3000' || origin.includes(':3000')) {
                return '3001';
            }
            // Default to 3001 for localhost/127.0.0.1
            if (hostname === 'localhost' || hostname === '127.0.0.1' || !hostname) {
                return '3001';
            }
            // For production/other hosts, try same port first, fallback to 3001
            return port || '3001';
        };

        const API_BASE = `http://${window.location.hostname || 'localhost'}:${getAPIPort()}`;

        // Log API_BASE for debugging
        console.log(`[Dashboard] API_BASE: ${API_BASE}, Origin: ${window.location.origin}, Port: ${window.location.port || 'default'}`);
        let autoRefreshInterval = null;
        let autoRefreshEnabled = false;

        // Check if running from file:// protocol (CORS will block)
        const isFileProtocol = window.location.protocol === 'file:';
        if (isFileProtocol) {
            document.body.innerHTML = `
                <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: system-ui, sans-serif; background: #0a0e27; min-height: 100vh; color: #e0e0e0;">
                    <h1 style="color: #ef4444; margin-bottom: 20px;">‚ö†Ô∏è CORS Error</h1>
                    <p style="line-height: 1.6; margin-bottom: 20px;">
                        The dashboard cannot be opened directly via <code style="background: #1a1f3a; padding: 2px 6px; border-radius: 4px;">file://</code> protocol due to browser security restrictions (CORS).
                    </p>
                    <div style="background: #1a1f3a; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <h2 style="color: #667eea; margin-bottom: 15px;">‚úÖ Solution:</h2>
                        <p style="margin-bottom: 15px;">Start the dashboard server:</p>
                        <pre style="background: #0a0e27; padding: 15px; border-radius: 6px; overflow-x: auto; color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2);"><code>bun run dashboard:serve</code></pre>
                        <p style="margin-top: 15px;">Then open in your browser:</p>
                        <pre style="background: #0a0e27; padding: 15px; border-radius: 6px; overflow-x: auto; color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2);"><code>http://localhost:8080</code></pre>
                    </div>
                    <div style="background: #1a1f3a; padding: 20px; border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <h3 style="color: #667eea; margin-bottom: 10px;">What the server does:</h3>
                        <ul style="line-height: 1.8; padding-left: 20px;">
                            <li>Serves the dashboard HTML with proper CORS headers</li>
                            <li>Proxies API requests to avoid CORS issues</li>
                            <li>Serves static files (CSS, JSON, etc.)</li>
                        </ul>
                    </div>
                    <p style="color: #9ca3af; font-size: 0.9em; margin-top: 20px;">
                        The dashboard server runs on port 8080 by default (configurable via DASHBOARD_PORT env var).
                    </p>
                </div>
            `;
            throw new Error('Cannot run dashboard via file:// protocol - use bun run dashboard:serve');
        }

        // Enhanced console logging with Bun-style formatting
        const consoleLog = console.log.bind(console);
        const consoleError = console.error.bind(console);
        const consoleWarn = console.warn.bind(console);
        const consoleInfo = console.info.bind(console);

        console.log = function(...args) {
            consoleLog(`[LOG]`, ...args);
            logToDashboard('log', args.join(' '));
        };

        console.error = function(...args) {
            consoleError(`[ERROR]`, ...args);
            logToDashboard('error', args.join(' '));
        };

        console.warn = function(...args) {
            consoleWarn(`[WARN]`, ...args);
            logToDashboard('warn', args.join(' '));
        };

        console.info = function(...args) {
            consoleInfo(`[INFO]`, ...args);
            logToDashboard('info', args.join(' '));
        };

        let consoleAutoScroll = true;
        let consoleLogCount = 0;

        function logToDashboard(level, message) {
            const logsList = document.getElementById('logsList');
            if (!logsList) return;

            // Remove empty state if present
            const emptyState = logsList.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;

            const levelSpan = document.createElement('span');
            levelSpan.className = 'log-level';
            levelSpan.setAttribute('data-level', level.toUpperCase());
            levelSpan.textContent = `[${level.toUpperCase()}]`;

            const timeSpan = document.createElement('span');
            timeSpan.className = 'log-time';
            timeSpan.textContent = timestamp;

            const messageSpan = document.createElement('span');
            messageSpan.className = 'log-message';
            messageSpan.textContent = message;

            logEntry.appendChild(timeSpan);
            logEntry.appendChild(levelSpan);
            logEntry.appendChild(messageSpan);

            logsList.appendChild(logEntry);
            consoleLogCount++;

            // Keep only last 100 logs
            while (logsList.children.length > 100) {
                logsList.removeChild(logsList.firstChild);
                consoleLogCount--;
            }

            // Scroll to bottom if auto-scroll is enabled
            if (consoleAutoScroll) {
                logsList.scrollTop = logsList.scrollHeight;
            }
        }

        function clearConsoleLogs() {
            const logsList = document.getElementById('logsList');
            if (!logsList) return;

            logsList.innerHTML = '<div class="empty-state">Console cleared. New logs will appear here.</div>';
            consoleLogCount = 0;
        }

        function toggleConsoleAutoScroll() {
            consoleAutoScroll = !consoleAutoScroll;
            const btn = document.getElementById('autoScrollBtn');
            if (btn) {
                btn.textContent = `Auto-scroll: ${consoleAutoScroll ? 'ON' : 'OFF'}`;
                btn.style.background = consoleAutoScroll
                    ? 'rgba(102, 126, 234, 0.2)'
                    : 'rgba(107, 114, 128, 0.2)';
                btn.style.color = consoleAutoScroll ? '#667eea' : '#6b7280';
            }
        }

        function showError(message) {
            const container = document.getElementById('errorContainer');
            container.innerHTML = `<div class="error-message" role="alert">‚ö†Ô∏è ${message}</div>`;
            console.error(message);
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // Bun.CookieMap demonstration
        function testCookieMap() {
            const name = document.getElementById('cookieName').value || 'test';
            const value = document.getElementById('cookieValue').value || 'demo';
            const resultDiv = document.getElementById('cookieResult');

            try {
                // Simulate Bun.CookieMap usage (client-side demo)
                const cookieString = `${name}=${value}; Path=/; Secure; HttpOnly; SameSite=Strict`;
                const cookies = parseCookies(document.cookie);

                // Add new cookie
                cookies[name] = value;
                const newCookieString = Object.entries(cookies).map(([k, v]) => `${k}=${v}`).join('; ');

                const result = `
                    <div style="color: #00d4ff; font-weight: 600; margin-bottom: 10px;">[COOKIE.TEST.RG] Bun.CookieMap Test Results:</div>
                    <div style="color: #ffeb3b; margin-bottom: 8px;">Cookie String: <span style="color: #fff;">${cookieString}</span></div>
                    <div style="color: #ff6b00; margin-bottom: 8px;">Parsed Cookies:</div>
                    <div style="margin-left: 20px; color: #4caf50;">
                        ${Object.entries(cookies).map(([k, v]) => `‚Ä¢ ${k} = ${v}`).join('<br>')}
                    </div>
                    <div style="color: #ff00ff; margin-top: 15px; margin-bottom: 8px;">Cookie Properties:</div>
                    <div style="margin-left: 20px; color: #fff; font-family: 'Monaco', 'Menlo', monospace;">
                        name: "${name}"<br>
                        value: "${value}"<br>
                        domain: undefined<br>
                        path: "/"<br>
                        secure: true<br>
                        httpOnly: true<br>
                        sameSite: "Strict"<br>
                        maxAge: undefined
                    </div>
                    <div style="color: #00d4ff; margin-top: 15px; font-size: 0.85em; opacity: 0.8;">
                        Note: This is a client-side simulation. In Bun server, use: <code style="color: #ffeb3b;">new Bun.CookieMap(req.headers.get('cookie'))</code>
                    </div>
                `;

                resultDiv.innerHTML = result;
                console.info(`CookieMap test: Set ${name}=${value}`);
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #ff1744;">Error: ${error.message}</div>`;
                console.error('CookieMap test failed:', error);
            }
        }

        function parseCookies(cookieString) {
            const cookies = {};
            if (!cookieString) return cookies;
            cookieString.split(';').forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                if (name) cookies[name] = value || '';
            });
            return cookies;
        }

        // URLSearchParams.forEach demonstration
        function testURLSearchParams() {
            const resultDiv = document.getElementById('urlSearchParamsResult');
            resultDiv.style.display = 'block';

            try {
                // Example from Bun documentation
                const myURL = new URL('https://example.org/?a=b&c=d');
                const results = [];

                myURL.searchParams.forEach((value, name, searchParams) => {
                    const isSame = myURL.searchParams === searchParams;
                    results.push({ name, value, isSame });
                    console.log(name, value, isSame);
                });

                const result = `
                    <div style="color: #ffeb3b; font-weight: 600; margin-bottom: 10px;">[URLSEARCHPARAMS.RESULT.RG] URLSearchParams.forEach() Results:</div>
                    <div style="color: #00d4ff; margin-bottom: 8px;">URL: <span style="color: #fff;">${myURL.href}</span></div>
                    <div style="color: #ff6b00; margin-bottom: 8px;">Parameters:</div>
                    <div style="margin-left: 20px;">
                        ${results.map(r => `
                            <div style="color: #4caf50; margin-bottom: 5px;">
                                ‚Ä¢ <span style="color: #ff00ff;">${r.name}</span> = <span style="color: #fff;">${r.value}</span>
                                (<span style="color: #00bcd4;">searchParams === myURL.searchParams: ${r.isSame}</span>)
                            </div>
                        `).join('')}
                    </div>
                    <div style="color: #9ca3af; margin-top: 15px; font-size: 0.85em; opacity: 0.8;">
                        Note: The third parameter (searchParams) in forEach callback is the same object reference as myURL.searchParams
                    </div>
                `;

                resultDiv.innerHTML = result;
                console.info('URLSearchParams.forEach() test completed');
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #ff1744;">Error: ${error.message}</div>`;
                console.error('URLSearchParams test failed:', error);
            }
        }

        /**
         * Format system time (matches Bun CLI dashboard format)
         * Uses toLocaleTimeString() to match test runner and CLI output
         */
        function formatSystemTime(date) {
            if (!date) {
                date = new Date();
            }
            return date.toLocaleTimeString();
        }

        // Update system time display (same format as CLI: toLocaleTimeString)
        function updateSystemTime() {
            const timeStr = formatSystemTime();
            const systemTimeEl = document.getElementById('systemTime');
            if (systemTimeEl) {
                systemTimeEl.textContent = timeStr;
            }
        }

        function updateLastUpdate() {
            const timeStr = formatSystemTime(); // Same format as CLI
            const lastUpdateEl = document.getElementById('lastUpdate');
            const headerLastUpdateEl = document.getElementById('headerLastUpdate');
            const footerLastUpdateEl = document.getElementById('footerLastUpdate');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = timeStr;
            }
            if (headerLastUpdateEl) {
                headerLastUpdateEl.textContent = timeStr;
            }
            if (footerLastUpdateEl) {
                footerLastUpdateEl.textContent = timeStr;
            }
        }

        // Helper function for API calls with cookie support
        function apiFetch(url, options = {}) {
            return fetch(url, {
                ...options,
                credentials: 'include', // Always include cookies
                mode: 'cors'
            });
        }

        async function checkAPI() {
            try {
                const response = await apiFetch(`${API_BASE}/api/health`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });

                // Extract response headers (ETag, Cookie, Git headers, Timezone)
                await extractResponseHeaders(response);

                if (response.ok) {
                    const data = await response.json();

                    // Extract timezone config from response body if available
                    if (window.timezoneUtils && data.timezone) {
                        window.timezoneUtils.extractTimezoneFromBody(data);
                        window.timezoneUtils.updateTimezoneConstantsDisplay();
                    }

                    document.getElementById('apiStatus').textContent = 'Online';
                    document.getElementById('apiStatus').className = 'status-badge status-online';
                    document.getElementById('apiStatusValue').textContent = 'Online';

                    // Update mode to Connected when API is online
                    document.getElementById('mode').textContent = 'Connected';

                    // Update Bun version in footer from health response
                    if (data.bunVersion) {
                        const bunVersionEl = document.getElementById('bunVersion');
                        if (bunVersionEl) {
                            bunVersionEl.textContent = data.bunVersion;
                        }
                    }

                    // Try to get more info from discovery endpoint
                    try {
                        const discovery = await apiFetch(`${API_BASE}/api/discovery`);
                        if (discovery.ok) {
                            const discData = await discovery.json();
                            document.getElementById('apiEndpoints').textContent = discData.endpoints?.length || 'Unknown';
                        }
                    } catch (e) {
                        // Discovery endpoint not available
                    }
                } else {
                    throw new Error('API returned error');
                }
            } catch (error) {
                console.error('[Dashboard] API check failed:', error.message, `API_BASE: ${API_BASE}`);
                document.getElementById('apiStatus').textContent = 'Offline';
                document.getElementById('apiStatus').className = 'status-badge status-offline';
                document.getElementById('apiStatusValue').textContent = 'Offline';
                document.getElementById('apiEndpoints').textContent = '-';

                // Update mode to Standalone when API is offline
                document.getElementById('mode').textContent = 'Standalone';

                // Show connection hint
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    console.error('[Dashboard] Connection failed - check if API server is running on', API_BASE);
                }
            }
        }

        // Update NEXUS nav links to use current API_BASE
        function updateNexusLinks() {
            const links = document.querySelectorAll('#nexusLinks a[data-api-path]');
            links.forEach(link => {
                const path = link.getAttribute('data-api-path');
                if (path) {
                    link.href = API_BASE + path;
                }
            });
        }

        // Call immediately to update links
        updateNexusLinks();

        // Extract ETag and Cookie from last API response
        async function extractResponseHeaders(response) {
            try {
                const etag = response.headers.get('ETag');
                const cookie = response.headers.get('Set-Cookie');
                const gitCommit = response.headers.get('X-Git-Commit');
                const gitBranch = response.headers.get('X-Git-Branch');

                if (etag) {
                    document.getElementById('responseETag').textContent = etag;
                }
                if (cookie) {
                    document.getElementById('responseCookie').textContent = cookie.substring(0, 50) + (cookie.length > 50 ? '...' : '');
                }
                if (gitCommit) {
                    document.getElementById('headerGitCommit').textContent = gitCommit;
                }
                if (gitBranch) {
                    document.getElementById('headerGitBranch').textContent = gitBranch;
                }
            } catch (error) {
                // Ignore
            }
        }

        // Note: loadRuntimeInfo, loadGitInfo, loadAppInfo, updateTimezone are defined below
        // after the refreshAll function to avoid hoisting issues

        async function checkTelegram() {
            // Check integration status
            try {
                const response = await fetch(`${API_BASE}/api/telegram/integration/status`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });

                const data = await response.json();

                if (data.status === 'ok' && data.data) {
                    const status = data.data.overall;
                    const client = data.data.client;
                    const api = data.data.api;

                    // Update status badge
                    const statusClass = status.status === 'healthy' ? 'status-online' :
                                      status.status === 'degraded' ? 'status-warning' : 'status-offline';
                    document.getElementById('telegramStatus').textContent = status.status.toUpperCase();
                    document.getElementById('telegramStatus').className = `status-badge ${statusClass}`;

                    // Update info
                    document.getElementById('telegramOverallStatus').textContent = status.message;
                    document.getElementById('telegramClientHealth').textContent = client.healthy ? 'Healthy' : 'Unhealthy';
                    document.getElementById('telegramApiConnected').textContent = api.connected ? 'Yes' : 'No';
                    document.getElementById('telegramSuccessRate').textContent = `${client.stats.successRate}%`;
                    document.getElementById('telegramTotalRequests').textContent = client.stats.totalRequests;
                    document.getElementById('telegramAvgResponseTime').textContent = `${client.stats.averageResponseTime}ms`;
                } else if (data.status === 'error') {
                    // Handle config errors gracefully
                    document.getElementById('telegramStatus').textContent = 'Not Configured';
                    document.getElementById('telegramStatus').className = 'status-badge status-warning';
                    document.getElementById('telegramOverallStatus').textContent = data.error || 'Missing TELEGRAM_BOT_TOKEN';
                    document.getElementById('telegramClientHealth').textContent = '-';
                    document.getElementById('telegramApiConnected').textContent = 'No';
                    document.getElementById('telegramSuccessRate').textContent = '-';
                    document.getElementById('telegramTotalRequests').textContent = '-';
                    document.getElementById('telegramAvgResponseTime').textContent = '-';
                } else {
                    throw new Error('Unknown response');
                }
            } catch (error) {
                document.getElementById('telegramStatus').textContent = 'Offline';
                document.getElementById('telegramStatus').className = 'status-badge status-offline';
                document.getElementById('telegramOverallStatus').textContent = 'Cannot connect to API';
            }

            // Try to get topics
            try {
                const topicsResponse = await fetch(`${API_BASE}/api/telegram/topics`, {
                    signal: AbortSignal.timeout(3000)
                });
                if (topicsResponse.ok) {
                    const topicsData = await topicsResponse.json();
                    if (topicsData.status === 'ok' && topicsData.data) {
                        displayTopics(topicsData.data);
                    }
                }
            } catch (error) {
                // Ignore topics error
            }
        }

        function displayTopics(topics) {
            const list = document.getElementById('topicsList');
            if (!topics || topics.length === 0) {
                list.innerHTML = '<li class="empty-state">No topics found</li>';
                return;
            }

            list.innerHTML = topics.map(topic => `
                <li class="topic-item">
                    <span class="topic-name">${topic.name || 'Unnamed'}</span>
                    <span class="topic-id">ID: ${topic.message_thread_id}</span>
                </li>
            `).join('');
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesList');
            if (!messages || messages.length === 0) {
                container.innerHTML = '<div class="empty-state">No messages</div>';
                return;
            }

            container.innerHTML = messages.slice(0, 10).map(msg => `
                <div class="log-entry">
                    <div class="log-time">${new Date(msg.timestamp).toLocaleString()}</div>
                    <div>${msg.message || 'No message'}</div>
                    ${msg.threadId ? `<div style="opacity: 0.6; font-size: 0.8em;">Topic: ${msg.threadId}</div>` : ''}
                </div>
            `).join('');
        }

        function updateSystemMetrics() {
            // Browser-based metrics (limited)
            if (navigator.deviceMemory) {
                document.getElementById('memoryUsage').textContent = `${navigator.deviceMemory} GB`;
            }

            if (navigator.hardwareConcurrency) {
                document.getElementById('cpuUsage').textContent = `${navigator.hardwareConcurrency} cores`;
            }

            document.getElementById('platform').textContent = navigator.platform || 'Unknown';
        }

        async function checkSecurity() {
            try {
                // Check security threats
                const threatsResponse = await fetch(`${API_BASE}/api/security/threats?hours=24`, {
                    signal: AbortSignal.timeout(3000)
                });

                if (threatsResponse.ok) {
                    const threatsData = await threatsResponse.json();
                    const summary = threatsData.summary || [];
                    const total = threatsData.total || 0;

                    document.getElementById('threatSummary').textContent = `${total} threats detected`;
                    document.getElementById('securityThreatsStatus').textContent = total > 0 ? 'Active' : 'Clean';
                    document.getElementById('securityThreatsStatus').className = total > 0 ? 'status-badge status-warning' : 'status-badge status-online';

                    // Update threats list
                    const threatsList = document.getElementById('threatsList');
                    if (threatsList) {
                        if (summary.length === 0) {
                            threatsList.innerHTML = '<div class="empty-state">No threats detected</div>';
                        } else {
                            threatsList.innerHTML = summary.map(t => `
                                <div style="padding: 10px; margin-bottom: 8px; background: rgba(255, 87, 34, 0.1); border-left: 3px solid #ff5722; border-radius: 4px;">
                                    <div style="font-weight: 600; color: #ff5722;">${t.type}</div>
                                    <div style="font-size: 0.85em; color: #9ca3af; margin-top: 4px;">
                                        ${t.count} events | Max Severity: ${t.maxSeverity}/10
                                    </div>
                                </div>
                            `).join('');
                        }
                    }
                }

                // Check incidents
                const incidentsResponse = await fetch(`${API_BASE}/api/security/incidents`, {
                    signal: AbortSignal.timeout(3000)
                });

                if (incidentsResponse.ok) {
                    const incidentsData = await incidentsResponse.json();
                    const incidents = incidentsData.incidents || [];
                    document.getElementById('activeIncidents').textContent = `${incidents.length} active`;
                }

                // Check compliance
                const complianceResponse = await fetch(`${API_BASE}/api/security/compliance?days=30`, {
                    signal: AbortSignal.timeout(3000)
                });

                if (complianceResponse.ok) {
                    const complianceData = await complianceResponse.json();
                    const status = complianceData.status || 'unknown';
                    document.getElementById('complianceStatus').textContent = status === 'healthy' ? '‚úÖ Healthy' : '‚ö†Ô∏è No Data';
                }
            } catch (error) {
                document.getElementById('securityThreatsStatus').textContent = 'Unknown';
                document.getElementById('securityThreatsStatus').className = 'status-badge status-unknown';
            }
        }

        async function checkForensic() {
            try {
                // Note: Forensic logging endpoints would need to be added to API
                // For now, show placeholder
                document.getElementById('auditLogsCount').textContent = 'N/A';
                document.getElementById('urlAnomaliesCount').textContent = 'N/A';
                document.getElementById('bookmakerProfilesCount').textContent = 'N/A';
                document.getElementById('forensicStatus').textContent = 'Ready';
                document.getElementById('forensicStatus').className = 'status-badge status-online';
            } catch (error) {
                document.getElementById('forensicStatus').textContent = 'Unknown';
                document.getElementById('forensicStatus').className = 'status-badge status-unknown';
            }
        }

        let currentMCPTab = 'overview';
        let currentErrorTab = 'overview';

        function showErrorTab(tabName) {
            currentErrorTab = tabName;
            // Hide all tab contents
            document.querySelectorAll('.error-tab-content').forEach(el => {
                el.style.display = 'none';
            });
            // Remove active class from all buttons
            document.querySelectorAll('.error-tab-btn').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = '#9ca3af';
            });
            // Show selected tab content
            const content = document.getElementById(`errorTabContent${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            const button = document.getElementById(`errorTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (content) content.style.display = 'block';
            if (button) {
                button.style.background = '#ef4444';
                button.style.color = 'white';
            }
        }

        function showMCPTab(tabName) {
            currentMCPTab = tabName;
            // Hide all tab contents
            document.querySelectorAll('.mcp-tab-content').forEach(el => {
                el.style.display = 'none';
            });
            // Remove active class from all buttons
            document.querySelectorAll('.mcp-tab-btn').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = '#9ca3af';
            });
            // Show selected tab content
            const content = document.getElementById(`mcpTabContent${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            const button = document.getElementById(`mcpTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (content) content.style.display = 'block';
            if (button) {
                button.style.background = '#667eea';
                button.style.color = 'white';
            }

            // Load secrets data when secrets tab is shown
            if (tabName === 'secrets') {
                checkMCPSecrets();
            }

            // Load CPU profiling data when CPU profiling tab is shown
            if (tabName === 'cpuProfiling' || tabName === 'CpuProfiling') {
                loadCPUProfiles();
                loadCPUProfRegressionStatus();
            }
        }

        function drawBarChart(canvasId, data, labels, colors) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const max = Math.max(...data, 1);
            const barWidth = canvas.width / labels.length - 10;
            const barHeight = canvas.height - 40;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#e0e0e0';
            ctx.font = '12px monospace';

            labels.forEach((label, i) => {
                const height = (data[i] / max) * barHeight;
                const x = i * (barWidth + 10) + 5;
                const y = canvas.height - height - 20;

                ctx.fillStyle = colors[i] || '#667eea';
                ctx.fillRect(x, y, barWidth, height);

                ctx.fillStyle = '#e0e0e0';
                ctx.fillText(label.substring(0, 15), x, canvas.height - 5);
                ctx.fillText(data[i].toString(), x, y - 5);
            });
        }

        // ============ MCP Secrets Management ============

        async function checkMCPSecrets() {
            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update overview metrics
                    document.getElementById('mcpSecretsConfigured').textContent = data.totalConfigured || '0';
                    document.getElementById('mcpSecretsWithApiKeys').textContent =
                        data.servers?.filter(s => s.hasApiKey).length || '0';
                    document.getElementById('mcpSecretsWithSessions').textContent =
                        data.servers?.filter(s => s.hasCookies).length || '0';

                    // Render server list
                    const serverListHtml = data.servers?.map(server => `
                        <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${server.configured ? '#10b981' : '#9ca3af'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <strong style="color: #ffeb3b; display: block; margin-bottom: 5px;">${server.name}</strong>
                                    <div style="display: flex; gap: 10px; font-size: 0.9em;">
                                        <span style="color: ${server.hasApiKey ? '#10b981' : '#9ca3af'};">
                                            ${server.hasApiKey ? '‚úì' : '‚óã'} API Key
                                        </span>
                                        <span style="color: ${server.hasCookies ? '#3b82f6' : '#9ca3af'};">
                                            ${server.hasCookies ? '‚úì' : '‚óã'} Session
                                        </span>
                                    </div>
                                </div>
                                <button onclick="loadServerSecrets('${server.name}')"
                                        style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                    Manage
                                </button>
                            </div>
                        </div>
                    `).join('') || '<div class="empty-state">No servers configured</div>';

                    document.getElementById('mcpSecretsServerList').innerHTML = serverListHtml;
                } else {
                    throw new Error('Secrets API returned error');
                }
            } catch (error) {
                console.error('MCP secrets error:', error);
                document.getElementById('mcpSecretsConfigured').textContent = '-';
                document.getElementById('mcpSecretsWithApiKeys').textContent = '-';
                document.getElementById('mcpSecretsWithSessions').textContent = '-';
            }
        }

        async function loadServerSecrets(serverName) {
            document.getElementById('mcpSecretsServerName').value = serverName;
            await viewMCPApiKey();
        }

        async function setMCPApiKey() {
            const serverName = document.getElementById('mcpSecretsServerName').value.trim();
            const apiKey = document.getElementById('mcpSecretsApiKey').value.trim();
            const messageDiv = document.getElementById('mcpSecretsMessage');

            if (!serverName) {
                showSecretsMessage('Please enter a server name', 'error');
                return;
            }

            if (!apiKey) {
                showSecretsMessage('Please enter an API key', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets/${serverName}/api-key`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey })
                });

                const data = await response.json();

                if (response.ok) {
                    showSecretsMessage(`‚úÖ ${data.message}`, 'success');
                    document.getElementById('mcpSecretsApiKey').value = '';
                    await checkMCPSecrets();
                } else {
                    showSecretsMessage(`‚ùå ${data.message || 'Failed to store API key'}`, 'error');
                }
            } catch (error) {
                showSecretsMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function deleteMCPApiKey() {
            const serverName = document.getElementById('mcpSecretsServerName').value.trim();
            const messageDiv = document.getElementById('mcpSecretsMessage');

            if (!serverName) {
                showSecretsMessage('Please enter a server name', 'error');
                return;
            }

            if (!confirm(`Delete API key for '${serverName}'?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets/${serverName}/api-key`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (response.ok) {
                    showSecretsMessage(`‚úÖ ${data.message}`, 'success');
                    await checkMCPSecrets();
                } else {
                    showSecretsMessage(`‚ùå ${data.message || 'Failed to delete API key'}`, 'error');
                }
            } catch (error) {
                showSecretsMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function viewMCPApiKey() {
            const serverName = document.getElementById('mcpSecretsServerName').value.trim();
            const messageDiv = document.getElementById('mcpSecretsMessage');

            if (!serverName) {
                showSecretsMessage('Please enter a server name', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets/${serverName}`);
                const data = await response.json();

                if (response.ok) {
                    const status = [];
                    if (data.hasApiKey) {
                        status.push(`‚úì API Key configured (${data.apiKeyLength} chars, masked: ${data.apiKeyMasked})`);
                    } else {
                        status.push('‚óã No API key configured');
                    }
                    if (data.hasCookies) {
                        status.push(`‚úì Session cookies configured (${data.cookieCount} cookies)`);
                    } else {
                        status.push('‚óã No session cookies configured');
                    }
                    showSecretsMessage(`üìã ${serverName}: ${status.join(', ')}`, 'info');
                } else {
                    showSecretsMessage(`‚ùå ${data.message || 'Failed to get secret status'}`, 'error');
                }
            } catch (error) {
                showSecretsMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function setMCPCookies() {
            const serverName = document.getElementById('mcpSecretsServerName').value.trim();
            const cookieString = document.getElementById('mcpSecretsCookies').value.trim();
            const messageDiv = document.getElementById('mcpSecretsMessage');

            if (!serverName) {
                showSecretsMessage('Please enter a server name', 'error');
                return;
            }

            if (!cookieString) {
                showSecretsMessage('Please enter cookie string', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets/${serverName}/cookies`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cookieString })
                });

                const data = await response.json();

                if (response.ok) {
                    showSecretsMessage(`‚úÖ ${data.message}`, 'success');
                    document.getElementById('mcpSecretsCookies').value = '';
                    await checkMCPSecrets();
                } else {
                    showSecretsMessage(`‚ùå ${data.message || 'Failed to store cookies'}`, 'error');
                }
            } catch (error) {
                showSecretsMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function deleteMCPCookies() {
            const serverName = document.getElementById('mcpSecretsServerName').value.trim();
            const messageDiv = document.getElementById('mcpSecretsMessage');

            if (!serverName) {
                showSecretsMessage('Please enter a server name', 'error');
                return;
            }

            if (!confirm(`Delete session cookies for '${serverName}'?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/mcp/secrets/${serverName}/cookies`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (response.ok) {
                    showSecretsMessage(`‚úÖ ${data.message}`, 'success');
                    await checkMCPSecrets();
                } else {
                    showSecretsMessage(`‚ùå ${data.message || 'Failed to delete cookies'}`, 'error');
                }
            } catch (error) {
                showSecretsMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function showSecretsMessage(message, type = 'info') {
            const messageDiv = document.getElementById('mcpSecretsMessage');
            const colors = {
                success: { bg: 'rgba(16, 185, 129, 0.2)', border: '#10b981', text: '#10b981' },
                error: { bg: 'rgba(239, 68, 68, 0.2)', border: '#ef4444', text: '#ef4444' },
                info: { bg: 'rgba(59, 130, 246, 0.2)', border: '#3b82f6', text: '#3b82f6' }
            };
            const color = colors[type] || colors.info;

            messageDiv.style.display = 'block';
            messageDiv.style.background = color.bg;
            messageDiv.style.border = `1px solid ${color.border}`;
            messageDiv.style.color = color.text;
            messageDiv.textContent = message;

            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CPU Profiling Functions
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function loadCPUProfiles() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/profiles?limit=20`);
                const data = await response.json();

                if (data.success && data.profiles) {
                    document.getElementById('cpuProfTotalProfiles').textContent = data.count || data.profiles.length;

                    if (data.profiles.length === 0) {
                        document.getElementById('cpuProfProfileList').innerHTML = '<div class="empty-state">No profiles found. Run <code>bun run cpu-prof:test</code> or <code>bunx cpu-prof:test</code> to create one.</div>';
                        return;
                    }

                    const profilesHtml = data.profiles.map(profile => {
                        const createdAt = new Date(profile.createdAt).toLocaleString();
                        const severityBadge = profile.metrics?.totalTime ? '' : '';

                        return `
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #f59e0b;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                    <div>
                                        <strong style="color: #f59e0b; font-size: 1.1em;">${profile.version}</strong>
                                        <div style="font-size: 0.85em; color: #9ca3af; margin-top: 5px;">
                                            ID: ${profile.id.substring(0, 8)}... | Git: ${profile.gitHash} | Created: ${createdAt}
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <button onclick="downloadCPUProfile('${profile.filename}')" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-left: 5px;">‚¨áÔ∏è Download</button>
                                        <button onclick="viewCPUProfileInDevTools('${profile.filename}')" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-left: 5px;">üîç View</button>
                                        <button onclick="showCPUProfileDetails('${profile.id}')" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; margin-left: 5px;">üìä Details</button>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9em; color: #9ca3af;">
                                    <div>Total Time: <strong style="color: #e0e0e0;">${profile.metrics.totalTime}ms</strong></div>
                                    <div>Function Calls: <strong style="color: #e0e0e0;">${profile.metrics.functionCalls}</strong></div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    document.getElementById('cpuProfProfileList').innerHTML = profilesHtml;

                    // Update latest version
                    if (data.profiles.length > 0) {
                        document.getElementById('cpuProfLatestVersion').textContent = data.profiles[0].version;
                    }
                } else {
                    document.getElementById('cpuProfProfileList').innerHTML = '<div class="empty-state">Failed to load profiles</div>';
                }
            } catch (error) {
                document.getElementById('cpuProfProfileList').innerHTML = `<div class="empty-state">Error: ${error.message}</div>`;
            }
        }

        async function loadCPUProfRegressionStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/regression-status`);
                const data = await response.json();

                if (data.success && data.status) {
                    const status = data.status;

                    // Update status indicators
                    document.getElementById('cpuProfBaselineStatus').textContent = status.hasBaseline ? '‚úÖ Set' : '‚ùå Not Set';
                    document.getElementById('cpuProfBaselineStatus').style.color = status.hasBaseline ? '#10b981' : '#ef4444';

                    if (status.regression) {
                        const reg = status.regression;
                        const severityColors = {
                            CRITICAL: '#ef4444',
                            WARNING: '#f59e0b',
                            INFO: '#3b82f6',
                            IMPROVEMENT: '#10b981'
                        };
                        const color = severityColors[reg.severity] || '#9ca3af';

                        document.getElementById('cpuProfRegressionStatus').textContent = reg.severity;
                        document.getElementById('cpuProfRegressionStatus').style.color = color;

                        const regressionHtml = `
                            <div style="margin-bottom: 15px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: ${color}; margin-bottom: 10px;">
                                    ${reg.severity}: ${reg.message}
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.9em;">
                                    <div>Current: <strong>${reg.currentVersion}</strong></div>
                                    <div>Baseline: <strong>${reg.baselineVersion}</strong></div>
                                    <div>Time Delta: <strong style="color: ${reg.metrics.executionTimeDeltaPercent > 0 ? '#ef4444' : '#10b981'}">${reg.metrics.executionTimeDeltaPercent.toFixed(2)}%</strong></div>
                                    <div>Calls Delta: <strong style="color: ${reg.metrics.functionCallsDeltaPercent > 0 ? '#ef4444' : '#10b981'}">${reg.metrics.functionCallsDeltaPercent.toFixed(2)}%</strong></div>
                                </div>
                                ${reg.hotFunctionShifts && reg.hotFunctionShifts.length > 0 ? `
                                    <div style="margin-top: 15px;">
                                        <strong style="color: #9ca3af;">Hot Function Shifts:</strong>
                                        <div style="margin-top: 5px;">
                                            ${reg.hotFunctionShifts.map(shift => `
                                                <div style="font-size: 0.85em; color: #9ca3af; margin-top: 5px;">
                                                    ${shift.name}: <strong style="color: ${shift.timeDeltaPercent > 0 ? '#ef4444' : '#10b981'}">${shift.timeDeltaPercent.toFixed(2)}%</strong>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                ${reg.statisticalAnalysis ? `
                                    <div style="margin-top: 15px; padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 4px; border-left: 3px solid #f59e0b;">
                                        <strong style="color: #f59e0b;">üìä Statistical Analysis Available</strong>
                                        <div style="margin-top: 8px; font-size: 0.85em;">
                                            <div>P-value: <strong style="color: ${reg.statisticalAnalysis.meanDifference.test.isSignificant ? '#ef4444' : '#10b981'}">${reg.statisticalAnalysis.meanDifference.test.pValue.toFixed(4)}</strong> ${reg.statisticalAnalysis.meanDifference.test.isSignificant ? '‚úÖ Significant' : '‚ùå Not Significant'}</div>
                                            <div>Effect Size: <strong>${reg.statisticalAnalysis.meanDifference.effectSize.value.toFixed(2)}</strong> (${reg.statisticalAnalysis.meanDifference.effectSize.magnitude})</div>
                                            <div>95% CI: [${reg.statisticalAnalysis.meanDifference.confidenceInterval.lower.toFixed(2)}, ${reg.statisticalAnalysis.meanDifference.confidenceInterval.upper.toFixed(2)}]</div>
                                            <button onclick="showStatisticalDetails('${reg.currentVersion}', '${reg.baselineVersion}')" style="margin-top: 8px; padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em;">View Full Analysis</button>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                        document.getElementById('cpuProfRegressionContent').innerHTML = regressionHtml;
                    } else {
                        document.getElementById('cpuProfRegressionStatus').textContent = 'No Data';
                        document.getElementById('cpuProfRegressionStatus').style.color = '#9ca3af';
                        document.getElementById('cpuProfRegressionContent').innerHTML = '<div class="empty-state">No regression data available. Run a comparison to see results.</div>';
                    }

                    // Update baseline info
                    if (status.baseline) {
                        const baseline = status.baseline;
                        const baselineHtml = `
                            <div style="color: #9ca3af;">
                                <div><strong style="color: #f59e0b;">Version:</strong> ${baseline.version}</div>
                                <div><strong style="color: #f59e0b;">Created:</strong> ${new Date(baseline.createdAt).toLocaleString()}</div>
                                <div><strong style="color: #f59e0b;">Git Hash:</strong> ${baseline.gitHash}</div>
                                <div><strong style="color: #f59e0b;">Metrics:</strong> ${baseline.metrics.totalTime}ms, ${baseline.metrics.functionCalls} calls</div>
                            </div>
                        `;
                        document.getElementById('cpuProfBaselineInfo').innerHTML = baselineHtml;
                    } else {
                        document.getElementById('cpuProfBaselineInfo').innerHTML = '<div class="empty-state">No baseline set. Run <code>bun run cpu-prof:baseline</code> or <code>bunx cpu-prof:baseline</code> to create one.</div>';
                    }
                }
            } catch (error) {
                document.getElementById('cpuProfRegressionContent').innerHTML = `<div class="empty-state">Error: ${error.message}</div>`;
            }
        }

        async function freezeCPUProfBaseline() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/baseline/freeze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                const data = await response.json();
                const messageDiv = document.getElementById('cpuProfBaselineMessage');

                if (data.success) {
                    showCPUProfMessage('‚úÖ Baseline frozen successfully', 'success');
                    await loadCPUProfRegressionStatus();
                } else {
                    showCPUProfMessage(`‚ùå ${data.message || 'Failed to freeze baseline'}`, 'error');
                }
            } catch (error) {
                showCPUProfMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function compareCPUProfiles() {
            try {
                const statusResponse = await fetch(`${API_BASE}/api/v1/cpu-profiling/regression-status`);
                const statusData = await statusResponse.json();

                if (!statusData.success || !statusData.status.hasBaseline || !statusData.status.latestProfile) {
                    showCPUProfMessage('‚ùå Need both baseline and latest profile to compare', 'error');
                    return;
                }

                const compareResponse = await fetch(`${API_BASE}/api/v1/cpu-profiling/compare`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        currentId: statusData.status.latestProfile.id,
                        baselineId: statusData.status.baseline.id
                    })
                });

                const compareData = await compareResponse.json();

                if (compareData.success) {
                    showCPUProfMessage('‚úÖ Comparison completed. See regression analysis above.', 'success');
                    await loadCPUProfRegressionStatus();
                } else {
                    showCPUProfMessage(`‚ùå ${compareData.message || 'Failed to compare profiles'}`, 'error');
                }
            } catch (error) {
                showCPUProfMessage(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function downloadCPUProfile(filename) {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/files/${filename}`);
                const profileData = await response.json();

                const blob = new Blob([JSON.stringify(profileData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert(`Failed to download profile: ${error.message}`);
            }
        }

        /**
         * Show full statistical analysis details in modal
         */
        async function showStatisticalDetails(currentVersion, baselineVersion) {
            try {
                const statusResponse = await fetch(`${API_BASE}/api/v1/cpu-profiling/regression-status`);
                const statusData = await statusResponse.json();

                if (!statusData.success || !statusData.status.regression?.statisticalAnalysis) {
                    alert('Statistical analysis not available');
                    return;
                }

                const stats = statusData.status.regression.statisticalAnalysis;

                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: #1a1f3a;
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 900px;
                    max-height: 90vh;
                    overflow-y: auto;
                    border: 2px solid #f59e0b;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                `;

                content.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                        <h2 style="color: #f59e0b; margin: 0;">üìä Statistical Analysis Details</h2>
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                    </div>
                    <div style="display: grid; gap: 20px;">
                        <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">Mean Difference Test (t-test)</h3>
                            <div style="display: grid; gap: 8px; font-size: 0.9em;">
                                <div><strong style="color: #9ca3af;">Test Statistic:</strong> <span style="color: #e0e0e0;">${stats.meanDifference.test.testStatistic.toFixed(4)}</span></div>
                                <div><strong style="color: #9ca3af;">P-value:</strong> <span style="color: ${stats.meanDifference.test.isSignificant ? '#ef4444' : '#10b981'}; font-weight: bold;">${stats.meanDifference.test.pValue.toFixed(4)}</span> ${stats.meanDifference.test.isSignificant ? '‚úÖ Significant' : '‚ùå Not Significant'}</div>
                                ${stats.meanDifference.test.degreesOfFreedom ? `<div><strong style="color: #9ca3af;">Degrees of Freedom:</strong> <span style="color: #e0e0e0;">${stats.meanDifference.test.degreesOfFreedom.toFixed(1)}</span></div>` : ''}
                                <div><strong style="color: #9ca3af;">Mean Difference:</strong> <span style="color: #e0e0e0;">${stats.meanDifference.meanDiff.toFixed(2)}ms</span></div>
                                <div><strong style="color: #9ca3af;">Confidence Interval (${stats.meanDifference.confidenceInterval.level * 100}%):</strong>
                                    <span style="color: #e0e0e0;">[${stats.meanDifference.confidenceInterval.lower.toFixed(2)}, ${stats.meanDifference.confidenceInterval.upper.toFixed(2)}]</span>
                                    ${stats.meanDifference.confidenceInterval.lower > 0 || stats.meanDifference.confidenceInterval.upper < 0 ? ' ‚úÖ Excludes zero' : ' ‚ùå Includes zero'}
                                </div>
                                <div><strong style="color: #9ca3af;">Effect Size (Cohen's d):</strong>
                                    <span style="color: #e0e0e0; font-weight: bold;">${stats.meanDifference.effectSize.value.toFixed(2)}</span>
                                    <span style="color: #f59e0b;">(${stats.meanDifference.effectSize.magnitude})</span>
                                </div>
                            </div>
                        </div>

                        <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">Variance Comparison (F-test)</h3>
                            <div style="display: grid; gap: 8px; font-size: 0.9em;">
                                <div><strong style="color: #9ca3af;">F-statistic:</strong> <span style="color: #e0e0e0;">${stats.varianceComparison.test.testStatistic.toFixed(4)}</span></div>
                                <div><strong style="color: #9ca3af;">P-value:</strong> <span style="color: ${stats.varianceComparison.test.isSignificant ? '#ef4444' : '#10b981'}; font-weight: bold;">${stats.varianceComparison.test.pValue.toFixed(4)}</span> ${stats.varianceComparison.test.isSignificant ? '‚úÖ Significant' : '‚ùå Not Significant'}</div>
                                <div><strong style="color: #9ca3af;">Variance Ratio:</strong> <span style="color: #e0e0e0;">${stats.varianceComparison.varianceRatio.toFixed(2)}</span> ${stats.varianceComparison.varianceRatio > 1 ? '(current has higher variance)' : '(baseline has higher variance)'}</div>
                            </div>
                        </div>

                        <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">Distribution Comparison (Kolmogorov-Smirnov Test)</h3>
                            <div style="display: grid; gap: 8px; font-size: 0.9em;">
                                <div><strong style="color: #9ca3af;">KS Statistic:</strong> <span style="color: #e0e0e0;">${stats.distributionComparison.test.testStatistic.toFixed(4)}</span></div>
                                <div><strong style="color: #9ca3af;">P-value:</strong> <span style="color: ${stats.distributionComparison.test.isSignificant ? '#ef4444' : '#10b981'}; font-weight: bold;">${stats.distributionComparison.test.pValue.toFixed(4)}</span> ${stats.distributionComparison.test.isSignificant ? '‚úÖ Different distributions' : '‚ùå Similar distributions'}</div>
                                <div><strong style="color: #9ca3af;">Max CDF Difference:</strong> <span style="color: #e0e0e0;">${stats.distributionComparison.maxDifference.toFixed(4)}</span></div>
                            </div>
                        </div>

                        <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">Sample Information</h3>
                            <div style="display: grid; gap: 8px; font-size: 0.9em;">
                                <div><strong style="color: #9ca3af;">Baseline Samples:</strong> <span style="color: #e0e0e0;">${stats.sampleInfo.baselineSize}</span></div>
                                <div><strong style="color: #9ca3af;">Current Samples:</strong> <span style="color: #e0e0e0;">${stats.sampleInfo.currentSize}</span></div>
                                ${stats.sampleInfo.warning ? `<div style="color: #f59e0b; margin-top: 10px;">‚ö†Ô∏è ${stats.sampleInfo.warning}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;

                modal.appendChild(content);
                document.body.appendChild(modal);

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            } catch (error) {
                alert(`Failed to load statistical details: ${error.message}`);
            }
        }

        function showCPUProfMessage(message, type = 'info') {
            const messageDiv = document.getElementById('cpuProfBaselineMessage');
            const colors = {
                success: { bg: 'rgba(16, 185, 129, 0.2)', border: '#10b981', text: '#10b981' },
                error: { bg: 'rgba(239, 68, 68, 0.2)', border: '#ef4444', text: '#ef4444' },
                info: { bg: 'rgba(59, 130, 246, 0.2)', border: '#3b82f6', text: '#3b82f6' }
            };
            const color = colors[type] || colors.info;

            messageDiv.style.display = 'block';
            messageDiv.style.background = color.bg;
            messageDiv.style.border = `1px solid ${color.border}`;
            messageDiv.style.color = color.text;
            messageDiv.textContent = message;

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        /**
         * View CPU profile in Chrome DevTools (interactive)
         * Creates a data URI and opens in new tab for Chrome DevTools to load
         */
        async function viewCPUProfileInDevTools(filename) {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/files/${filename}`);
                const profileData = await response.json();

                // Create data URI for .cpuprofile file
                const jsonString = JSON.stringify(profileData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonString);

                // Open in new tab - Chrome DevTools can load .cpuprofile files
                const newWindow = window.open();
                if (newWindow) {
                    newWindow.location.href = dataUri;
                    // Also provide instructions
                    setTimeout(() => {
                        alert('Profile opened. To view in Chrome DevTools:\n1. Open Chrome DevTools (F12)\n2. Go to Performance tab\n3. Click "Load profile"\n4. Select the opened file\n\nOr drag the downloaded file into Chrome DevTools Performance tab.');
                    }, 500);
                } else {
                    // Fallback: download with instructions
                    downloadCPUProfile(filename);
                    alert('Profile downloaded. Open Chrome DevTools ‚Üí Performance ‚Üí Load profile ‚Üí Select the downloaded file.');
                }
            } catch (error) {
                alert(`Failed to open profile: ${error.message}`);
            }
        }

        /**
         * Show detailed CPU profile information (interactive modal)
         */
        async function showCPUProfileDetails(profileId) {
            try {
                const response = await fetch(`${API_BASE}/api/v1/cpu-profiling/profiles/${profileId}`);
                const data = await response.json();

                if (!data.success || !data.profile) {
                    alert('Profile not found');
                    return;
                }

                const profile = data.profile;
                const stats = profile.statisticalAnalysis;

                // Create modal with detailed information
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: #1a1f3a;
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                    border: 2px solid #667eea;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                `;

                let statsHtml = '';
                if (stats) {
                    statsHtml = `
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #f59e0b; margin-bottom: 15px;">üìä Statistical Analysis</h3>
                            <div style="display: grid; gap: 10px;">
                                <div>
                                    <strong style="color: #9ca3af;">Mean Difference Test:</strong>
                                    <div style="margin-left: 15px; font-size: 0.9em;">
                                        P-value: <strong style="color: ${stats.meanDifference.test.isSignificant ? '#ef4444' : '#10b981'}">${stats.meanDifference.test.pValue.toFixed(4)}</strong>
                                        ${stats.meanDifference.test.isSignificant ? ' ‚úÖ Significant' : ' ‚ùå Not Significant'}<br>
                                        Effect Size: <strong>${stats.meanDifference.effectSize.value.toFixed(2)}</strong> (${stats.meanDifference.effectSize.magnitude})<br>
                                        95% CI: [${stats.meanDifference.confidenceInterval.lower.toFixed(2)}, ${stats.meanDifference.confidenceInterval.upper.toFixed(2)}]
                                    </div>
                                </div>
                                <div>
                                    <strong style="color: #9ca3af;">Variance Comparison:</strong>
                                    <div style="margin-left: 15px; font-size: 0.9em;">
                                        P-value: <strong>${stats.varianceComparison.test.pValue.toFixed(4)}</strong>
                                        ${stats.varianceComparison.test.isSignificant ? ' ‚úÖ Significant' : ' ‚ùå Not Significant'}<br>
                                        Variance Ratio: <strong>${stats.varianceComparison.varianceRatio.toFixed(2)}</strong>
                                    </div>
                                </div>
                                <div>
                                    <strong style="color: #9ca3af;">Distribution Comparison (KS Test):</strong>
                                    <div style="margin-left: 15px; font-size: 0.9em;">
                                        P-value: <strong>${stats.distributionComparison.test.pValue.toFixed(4)}</strong>
                                        ${stats.distributionComparison.test.isSignificant ? ' ‚úÖ Different' : ' ‚ùå Similar'}<br>
                                        Max Difference: <strong>${stats.distributionComparison.maxDifference.toFixed(4)}</strong>
                                    </div>
                                </div>
                                ${stats.sampleInfo.warning ? `<div style="color: #f59e0b; margin-top: 10px;">‚ö†Ô∏è ${stats.sampleInfo.warning}</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                content.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                        <h2 style="color: #f59e0b; margin: 0;">üìä CPU Profile Details</h2>
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                    </div>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <strong style="color: #9ca3af;">Version:</strong> <span style="color: #e0e0e0;">${profile.version}</span>
                        </div>
                        <div>
                            <strong style="color: #9ca3af;">ID:</strong> <span style="color: #e0e0e0; font-family: monospace;">${profile.id}</span>
                        </div>
                        <div>
                            <strong style="color: #9ca3af;">Git Hash:</strong> <span style="color: #e0e0e0;">${profile.gitHash}</span>
                        </div>
                        <div>
                            <strong style="color: #9ca3af;">Created:</strong> <span style="color: #e0e0e0;">${new Date(profile.createdAt).toLocaleString()}</span>
                        </div>
                        <div>
                            <strong style="color: #9ca3af;">Filename:</strong> <span style="color: #e0e0e0;">${profile.filename}</span>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                            <h3 style="color: #667eea; margin-bottom: 10px;">Metrics</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9em;">
                                <div><strong style="color: #9ca3af;">Total Time:</strong> <span style="color: #e0e0e0;">${profile.metrics.totalTime}ms</span></div>
                                <div><strong style="color: #9ca3af;">Function Calls:</strong> <span style="color: #e0e0e0;">${profile.metrics.functionCalls}</span></div>
                                ${profile.metrics.rawSamples ? `<div><strong style="color: #9ca3af;">Samples:</strong> <span style="color: #e0e0e0;">${profile.metrics.rawSamples.executionTimes?.length || 0}</span></div>` : ''}
                            </div>
                            ${profile.metrics.hotFunctions && profile.metrics.hotFunctions.length > 0 ? `
                                <div style="margin-top: 15px;">
                                    <strong style="color: #9ca3af;">Hot Functions:</strong>
                                    <div style="margin-top: 10px;">
                                        ${profile.metrics.hotFunctions.map((func, idx) => `
                                            <div style="font-size: 0.85em; color: #9ca3af; margin-top: 5px;">
                                                ${idx + 1}. ${func.name}: ${func.time.toFixed(2)}ms (${func.percentage.toFixed(1)}%)
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        ${statsHtml}
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button onclick="downloadCPUProfile('${profile.filename}')" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">‚¨áÔ∏è Download Profile</button>
                            <button onclick="viewCPUProfileInDevTools('${profile.filename}')" style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">üîç Open in DevTools</button>
                        </div>
                    </div>
                `;

                modal.appendChild(content);
                document.body.appendChild(modal);

                // Close on background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            } catch (error) {
                alert(`Failed to load profile details: ${error.message}`);
            }
        }

        async function checkMCPTools() {
            try {
                // Fetch stats endpoint
                const statsResponse = await fetch(`${API_BASE}/api/mcp/stats`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();

                    // Update status
                    document.getElementById('mcpMonitoringStatus').textContent = 'Online';
                    document.getElementById('mcpMonitoringStatus').className = 'status-badge status-online';

                    // Update overview metrics
                    const summary = statsData.summary || {};
                    document.getElementById('mcpTotalInvocations').textContent = summary.totalInvocations?.toLocaleString() || '0';
                    document.getElementById('mcpSuccessRate').textContent = summary.successRate ? `${summary.successRate}%` : '-';
                    document.getElementById('mcpErrorRate').textContent = summary.errorRate ? `${summary.errorRate}%` : '-';
                    document.getElementById('mcpTotalTools').textContent = summary.totalTools?.toString() || '-';
                    document.getElementById('mcpCategories').textContent = summary.categories?.toString() || '-';

                    // Update overview details
                    const overviewHtml = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #667eea; margin-bottom: 10px;">Success Metrics</h4>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    <div>Total: ${summary.successCount?.toLocaleString() || 0}</div>
                                    <div>Rate: ${summary.successRate || 0}%</div>
                                </div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">Error Metrics</h4>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    <div>Total: ${summary.errorCount?.toLocaleString() || 0}</div>
                                    <div>Rate: ${summary.errorRate || 0}%</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('mcpOverviewDetails').innerHTML = overviewHtml;

                    // Update metrics graphs
                    if (statsData.tools && statsData.tools.length > 0) {
                        const topTools = statsData.tools
                            .filter(t => t.stats.total > 0)
                            .sort((a, b) => b.stats.total - a.stats.total)
                            .slice(0, 10);

                        const toolNames = topTools.map(t => t.name);
                        const toolInvocations = topTools.map(t => t.stats.total);
                        const toolSuccess = topTools.map(t => t.stats.success);
                        const toolErrors = topTools.map(t => t.stats.errors);

                        drawBarChart('mcpInvocationChart', toolInvocations, toolNames, toolNames.map(() => '#667eea'));

                        // Success vs Error chart
                        const canvas = document.getElementById('mcpSuccessErrorChart');
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            const max = Math.max(...toolInvocations, 1);
                            const barWidth = canvas.width / toolNames.length - 10;
                            const barHeight = canvas.height - 40;

                            toolNames.forEach((name, i) => {
                                const successHeight = (toolSuccess[i] / max) * barHeight;
                                const errorHeight = (toolErrors[i] / max) * barHeight;
                                const x = i * (barWidth + 10) + 5;

                                ctx.fillStyle = '#10b981';
                                ctx.fillRect(x, canvas.height - successHeight - errorHeight - 20, barWidth, successHeight);
                                ctx.fillStyle = '#ef4444';
                                ctx.fillRect(x, canvas.height - errorHeight - 20, barWidth, errorHeight);
                            });
                        }
                    }

                    // Update latency stats
                    if (statsData.latency) {
                        const latencyHtml = `
                            <h3 style="color: #667eea; margin-bottom: 15px;">Latency Statistics (ms)</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                                <div><strong>Avg:</strong> ${statsData.latency.avg?.toFixed(0) || 0}</div>
                                <div><strong>P50:</strong> ${statsData.latency.p50?.toFixed(0) || 0}</div>
                                <div><strong>P95:</strong> ${statsData.latency.p95?.toFixed(0) || 0}</div>
                                <div><strong>P99:</strong> ${statsData.latency.p99?.toFixed(0) || 0}</div>
                                <div><strong>Min:</strong> ${statsData.latency.min?.toFixed(0) || 0}</div>
                                <div><strong>Max:</strong> ${statsData.latency.max?.toFixed(0) || 0}</div>
                            </div>
                        `;
                        document.getElementById('mcpLatencyStats').innerHTML = latencyHtml;
                    }

                    // Update errors tab
                    if (statsData.errors) {
                        const errorSummaryHtml = `
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #ef4444;">Total Errors: ${statsData.errors.total || 0}</div>
                            </div>
                            ${statsData.errors.byTool && statsData.errors.byTool.length > 0 ? `
                                <h4 style="color: #9ca3af; margin-bottom: 10px;">Errors by Tool</h4>
                                <div style="display: grid; gap: 10px;">
                                    ${statsData.errors.byTool.map(e => `
                                        <div style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 8px; border-left: 3px solid #ef4444;">
                                            <strong style="color: #00d4ff;">${e.toolName}</strong>
                                            <div style="font-size: 0.9em; color: #9ca3af; margin-top: 5px;">
                                                Errors: ${e.errorCount} | Rate: ${e.errorRate}%
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<div class="empty-state">No errors recorded</div>'}
                        `;
                        document.getElementById('mcpErrorSummary').innerHTML = errorSummaryHtml;

                        const recentErrorsHtml = statsData.errors.recent && statsData.errors.recent.length > 0
                            ? statsData.errors.recent.map(e => `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #ef4444;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <strong style="color: #00d4ff;">${e.toolName}</strong>
                                        <span style="font-size: 0.85em; color: #9ca3af;">${new Date(e.timestamp).toLocaleString()}</span>
                                    </div>
                                    <div style="font-size: 0.9em; color: #9ca3af;">${e.error}</div>
                                </div>
                            `).join('')
                            : '<div class="empty-state">No recent errors</div>';
                        document.getElementById('mcpRecentErrors').innerHTML = recentErrorsHtml;
                    }

                    // Update tools tab
                    if (statsData.tools && statsData.tools.length > 0) {
                        const categoryGroups = {};
                        for (const tool of statsData.tools) {
                            const cat = tool.category || 'other';
                            if (!categoryGroups[cat]) categoryGroups[cat] = [];
                            categoryGroups[cat].push(tool);
                        }

                        let toolsHtml = '';
                        for (const [category, tools] of Object.entries(categoryGroups)) {
                            toolsHtml += `<div style="margin-bottom: 20px;">`;
                            toolsHtml += `<h3 style="color: #667eea; font-size: 1em; margin-bottom: 10px; text-transform: uppercase; border-bottom: 2px solid rgba(102, 126, 234, 0.3); padding-bottom: 5px;">${category} (${tools.length})</h3>`;
                            toolsHtml += `<div style="display: grid; gap: 10px;">`;
                            for (const tool of tools) {
                                const successRate = tool.successRate || 0;
                                const successColor = successRate >= 95 ? '#10b981' : successRate >= 80 ? '#f59e0b' : '#ef4444';
                                toolsHtml += `<div style="background: rgba(0, 0, 0, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid ${successColor};">`;
                                toolsHtml += `<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">`;
                                toolsHtml += `<strong style="color: #00d4ff;">${tool.name}</strong>`;
                                toolsHtml += `<span style="font-size: 0.85em; color: ${successColor};">${successRate}% success</span>`;
                                toolsHtml += `</div>`;
                                toolsHtml += `<div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 8px;">${tool.description || 'No description'}</div>`;
                                if (tool.tags && tool.tags.length > 0) {
                                    toolsHtml += `<div style="margin-top: 8px;">`;
                                    for (const tag of tool.tags.slice(0, 5)) {
                                        toolsHtml += `<span style="display: inline-block; background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-right: 6px; margin-bottom: 4px;">${tag}</span>`;
                                    }
                                    toolsHtml += `</div>`;
                                }
                                if (tool.inputSchema && tool.inputSchema.properties) {
                                    const props = Object.keys(tool.inputSchema.properties);
                                    if (props.length > 0) {
                                        toolsHtml += `<div style="margin-top: 8px; font-size: 0.8em; color: #6b7280;">Properties: ${props.join(', ')}</div>`;
                                    }
                                }
                                if (tool.stats) {
                                    toolsHtml += `<div style="margin-top: 8px; font-size: 0.8em; color: #6b7280;">Invocations: ${tool.stats.total} | Success: ${tool.stats.success} | Errors: ${tool.stats.errors}</div>`;
                                }
                                toolsHtml += `</div>`;
                            }
                            toolsHtml += `</div></div>`;
                        }
                        document.getElementById('mcpToolsList').innerHTML = toolsHtml || '<div class="empty-state">No tools available</div>';
                    }

                    // Update endpoints tab
                    if (statsData.endpoints) {
                        const endpointsHtml = `
                            <div style="display: grid; gap: 15px;">
                                ${Object.entries(statsData.endpoints).map(([name, url]) => `
                                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <strong style="color: #00d4ff; display: block; margin-bottom: 5px;">${name}</strong>
                                                <code style="color: #9ca3af; font-size: 0.9em;">${url}</code>
                                            </div>
                                            <a href="${API_BASE}${url}" target="_blank" style="color: #667eea; text-decoration: none; padding: 5px 10px; border: 1px solid #667eea; border-radius: 4px;">Open</a>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        document.getElementById('mcpEndpointsList').innerHTML = endpointsHtml;
                    }

                } else {
                    throw new Error('Stats API returned error');
                }
            } catch (error) {
                document.getElementById('mcpMonitoringStatus').textContent = 'Offline';
                document.getElementById('mcpMonitoringStatus').className = 'status-badge status-offline';
                console.error('MCP monitoring error:', error);
            }
        }

        async function checkErrorTracking() {
            try {
                const response = await fetch(`${API_BASE}/api/errors/stats`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update status
                    document.getElementById('errorTrackingStatus').textContent = 'Online';
                    document.getElementById('errorTrackingStatus').className = 'status-badge status-online';

                    // Update overview metrics
                    const summary = data.summary || {};
                    document.getElementById('errorTotal').textContent = summary.totalErrors?.toLocaleString() || '0';
                    document.getElementById('errorDowntimeIncidents').textContent = summary.totalDowntimeIncidents?.toLocaleString() || '0';

                    const totalDowntimeHours = summary.totalDowntimeMs ? Math.round(summary.totalDowntimeMs / (1000 * 60 * 60) * 100) / 100 : 0;
                    document.getElementById('errorTotalDowntime').textContent = `${totalDowntimeHours}h`;

                    const currentlyDown = summary.currentlyDown ? 'Yes' : 'No';
                    const downColor = summary.currentlyDown ? '#ef4444' : '#10b981';
                    document.getElementById('errorCurrentlyDown').textContent = currentlyDown;
                    document.getElementById('errorCurrentlyDown').style.color = downColor;

                    // Update overview details
                    const overviewHtml = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">Errors by Category</h4>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    ${Object.entries(data.byCategory || {}).map(([cat, count]) =>
                                        `<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span>${cat}:</span>
                                            <strong style="color: #ef4444;">${count}</strong>
                                        </div>`
                                    ).join('') || '<div>No errors</div>'}
                                </div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">Errors by Status Code</h4>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    ${Object.entries(data.byStatus || {}).map(([status, count]) =>
                                        `<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span>${status}:</span>
                                            <strong style="color: #ef4444;">${count}</strong>
                                        </div>`
                                    ).join('') || '<div>No errors</div>'}
                                </div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">Downtime Stats</h4>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    <div style="margin-bottom: 5px;">Avg Duration: ${summary.averageDowntimeMs ? Math.round(summary.averageDowntimeMs / 1000) : 0}s</div>
                                    <div style="margin-bottom: 5px;">Longest: ${summary.longestDowntimeMs ? Math.round(summary.longestDowntimeMs / 1000) : 0}s</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('errorOverviewDetails').innerHTML = overviewHtml;

                    // Update downtime incidents
                    if (data.downtimeIncidents && data.downtimeIncidents.length > 0) {
                        const downtimeHtml = data.downtimeIncidents.map(inc => `
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${inc.resolved ? '#10b981' : '#ef4444'};">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                    <div>
                                        <strong style="color: #00d4ff;">${inc.errorCode}</strong>
                                        <div style="font-size: 0.85em; color: #9ca3af; margin-top: 5px;">${inc.reason}</div>
                                    </div>
                                    <span style="font-size: 0.85em; color: ${inc.resolved ? '#10b981' : '#ef4444'};">
                                        ${inc.resolved ? 'Resolved' : 'Active'}
                                    </span>
                                </div>
                                <div style="font-size: 0.9em; color: #9ca3af;">
                                    <div>Start: ${inc.startTime}</div>
                                    ${inc.endTime ? `<div>End: ${inc.endTime}</div>` : ''}
                                    ${inc.durationSeconds ? `<div>Duration: ${inc.durationSeconds}s</div>` : ''}
                                    <div>Status: ${inc.statusCode}</div>
                                </div>
                            </div>
                        `).join('');
                        document.getElementById('errorDowntimeList').innerHTML = downtimeHtml;
                    } else {
                        document.getElementById('errorDowntimeList').innerHTML = '<div class="empty-state">No downtime incidents recorded</div>';
                    }

                    // Update error codes
                    if (data.errorCodes && data.errorCodes.length > 0) {
                        const codesHtml = data.errorCodes
                            .sort((a, b) => b.count - a.count)
                            .map(code => `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${code.recoverable ? '#10b981' : '#ef4444'};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                        <div>
                                            <strong style="color: #00d4ff;">${code.code}</strong>
                                            <span style="font-size: 0.85em; color: #9ca3af; margin-left: 10px;">${code.status}</span>
                                        </div>
                                        <span style="font-size: 0.85em; color: #ef4444;">${code.count} occurrences</span>
                                    </div>
                                    <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 8px;">${code.message}</div>
                                    <div style="display: flex; gap: 10px; font-size: 0.85em;">
                                        <span style="color: #667eea;">Category: ${code.category}</span>
                                        <span style="color: ${code.recoverable ? '#10b981' : '#ef4444'};">${code.recoverable ? 'Recoverable' : 'Not Recoverable'}</span>
                                        <a href="${code.ref}" target="_blank" style="color: #00d4ff; text-decoration: none;">Docs</a>
                                    </div>
                                </div>
                            `).join('');
                        document.getElementById('errorCodesList').innerHTML = codesHtml;
                    } else {
                        document.getElementById('errorCodesList').innerHTML = '<div class="empty-state">No error codes available</div>';
                    }

                    // Update recent errors
                    if (data.recentErrors && data.recentErrors.length > 0) {
                        const recentHtml = data.recentErrors.map(err => `
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #ef4444;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px;">
                                    <strong style="color: #00d4ff;">${err.code}</strong>
                                    <span style="font-size: 0.85em; color: #9ca3af;">${new Date(err.timestamp).toLocaleString()}</span>
                                </div>
                                <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 5px;">${err.message}</div>
                                ${err.path ? `<div style="font-size: 0.85em; color: #6b7280;">Path: ${err.path}</div>` : ''}
                            </div>
                        `).join('');
                        document.getElementById('errorRecentList').innerHTML = recentHtml;
                    } else {
                        document.getElementById('errorRecentList').innerHTML = '<div class="empty-state">No recent errors</div>';
                    }

                } else {
                    throw new Error('Error tracking API returned error');
                }
            } catch (error) {
                document.getElementById('errorTrackingStatus').textContent = 'Offline';
                document.getElementById('errorTrackingStatus').className = 'status-badge status-offline';
                console.error('Error tracking error:', error);
            }
        }

        // Miniapp response time history for chart
        const miniappResponseTimeHistory = [];
        const MAX_HISTORY = 10;
        let miniappViewMode = 'embedded'; // 'embedded' or 'stats'

        function toggleMiniappView() {
            const embeddedView = document.getElementById('miniappEmbeddedView');
            const statsView = document.getElementById('miniappStatsView');
            const viewMode = document.getElementById('miniappViewMode');
            const viewText = document.getElementById('miniappViewText');

            if (miniappViewMode === 'embedded') {
                embeddedView.style.display = 'none';
                statsView.style.display = 'block';
                viewMode.textContent = 'üì±';
                viewText.textContent = 'Stats';
                miniappViewMode = 'stats';
            } else {
                embeddedView.style.display = 'block';
                statsView.style.display = 'none';
                viewMode.textContent = 'üìä';
                viewText.textContent = 'Embedded';
                miniappViewMode = 'embedded';
            }
        }

        function refreshMiniapp() {
            const iframe = document.getElementById('miniappIframe');
            const refreshBtn = document.getElementById('miniappRefresh');

            if (refreshBtn) {
                refreshBtn.style.opacity = '0.5';
                refreshBtn.style.pointerEvents = 'none';
            }

            if (iframe) {
                iframe.classList.add('loading');
                // Force reload by adding timestamp
                const url = new URL(iframe.src);
                url.searchParams.set('_refresh', Date.now());
                iframe.src = url.toString();

                iframe.onload = () => {
                    iframe.classList.remove('loading');
                    if (refreshBtn) {
                        refreshBtn.style.opacity = '1';
                        refreshBtn.style.pointerEvents = 'auto';
                    }
                };
            }
            checkMiniapp();
        }

        // Deep linking: Navigate miniapp iframe to specific path
        function navigateMiniapp(path) {
            const iframe = document.getElementById('miniappIframe');
            if (iframe) {
                const baseUrl = 'https://staging.factory-wager-miniapp.pages.dev';
                iframe.src = `${baseUrl}${path.startsWith('/') ? path : '/' + path}`;

                // Switch to embedded view if in stats mode
                if (miniappViewMode === 'stats') {
                    toggleMiniappView();
                }
            }
        }

        // Listen for messages from miniapp iframe (postMessage API)
        window.addEventListener('message', (event) => {
            // Security: Only accept messages from miniapp origin
            if (event.origin !== 'https://staging.factory-wager-miniapp.pages.dev') {
                return;
            }

            const data = event.data;
            if (data && data.type === 'miniapp-navigation') {
                // Handle navigation requests from miniapp
                console.log('Miniapp navigation:', data.path);
            } else if (data && data.type === 'miniapp-status') {
                // Update status from miniapp
                if (data.status) {
                    document.getElementById('miniappStatus').textContent =
                        data.status.charAt(0).toUpperCase() + data.status.slice(1);
                }
            }
        });

        // ============ Telegram Supergroup Management ============

        async function refreshSupergroup() {
            await Promise.all([
                loadSupergroupTopics(),
                loadSupergroupStats()
            ]);
        }

        async function loadSupergroupTopics() {
            try {
                const response = await fetch(`${API_BASE}/api/miniapp/supergroup/topics`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (response.ok) {
                    const data = await response.json();
                    const topicsContainer = document.getElementById('supergroupTopics');
                    const topicSelect = document.getElementById('alertTopicSelect');

                    if (data.success && data.topics && data.topics.length > 0) {
                        // Update status
                        document.getElementById('supergroupStatus').textContent = 'Online';
                        document.getElementById('supergroupStatus').className = 'status-badge status-online';

                        // Render topics grid
                        const topicsHtml = data.topics.map(topic => {
                            const goldenTopic = data.goldenConfig?.find((gt) => gt.threadId === topic.message_thread_id);
                            const categoryColors = {
                                'live': '#ef4444',
                                'alerts': '#f59e0b',
                                'analytics': '#3b82f6',
                                'general': '#667eea'
                            };
                            const color = categoryColors[goldenTopic?.category || 'general'] || '#667eea';

                            return `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${color};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                        <div>
                                            <strong style="color: ${color}; font-size: 1em;">${topic.name || `Topic ${topic.message_thread_id}`}</strong>
                                            ${goldenTopic ? `<div style="font-size: 0.75em; color: #9ca3af; margin-top: 2px;">${goldenTopic.category}</div>` : ''}
                                        </div>
                                        <span style="font-size: 0.85em; color: #6b7280;">ID: ${topic.message_thread_id}</span>
                                    </div>
                                    ${goldenTopic ? `
                                        <div style="font-size: 0.85em; color: #9ca3af; margin-top: 8px;">
                                            ${goldenTopic.description}
                                        </div>
                                        ${goldenTopic.autoPin ? `<div style="font-size: 0.75em; color: #f59e0b; margin-top: 5px;">üìå Auto-pin enabled</div>` : ''}
                                    ` : ''}
                                    <button onclick="sendToTopic(${topic.message_thread_id})"
                                            style="margin-top: 10px; padding: 6px 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 6px; color: #667eea; cursor: pointer; font-size: 0.85em; width: 100%; transition: all 0.2s;"
                                            onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'"
                                            onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'">
                                        üì§ Send Alert
                                    </button>
                                </div>
                            `;
                        }).join('');

                        topicsContainer.innerHTML = topicsHtml;

                        // Update select dropdown
                        topicSelect.innerHTML = '<option value="">Select topic...</option>' +
                            data.topics.map(topic => {
                                const goldenTopic = data.goldenConfig?.find((gt) => gt.threadId === topic.message_thread_id);
                                return `<option value="${topic.message_thread_id}">${topic.name || `Topic ${topic.message_thread_id}`}${goldenTopic ? ` (${goldenTopic.category})` : ''}</option>`;
                            }).join('');
                    } else {
                        topicsContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af;">No topics found</div>';
                        document.getElementById('supergroupStatus').textContent = 'No Topics';
                        document.getElementById('supergroupStatus').className = 'status-badge status-warning';
                    }
                } else {
                    throw new Error('Failed to load topics');
                }
            } catch (error) {
                document.getElementById('supergroupStatus').textContent = 'Error';
                document.getElementById('supergroupStatus').className = 'status-badge status-offline';
                document.getElementById('supergroupTopics').innerHTML =
                    '<div style="text-align: center; padding: 40px; color: #ef4444;">Failed to load topics</div>';
                console.error('Supergroup topics error:', error);
            }
        }

        async function loadSupergroupStats() {
            try {
                const response = await fetch(`${API_BASE}/api/miniapp/supergroup/stats`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (response.ok) {
                    const data = await response.json();
                    const statsContainer = document.getElementById('supergroupStatsContent');

                    if (data.alertStats) {
                        const statsHtml = `
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                                <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">Total Alerts</div>
                                <div style="font-size: 1.5em; font-weight: 600; color: #667eea;">${data.alertStats.total || 0}</div>
                            </div>
                            ${data.alertStats.bySeverity ? Object.entries(data.alertStats.bySeverity).map(([severity, count]) => `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${severity === 'critical' ? '#ef4444' : severity === 'high' ? '#f59e0b' : '#3b82f6'};">
                                    <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">${severity.charAt(0).toUpperCase() + severity.slice(1)}</div>
                                    <div style="font-size: 1.5em; font-weight: 600; color: ${severity === 'critical' ? '#ef4444' : severity === 'high' ? '#f59e0b' : '#3b82f6'};">${count}</div>
                                </div>
                            `).join('') : ''}
                        `;
                        statsContainer.innerHTML = statsHtml;
                    }
                }
            } catch (error) {
                console.error('Supergroup stats error:', error);
            }
        }

        async function sendQuickAlert() {
            const topicId = document.getElementById('alertTopicSelect').value;
            const message = document.getElementById('alertMessageInput').value;
            const pinMessage = document.getElementById('pinAlertCheck').checked;
            const addDeepLink = document.getElementById('addDeepLinkCheck').checked;

            if (!topicId || !message) {
                alert('Please select a topic and enter a message');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/miniapp/supergroup/send-alert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        threadId: parseInt(topicId),
                        pinMessage,
                        alertType: addDeepLink ? 'covert-steam' : undefined,
                        alertData: addDeepLink ? {
                            id: `alert-${Date.now()}`,
                            type: 'manual',
                            ts: Date.now()
                        } : undefined
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        document.getElementById('alertMessageInput').value = '';
                        alert('Alert sent successfully!');
                        await refreshSupergroup();
                    } else {
                        alert('Failed to send alert');
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                alert('Error sending alert: ' + (error instanceof Error ? error.message : 'Unknown error'));
                console.error('Send alert error:', error);
            }
        }

        function sendToTopic(threadId) {
            document.getElementById('alertTopicSelect').value = threadId.toString();
            document.getElementById('alertMessageInput').focus();
        }

        async function checkSupergroup() {
            await refreshSupergroup();
        }

        // Initial load
        setTimeout(() => {
            refreshSupergroup();
            loadAnomalyPatterns();
        }, 2000);

        // ============ URL Anomaly Patterns Monitoring ============

        let currentAnomalyData = null;

        async function loadAnomalyPatterns() {
            const sport = document.getElementById('anomalySportSelect').value;
            const hours = parseInt(document.getElementById('anomalyHoursSelect').value);

            try {
                const response = await fetch(`${API_BASE}/api/registry/url-anomaly-patterns?sport=${sport}&hours=${hours}`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(10000)
                });

                if (response.ok) {
                    const data = await response.json();
                    currentAnomalyData = data;

                    // Update status
                    const hasPatterns = data.patterns && data.patterns.length > 0;
                    const statusElement = document.getElementById('anomalyStatus');
                    statusElement.textContent = hasPatterns ? 'Active' : 'No Patterns';
                    statusElement.className = hasPatterns ? 'status-badge status-warning' : 'status-badge status-online';

                    // Update statistics
                    document.getElementById('anomalyTotal').textContent = data.metrics?.total || 0;
                    document.getElementById('anomalyDatabaseTotal').textContent = data.database_stats?.total_anomalies || 0;
                    document.getElementById('anomalyAvgConfidence').textContent =
                        data.metrics?.confidence_summary?.avg_confidence
                            ? `${(data.metrics.confidence_summary.avg_confidence * 100).toFixed(1)}%`
                            : '-';
                    document.getElementById('anomalyFalseSteamRate').textContent =
                        data.metrics?.market_impact_summary?.avg_false_steam_probability
                            ? `${(data.metrics.market_impact_summary.avg_false_steam_probability * 100).toFixed(1)}%`
                            : '-';

                    // Render patterns
                    renderAnomalyPatterns(data.patterns || []);

                    // Render diagnostics
                    renderAnomalyDiagnostics(data.diagnostics || {});
                } else {
                    throw new Error('Failed to load anomaly patterns');
                }
            } catch (error) {
                document.getElementById('anomalyStatus').textContent = 'Error';
                document.getElementById('anomalyStatus').className = 'status-badge status-offline';
                document.getElementById('anomalyPatternsList').innerHTML =
                    '<div style="text-align: center; padding: 40px; color: #ef4444;">Failed to load patterns</div>';
                console.error('Anomaly patterns error:', error);
            }
        }

        function renderAnomalyPatterns(patterns) {
            const container = document.getElementById('anomalyPatternsList');

            if (patterns.length === 0) {
                container.innerHTML = `
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 30px; border-radius: 8px; text-align: center; border: 1px dashed rgba(102, 126, 234, 0.3);">
                        <div style="font-size: 2em; margin-bottom: 10px;">üîç</div>
                        <div style="color: #9ca3af; font-size: 1em; margin-bottom: 5px;">No URL anomaly patterns detected</div>
                        <div style="color: #6b7280; font-size: 0.85em;">Database is accessible and tables exist, but no anomalies found in the selected time range.</div>
                    </div>
                `;
                return;
            }

            const patternsHtml = patterns.map(pattern => {
                const anomalyTypeColors = {
                    'html_entity_splitting': '#ef4444',
                    'parameter_injection': '#f59e0b',
                    'encoding_mismatch': '#3b82f6',
                    'duplicate_params': '#8b5cf6'
                };
                const color = anomalyTypeColors[pattern.anomaly_type] || '#667eea';
                const confidenceColor = pattern.confidence_level >= 0.7 ? '#10b981' :
                                      pattern.confidence_level >= 0.4 ? '#f59e0b' : '#ef4444';

                return `
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${color};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <strong style="color: ${color}; font-size: 1em;">${pattern.pattern_name}</strong>
                                <div style="font-size: 0.75em; color: #9ca3af; margin-top: 2px;">
                                    ${pattern.anomaly_type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.85em; color: ${confidenceColor}; font-weight: 600;">
                                    ${(pattern.confidence_level * 100).toFixed(0)}% confidence
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                            <div>
                                <div style="font-size: 0.75em; color: #9ca3af;">Bookmakers</div>
                                <div style="font-size: 0.9em; color: #e0e0e0;">${pattern.affected_bookmakers.join(', ') || 'N/A'}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: #9ca3af;">Frequency</div>
                                <div style="font-size: 0.9em; color: #e0e0e0;">${pattern.market_impact.frequency_per_hour.toFixed(2)}/hr</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: #9ca3af;">False Steam</div>
                                <div style="font-size: 0.9em; color: #ef4444;">${(pattern.market_impact.false_steam_probability * 100).toFixed(0)}%</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75em; color: #9ca3af;">Line Delta</div>
                                <div style="font-size: 0.9em; color: #e0e0e0;">${pattern.market_impact.avg_line_delta.toFixed(2)}</div>
                            </div>
                        </div>

                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="font-size: 0.75em; color: #6b7280; font-family: monospace; word-break: break-all;">
                                Pattern ID: ${pattern.patternId}
                            </div>
                        </div>

                        <button onclick="sendAnomalyPatternAlert('${pattern.patternId}')"
                                style="margin-top: 10px; padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); border-radius: 6px; color: #ef4444; cursor: pointer; font-size: 0.85em; width: 100%; transition: all 0.2s;"
                                onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'"
                                onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                            üö® Send Alert to Supergroup
                        </button>
                    </div>
                `;
            }).join('');

            container.innerHTML = patternsHtml;
        }

        function renderAnomalyDiagnostics(diagnostics) {
            const container = document.getElementById('anomalyDiagnosticsContent');

            const diagnosticsHtml = `
                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${diagnostics.database_accessible ? '#10b981' : '#ef4444'};">
                    <strong style="color: ${diagnostics.database_accessible ? '#10b981' : '#ef4444'}; display: block; margin-bottom: 8px; font-size: 0.95em;">Database Status</strong>
                    <div style="font-size: 0.9em; color: #9ca3af;">
                        ${diagnostics.database_accessible ? '‚úÖ Accessible' : '‚ùå Not Accessible'}
                    </div>
                </div>

                ${diagnostics.tables_exist ? `
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid ${diagnostics.tables_exist.url_anomaly_audit && diagnostics.tables_exist.line_movement_audit_v2 ? '#10b981' : '#f59e0b'};">
                        <strong style="color: ${diagnostics.tables_exist.url_anomaly_audit && diagnostics.tables_exist.line_movement_audit_v2 ? '#10b981' : '#f59e0b'}; display: block; margin-bottom: 8px; font-size: 0.95em;">Tables</strong>
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 4px;">
                            url_anomaly_audit: ${diagnostics.tables_exist.url_anomaly_audit ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div style="font-size: 0.85em; color: #9ca3af;">
                            line_movement_audit_v2: ${diagnostics.tables_exist.line_movement_audit_v2 ? '‚úÖ' : '‚ùå'}
                        </div>
                    </div>
                ` : ''}

                ${diagnostics.anomalies_all_time !== undefined ? `
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                        <strong style="color: #3b82f6; display: block; margin-bottom: 8px; font-size: 0.95em;">All-Time Stats</strong>
                        <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 4px;">
                            Anomalies: <span style="color: #3b82f6;">${diagnostics.anomalies_all_time}</span>
                        </div>
                        <div style="font-size: 0.9em; color: #9ca3af;">
                            Movements: <span style="color: #3b82f6;">${diagnostics.movements_all_time || 0}</span>
                        </div>
                    </div>
                ` : ''}

                ${diagnostics.anomalies_by_bookmaker ? Object.entries(diagnostics.anomalies_by_bookmaker).slice(0, 3).map(([bookmaker, count]) => `
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                        <strong style="color: #667eea; display: block; margin-bottom: 8px; font-size: 0.95em;">${bookmaker}</strong>
                        <div style="font-size: 1.2em; font-weight: 600; color: #667eea;">${count}</div>
                    </div>
                `).join('') : ''}
            `;

            container.innerHTML = diagnosticsHtml || '<div style="text-align: center; padding: 20px; color: #9ca3af;">No diagnostics available</div>';
        }

        async function sendAnomalyAlert() {
            if (!currentAnomalyData) {
                alert('Please load anomaly patterns first');
                return;
            }

            const patterns = currentAnomalyData.patterns || [];
            if (patterns.length === 0) {
                alert('No patterns to alert about');
                return;
            }

            // Find highest severity pattern
            const criticalPattern = patterns.find(p => p.confidence_level >= 0.7) || patterns[0];

            await sendAnomalyPatternAlert(criticalPattern.patternId);
        }

        async function sendAnomalyPatternAlert(patternId) {
            if (!currentAnomalyData) {
                await loadAnomalyPatterns();
            }

            const pattern = currentAnomalyData?.patterns?.find(p => p.patternId === patternId);
            if (!pattern) {
                alert('Pattern not found');
                return;
            }

            // Build alert message
            const message = `üö® **URL Anomaly Pattern Detected**

**Pattern:** ${pattern.pattern_name}
**Type:** ${pattern.anomaly_type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
**Confidence:** ${(pattern.confidence_level * 100).toFixed(0)}%
**False Steam Probability:** ${(pattern.market_impact.false_steam_probability * 100).toFixed(0)}%

**Affected Bookmakers:** ${pattern.affected_bookmakers.join(', ')}
**Frequency:** ${pattern.market_impact.frequency_per_hour.toFixed(2)}/hour
**Avg Line Delta:** ${pattern.market_impact.avg_line_delta.toFixed(2)}

**Pattern ID:** \`${pattern.patternId}\`

[View Details in Dashboard](${API_BASE.replace('/api', '')}/dashboard#anomaly-${patternId})`;

            try {
                // Send to System Status topic (thread ID 5) or Live Alerts (thread ID 2)
                const threadId = pattern.market_impact.false_steam_probability > 0.8 ? 2 : 5; // High false steam -> Live Alerts

                const response = await fetch(`${API_BASE}/api/miniapp/supergroup/send-alert`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        threadId,
                        pinMessage: pattern.confidence_level >= 0.7, // Pin high confidence patterns
                        alertType: 'url-anomaly',
                        alertData: {
                            id: pattern.patternId,
                            type: 'url-anomaly',
                            ts: Date.now(),
                            anomaly_type: pattern.anomaly_type,
                            sport: currentAnomalyData.query.sport
                        }
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert(`Alert sent to topic ${threadId} successfully!`);
                    } else {
                        alert('Failed to send alert');
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                alert('Error sending alert: ' + (error instanceof Error ? error.message : 'Unknown error'));
                console.error('Send anomaly alert error:', error);
            }
        }

        function updateMiniappChart(responseTime) {
            if (!responseTime) return;

            miniappResponseTimeHistory.push(responseTime);
            if (miniappResponseTimeHistory.length > MAX_HISTORY) {
                miniappResponseTimeHistory.shift();
            }

            const chartContainer = document.getElementById('miniappMetricsChart');
            const canvas = document.getElementById('miniappResponseTimeChart');

            if (!canvas || miniappResponseTimeHistory.length < 2) {
                chartContainer.style.display = 'none';
                return;
            }

            chartContainer.style.display = 'block';
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 150;

            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (height / 4) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Draw line
            const maxTime = Math.max(...miniappResponseTimeHistory, 100);
            const minTime = Math.min(...miniappResponseTimeHistory, 0);
            const range = maxTime - minTime || 100;

            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();

            miniappResponseTimeHistory.forEach((time, index) => {
                const x = (width / (MAX_HISTORY - 1)) * index;
                const y = height - ((time - minTime) / range) * height;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#667eea';
            miniappResponseTimeHistory.forEach((time, index) => {
                const x = (width / (MAX_HISTORY - 1)) * index;
                const y = height - ((time - minTime) / range) * height;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw labels
            ctx.fillStyle = '#9ca3af';
            ctx.font = '10px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText(`${Math.round(maxTime)}ms`, width - 5, 10);
            ctx.fillText(`${Math.round(minTime)}ms`, width - 5, height - 5);
        }

        async function checkMiniapp() {
            try {
                const response = await fetch(`${API_BASE}/api/miniapp/info`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });

                if (response.ok) {
                    const data = await response.json();

                    // Update status
                    const status = data.status?.status || 'unknown';
                    const statusElement = document.getElementById('miniappStatus');
                    statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                    statusElement.className =
                        status === 'online' ? 'status-badge status-online' :
                        status === 'degraded' ? 'status-badge status-warning' :
                        'status-badge status-offline';
                    document.getElementById('miniappStatusValue').textContent = status.charAt(0).toUpperCase() + status.slice(1);

                    // Update response time
                    if (data.status?.responseTime) {
                        const responseTime = data.status.responseTime;
                        document.getElementById('miniappResponseTime').textContent =
                            `${responseTime.toFixed(0)}ms`;
                        updateMiniappChart(responseTime);
                    }

                    // Update version
                    if (data.health?.version) {
                        document.getElementById('miniappVersion').textContent = data.health.version;
                    }

                    // Update environment
                    if (data.deployment?.environment) {
                        document.getElementById('miniappEnvironment').textContent = data.deployment.environment;
                    }

                    // Update deployed time
                    if (data.deployment?.deployedAt) {
                        const deployed = new Date(data.deployment.deployedAt);
                        document.getElementById('miniappDeployed').textContent = deployed.toLocaleString();
                    }

                    // Update details with enhanced layout
                    const detailsHtml = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            ${data.health ? `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                    <strong style="color: #10b981; display: block; margin-bottom: 8px; font-size: 0.95em;">Health Status</strong>
                                    ${data.health.uptime ? `<div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 4px;">Uptime: ${Math.floor(data.health.uptime / 1000)}s</div>` : ''}
                                    ${data.health.status ? `<div style="font-size: 0.9em; color: #9ca3af;">Status: <span style="color: #10b981;">${data.health.status}</span></div>` : ''}
                                    ${data.health.version ? `<div style="font-size: 0.9em; color: #9ca3af; margin-top: 4px;">Version: ${data.health.version}</div>` : ''}
                                </div>
                            ` : ''}
                            ${data.deployment ? `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                                    <strong style="color: #3b82f6; display: block; margin-bottom: 8px; font-size: 0.95em;">Deployment Info</strong>
                                    ${data.deployment.commit ? `<div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 4px;">Commit: <code style="background: rgba(59, 130, 246, 0.2); padding: 2px 6px; border-radius: 3px;">${data.deployment.commit.substring(0, 7)}</code></div>` : ''}
                                    ${data.deployment.environment ? `<div style="font-size: 0.9em; color: #9ca3af;">Environment: <span style="color: #3b82f6;">${data.deployment.environment}</span></div>` : ''}
                                    ${data.deployment.deployedAt ? `<div style="font-size: 0.9em; color: #9ca3af; margin-top: 4px;">Deployed: ${new Date(data.deployment.deployedAt).toLocaleString()}</div>` : ''}
                                </div>
                            ` : ''}
                            ${data.config ? `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                                    <strong style="color: #f59e0b; display: block; margin-bottom: 8px; font-size: 0.95em;">Configuration</strong>
                                    <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 4px;">Status: <span style="color: ${data.config.status === 200 ? '#10b981' : '#ef4444'}">${data.config.status}</span></div>
                                    ${data.config.responseTime ? `<div style="font-size: 0.9em; color: #9ca3af;">Response: ${data.config.responseTime.toFixed(0)}ms</div>` : ''}
                                    ${data.config.etag ? `<div style="font-size: 0.85em; color: #6b7280; margin-top: 4px; font-family: monospace;">ETag: ${data.config.etag.substring(0, 20)}...</div>` : ''}
                                </div>
                            ` : ''}
                            ${data.status ? `
                                <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                                    <strong style="color: #667eea; display: block; margin-bottom: 8px; font-size: 0.95em;">Performance</strong>
                                    <div style="font-size: 0.9em; color: #9ca3af; margin-bottom: 4px;">Response Time: <span style="color: #667eea;">${data.status.responseTime?.toFixed(0) || '-'}ms</span></div>
                                    <div style="font-size: 0.9em; color: #9ca3af;">HTTP Status: <span style="color: ${data.status.statusCode === 200 ? '#10b981' : '#ef4444'}">${data.status.statusCode || '-'}</span></div>
                                    <div style="font-size: 0.85em; color: #6b7280; margin-top: 4px;">Last Check: ${new Date(data.status.timestamp).toLocaleTimeString()}</div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    document.getElementById('miniappDetails').innerHTML = detailsHtml;
                } else {
                    throw new Error('Miniapp API returned error');
                }
            } catch (error) {
                document.getElementById('miniappStatus').textContent = 'Offline';
                document.getElementById('miniappStatus').className = 'status-badge status-offline';
                document.getElementById('miniappStatusValue').textContent = 'Offline';
                console.error('Miniapp check error:', error);
            }
        }

        async function loadChangelog() {
            const loading = document.getElementById('changelogLoading');
            const content = document.getElementById('changelogContent');
            const error = document.getElementById('changelogError');
            const container = document.getElementById('changelogEntries');

            try {
                loading.style.display = 'block';
                content.style.display = 'none';
                error.style.display = 'none';

                const response = await fetch(`${API_BASE}/api/changelog?limit=15`, {
                    signal: AbortSignal.timeout(5000)
                });

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }

                const data = await response.json();

                // Update stats
                document.getElementById('changelogVersion').textContent = data.version || '--';
                document.getElementById('changelogTotal').textContent = data.total || '0';
                document.getElementById('changelogCategories').textContent = data.categories?.join(', ') || '--';

                // Create filter buttons for each category
                const filterContainer = document.getElementById('changelogFilter');
                if (data.categories && data.categories.length > 0) {
                    let filterHtml = '';
                    for (const cat of data.categories) {
                        const color = categoryColors[cat] || categoryColors['other'];
                        filterHtml += `<button onclick="filterChangelog('${cat}')" id="filter${cat}" class="changelog-filter-btn" style="padding: 6px 12px; background: ${color}20; border: 1px solid ${color}; color: ${color}; border-radius: 4px; cursor: pointer; font-size: 0.85em; transition: all 0.2s; text-transform: uppercase; font-weight: 600;" onmouseover="this.style.background='${color}40'; this.style.textShadow='0 0 5px ${color}'" onmouseout="this.style.background='${color}20'; this.style.textShadow='none'">${cat}</button>`;
                    }
                    filterContainer.innerHTML = filterContainer.querySelector('#filterAll').outerHTML + filterHtml;
                }

                // Store data globally for filtering
                window.changelogData = data;

                // Render changelog entries grouped by category
                // Vibrant colors matching NEXUS tag system for code search
                // [Bun.inspect.custom] Category color mapping
                const categoryColors = data.categoryColors || {
                    // Feature categories
                    'feat': '#00d4ff',        // Cyan - API routes, enhancements
                    'feature': '#00d4ff',     // Cyan
                    'enhancement': '#00d4ff', // Cyan

                    // Bug fixes
                    'fix': '#ff1744',        // Red - Critical issues, bug fixes
                    'bug': '#ff1744',        // Red
                    'fixes': '#ff1744',      // Red

                    // Documentation
                    'docs': '#00ff88',       // Green - Documentation, guides
                    'doc': '#00ff88',        // Green
                    'documentation': '#00ff88', // Green

                    // Refactoring
                    'refactor': '#667eea',   // Indigo - Code cleanup, restructuring
                    'refactoring': '#667eea', // Indigo

                    // Chores
                    'chore': '#9c27b0',      // Purple - Configuration, external services
                    'chores': '#9c27b0',     // Purple

                    // Testing
                    'test': '#ffeb3b',       // Yellow - VM, runtime, testing
                    'tests': '#ffeb3b',      // Yellow
                    'testing': '#ffeb3b',     // Yellow

                    // Performance
                    'perf': '#00ff88',       // Green - Performance & caching
                    'performance': '#00ff88', // Green

                    // Security
                    'security': '#ff6b00',   // Orange - Security, warnings
                    'sec': '#ff6b00',        // Orange

                    // Registry/MCP
                    'registry': '#ff00ff',   // Magenta - Registry & MCP tools
                    'mcp': '#ff00ff',        // Magenta

                    // Component categories
                    'api': '#00d4ff',        // Cyan - API routes
                    'arbitrage': '#ff1744',  // Red - Arbitrage & trading
                    'orca': '#9c27b0',       // Purple - ORCA & sports betting
                    'dashboard': '#667eea',  // Indigo - Dashboard & UI

                    // Fallback
                    'other': '#9ca3af',      // Gray - Uncategorized
                    'misc': '#9ca3af',       // Gray
                };

                let html = '';

                if (data.byCategory && Object.keys(data.byCategory).length > 0) {
                    for (const [category, commits] of Object.entries(data.byCategory)) {
                        const color = categoryColors[category] || categoryColors['other'];
                        html += `<div style="margin-bottom: 25px;">`;
                        // Vibrant category header with glow effect
                        html += `<h4 style="color: ${color}; font-size: 1.1em; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; text-shadow: 0 0 10px ${color}40, 0 0 20px ${color}20;">${category}</h4>`;
                        html += `<ul style="list-style: none; padding: 0; margin: 0;">`;

                        for (const commit of commits as Array<{hash: string; message: string; date: string; author?: string}>) {
                            const commitDate = new Date(commit.date);
                            const shortHash = commit.hash.substring(0, 7);
                            const githubLink = `https://github.com/brendadeeznuts1111/trader-analyzer-bun/commit/${commit.hash}`;

                            // Enhanced styling with vibrant colors and hover effects
                            html += `<li style="margin-bottom: 10px; padding: 10px 15px; border-left: 3px solid ${color}; background: ${color}10; border-radius: 4px; transition: all 0.2s;">`;
                            html += `<div style="display: flex; align-items: start; gap: 12px; flex-wrap: wrap;">`;
                            // Vibrant hash link with glow
                            html += `<a href="${githubLink}" target="_blank" style="color: ${color}; text-decoration: none; font-family: monospace; font-size: 0.9em; min-width: 70px; font-weight: 600; text-shadow: 0 0 5px ${color}60; transition: all 0.2s;" onmouseover="this.style.textShadow='0 0 10px ${color}'" onmouseout="this.style.textShadow='0 0 5px ${color}60'">${shortHash}</a>`;
                            html += `<span style="flex: 1; color: #e0e0e0; line-height: 1.5;">${commit.message}</span>`;
                            html += `<span style="color: #9ca3af; font-size: 0.85em; white-space: nowrap;">${commitDate.toLocaleDateString()}</span>`;
                            html += `</div>`;
                            if (commit.author) {
                                html += `<div style="margin-left: 82px; color: #9ca3af; font-size: 0.8em; margin-top: 4px;">by <span style="color: ${color};">${commit.author}</span></div>`;
                            }
                            html += `</li>`;
                        }

                        html += `</ul></div>`;
                    }
                } else if (data.commits && data.commits.length > 0) {
                    // Fallback: show all commits if no category grouping with vibrant styling
                    html += `<ul style="list-style: none; padding: 0;">`;
                    for (const commit of data.commits) {
                        const commitDate = new Date(commit.date);
                        const shortHash = commit.hash.substring(0, 7);
                        const githubLink = `https://github.com/brendadeeznuts1111/trader-analyzer-bun/commit/${commit.hash}`;
                        const fallbackColor = '#667eea'; // Indigo fallback

                        html += `<li style="margin-bottom: 10px; padding: 10px 15px; background: ${fallbackColor}15; border-left: 3px solid ${fallbackColor}; border-radius: 4px;">`;
                        html += `<a href="${githubLink}" target="_blank" style="color: ${fallbackColor}; text-decoration: none; font-family: monospace; font-size: 0.9em; font-weight: 600; text-shadow: 0 0 5px ${fallbackColor}60;">${shortHash}</a> `;
                        html += `<span style="color: #e0e0e0; line-height: 1.5;">${commit.message}</span>`;
                        html += `<span style="color: #9ca3af; font-size: 0.85em; margin-left: 10px;">${commitDate.toLocaleDateString()}</span>`;
                        html += `</li>`;
                    }
                    html += `</ul>`;
                } else {
                    html = '<p style="color: #9ca3af; text-align: center; padding: 20px;">No changelog entries available</p>';
                }

                container.innerHTML = html;

                loading.style.display = 'none';
                content.style.display = 'block';
            } catch (error) {
                console.debug('Changelog not available:', error);
                loading.style.display = 'none';
                content.style.display = 'none';
                // Don't show error - changelog is optional
            }
        }

        // Filter changelog by category
        function filterChangelog(category) {
            if (!window.changelogData) return;

            // Update active filter button
            document.querySelectorAll('.changelog-filter-btn').forEach(btn => {
                btn.style.background = btn.style.borderColor + '20';
                btn.style.fontWeight = '600';
            });
            const activeBtn = document.getElementById(category === 'all' ? 'filterAll' : `filter${category}`);
            if (activeBtn) {
                activeBtn.style.background = activeBtn.style.borderColor + '60';
                activeBtn.style.fontWeight = '700';
            }

            const container = document.getElementById('changelogEntries');
            const data = window.changelogData;
            // [Bun.inspect.custom] Category color mapping - use from API response or fallback
            const categoryColors = data.categoryColors || {
                'feat': '#00d4ff', 'feature': '#00d4ff', 'enhancement': '#00d4ff',
                'fix': '#ff1744', 'bug': '#ff1744', 'fixes': '#ff1744',
                'docs': '#00ff88', 'doc': '#00ff88', 'documentation': '#00ff88',
                'refactor': '#667eea', 'refactoring': '#667eea',
                'chore': '#9c27b0', 'chores': '#9c27b0',
                'test': '#ffeb3b', 'tests': '#ffeb3b', 'testing': '#ffeb3b',
                'perf': '#00ff88', 'performance': '#00ff88',
                'security': '#ff6b00', 'sec': '#ff6b00',
                'registry': '#ff00ff', 'mcp': '#ff00ff',
                'api': '#00d4ff', 'arbitrage': '#ff1744', 'orca': '#9c27b0',
                'dashboard': '#667eea', 'other': '#9ca3af', 'misc': '#9ca3af'
            };

            let html = '';
            const categoriesToShow = category === 'all' ? Object.keys(data.byCategory || {}) : [category];

            if (data.byCategory && categoriesToShow.length > 0) {
                for (const cat of categoriesToShow) {
                    if (!data.byCategory[cat] || data.byCategory[cat].length === 0) continue;
                    const commits = data.byCategory[cat];
                    const color = categoryColors[cat] || categoryColors['other'];

                    html += `<div style="margin-bottom: 25px;">`;
                    html += `<h4 style="color: ${color}; font-size: 1.1em; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; text-shadow: 0 0 10px ${color}40, 0 0 20px ${color}20;">${cat}</h4>`;
                    html += `<ul style="list-style: none; padding: 0; margin: 0;">`;

                    for (const commit of commits) {
                        const commitDate = new Date(commit.date);
                        const shortHash = commit.hash.substring(0, 7);
                        const githubLink = `https://github.com/brendadeeznuts1111/trader-analyzer-bun/commit/${commit.hash}`;

                        html += `<li style="margin-bottom: 10px; padding: 10px 15px; border-left: 3px solid ${color}; background: ${color}10; border-radius: 4px; transition: all 0.2s;">`;
                        html += `<div style="display: flex; align-items: start; gap: 12px; flex-wrap: wrap;">`;
                        html += `<a href="${githubLink}" target="_blank" style="color: ${color}; text-decoration: none; font-family: monospace; font-size: 0.9em; min-width: 70px; font-weight: 600; text-shadow: 0 0 5px ${color}60; transition: all 0.2s;" onmouseover="this.style.textShadow='0 0 10px ${color}'" onmouseout="this.style.textShadow='0 0 5px ${color}60'">${shortHash}</a>`;
                        html += `<span style="flex: 1; color: #e0e0e0; line-height: 1.5;">${commit.message}</span>`;
                        html += `<span style="color: #9ca3af; font-size: 0.85em; white-space: nowrap;">${commitDate.toLocaleDateString()}</span>`;
                        html += `</div>`;
                        if (commit.author) {
                            html += `<div style="margin-left: 82px; color: #9ca3af; font-size: 0.8em; margin-top: 4px;">by <span style="color: ${color};">${commit.author}</span></div>`;
                        }
                        html += `</li>`;
                    }

                    html += `</ul></div>`;
                }
            }

            container.innerHTML = html || '<p style="color: #9ca3af; text-align: center; padding: 20px;">No entries in this category</p>';
        }

        async function refreshAll() {
            updateLastUpdate(); // Uses toLocaleTimeString() - same format as CLI
            updateSystemTime(); // Also update system time
            await Promise.all([
                checkAPI(),
                checkSession(),
                checkTelegram(),
                loadMessages(),
                updateSystemMetrics(),
                checkSecurity(),
                checkForensic(),
                checkMCPTools(),
                loadChangelog(),
                showMCPTab(currentMCPTab),
                checkErrorTracking(),
                showErrorTab(currentErrorTab),
                checkMCPSecrets(),
                checkMiniapp(),
                checkSupergroup(),
                loadAnomalyPatterns(),
                checkMiniapp(),
                loadRuntimeInfo(),
                loadGitInfo(),
                loadAppInfo()
            ]);
        }

        // Session management functions
        async function checkSession() {
            try {
                const response = await apiFetch(`${API_BASE}/api/users/session`, {
                    method: 'GET'
                });

                const sessionStatusEl = document.getElementById('sessionStatus');
                const signInBtn = document.getElementById('signInBtn');
                const signOutBtn = document.getElementById('signOutBtn');

                if (response.ok) {
                    const data = await response.json();
                    if (data.authenticated) {
                        if (sessionStatusEl) {
                            sessionStatusEl.textContent = `‚úì ${data.userId || 'Authenticated'}`;
                            sessionStatusEl.style.color = '#10b981';
                        }
                        if (signInBtn) signInBtn.style.display = 'none';
                        if (signOutBtn) signOutBtn.style.display = 'inline-block';
                    } else {
                        if (sessionStatusEl) {
                            sessionStatusEl.textContent = 'Not signed in';
                            sessionStatusEl.style.color = '#9ca3af';
                        }
                        if (signInBtn) signInBtn.style.display = 'inline-block';
                        if (signOutBtn) signOutBtn.style.display = 'none';
                    }
                } else {
                    if (sessionStatusEl) {
                        sessionStatusEl.textContent = 'Not signed in';
                        sessionStatusEl.style.color = '#9ca3af';
                    }
                    if (signInBtn) signInBtn.style.display = 'inline-block';
                    if (signOutBtn) signOutBtn.style.display = 'none';
                }
            } catch (error) {
                const sessionStatusEl = document.getElementById('sessionStatus');
                if (sessionStatusEl) {
                    sessionStatusEl.textContent = 'Error';
                    sessionStatusEl.style.color = '#ef4444';
                }
            }
        }

        async function signIn() {
            try {
                const response = await apiFetch(`${API_BASE}/api/users/sign-in`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: 'dashboard-user' })
                });

                if (response.ok) {
                    await checkSession();
                    console.log('[Dashboard] Signed in successfully');
                } else {
                    console.error('[Dashboard] Sign-in failed:', response.status);
                }
            } catch (error) {
                console.error('[Dashboard] Sign-in error:', error);
            }
        }

        async function signOut() {
            try {
                const response = await apiFetch(`${API_BASE}/api/users/sign-out`, {
                    method: 'POST'
                });

                if (response.ok) {
                    await checkSession();
                    console.log('[Dashboard] Signed out successfully');
                } else {
                    console.error('[Dashboard] Sign-out failed:', response.status);
                }
            } catch (error) {
                console.error('[Dashboard] Sign-out error:', error);
            }
        }

        // Load Bun runtime info (Bun.version, Bun.revision, process.uptime, etc.)
        // Includes enhanced Bun 1.3 features: socket info, rapidhash, process features
        async function loadRuntimeInfo() {
            try {
                const url = `${API_BASE}/api/debug/runtime`;
                console.debug(`[Dashboard] Fetching runtime info from: ${url}`);
                const response = await fetch(url, {
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    const data = await response.json();
                    console.debug('[Dashboard] Runtime info loaded:', data.bunVersion);

                    // Basic runtime info
                    document.getElementById('bunVersion').textContent = data.bunVersion || '--';
                    document.getElementById('bunRevision').textContent = data.revision ? data.revision.substring(0, 12) : '--';
                    document.getElementById('platform').textContent = data.platform || '--';
                    document.getElementById('arch').textContent = data.arch || '--';
                    document.getElementById('serverUptime').textContent = data.uptime || '--';
                    document.getElementById('processId').textContent = data.pid || '--';

                    // Network info (DNS, IPv4, IPv6)
                    document.getElementById('dnsHostname').textContent = data.hostname || '--';
                    document.getElementById('ipv4Address').textContent = data.ipv4 || '--';
                    document.getElementById('ipv6Address').textContent = data.ipv6 || '--';
                    document.getElementById('localIP').textContent = data.localIP || '--';

                    // Bun 1.3 Enhanced Socket Information
                    if (data.socket) {
                        document.getElementById('socketLocalAddress').textContent = data.socket.localAddress || '--';
                        document.getElementById('socketLocalPort').textContent = data.socket.localPort || '--';
                        document.getElementById('socketLocalFamily').textContent = data.socket.localFamily || '--';
                        document.getElementById('socketRemoteAddress').textContent = data.socket.remoteAddress || '--';
                        document.getElementById('socketRemotePort').textContent = data.socket.remotePort || '--';
                        document.getElementById('socketRemoteFamily').textContent = data.socket.remoteFamily || '--';
                    }

                    // Bun 1.3 Rapidhash
                    if (data.rapidhash) {
                        document.getElementById('rapidhashStatus').textContent = data.rapidhash.available ? '‚úì Available' : '‚úó Not Available';
                        document.getElementById('rapidhashExample').textContent = data.rapidhash.example || '--';
                    }

                    // Bun 1.3 Process Features
                    if (data.processFeatures) {
                        document.getElementById('processTimeout').textContent = data.processFeatures.timeout ? '‚úì Supported' : '‚úó Not Supported';
                        document.getElementById('processMaxBuffer').textContent = data.processFeatures.maxBuffer ? '‚úì Supported' : '‚úó Not Supported';
                    }
                } else {
                    console.warn(`[Dashboard] Runtime info fetch failed: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('[Dashboard] Runtime info fetch error:', error.message, `API_BASE: ${API_BASE}`);
                // Show error in UI for debugging
                if (error.name === 'AbortError') {
                    console.error('[Dashboard] Request timed out - API may be unreachable');
                }
            }
        }

        // Load git information
        async function loadGitInfo() {
            try {
                const url = `${API_BASE}/api/git-info`;
                const response = await fetch(url, {
                    signal: AbortSignal.timeout(3000)
                });
                if (response.ok) {
                    const data = await response.json();
                    if (data.commit) {
                        document.getElementById('gitCommit').textContent = data.commit.short || '--';
                    }
                    document.getElementById('gitBranch').textContent = data.branch || '--';
                } else {
                    console.warn(`[Dashboard] Git info fetch failed: ${response.status}`);
                }
            } catch (error) {
                console.debug('[Dashboard] Git info fetch error:', error.message);
                // Silently fail - git info is optional
            }
        }

        // Load application info (version, API version, endpoints)
        async function loadAppInfo() {
            try {
                const url = `${API_BASE}/api`;
                const rootResponse = await fetch(url, {
                    signal: AbortSignal.timeout(3000)
                });
                if (rootResponse.ok) {
                    const rootData = await rootResponse.json();
                    console.debug('[Dashboard] App info loaded:', rootData.version);
                    document.getElementById('appVersion').textContent = rootData.version || '--';
                    document.getElementById('apiVersion').textContent = rootData.version || '--';

                    // Count endpoints if available
                    if (rootData.endpoints) {
                        const endpointCount = Object.keys(rootData.endpoints).length;
                        document.getElementById('endpointCount').textContent = `${endpointCount}+`;
                    }

                    // Try to get OpenAPI spec version
                    try {
                        const openApiResponse = await fetch(`${API_BASE}/docs/openapi.json`, {
                            signal: AbortSignal.timeout(3000)
                        });
                        if (openApiResponse.ok) {
                            const openApiData = await openApiResponse.json();
                            document.getElementById('openApiVersion').textContent = openApiData.info?.version || '--';
                        }
                    } catch (e) {
                        console.debug('[Dashboard] OpenAPI spec not available');
                    }
                } else {
                    console.warn(`[Dashboard] App info fetch failed: ${rootResponse.status}`);
                }
            } catch (error) {
                console.error('[Dashboard] App info fetch error:', error.message, `API_BASE: ${API_BASE}`);
            }
        }

        // Extract ETag and Cookie from last API response
        let lastResponseHeaders = {};

        async function extractResponseHeaders(response) {
            try {
                const etag = response.headers.get('ETag');
                const cookie = response.headers.get('Set-Cookie');
                const gitCommit = response.headers.get('X-Git-Commit');
                const gitBranch = response.headers.get('X-Git-Branch');

                if (etag) {
                    document.getElementById('responseETag').textContent = etag;
                }
                if (cookie) {
                    document.getElementById('responseCookie').textContent = cookie.substring(0, 50) + (cookie.length > 50 ? '...' : '');
                }
                if (gitCommit) {
                    document.getElementById('headerGitCommit').textContent = gitCommit;
                }
                if (gitBranch) {
                    document.getElementById('headerGitBranch').textContent = gitBranch;
                }

                // Extract timezone headers using shared utility
                if (window.timezoneUtils) {
                    window.timezoneUtils.extractTimezoneHeaders(response);
                    window.timezoneUtils.updateTimezoneDisplay();
                }
            } catch (error) {
                // Ignore
            }
        }

        // Update timezone display (uses shared utility)
        function updateTimezone() {
            if (window.timezoneUtils) {
                window.timezoneUtils.updateTimezoneDisplay();
            }
        }

        async function loadMessages() {
            // Try to load from API first - get today's log file (JSONL format)
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${API_BASE}/data/telegram-logs/telegram-${today}.jsonl`);
                if (response.ok) {
                    const text = await response.text();
                    // Parse JSONL (one JSON object per line)
                    const messages = text.trim().split('\n')
                        .filter(line => line.trim())
                        .map(line => {
                            try {
                                return JSON.parse(line);
                            } catch {
                                return null;
                            }
                        })
                        .filter(msg => msg !== null);
                    displayMessages(messages);
                }
            } catch (error) {
                console.debug('Telegram logs not available:', error.message);
                // Silently fail - telegram logs are optional
            }
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('autoRefreshBtn');

            if (autoRefreshEnabled) {
                autoRefreshInterval = setInterval(refreshAll, 5000);
                btn.textContent = '‚è∏Ô∏è Stop Auto Refresh';
                document.getElementById('autoRefresh').textContent = 'On (5s)';
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                btn.textContent = '‚ñ∂Ô∏è Start Auto Refresh';
                document.getElementById('autoRefresh').textContent = 'Off';
            }
        }

        function loadFromFile() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);

                        // Update dashboard with file data
                        if (data.telegram) {
                            if (data.telegram.topics) displayTopics(data.telegram.topics);
                            if (data.telegram.messages) displayMessages(data.telegram.messages);
                        }

                        alert('Data loaded successfully!');
                    } catch (error) {
                        showError('Failed to load file: ' + error.message);
                    }
                }
            };
            fileInput.click();
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                api: {
                    status: document.getElementById('apiStatusValue').textContent,
                },
                telegram: {
                    status: document.getElementById('telegramStatusValue').textContent,
                }
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nexus-dashboard-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function renderArchitecture() {
            const container = document.getElementById('architectureContainer');

            // Add grepable section headers
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid #667eea;">
                    <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">
                        [ARCHITECTURE.CLASSES.RG] Classes
                    </div>
                    <div style="font-size: 0.9em; color: #d1d5db;">
                        Core classes implementing Telegram integration functionality
                    </div>
                </div>
            `;

            const architecture = {
                classes: [
                    {
                        name: 'EnhancedTelegramClient',
                        type: 'class',
                        color: '#00d4ff',
                        file: 'src/telegram/client.ts',
                        extends: null,
                        implements: null,
                        bunApis: [
                            'process.env (env vars)',
                            'setTimeout (timing)',
                            'Promise (async)'
                        ],
                        telegramApis: [
                            'sendMessage(chatId, text, threadId?)',
                            'sendAndPin(chatId, text, threadId)',
                            'pinMessage(chatId, messageId, threadId?)'
                        ],
                        properties: [
                            { name: 'api', type: 'TelegramBotApi', access: 'private', desc: 'Underlying API client instance' },
                            { name: 'circuitBreaker', type: 'CircuitBreaker', access: 'private', desc: 'Circuit breaker for failure protection' },
                            { name: 'rateLimiter', type: 'RateLimiter', access: 'private', desc: 'Rate limiting handler (30/sec, 1000/min)' },
                            { name: 'stats', type: 'TelegramClientStats', access: 'private', desc: 'Client statistics tracking' },
                            { name: 'config', type: 'Required<TelegramClientConfig>', access: 'private', desc: 'Client configuration (readonly)' },
                            { name: 'requestQueue', type: 'Array<() => Promise<any>>', access: 'private', desc: 'Async request queue for non-blocking ops' },
                            { name: 'processingQueue', type: 'boolean', access: 'private', desc: 'Queue processing flag' }
                        ],
                        functions: [
                            { name: 'constructor(config?: TelegramClientConfig)', access: 'public', returns: 'void', desc: 'Initialize client with config, load bot token from env/secrets' },
                            { name: 'sendMessage(message: TelegramMessage)', access: 'public', returns: 'Promise<{ok: boolean, messageId?: number, error?: string}>', desc: 'Send message with retry logic, rate limiting, and circuit breaker' },
                            { name: 'sendMessageAsync(message: TelegramMessage)', access: 'public', returns: 'Promise<Promise<{ok: boolean, messageId?: number, error?: string}>>', desc: 'Queue message for async sending (non-blocking)' },
                            { name: 'getStats()', access: 'public', returns: 'TelegramClientStats', desc: 'Get current client statistics' },
                            { name: 'resetStats()', access: 'public', returns: 'void', desc: 'Reset all statistics counters' },
                            { name: 'getApiClient()', access: 'public', returns: 'TelegramBotApi', desc: 'Get underlying API client instance' },
                            { name: 'healthCheck()', access: 'public', returns: 'Promise<{healthy: boolean, message: string, stats: TelegramClientStats}>', desc: 'Perform health check and return status' },
                            { name: 'executeWithRetry<T>(fn: () => Promise<T>)', access: 'private', returns: 'Promise<T>', desc: 'Execute function with retry logic and circuit breaker' },
                            { name: 'processQueue()', access: 'private', returns: 'Promise<void>', desc: 'Process queued requests asynchronously' },
                            { name: 'updateStats(success: boolean, responseTime: number)', access: 'private', returns: 'void', desc: 'Update internal statistics' }
                        ]
                    },
                    {
                        name: 'TelegramIntegrationMonitor',
                        type: 'class',
                        color: '#00d4ff',
                        file: 'src/telegram/monitor.ts',
                        extends: null,
                        implements: null,
                        bunApis: [
                            'process.env (env vars)',
                            'Bun.secrets.getSync (secrets)',
                            'Date.now() (timing)'
                        ],
                        telegramApis: [
                            'getForumTopics(chatId)',
                            'healthCheck()'
                        ],
                        properties: [
                            { name: 'client', type: 'EnhancedTelegramClient', access: 'private', desc: 'Telegram client instance' },
                            { name: 'api', type: 'TelegramBotApi', access: 'private', desc: 'Direct API access for topic queries' },
                            { name: 'chatId', type: 'string | null', access: 'private', desc: 'Chat/supergroup ID (loaded from env/secrets)' }
                        ],
                        functions: [
                            { name: 'constructor()', access: 'public', returns: 'void', desc: 'Initialize monitor, load chat ID from env/secrets' },
                            { name: 'getStatus()', access: 'public', returns: 'Promise<IntegrationStatus>', desc: 'Get comprehensive integration status (client, API, config, overall)' },
                            { name: 'quickHealthCheck()', access: 'public', returns: 'Promise<boolean>', desc: 'Quick health validation (returns true if healthy)' },
                            { name: 'monitorStatus(intervalMs?: number)', access: 'public', returns: 'AsyncGenerator<IntegrationStatus>', desc: 'Continuous status monitoring with configurable interval (default 5s)' }
                        ]
                    },
                    {
                        name: 'TelegramBotApi',
                        type: 'class',
                        color: '#00d4ff',
                        file: 'src/api/telegram-ws.ts',
                        extends: null,
                        implements: null,
                        bunApis: [
                            'process.env (env vars)',
                            'fetch() (HTTP requests)',
                            'URLSearchParams (query params)',
                            'console.warn (logging)'
                        ],
                        telegramApis: [
                            'GET /bot{token}/sendMessage',
                            'POST /bot{token}/pinChatMessage',
                            'POST /bot{token}/unpinChatMessage',
                            'GET /bot{token}/getForumTopics',
                            'POST /bot{token}/createForumTopic',
                            'POST /bot{token}/editForumTopic',
                            'POST /bot{token}/closeForumTopic',
                            'POST /bot{token}/reopenForumTopic',
                            'POST /bot{token}/deleteForumTopic'
                        ],
                        properties: [
                            { name: 'botToken', type: 'string', access: 'private readonly', desc: 'Bot API token from constructor or env' },
                            { name: 'apiBase', type: 'string', access: 'private readonly', desc: 'Telegram API base URL: "https://api.telegram.org/bot"' }
                        ],
                        functions: [
                            { name: 'constructor(botToken?: string)', access: 'public', returns: 'void', desc: 'Initialize API client with bot token' },
                            { name: 'sendMessage(chatId: string|number, text: string, threadId?: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Send message to chat/topic via Telegram API' },
                            { name: 'pinMessage(chatId: string|number, messageId: number, threadId?: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Pin message in chat/topic' },
                            { name: 'unpinMessage(chatId: string|number, messageId: number, threadId?: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Unpin message in chat/topic' },
                            { name: 'sendAndPin(chatId: string|number, text: string, threadId: number)', access: 'public', returns: 'Promise<{ok: boolean, messageId?: number, error?: string}>', desc: 'Send message and pin it in topic' },
                            { name: 'getForumTopics(chatId: string|number)', access: 'public', returns: 'Promise<{ok: boolean, result?: {topics: Array}, description?: string}>', desc: 'Get all forum topics for supergroup' },
                            { name: 'createForumTopic(chatId: string|number, name: string, iconColor?: number, iconCustomEmojiId?: string)', access: 'public', returns: 'Promise<{ok: boolean, result?: {message_thread_id: number}, description?: string}>', desc: 'Create new forum topic' },
                            { name: 'editForumTopic(chatId: string|number, messageThreadId: number, name?: string, iconCustomEmojiId?: string)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Edit topic name and/or icon' },
                            { name: 'closeForumTopic(chatId: string|number, messageThreadId: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Close forum topic' },
                            { name: 'reopenForumTopic(chatId: string|number, messageThreadId: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Reopen closed forum topic' },
                            { name: 'deleteForumTopic(chatId: string|number, messageThreadId: number)', access: 'public', returns: 'Promise<TelegramBotApiResponse>', desc: 'Delete forum topic permanently' }
                        ]
                    },
                    {
                        name: 'RateLimiter',
                        type: 'class',
                        color: '#00d4ff',
                        file: 'src/telegram/client.ts',
                        extends: null,
                        implements: null,
                        bunApis: [
                            'Date.now() (timing)',
                            'Promise (async)',
                            'setTimeout (delays)',
                            'Array.filter() (array ops)',
                            'Math.min() (calculations)'
                        ],
                        telegramApis: [],
                        properties: [
                            { name: 'requests', type: 'number[]', access: 'private', desc: 'Array of request timestamps for rate tracking' },
                            { name: 'maxPerSecond', type: 'number', access: 'private readonly', desc: 'Maximum requests per second (default: 30)' },
                            { name: 'maxPerMinute', type: 'number', access: 'private readonly', desc: 'Maximum requests per minute (default: 1000)' }
                        ],
                        functions: [
                            { name: 'constructor(maxPerSecond?: number, maxPerMinute?: number)', access: 'public', returns: 'void', desc: 'Initialize rate limiter with limits' },
                            { name: 'waitIfNeeded()', access: 'public', returns: 'Promise<void>', desc: 'Wait if rate limit reached, clean old requests, enforce limits' },
                            { name: 'reset()', access: 'public', returns: 'void', desc: 'Reset rate limiter (clear request history)' }
                        ]
                    },
                    {
                        name: 'CircuitBreaker',
                        type: 'class',
                        color: '#00d4ff',
                        file: 'src/utils/enterprise-retry.ts',
                        extends: null,
                        implements: null,
                        bunApis: [
                            'Date.now() (timing)'
                        ],
                        telegramApis: [],
                        properties: [
                            { name: 'state', type: 'CircuitState ("closed" | "open" | "half-open")', access: 'private', desc: 'Current circuit breaker state' },
                            { name: 'failures', type: 'number', access: 'private', desc: 'Consecutive failure count' },
                            { name: 'lastFailureTime', type: 'number', access: 'private', desc: 'Timestamp of last failure' },
                            { name: 'halfOpenAttempts', type: 'number', access: 'private', desc: 'Attempts in half-open state' },
                            { name: 'failureThreshold', type: 'number', access: 'private readonly', desc: 'Failures before opening circuit (default: 5)' },
                            { name: 'resetTimeoutMs', type: 'number', access: 'private readonly', desc: 'Time before attempting reset (default: 60000)' },
                            { name: 'halfOpenMaxAttempts', type: 'number', access: 'private readonly', desc: 'Max attempts in half-open (default: 3)' }
                        ],
                        functions: [
                            { name: 'constructor(failureThreshold?: number, resetTimeoutMs?: number, halfOpenMaxAttempts?: number)', access: 'public', returns: 'void', desc: 'Initialize circuit breaker with thresholds' },
                            { name: 'execute<T>(fn: () => Promise<T>)', access: 'public', returns: 'Promise<T>', desc: 'Execute function with circuit breaker protection' },
                            { name: 'getState()', access: 'public', returns: 'CircuitState', desc: 'Get current circuit breaker state' },
                            { name: 'reset()', access: 'public', returns: 'void', desc: 'Manually reset circuit breaker to closed state' }
                        ]
                    }
                ],
                interfaces: [
                    {
                        name: 'TelegramMessage',
                        type: 'interface',
                        color: '#00ff88',
                        file: 'src/telegram/client.ts',
                        properties: [
                            { name: 'chatId', type: 'string | number', access: 'required', desc: 'Chat/supergroup ID' },
                            { name: 'text', type: 'string', access: 'required', desc: 'Message text content' },
                            { name: 'threadId', type: 'number', access: 'optional', desc: 'Topic/thread ID for forum topics' },
                            { name: 'pin', type: 'boolean', access: 'optional', desc: 'Whether to pin the message' },
                            { name: 'parseMode', type: '"HTML" | "Markdown" | "MarkdownV2"', access: 'optional', desc: 'Message parse mode (default: HTML)' }
                        ]
                    },
                    {
                        name: 'TelegramClientStats',
                        type: 'interface',
                        color: '#00ff88',
                        file: 'src/telegram/client.ts',
                        properties: [
                            { name: 'totalRequests', type: 'number', access: 'readonly', desc: 'Total API requests made' },
                            { name: 'successfulRequests', type: 'number', access: 'readonly', desc: 'Successfully completed requests' },
                            { name: 'failedRequests', type: 'number', access: 'readonly', desc: 'Failed requests (after retries)' },
                            { name: 'retries', type: 'number', access: 'readonly', desc: 'Total retry attempts across all requests' },
                            { name: 'circuitBreakerTrips', type: 'number', access: 'readonly', desc: 'Number of times circuit breaker opened' },
                            { name: 'rateLimitHits', type: 'number', access: 'readonly', desc: 'Number of times rate limit was hit' },
                            { name: 'averageResponseTime', type: 'number', access: 'readonly', desc: 'Average response time in milliseconds' }
                        ]
                    },
                    {
                        name: 'TelegramClientConfig',
                        type: 'interface',
                        color: '#00ff88',
                        file: 'src/telegram/client.ts',
                        properties: [
                            { name: 'botToken', type: 'string', access: 'optional', desc: 'Bot API token (falls back to env/secrets)' },
                            { name: 'maxRetries', type: 'number', access: 'optional', desc: 'Maximum retry attempts (default: 3)' },
                            { name: 'retryDelay', type: 'number', access: 'optional', desc: 'Initial retry delay in ms (default: 1000)' },
                            { name: 'circuitBreakerThreshold', type: 'number', access: 'optional', desc: 'Failures before opening circuit (default: 5)' },
                            { name: 'rateLimitPerSecond', type: 'number', access: 'optional', desc: 'Max requests per second (default: 30)' },
                            { name: 'rateLimitPerMinute', type: 'number', access: 'optional', desc: 'Max requests per minute (default: 1000)' },
                            { name: 'enableLogging', type: 'boolean', access: 'optional', desc: 'Enable request/response logging (default: true)' }
                        ]
                    },
                    {
                        name: 'IntegrationStatus',
                        type: 'interface',
                        color: '#00ff88',
                        file: 'src/telegram/monitor.ts',
                        properties: [
                            { name: 'client', type: '{healthy: boolean, message: string, stats: {...}}', access: 'readonly', desc: 'Client health status and statistics' },
                            { name: 'api', type: '{connected: boolean, chatId: string|null, topicsCount: number, lastMessageTime: string|null}', access: 'readonly', desc: 'Telegram API connection information' },
                            { name: 'configuration', type: '{botTokenConfigured: boolean, chatIdConfigured: boolean, secretsConfigured: boolean}', access: 'readonly', desc: 'Configuration validation status' },
                            { name: 'overall', type: '{status: "healthy"|"degraded"|"unhealthy", message: string, timestamp: string}', access: 'readonly', desc: 'Overall integration status' }
                        ]
                    },
                    {
                        name: 'TelegramBotApiResponse',
                        type: 'interface',
                        color: '#00ff88',
                        file: 'src/api/telegram-ws.ts',
                        properties: [
                            { name: 'ok', type: 'boolean', access: 'required', desc: 'Whether request was successful' },
                            { name: 'result', type: 'any', access: 'optional', desc: 'Response result object (varies by method)' },
                            { name: 'description', type: 'string', access: 'optional', desc: 'Error description if ok is false' },
                            { name: 'error_code', type: 'number', access: 'optional', desc: 'Telegram API error code' }
                        ]
                    }
                ],
                functions: [
                    {
                        name: 'getTelegramClient(config?: TelegramClientConfig)',
                        type: 'function',
                        color: '#ff6b00',
                        file: 'src/telegram/client.ts',
                        returns: 'EnhancedTelegramClient',
                        bunApis: [],
                        telegramApis: [],
                        desc: 'Get singleton enhanced client instance. Creates new instance if none exists.'
                    },
                    {
                        name: 'getTelegramMonitor()',
                        type: 'function',
                        color: '#ff6b00',
                        file: 'src/telegram/monitor.ts',
                        returns: 'TelegramIntegrationMonitor',
                        bunApis: [],
                        telegramApis: [],
                        desc: 'Get singleton monitor instance. Creates new instance if none exists.'
                    },
                    {
                        name: 'retryWithBackoff<T>(fn: () => Promise<T>, options?: RetryOptions)',
                        type: 'function',
                        color: '#ff6b00',
                        file: 'src/utils/enterprise-retry.ts',
                        returns: 'Promise<RetryResult<T>>',
                        bunApis: ['Bun.nanoseconds()', 'Bun.sleep()'],
                        telegramApis: [],
                        desc: 'Execute function with exponential backoff retry logic. Uses Bun.nanoseconds for timing and Bun.sleep for delays.'
                    }
                ]
            };

            html += '<div class="architecture-grid">';

            // Render classes
            architecture.classes.forEach(cls => {
                html += `
                    <div class="arch-node class">
                        <div class="arch-header">
                            <div class="arch-color" style="background: ${cls.color};"></div>
                            <div>
                                <div class="arch-type">${cls.type}</div>
                                <div class="arch-name">${cls.name}</div>
                            </div>
                        </div>
                        <div class="arch-content">
                            ${cls.file ? `<div style="font-size: 0.75em; color: #9ca3af; margin-bottom: 10px;">üìÑ ${cls.file}</div>` : ''}
                            ${cls.extends ? `<div style="font-size: 0.75em; color: #667eea; margin-bottom: 10px;">extends ${cls.extends}</div>` : ''}
                            ${cls.implements ? `<div style="font-size: 0.75em; color: #10b981; margin-bottom: 10px;">implements ${cls.implements}</div>` : ''}
                            ${cls.bunApis && cls.bunApis.length > 0 ? `
                                <div style="margin-top: 10px; margin-bottom: 8px; color: #ffeb3b; font-weight: 700; font-size: 0.95em;">üîß Bun APIs Used:</div>
                                ${cls.bunApis.map(api => `
                                    <div class="arch-item" style="font-size: 0.85em;">
                                        <div class="arch-item-name" style="color: #ffeb3b; font-weight: 600;">${api}</div>
                                    </div>
                                `).join('')}
                            ` : ''}
                            ${cls.telegramApis && cls.telegramApis.length > 0 ? `
                                <div style="margin-top: 10px; margin-bottom: 8px; color: #9c27b0; font-weight: 700; font-size: 0.95em;">üì° Telegram API Methods:</div>
                                ${cls.telegramApis.map(api => `
                                    <div class="arch-item" style="font-size: 0.85em;">
                                        <div class="arch-item-name" style="color: #9c27b0; font-weight: 600;">${api}</div>
                                    </div>
                                `).join('')}
                            ` : ''}
                            <div style="margin-top: 15px; margin-bottom: 10px; color: #ff00ff; font-weight: 600; font-size: 1em;">Properties:</div>
                            ${cls.properties.map(prop => `
                                <div class="arch-item">
                                    <div class="arch-item-name">
                                        <span style="color: #00bcd4; font-weight: 700;">${prop.access || ''}</span>
                                        <span style="color: #ff00ff; font-weight: 700;">${prop.name}</span>
                                        <span style="color: #4caf50; margin-left: 8px; font-weight: 600;">: ${prop.type}</span>
                                    </div>
                                    <div class="arch-item-desc">${prop.desc}</div>
                                </div>
                            `).join('')}
                            ${cls.functions ? `
                                <div style="margin-top: 15px; margin-bottom: 10px; color: #ff6b00; font-weight: 600; font-size: 1em;">Functions:</div>
                                ${cls.functions.map(fn => `
                                    <div class="arch-item">
                                        <div class="arch-item-name">
                                            <span style="color: #00bcd4; font-weight: 700;">${fn.access || ''}</span>
                                            <span style="color: #ff6b00; font-weight: 700;">${fn.name}</span>
                                            ${fn.returns ? `<span style="color: #4caf50; margin-left: 8px; font-weight: 600;">‚Üí ${fn.returns}</span>` : ''}
                                        </div>
                                        <div class="arch-item-desc">${fn.desc}</div>
                                    </div>
                                `).join('')}
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>'; // Close classes grid

            // Add interfaces section header
            html += `
                <div style="margin-top: 40px; margin-bottom: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                    <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">
                        [ARCHITECTURE.INTERFACES.RG] Interfaces
                    </div>
                    <div style="font-size: 0.9em; color: #d1d5db;">
                        TypeScript interfaces defining data structures and contracts
                    </div>
                </div>
                <div class="architecture-grid">
            `;

            // Render interfaces
            architecture.interfaces.forEach(iface => {
                html += `
                    <div class="arch-node interface">
                        <div class="arch-header">
                            <div class="arch-color" style="background: ${iface.color};"></div>
                            <div>
                                <div class="arch-type">${iface.type}</div>
                                <div class="arch-name">${iface.name}</div>
                            </div>
                        </div>
                        <div class="arch-content">
                            ${iface.file ? `<div style="font-size: 0.75em; color: #9ca3af; margin-bottom: 10px;">üìÑ ${iface.file}</div>` : ''}
                            <div style="margin-bottom: 10px; color: #ff00ff; font-weight: 600; font-size: 1em;">Properties:</div>
                            ${iface.properties.map(prop => `
                                <div class="arch-item">
                                    <div class="arch-item-name">
                                        <span style="color: #ff00ff; font-weight: 700;">${prop.name}</span>
                                        <span style="color: #4caf50; margin-left: 8px; font-weight: 600;">: ${prop.type}</span>
                                        ${prop.access ? `<span style="color: #00bcd4; margin-left: 8px; font-weight: 600;">(${prop.access})</span>` : ''}
                                    </div>
                                    <div class="arch-item-desc">${prop.desc}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            html += '</div>'; // Close interfaces grid

            // Add functions section header
            html += `
                <div style="margin-top: 40px; margin-bottom: 20px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">
                        [ARCHITECTURE.FUNCTIONS.RG] Functions
                    </div>
                    <div style="font-size: 0.9em; color: #d1d5db;">
                        Utility functions and singleton getters
                    </div>
                </div>
                <div class="architecture-grid">
            `;

            // Render functions
            architecture.functions.forEach(fn => {
                html += `
                    <div class="arch-node function">
                        <div class="arch-header">
                            <div class="arch-color" style="background: ${fn.color};"></div>
                            <div>
                                <div class="arch-type">${fn.type}</div>
                                <div class="arch-name">${fn.name}</div>
                            </div>
                        </div>
                        <div class="arch-content">
                            ${fn.file ? `<div style="font-size: 0.75em; color: #9ca3af; margin-bottom: 10px;">üìÑ ${fn.file}</div>` : ''}
                            <div class="arch-item">
                                <div class="arch-item-desc">${fn.desc}</div>
                                <div style="margin-top: 8px;">
                                    <span style="color: #00bcd4; font-weight: 600;">Returns:</span>
                                    <span style="color: #4caf50; font-weight: 700;">${fn.returns}</span>
                                </div>
                            </div>
                            ${fn.bunApis && fn.bunApis.length > 0 ? `
                                <div style="margin-top: 10px; margin-bottom: 8px; color: #ffeb3b; font-weight: 700; font-size: 0.95em;">üîß Bun APIs:</div>
                                ${fn.bunApis.map(api => `
                                    <div class="arch-item" style="font-size: 0.85em;">
                                        <div class="arch-item-name" style="color: #ffeb3b; font-weight: 600;">${api}</div>
                                    </div>
                                `).join('')}
                            ` : ''}
                            ${fn.telegramApis && fn.telegramApis.length > 0 ? `
                                <div style="margin-top: 10px; margin-bottom: 8px; color: #9c27b0; font-weight: 700; font-size: 0.95em;">üì° Telegram APIs:</div>
                                ${fn.telegramApis.map(api => `
                                    <div class="arch-item" style="font-size: 0.85em;">
                                        <div class="arch-item-name" style="color: #9c27b0; font-weight: 600;">${api}</div>
                                    </div>
                                `).join('')}
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>'; // Close functions grid

            // Add connection diagram with Mermaid
            html += `
                <div style="margin-top: 30px; padding: 25px; background: rgba(0, 212, 255, 0.1); border-radius: 12px; border: 3px solid #00d4ff; box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);">
                    <div style="font-weight: 700; margin-bottom: 20px; color: #00d4ff; font-size: 1.2em; font-family: 'Monaco', 'Menlo', monospace;">
                        <span id="architecture-flow-header">[ARCHITECTURE.FLOW.RG] Architecture Flow</span>
                    </div>

                    <!-- Mermaid Diagram -->
                    <div class="mermaid" style="margin-top: 20px; background: rgba(0, 0, 0, 0.4); padding: 30px; border-radius: 12px; border: 2px solid rgba(0, 212, 255, 0.3);">
graph TB
    subgraph APP["Application Layer<br/>#00d4ff"]
        CLI["CLI Tools<br/>telegram.ts<br/>#00d4ff"]
        API["API Routes<br/>routes.ts<br/>#00d4ff"]
        DASH["Dashboard<br/>index.html<br/>#00d4ff"]
        WS["WebSocket<br/>telegram-ws.ts<br/>#00d4ff"]
    end

    subgraph CLIENT["Enhanced Client Container<br/>#00d4ff"]
        ETC["EnhancedTelegramClient<br/>Class #00d4ff<br/>Properties: api, circuitBreaker<br/>rateLimiter, stats, config"]
        RL["RateLimiter<br/>Property #ff00ff<br/>Type: RateLimiter<br/>maxPerSecond, maxPerMinute"]
        CB["CircuitBreaker<br/>Property #ff00ff<br/>Type: CircuitBreaker<br/>state, failures, threshold"]
        RQ["Request Queue<br/>Property #ff00ff<br/>Type: Array&lt;Function&gt;<br/>async processing"]
        STATS["Stats Tracker<br/>Property #ff00ff<br/>Type: TelegramClientStats<br/>totalRequests, successRate"]
    end

    subgraph MONITOR["Monitor Container<br/>#00d4ff"]
        TIM["TelegramIntegrationMonitor<br/>Class #00d4ff<br/>Properties: client, api, chatId"]
        HEALTH["Health Check<br/>Function #ff6b00<br/>getStatus() ‚Üí IntegrationStatus"]
    end

    subgraph BASE["Base API Container<br/>#00d4ff"]
        TBA["TelegramBotApi<br/>Class #00d4ff<br/>Properties: botToken, apiBase"]
        FETCH["fetch() API<br/>Bun API #ffeb3b<br/>HTTP requests"]
        PARAMS["URLSearchParams<br/>Bun API #ffeb3b<br/>Query building"]
    end

    subgraph VM["Bun Runtime VM<br/>#ffeb3b"]
        ENV["process.env<br/>Property #ff00ff<br/>Type: object<br/>Environment Vars"]
        SECRETS["Bun.secrets<br/>Property #ff00ff<br/>Type: BunSecrets<br/>Credential Storage"]
        TIMING["Bun.nanoseconds()<br/>Function #ff6b00<br/>‚Üí number<br/>High-Precision Timing"]
        SLEEP["Bun.sleep()<br/>Function #ff6b00<br/>‚Üí Promise<br/>Async Delays"]
    end

    subgraph EXTERNAL["External Telegram API<br/>#9c27b0"]
        TGAPI["Telegram Bot API<br/>api.telegram.org<br/>#9c27b0"]
        SEND["sendMessage<br/>Method #9c27b0<br/>POST /sendMessage"]
        PIN["pinMessage<br/>Method #9c27b0<br/>POST /pinChatMessage"]
        TOPICS["getForumTopics<br/>Method #9c27b0<br/>GET /getForumTopics"]
    end

    CLI -->|"uses"| ETC
    API -->|"uses"| ETC
    DASH -->|"queries"| TIM
    WS -->|"uses"| ETC

    ETC -->|"contains"| RL
    ETC -->|"contains"| CB
    ETC -->|"contains"| RQ
    ETC -->|"contains"| STATS
    ETC -->|"delegates to"| TBA

    TIM -->|"uses"| ETC
    TIM -->|"calls"| HEALTH
    TIM -->|"queries"| TBA

    TBA -->|"uses"| FETCH
    TBA -->|"uses"| PARAMS

    ETC -.->|"reads"| ENV
    ETC -.->|"reads"| SECRETS
    RL -.->|"calls"| TIMING
    RL -.->|"calls"| SLEEP
    CB -.->|"calls"| TIMING

    FETCH -->|"HTTP request"| TGAPI
    TGAPI -->|"contains"| SEND
    TGAPI -->|"contains"| PIN
    TGAPI -->|"contains"| TOPICS

    style APP fill:#00d4ff,stroke:#00a8cc,stroke-width:3px,color:#000
    style CLIENT fill:#00d4ff,stroke:#00a8cc,stroke-width:3px,color:#000
    style MONITOR fill:#00d4ff,stroke:#00a8cc,stroke-width:3px,color:#000
    style BASE fill:#00d4ff,stroke:#00a8cc,stroke-width:3px,color:#000
    style VM fill:#ffeb3b,stroke:#fbc02d,stroke-width:3px,color:#000
    style EXTERNAL fill:#9c27b0,stroke:#7b1fa2,stroke-width:3px,color:#fff

    style ETC fill:#00d4ff,stroke:#00a8cc,stroke-width:4px,color:#000,font-weight:bold
    style TIM fill:#00d4ff,stroke:#00a8cc,stroke-width:4px,color:#000,font-weight:bold
    style TBA fill:#00d4ff,stroke:#00a8cc,stroke-width:4px,color:#000,font-weight:bold
    style RL fill:#ff00ff,stroke:#cc00cc,stroke-width:3px,color:#fff,font-weight:bold
    style CB fill:#ff1744,stroke:#cc0028,stroke-width:3px,color:#fff,font-weight:bold
    style RQ fill:#ff00ff,stroke:#cc00cc,stroke-width:3px,color:#fff,font-weight:bold
    style STATS fill:#ff00ff,stroke:#cc00cc,stroke-width:3px,color:#fff,font-weight:bold
    style TGAPI fill:#9c27b0,stroke:#7b1fa2,stroke-width:4px,color:#fff,font-weight:bold
    style SEND fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px,color:#fff
    style PIN fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px,color:#fff
    style TOPICS fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px,color:#fff
    style FETCH fill:#ffeb3b,stroke:#fbc02d,stroke-width:3px,color:#000,font-weight:bold
    style PARAMS fill:#ffeb3b,stroke:#fbc02d,stroke-width:3px,color:#000,font-weight:bold
    style ENV fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px,color:#000
    style SECRETS fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px,color:#000
    style TIMING fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px,color:#000
    style SLEEP fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px,color:#000
    style HEALTH fill:#ff6b00,stroke:#cc5500,stroke-width:3px,color:#fff,font-weight:bold
                    </div>

                    <!-- ASCII Flow Diagram -->
                    <div style="margin-top: 30px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; line-height: 1.8; white-space: pre; background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 8px;">
                        <div style="color: #00d4ff; font-weight: 700; margin-bottom: 10px; font-size: 1.1em;">[DATAFLOW.RG] Data Flow:</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îå‚îÄ Application Layer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
                        <div style="color: #ffffff;">‚îÇ  CLI Tools ‚îÇ API Routes ‚îÇ Dashboard ‚îÇ WebSocket          ‚îÇ</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚îÇ</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚Üì</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îå‚îÄ Enhanced Client Container ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
                        <div style="color: #00d4ff; font-weight: 700;">‚îÇ  EnhancedTelegramClient (#00d4ff)                        ‚îÇ</div>
                        <div style="color: #ff00ff; font-weight: 600;">‚îÇ    ‚îú‚îÄ RateLimiter (#ff00ff) - Properties                  ‚îÇ</div>
                        <div style="color: #ff1744; font-weight: 600;">‚îÇ    ‚îú‚îÄ CircuitBreaker (#ff1744) - Properties               ‚îÇ</div>
                        <div style="color: #ff00ff; font-weight: 600;">‚îÇ    ‚îú‚îÄ Request Queue (#ff00ff) - Properties               ‚îÇ</div>
                        <div style="color: #ff00ff; font-weight: 600;">‚îÇ    ‚îî‚îÄ Stats Tracker (#ff00ff) - Properties               ‚îÇ</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚îÇ</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚Üì</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îå‚îÄ Base API Container ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
                        <div style="color: #00d4ff; font-weight: 700;">‚îÇ  TelegramBotApi (#00d4ff)                                 ‚îÇ</div>
                        <div style="color: #ffeb3b; font-weight: 600;">‚îÇ    ‚îú‚îÄ fetch() (#ffeb3b) - Bun API                         ‚îÇ</div>
                        <div style="color: #ffeb3b; font-weight: 600;">‚îÇ    ‚îî‚îÄ URLSearchParams (#ffeb3b) - Bun API                  ‚îÇ</div>
                        <div style="color: #00d4ff; font-weight: 600;">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚îÇ</div>
                        <div style="text-align: center; color: #00d4ff; margin: 10px 0; font-size: 1.2em;">‚Üì</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îå‚îÄ External API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
                        <div style="color: #9c27b0; font-weight: 700;">‚îÇ  Telegram Bot API (api.telegram.org) (#9c27b0)            ‚îÇ</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îÇ    ‚îú‚îÄ sendMessage (#9c27b0)                                ‚îÇ</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îÇ    ‚îú‚îÄ pinMessage (#9c27b0)                                ‚îÇ</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îÇ    ‚îú‚îÄ getForumTopics (#9c27b0)                            ‚îÇ</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îÇ    ‚îî‚îÄ Topic Management (#9c27b0)                          ‚îÇ</div>
                        <div style="color: #9c27b0; font-weight: 600;">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>

                        <div style="margin-top: 20px; color: #ffeb3b; font-weight: 700; font-size: 1.1em;">[BUN.VM.RG] Bun Runtime VM Integration:</div>
                        <div style="color: #ffffff; margin-top: 10px; font-weight: 600;">
                            <div style="color: #00d4ff;">EnhancedTelegramClient</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí process.env (#ffeb3b) - TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí Bun.secrets.get() (#ffeb3b) - Credential fallback</div>
                            <div style="color: #ff00ff; margin-top: 8px;">RateLimiter</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí Date.now() (#ffeb3b) - Timing</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí setTimeout() (#ffeb3b) - Delays</div>
                            <div style="color: #ff1744; margin-top: 8px;">CircuitBreaker</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí Date.now() (#ffeb3b) - Failure tracking</div>
                            <div style="color: #ff6b00; margin-top: 8px;">retryWithBackoff()</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí Bun.nanoseconds() (#ffeb3b) - High-precision timing</div>
                            <div style="margin-left: 20px; color: #ffeb3b;">‚îî‚îÄ‚Üí Bun.sleep() (#ffeb3b) - Exponential backoff delays</div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function hexToHsl(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }

            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        }

        function getContrastColor(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 128 ? '#000000' : '#ffffff';
        }

        function renderColorMap() {
            const container = document.getElementById('colorMapContainer');

            const colorMap = [
                {
                    hex: '#00d4ff',
                    name: 'Vibrant Cyan - Classes',
                    usage: 'Classes, Main Components',
                    reason: 'Bright cyan (#00d4ff) - Highly visible, modern tech color. Excellent contrast. Represents core classes and main functionality. HSL: 192¬∞ 100% 50%',
                    category: 'Class'
                },
                {
                    hex: '#00ff88',
                    name: 'Electric Green - Interfaces',
                    usage: 'Interfaces, Type Definitions',
                    reason: 'Electric green (#00ff88) - Vibrant, fresh color. High saturation ensures visibility. Perfect for interfaces and type contracts. HSL: 150¬∞ 100% 50%',
                    category: 'Interface'
                },
                {
                    hex: '#ff6b00',
                    name: 'Vibrant Orange - Functions',
                    usage: 'Functions, Methods, API Calls',
                    reason: 'Vibrant orange (#ff6b00) - Energetic and attention-grabbing. High contrast against dark backgrounds. Ideal for functions and actionable methods. HSL: 24¬∞ 100% 50%',
                    category: 'Function'
                },
                {
                    hex: '#ff00ff',
                    name: 'Magenta - Properties',
                    usage: 'Properties, Attributes, Fields',
                    reason: 'Magenta (#ff00ff) - Distinctive and vibrant. Maximum saturation ensures clear distinction from other types. Perfect for properties and data fields. HSL: 300¬∞ 100% 50%',
                    category: 'Property'
                },
                {
                    hex: '#ff1744',
                    name: 'Vibrant Red - Errors',
                    usage: 'Errors, Circuit Breaker, Critical',
                    reason: 'Vibrant red (#ff1744) - High visibility for critical components. Strong warning signal. Excellent for error states and circuit breakers. HSL: 348¬∞ 100% 54%',
                    category: 'Error'
                },
                {
                    hex: '#ffeb3b',
                    name: 'Bright Yellow - Bun APIs',
                    usage: 'Bun Runtime APIs, VM Integration',
                    reason: 'Bright yellow (#ffeb3b) - Highly visible, stands out. Perfect for highlighting Bun-specific APIs and VM integration points. HSL: 54¬∞ 100% 58%',
                    category: 'Bun API'
                },
                {
                    hex: '#9c27b0',
                    name: 'Deep Purple - Telegram APIs',
                    usage: 'Telegram API Methods, Endpoints',
                    reason: 'Deep purple (#9c27b0) - Rich, distinctive color. High contrast. Perfect for Telegram API methods and external endpoints. HSL: 292¬∞ 70% 42%',
                    category: 'Telegram API'
                },
                {
                    hex: '#00bcd4',
                    name: 'Cyan - Access Modifiers',
                    usage: 'Private, Public, Readonly',
                    reason: 'Cyan (#00bcd4) - Bright and clear. Good contrast for access modifiers. Helps distinguish visibility levels. HSL: 187¬∞ 100% 42%',
                    category: 'Modifier'
                },
                {
                    hex: '#4caf50',
                    name: 'Green - Return Types',
                    usage: 'Return Types, Type Annotations',
                    reason: 'Green (#4caf50) - Clear and readable. Good for return types and type annotations. Maintains visibility. HSL: 122¬∞ 39% 50%',
                    category: 'Type'
                },
                {
                    hex: '#1a1f3a',
                    name: 'Card Background',
                    usage: 'Card Backgrounds',
                    reason: 'Dark navy provides contrast against vibrant colors. Maintains readability. Professional dark theme standard.',
                    category: 'Background'
                },
                {
                    hex: '#0a0e27',
                    name: 'Page Background',
                    usage: 'Main Background',
                    reason: 'Deepest blue-black reduces eye strain. Maximum contrast for vibrant content. Modern dark mode aesthetic.',
                    category: 'Background'
                },
                {
                    hex: '#ffffff',
                    name: 'Pure White - Text',
                    usage: 'Primary Text Content',
                    reason: 'Pure white ensures maximum readability on dark backgrounds. Highest contrast ratio. Perfect for main content.',
                    category: 'Text'
                },
                {
                    hex: '#b0bec5',
                    name: 'Light Blue-Gray - Secondary',
                    usage: 'Descriptions, Metadata',
                    reason: 'Light blue-gray for secondary information. Maintains hierarchy while staying readable. Reduces visual noise.',
                    category: 'Text'
                }
            ];

            let html = '<div class="colormap-grid">';

            colorMap.forEach(color => {
                const hsl = hexToHsl(color.hex);
                const contrastColor = getContrastColor(color.hex);

                html += `
                    <div class="color-swatch">
                        <div class="color-preview" style="background: ${color.hex}; color: ${contrastColor};">
                            ${color.hex}
                        </div>
                        <div class="color-info">
                            <div style="font-weight: 600; margin-bottom: 5px; color: #667eea;">${color.name}</div>
                            <div class="color-hex">
                                <span style="color: ${color.hex}; font-size: 1.5em;">‚¨§</span>
                                <span class="color-hex-code" style="color: ${color.hex};">${color.hex.toUpperCase()}</span>
                            </div>
                            <div class="color-hsl">
                                HSL: ${hsl.h}¬∞ ${hsl.s}% ${hsl.l}%
                            </div>
                            <div class="color-usage">
                                <strong>Usage:</strong> ${color.usage}
                            </div>
                            <div class="color-reason">
                                <strong>Why:</strong> ${color.reason}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            // Add Bun console color reference
            html += `
                <div style="margin-top: 30px; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                    <div style="font-weight: 600; margin-bottom: 15px; color: #667eea;">
                        <span id="bun-console-header">[BUN.CONSOLE.COLORS.RG] üîß Bun Console Colors Reference</span>
                    </div>
                    <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9em; line-height: 2;">
                        <div style="color: #667eea;">console.log() - Default (uses terminal colors)</div>
                        <div style="color: #10b981;">‚úì Success/Info messages</div>
                        <div style="color: #f59e0b;">‚ö† Warning messages</div>
                        <div style="color: #ef4444;">‚úó Error messages</div>
                        <div style="color: #8b5cf6;">‚Ñπ Debug/Technical info</div>
                        <div style="margin-top: 10px; opacity: 0.7;">
                            Note: Bun console supports ANSI color codes and automatically colors output based on context.
                        </div>
                    </div>
                </div>

                <!-- Console Depth Debugging Features (7.0.0.0.0.0.0) -->
                <div style="margin-top: 30px; padding: 20px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 212, 255, 0.3);">
                    <div style="font-weight: 600; margin-bottom: 15px; color: #00d4ff;">
                        <span>[7.0.0.0.0.0.0] üîç Console Depth Debugging Features</span>
                    </div>
                    <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.9em; line-height: 1.8;">
                        <div style="margin-bottom: 12px;">
                            <strong style="color: #00d4ff;">--console-depth=&lt;N&gt;</strong> - Control nested object display depth
                        </div>
                        <div style="margin-left: 20px; margin-bottom: 10px; opacity: 0.9;">
                            <div>‚Ä¢ <code style="color: #00ff88;">bun --console-depth=7 run script.ts</code> - Development (depth 7)</div>
                            <div>‚Ä¢ <code style="color: #00ff88;">bun --console-depth=5 run script.ts</code> - Production (depth 5)</div>
                            <div>‚Ä¢ <code style="color: #00ff88;">bun --console-depth=10 run script.ts</code> - Deep debugging (depth 10)</div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 212, 255, 0.2);">
                            <strong style="color: #00d4ff;">Bun's Internal Array Formatting:</strong>
                            <div style="margin-top: 8px; opacity: 0.9;">
                                Arrays show intelligently: <code style="color: #00ff88;">[MarketOfferingNode, MarketOfferingNode, ..., 15 more items]</code>
                            </div>
                            <div style="margin-top: 8px; opacity: 0.9;">
                                Provides type info, count, and respects <code style="color: #00ff88;">--console-depth</code> limits
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 212, 255, 0.2);">
                            <div style="opacity: 0.8; font-size: 0.85em;">
                                üìö See <a href="../docs/7.0.0.0.0.0.0-CONSOLE-DEPTH-DEBUGGING.md" target="_blank" style="color: #00d4ff; text-decoration: underline;">docs/7.0.0.0.0.0.0-CONSOLE-DEPTH-DEBUGGING.md</a> for comprehensive guide
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function renderNode(node, depth = 0) {
            const hasTension = node.tensions && node.tensions.length > 0;
            const tensionClass = hasTension ? 'has-tension' : '';
            const indent = depth * 25;
            const borderColor = depth === 0 ? '#00d4ff' : depth === 1 ? '#00ff88' : depth === 2 ? '#ff6b00' : '#9c27b0';

            let html = `
                <div class="node-item ${tensionClass}" style="margin-left: ${indent}px; border-left-color: ${borderColor};">
                    <div class="node-header">
                        <span class="node-id" style="color: ${borderColor}; text-shadow: 0 0 8px ${borderColor}80;">${node.nodeId}</span>
                        <span class="node-type">${node.baseLineType || 'N/A'}</span>
                        <span class="node-period">${node.period || 'N/A'}</span>
                        ${node.parentNodeId ? `<span style="color: #00bcd4; font-size: 0.8em;">‚Üê Parent: ${node.parentNodeId.split(':').slice(-2).join(':')}</span>` : '<span style="color: #00d4ff; font-weight: 700;">ROOT</span>'}
                        ${hasTension ? `
                            ${node.tensions.map(t => `
                                <span class="tension-badge ${t.severity >= 8 ? 'tension-high' : t.severity >= 5 ? 'tension-medium' : 'tension-low'}">
                                    ${t.tension_type} (${t.severity})
                                </span>
                            `).join('')}
                        ` : ''}
                    </div>
                    <div class="node-properties">
                        <div style="color: #ff00ff; font-weight: 700; margin-bottom: 8px; font-size: 0.9em;">Properties:</div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">bookmaker:</span>
                            <span class="node-prop-value" style="color: #4caf50;">string = "${node.bookmaker}"</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">marketId:</span>
                            <span class="node-prop-value" style="color: #4caf50;">string = "${node.marketId}"</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">period:</span>
                            <span class="node-prop-value" style="color: #4caf50;">string = "${node.period}"</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">baseLineType:</span>
                            <span class="node-prop-value" style="color: #4caf50;">string = "${node.baseLineType}"</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">parentNodeId:</span>
                            <span class="node-prop-value" style="color: #4caf50;">string | null = ${node.parentNodeId ? `"${node.parentNodeId}"` : 'null'}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.impliedVolume:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number | null = ${node.properties.impliedVolume !== null ? node.properties.impliedVolume.toFixed(2) : 'null'}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.numberOfMoves:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.properties.numberOfMoves}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.velocity:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.properties.velocity.toFixed(4)}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.juiceVolatility:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.properties.juiceVolatility.toFixed(4)}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.arbitragePressure:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.properties.arbitragePressure.toFixed(4)}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.tensionScore:</span>
                            <span class="node-prop-value" style="color: ${node.properties.tensionScore > 50 ? '#ff1744' : node.properties.tensionScore > 20 ? '#ff6b00' : '#4caf50'}; font-weight: 700;">
                                number = ${node.properties.tensionScore.toFixed(2)}
                            </span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.lastLine:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number | null = ${node.properties.lastLine !== null ? node.properties.lastLine : 'null'}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">properties.lastOdds:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number | null = ${node.properties.lastOdds !== null ? node.properties.lastOdds : 'null'}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">depth:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.depth}</span>
                        </div>
                        <div class="node-prop">
                            <span class="node-prop-name" style="color: #ff00ff;">path.length:</span>
                            <span class="node-prop-value" style="color: #4caf50;">number = ${node.path ? node.path.length : 0}</span>
                        </div>
                        ${node.edges && node.edges.length > 0 ? `
                            <div style="margin-top: 10px; color: #9c27b0; font-weight: 700;">Edges (${node.edges.length}):</div>
                            ${node.edges.map(e => `
                                <div class="node-prop" style="margin-left: 15px;">
                                    <span style="color: #9c27b0;">‚Üí ${e.toNodeId.split(':').slice(-2).join(':')}</span>
                                    <span style="color: #00bcd4; margin-left: 8px;">(${e.relationshipType})</span>
                                    <span style="color: #4caf50; margin-left: 8px;">conf: ${e.confidence.toFixed(2)}</span>
                                </div>
                            `).join('')}
                        ` : ''}
                        ${hasTension ? `
                            <div style="margin-top: 10px; color: #ff1744; font-weight: 700;">Tensions (${node.tensions.length}):</div>
                            ${node.tensions.map(t => `
                                <div class="node-prop" style="margin-left: 15px;">
                                    <span style="color: #ff1744;">${t.tension_type}</span>
                                    <span style="color: #ff6b00; margin-left: 8px;">severity: ${t.severity}</span>
                                    <span style="color: #00bcd4; margin-left: 8px;">nodes: ${t.nodes.length}</span>
                                </div>
                            `).join('')}
                        ` : ''}
                    </div>
            `;

            if (node.children && node.children.length > 0) {
                html += `<div class="node-children">`;
                html += `<div style="color: ${borderColor}; font-weight: 700; margin-bottom: 10px; font-size: 1em; text-shadow: 0 0 8px ${borderColor}80;">
                    Children (${node.children.length}) - Depth ${depth + 1}:
                </div>`;
                for (const child of node.children) {
                    html += renderNode(child, depth + 1);
                }
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        async function loadSitemap() {
            const eventId = document.getElementById('sitemapEventId').value;
            if (!eventId) {
                showError('Please enter an Event ID');
                return;
            }

            const container = document.getElementById('sitemapContainer');
            container.innerHTML = '<div style="color: #00d4ff;">Loading sitemap...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/research/sitemap/${eventId}`);
                if (!response.ok) {
                    throw new Error('Failed to load sitemap');
                }

                const result = await response.json();
                if (result.status === 'ok' && result.data) {
                    const sitemap = result.data;

                    let html = `
                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; border-left: 4px solid #00d4ff;">
                            <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 5px;">
                                [SITEMAP.STATS.RG] Sitemap Statistics
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                                <div>
                                    <div style="color: #00d4ff; font-weight: 600;">Total Nodes</div>
                                    <div style="color: #fff; font-size: 1.5em; font-weight: 700;">${sitemap.totalNodes}</div>
                                </div>
                                <div>
                                    <div style="color: #ff1744; font-weight: 600;">Total Tensions</div>
                                    <div style="color: #fff; font-size: 1.5em; font-weight: 700;">${sitemap.totalTensions}</div>
                                </div>
                                <div>
                                    <div style="color: #00ff88; font-weight: 600;">Max Depth</div>
                                    <div style="color: #fff; font-size: 1.5em; font-weight: 700;">${sitemap.maxDepth}</div>
                                </div>
                                <div>
                                    <div style="color: #ff6b00; font-weight: 600;">Root Nodes</div>
                                    <div style="color: #fff; font-size: 1.5em; font-weight: 700;">${sitemap.rootNodes.length}</div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <div style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #9ca3af; margin-bottom: 10px;">
                                [NODE.HIERARCHY.RG] Node Hierarchy
                            </div>
                    `;

                    for (const rootNode of sitemap.rootNodes) {
                        html += renderNode(rootNode, 0);
                    }

                    html += '</div>';
                    container.innerHTML = html;
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                container.innerHTML = `<div style="color: #ff1744;">Error loading sitemap: ${error.message}</div>`;
            }
        }

        // Update header system time and last update
        // Make it globally accessible for updateFooterTimes
        window.updateHeaderTime = function updateHeaderTime() {
            const timeStr = formatSystemTime();
            const headerTimeEl = document.getElementById('headerSystemTime');
            if (headerTimeEl) {
                headerTimeEl.textContent = timeStr;
            }
            // Note: headerLastUpdate is updated by updateLastUpdate() when data refreshes
            // We only set initial value here if it's still "Never"
            const headerLastUpdateEl = document.getElementById('headerLastUpdate');
            if (headerLastUpdateEl && headerLastUpdateEl.textContent === 'Never') {
                headerLastUpdateEl.textContent = timeStr;
            }
        };

        // Update header time every second
        setInterval(window.updateHeaderTime, 1000);
        window.updateHeaderTime(); // Initial update

        // Update system time every second (same format as CLI: toLocaleTimeString)
        setInterval(updateSystemTime, 1000);
        updateSystemTime(); // Initial update

        // Initialize timezone constants display immediately (will be updated by API if available)
        function initializeTimezoneConstants() {
            try {
                if (window.timezoneUtils && typeof window.timezoneUtils.updateTimezoneConstantsDisplay === 'function') {
                    window.timezoneUtils.updateTimezoneConstantsDisplay();
                } else {
                    // Fallback: Use browser-detected timezone
                    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const tzDisplay = `[TZ][${tz}][setSystemTime (N/A)]`;
                    const headerTzEl = document.getElementById('headerTimezoneConstants');
                    const footerTzEl = document.getElementById('footerTimezoneConstants');
                    if (headerTzEl) headerTzEl.textContent = tzDisplay;
                    if (footerTzEl) footerTzEl.textContent = tzDisplay;
                }
            } catch (e) {
                console.debug('Initial timezone constants update failed:', e);
            }
        }
        // Initialize timezone constants after a short delay to ensure DOM is ready
        setTimeout(initializeTimezoneConstants, 100);

        // Initial load with connection test
        async function initialLoad() {
            console.log('[Dashboard] Starting initial load...');
            console.log(`[Dashboard] Window origin: ${window.location.origin}`);
            console.log(`[Dashboard] API_BASE: ${API_BASE}`);

            // Test API connection first
            try {
                const testResponse = await apiFetch(`${API_BASE}/api/health`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(2000)
                });
                if (testResponse.ok) {
                    console.log('[Dashboard] ‚úÖ API connection successful');
                } else {
                    console.warn(`[Dashboard] ‚ö†Ô∏è API returned status ${testResponse.status}`);
                }
            } catch (error) {
                // Only log as warning, not error, since dashboard can work in standalone mode
                console.warn('[Dashboard] ‚ö†Ô∏è API connection test failed:', error.message);
                console.warn('[Dashboard] Dashboard will run in standalone mode. API server should be running on', API_BASE);
                console.warn('[Dashboard] To start API server: bun run dev');
            }

            // Load all data
            await refreshAll();
            updateSystemMetrics();
            renderColorMap();
            renderArchitecture();
        }

        initialLoad();
    </script>

    <!-- Footer -->
    <footer role="contentinfo" style="margin-top: 50px; padding: 30px 20px; background: #1a1f3a; border-top: 2px solid rgba(102, 126, 234, 0.3); border-radius: 12px 12px 0 0;">
        <div style="max-width: 1400px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 30px;">
                <!-- Bun Documentation -->
                <nav aria-label="Bun documentation links">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üìö Bun Documentation</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;">
                            <a href="https://bun.com/reference" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>API Reference</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">bun.com/reference</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://bun.com/reference/globals" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Globals Reference</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">bun.com/reference/globals</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://bun.com/docs/runtime/bun-apis" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Runtime APIs</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">bun.com/docs/runtime/bun-apis</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://bun.com/blog" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Blog</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">bun.com/blog</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/oven-sh/bun" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>GitHub</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">github.com/oven-sh/bun</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- NEXUS Platform -->
                <nav aria-label="NEXUS platform links">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üîó NEXUS Platform</h3>
                    <ul id="nexusLinks" style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/docs" data-api-path="/docs" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>API Documentation</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/docs</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/docs/errors" data-api-path="/docs/errors" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Error Registry</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/docs/errors</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/api/health" data-api-path="/api/health" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Health Check</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/api/health</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/api/examples" data-api-path="/api/examples" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>API Examples</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/api/examples</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/api/security/threats" data-api-path="/api/security/threats" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Security Threats</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/api/security/threats</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>GitHub</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">github.com/brendadeeznuts1111/trader-analyzer-bun</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Changelog -->
                <section aria-label="Changelog" id="changelogSection" style="margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em; display: flex; align-items: center; gap: 10px;">
                        <span>üìã</span>
                        <span>Changelog</span>
                        <span style="font-size: 0.7em; color: #9ca3af; font-weight: normal;">(vibrant tags)</span>
                    </h3>
                    <div id="changelogContainer" style="background: rgba(26, 31, 58, 0.6); border-radius: 8px; padding: 15px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div id="changelogLoading" style="text-align: center; padding: 20px; color: #9ca3af;">
                            Loading changelog...
                        </div>
                        <div id="changelogContent" style="display: none;">
                            <div id="changelogStats" style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; font-size: 0.9em; padding-bottom: 15px; border-bottom: 1px solid rgba(102, 126, 234, 0.2);">
                                <span style="color: #9ca3af;">Version: <strong id="changelogVersion" style="color: #00ff88; text-shadow: 0 0 5px #00ff8860;">--</strong></span>
                                <span style="color: #9ca3af;">Total: <strong id="changelogTotal" style="color: #00d4ff; text-shadow: 0 0 5px #00d4ff60;">--</strong></span>
                                <span style="color: #9ca3af;">Categories: <strong id="changelogCategories" style="color: #ff00ff; text-shadow: 0 0 5px #ff00ff60;">--</strong></span>
                            </div>
                            <div id="changelogFilter" style="margin-bottom: 15px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="filterChangelog('all')" id="filterAll" style="padding: 6px 12px; background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; color: #667eea; border-radius: 4px; cursor: pointer; font-size: 0.85em; transition: all 0.2s;">All</button>
                                <!-- Filter buttons will be inserted here -->
                            </div>
                            <div id="changelogEntries" style="max-height: 400px; overflow-y: auto; padding-right: 5px;">
                                <!-- Changelog entries will be inserted here -->
                            </div>
                        </div>
                        <div id="changelogError" style="display: none; color: #ef4444; padding: 10px;">
                            Failed to load changelog
                        </div>
                    </div>
                </section>

                <!-- RSS Feeds -->
                <nav aria-label="RSS feed links">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üì° RSS Feeds</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;">
                            <a href="https://bun.com/rss.xml" target="_blank" style="color: #00ff88; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Bun RSS</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">bun.com/rss.xml</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="http://localhost:3001/api/rss.xml" target="_blank" style="color: #00ff88; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>NEXUS RSS</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">/api/rss.xml</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Bun APIs - Comprehensive Reference -->
                <nav aria-label="Bun API reference links">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üìñ Bun APIs Reference</h3>

                    <!-- HTTP & Networking -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #10b981; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(16, 185, 129, 0.3); padding-bottom: 5px;">üåê HTTP & Networking</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/http" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.serve()</a></li>
                            <li><a href="https://bun.com/docs/api/tcp" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.listen()</a></li>
                            <li><a href="https://bun.com/docs/api/tcp" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.connect()</a></li>
                            <li><a href="https://bun.com/docs/api/websockets" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.WebSocket</a></li>
                            <li><a href="https://bun.com/docs/api/udp" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.udpSocket()</a></li>
                            <li><a href="https://bun.com/docs/api/dns" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.dns</a></li>
                        </ul>
                    </div>

                    <!-- File I/O -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #f59e0b; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(245, 158, 11, 0.3); padding-bottom: 5px;">üìÅ File I/O</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/file-io" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.file()</a></li>
                            <li><a href="https://bun.com/docs/api/file-io" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.write()</a></li>
                            <li><a href="https://bun.com/docs/api/file-io" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.stdin</a></li>
                            <li><a href="https://bun.com/docs/api/file-io" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.stdout</a></li>
                            <li><a href="https://bun.com/docs/api/glob" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.Glob</a></li>
                            <li><a href="https://bun.com/docs/api/glob" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.globSync()</a></li>
                        </ul>
                    </div>

                    <!-- Database -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #8b5cf6; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(139, 92, 246, 0.3); padding-bottom: 5px;">üóÑÔ∏è Database</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/sqlite" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">bun:sqlite</a></li>
                            <li><a href="https://bun.com/docs/api/sql" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.SQL</a></li>
                            <li><a href="https://bun.com/blog/bun-v1.2#built-in-s3-client" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.S3Client</a></li>
                        </ul>
                    </div>

                    <!-- Hashing & Crypto -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #ef4444; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(239, 68, 68, 0.3); padding-bottom: 5px;">üîê Hashing & Crypto</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/hashing" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.hash()</a></li>
                            <li><a href="https://bun.com/docs/api/hashing" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.CryptoHasher</a></li>
                            <li><a href="https://bun.com/docs/api/hashing" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.password</a></li>
                            <li><a href="https://bun.com/docs/api/hashing" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.sha()</a></li>
                        </ul>
                    </div>

                    <!-- Compression -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #06b6d4; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(6, 182, 212, 0.3); padding-bottom: 5px;">üóúÔ∏è Compression</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.gzipSync()</a></li>
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.gunzipSync()</a></li>
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.deflateSync()</a></li>
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.inflateSync()</a></li>
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.zstdCompress()</a></li>
                            <li><a href="https://bun.com/docs/api/compression" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.zstdDecompress()</a></li>
                        </ul>
                    </div>

                    <!-- Process & Shell -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #ec4899; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(236, 72, 153, 0.3); padding-bottom: 5px;">‚öôÔ∏è Process & Shell</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/spawn" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.spawn()</a></li>
                            <li><a href="https://bun.com/docs/api/spawn" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.spawnSync()</a></li>
                            <li><a href="https://bun.com/docs/runtime/shell" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.$()</a></li>
                            <li><a href="https://bun.com/docs/api/spawn" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.which()</a></li>
                            <li><a href="https://bun.com/docs/runtime/env" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.env</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.argv</a></li>
                        </ul>
                    </div>

                    <!-- Utilities -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #84cc16; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(132, 204, 22, 0.3); padding-bottom: 5px;">üõ†Ô∏è Utilities</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.version</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.revision</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.nanoseconds()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.sleep()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.sleepSync()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.peek()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.inspect()</a></li>
                            <li><a href="../docs/7.0.0.0.0.0.0-CONSOLE-DEPTH-DEBUGGING.md" target="_blank" style="color: #00ff88; text-decoration: none; font-size: 0.9em;">--console-depth</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.deepEquals()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.escapeHTML()</a></li>
                            <li><a href="https://bun.com/docs/api/utils" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.stringWidth()</a></li>
                            <li><a href="https://bun.com/docs/api/semver" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.semver</a></li>
                            <li><a href="https://bun.com/docs/api/color" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.color()</a></li>
                        </ul>
                    </div>

                    <!-- Testing -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #14b8a6; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(20, 184, 166, 0.3); padding-bottom: 5px;">üß™ Testing</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/cli/test" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">bun:test</a></li>
                            <li><a href="https://bun.com/docs/cli/test" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">describe/it/expect</a></li>
                            <li><a href="https://bun.com/docs/cli/test" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">mock()</a></li>
                            <li><a href="https://bun.com/docs/cli/test" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">spyOn()</a></li>
                        </ul>
                    </div>

                    <!-- Bundler & Transpiler -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #f97316; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(249, 115, 22, 0.3); padding-bottom: 5px;">üì¶ Bundler & Transpiler</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/bundler" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.build()</a></li>
                            <li><a href="https://bun.com/docs/api/transpiler" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.Transpiler</a></li>
                            <li><a href="https://bun.com/docs/runtime/plugins" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">Bun.plugin()</a></li>
                            <li><a href="https://bun.com/docs/api/import-meta" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">import.meta</a></li>
                        </ul>
                    </div>

                    <!-- FFI & Native -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #a855f7; margin-bottom: 10px; font-size: 0.95em; border-bottom: 1px solid rgba(168, 85, 247, 0.3); padding-bottom: 5px;">üîå FFI & Native</h4>
                        <ul style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <li><a href="https://bun.com/docs/api/ffi" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">bun:ffi</a></li>
                            <li><a href="https://bun.com/docs/api/ffi" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">dlopen()</a></li>
                            <li><a href="https://bun.com/docs/api/ffi" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">JSCallback</a></li>
                            <li><a href="https://bun.com/docs/api/ffi" target="_blank" style="color: #00d4ff; text-decoration: none; font-size: 0.9em;">CString</a></li>
                        </ul>
                    </div>

                    <!-- Full Reference -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(102, 126, 234, 0.2);">
                        <a href="https://bun.com/docs/api" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600; font-size: 0.95em;">
                            üìö View Full Bun API Reference ‚Üí
                        </a>
                    </div>
                </nav>

                <!-- Security & Forensic Documentation -->
                <nav aria-label="Security and forensic documentation">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üõ°Ô∏è Security & Forensic</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/SECURITY-ARCHITECTURE.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Security Architecture</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/SECURITY-ARCHITECTURE.md</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/FORENSIC-LOGGING.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Forensic Logging</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/FORENSIC-LOGGING.md</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/FORENSIC-LOGGING-IMPROVEMENTS.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Forensic Improvements</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/FORENSIC-LOGGING-IMPROVEMENTS.md</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/BOOKMAKER-PROFILING.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>Bookmaker Profiling</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/BOOKMAKER-PROFILING.md</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/URL-PARSING-EDGE-CASE.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>URL Parsing Edge Case</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/URL-PARSING-EDGE-CASE.md</span>
                            </a>
                        </li>
                        <li style="margin-bottom: 10px;">
                            <a href="https://github.com/brendadeeznuts1111/trader-analyzer-bun/blob/main/docs/URL-ANOMALY-PATTERNS.md" target="_blank" style="color: #00d4ff; text-decoration: none; transition: color 0.2s; display: block;">
                                <strong>URL Anomaly Patterns</strong>
                                <span style="display: block; opacity: 0.7; font-size: 0.85em; margin-top: 2px;">docs/URL-ANOMALY-PATTERNS.md</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Footer Bottom -->
            <div style="text-align: center; padding-top: 20px; border-top: 1px solid rgba(102, 126, 234, 0.2); color: #9ca3af; font-size: 0.9em;">
                <p style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">NEXUS Trading Platform</strong> v1.0.0 | Built with Bun 1.3.x + Hono<br>
                    System Time: <span id="headerSystemTime">--:--:--</span> | Last Update: <span id="headerLastUpdate">Never</span><br>
                    <span style="font-size: 0.85em; opacity: 0.7;" id="headerTimezoneConstants">[$TZ][Etc/UTC][setSystemTime]</span>
                </p>
                <p style="margin-top: 10px; opacity: 0.7;">
                    System Time: <span id="footerSystemTime">--:--:--</span> | Last Update: <span id="footerLastUpdate">Never</span><br>
                    <span style="font-size: 0.85em;" id="footerTimezoneConstants">[$TZ][Etc/UTC][setSystemTime]</span>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Update footer and header time displays
        function updateFooterTimes() {
            // Safely call updateHeaderTime if it exists (defined in main script block)
            try {
                if (typeof window.updateHeaderTime === 'function') {
                    window.updateHeaderTime(); // Also update header
                } else if (typeof updateHeaderTime === 'function') {
                    updateHeaderTime(); // Fallback to global scope
                }
            } catch (e) {
                // updateHeaderTime not available yet, skip
                console.debug('updateHeaderTime not available:', e);
            }

            // Safely call formatSystemTime if it exists
            let timeStr;
            try {
                if (typeof formatSystemTime === 'function') {
                    timeStr = formatSystemTime();
                } else {
                    timeStr = new Date().toLocaleTimeString();
                }
            } catch (e) {
                timeStr = new Date().toLocaleTimeString();
            }

            const footerSystemTime = document.getElementById('footerSystemTime');
            if (footerSystemTime) {
                footerSystemTime.textContent = timeStr;
            }

            const footerLastUpdate = document.getElementById('footerLastUpdate');
            if (footerLastUpdate) {
                // Prefer headerLastUpdate if available (it's updated by updateLastUpdate())
                const headerLastUpdateEl = document.getElementById('headerLastUpdate');
                const lastUpdateEl = document.getElementById('lastUpdate');
                if (headerLastUpdateEl && headerLastUpdateEl.textContent !== 'Never') {
                    footerLastUpdate.textContent = headerLastUpdateEl.textContent;
                } else if (lastUpdateEl && lastUpdateEl.textContent !== 'Never') {
                    footerLastUpdate.textContent = lastUpdateEl.textContent;
                } else {
                    // Use current time as fallback
                    footerLastUpdate.textContent = timeStr;
                }
            }

            // Update timezone constants in headers/footers
            try {
                if (window.timezoneUtils && typeof window.timezoneUtils.updateTimezoneConstantsDisplay === 'function') {
                    window.timezoneUtils.updateTimezoneConstantsDisplay();
                } else {
                    // Fallback: Update timezone constants manually using browser detection
                    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const tzEnv = 'TZ'; // Environment variable name (we can't read it in browser)
                    const defaultTz = tz || 'Etc/UTC';
                    const setSystemTimeAvailable = typeof Bun !== 'undefined' && Bun.setSystemTime ? 'setSystemTime' : 'setSystemTime (N/A)';
                    const tzDisplay = `[$${tzEnv}][${defaultTz}][${setSystemTimeAvailable}]`;

                    const headerTzEl = document.getElementById('headerTimezoneConstants');
                    const footerTzEl = document.getElementById('footerTimezoneConstants');
                    if (headerTzEl) {
                        headerTzEl.textContent = tzDisplay;
                    }
                    if (footerTzEl) {
                        footerTzEl.textContent = tzDisplay;
                    }
                }
            } catch (e) {
                console.debug('Timezone constants update failed:', e);
            }
        }

        // Update footer times every second (wait for DOM and other scripts to load)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    setInterval(updateFooterTimes, 1000);
                    updateFooterTimes();
                }, 100);
            });
        } else {
            setTimeout(() => {
                setInterval(updateFooterTimes, 1000);
                updateFooterTimes();
            }, 100);
        }

        // Update timezone on load and every minute (if function exists)
        if (typeof updateTimezone === 'function') {
            updateTimezone();
            setInterval(updateTimezone, 60000);
        }

        // Initial load - refreshAll is called elsewhere
    </script>

    <!-- Mermaid diagram library - loaded at end of body to prevent execution context errors -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        // Initialize mermaid after DOM is fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeMermaid);
        } else {
            initializeMermaid();
        }

        function initializeMermaid() {
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: 'dark',
                    themeVariables: {
                        primaryColor: '#667eea',
                        primaryTextColor: '#e0e0e0',
                        primaryBorderColor: '#5568d3',
                        lineColor: '#667eea',
                        secondaryColor: '#10b981',
                        tertiaryColor: '#f59e0b',
                        background: '#1a1f3a',
                        mainBkg: '#1a1f3a',
                        secondBkg: '#0a0e27',
                        textColor: '#e0e0e0',
                        border1: '#667eea',
                        border2: '#10b981',
                        noteBkgColor: '#1a1f3a',
                        noteTextColor: '#e0e0e0',
                        noteBorderColor: '#667eea'
                    }
                });
            }
        }

        // 14.3.6.0.0.0.0: Client-Side UI Interaction in TMUX Environment
        // Example: Activate team tab based on team name matching
        // This demonstrates interactive navigation of multi-team dashboards without page reloads
        function activateTeamTab(teamName) {
            const tabs = document.querySelectorAll('.team-tab');
            const targetIndex = Array.from(tabs).findIndex(t => 
                t.textContent?.toLowerCase().includes(teamName.toLowerCase())
            );
            
            if (targetIndex !== -1 && tabs[targetIndex + 1]) {
                // Activate adjacent tab (e.g., data view tab)
                tabs[targetIndex + 1].classList.add('active');
                
                // Trigger RSS feed update for the team
                const teamId = window.HYPERBUN_UI_CONTEXT?.teams?.find(
                    t => t.name.toLowerCase().includes(teamName)
                )?.id;
                
                if (teamId && window.HYPERBUN_RSS_BRIDGE) {
                    window.HYPERBUN_RSS_BRIDGE.queryTeamFeed(teamId);
                }
            }
        }

        // Initialize HYPERBUN_UI_CONTEXT if not present (for testing)
        if (!window.HYPERBUN_UI_CONTEXT) {
            window.HYPERBUN_UI_CONTEXT = {
                teams: [
                    { id: 'sports-correlation', name: 'Sports Correlation' },
                    { id: 'market-analytics', name: 'Market Analytics' },
                    { id: 'platform-tools', name: 'Platform & Tools' }
                ]
            };
        }

        // Expose activateTeamTab globally for REPL/testing
        window.activateTeamTab = activateTeamTab;
    </script>
</body>
</html>

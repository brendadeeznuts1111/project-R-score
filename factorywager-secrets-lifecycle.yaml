version: '5.1'
rules:
  - key: "API_KEY_V3"
    schedule:
      type: "cron"
      cron: "0 0 1 * *"  # Monthly rotation
    action: "rotate"
    metadata:
      severity: "HIGH"
      notify: ["slack#security", "email#admins"]
      documentation: "https://bun.com/docs/runtime/secrets#lifecycle-management"

  - key: "DATABASE_URL"
    schedule:
      type: "interval"
      intervalMs: 2592000000  # 30 days
    action: "rotate"
    preCheck: "test-connection"
    postCheck: "verify-migration"

  - key: "JWT_SECRET"
    expiration:
      days: 90
      warningDays: 7
    action: "rotate"
    rotateOnWarning: true

  - key: "R2_ACCESS_KEY"
    schedule:
      type: "event"
      event: "iam-role-update"
    action: "rotate"

audit:
  enabled: true
  retentionDays: 365
  visualMetadata: true
  r2Bucket: "factorywager-secrets-audit"

documentation:
  autoGenerate: true
  includeInAudit: true
  domains: ["com", "sh"]

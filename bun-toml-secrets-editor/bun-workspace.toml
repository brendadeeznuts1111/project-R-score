# Bun Workspace Configuration
# Emergency separation to fix architectural debt

[workspace]
members = [
    "packages/core",
    "packages/profiler", 
    "packages/rss",
    "packages/logger",
    "packages/cli",
    "packages/secrets-editor",
    "apps/*",
    "."
]

# Hoist common dependencies to root
hoist = true

# Cache configuration
cache = true

[workspace.dependencies]
# Shared dependencies across all packages
"fast-xml-parser" = "5.3.3"
"mitata" = "1.0.34"

[workspace.dev-dependencies]
"bun-types" = "1.3.7"
"typescript" = "5.9.3"

# Package-specific overrides
[packages.core]
publish = false

[packages.profiler]
publish = false

[packages.rss]
publish = false
# RSS package needs specific Node.js compat
node_compat = true

[packages.logger]
publish = false

[packages.cli]
publish = false

[packages.secrets-editor]
publish = false

[install]
# Save exact versions for reproducibility
exact = true

# Don't install optional deps unless needed
optional = false

# Registry configuration
registry = "https://registry.npmjs.org/"

# Lockfile configuration
lockfile = true

# Cache directory
cache-dir = ".bun-cache"

[build]
# Default build target
target = "bun"

# Minification in production
minify = false

# Source maps
sourcemap = true

# External dependencies (don't bundle)
external = [
    "node:*",
    "bun:*"
]

[test]
# Default test configuration
preload = ["./tests/setup.ts"]

# Coverage configuration
coverage = true
coverage-dir = "./coverage"

# Test timeout
timeout = 30000

# Retry failed tests
retry = 3

[run]
# Default script configuration
shell = "bash"

# Environment variables
[run.env]
NODE_ENV = "development"
DEBUG = "false"
LOG_LEVEL = "info"

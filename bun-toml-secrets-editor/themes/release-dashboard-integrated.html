<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Profiling System | Release Theme Dashboard</title>
    <link rel="stylesheet" href="release-theme.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: var(--space-4);
        }
        
        .action-button {
            background: var(--primary-600);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-6);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--duration-300) var(--ease-out);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .action-button:hover {
            background: var(--primary-700);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }
        
        .action-button.success {
            background: var(--success-600);
        }
        
        .action-button.success:hover {
            background: var(--success-700);
        }
        
        .action-button.warning {
            background: var(--warning-600);
        }
        
        .action-button.warning:hover {
            background: var(--warning-700);
        }
        
        .action-button.danger {
            background: var(--error-600);
        }
        
        .action-button.danger:hover {
            background: var(--error-700);
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            display: inline-block;
            margin-right: var(--space-2);
        }
        
        .status-indicator.online {
            background: var(--success-500);
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: var(--error-500);
        }
        
        .status-indicator.warning {
            background: var(--warning-500);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- üåä Floating Background Elements -->
    <div class="floating-elements">
        <div class="floating-element" style="left: 10%; animation-delay: 0s;"></div>
        <div class="floating-element" style="left: 25%; animation-delay: 3s;"></div>
        <div class="floating-element" style="left: 40%; animation-delay: 6s;"></div>
        <div class="floating-element" style="left: 60%; animation-delay: 9s;"></div>
        <div class="floating-element" style="left: 75%; animation-delay: 12s;"></div>
        <div class="floating-element" style="left: 90%; animation-delay: 15s;"></div>
    </div>

    <div class="release-container">
        <!-- üéØ Header -->
        <header class="release-header">
            <h1 class="release-title">üöÄ Profiling System Dashboard</h1>
            <p class="release-subtitle">Enterprise-grade performance monitoring with Bun v1.3.7 integration</p>
            
            <!-- üìä Real-time Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="cpu-usage">0%</div>
                    <div class="metric-label">CPU Usage</div>
                    <div class="metric-change positive" id="cpu-change">‚Üì 2.3%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="memory-usage">0MB</div>
                    <div class="metric-label">Memory Used</div>
                    <div class="metric-change positive" id="memory-change">‚Üì 125MB</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="active-profiles">0</div>
                    <div class="metric-label">Active Profiles</div>
                    <div class="metric-change positive" id="profiles-change">‚Üí 0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="response-time">0ms</div>
                    <div class="metric-label">Response Time</div>
                    <div class="metric-change positive" id="response-change">‚Üì 45ms</div>
                </div>
            </div>
        </header>

        <!-- üö® Alert Banner -->
        <div class="alert-banner" id="alert-banner" style="display: none;">
            <div class="alert-icon">!</div>
            <div class="alert-content">
                <div class="alert-title" id="alert-title">System Alert</div>
                <div class="alert-message" id="alert-message">Monitoring system performance...</div>
            </div>
        </div>

        <!-- üåä Wave Animation -->
        <div class="wave-container">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>

        <!-- üìä Charts and Analytics -->
        <main class="release-grid">
            <!-- üìà Performance Chart -->
            <article class="release-card" style="grid-column: span 2;">
                <div class="feature-icon cpu">üìà</div>
                <h3 class="feature-title">Performance Trends</h3>
                <p class="feature-description">Real-time system performance metrics and historical trends analysis.</p>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </article>

            <!-- üß† Memory Analysis -->
            <article class="release-card">
                <div class="feature-icon memory">üß†</div>
                <h3 class="feature-title">Memory Analysis</h3>
                <p class="feature-description">Memory usage patterns, leak detection, and optimization recommendations.</p>
                <div class="chart-container">
                    <canvas id="memoryChart"></canvas>
                </div>
            </article>

            <!-- üö® Alert Management -->
            <article class="release-card">
                <div class="feature-icon alert">üö®</div>
                <h3 class="feature-title">System Alerts</h3>
                <p class="feature-description">Real-time alerts and notifications for system anomalies and performance issues.</p>
                <div id="alerts-list" style="max-height: 200px; overflow-y: auto;">
                    <p style="color: var(--dark-text-secondary);">No active alerts</p>
                </div>
            </article>

            <!-- üéØ Quick Actions -->
            <article class="release-card">
                <div class="feature-icon success">üéØ</div>
                <h3 class="feature-title">Quick Actions</h3>
                <p class="feature-description">Execute common profiling and monitoring tasks instantly.</p>
                <div style="display: flex; flex-wrap: wrap; gap: var(--space-3); margin-top: var(--space-4);">
                    <button class="action-button" onclick="startCPUProfile()">
                        üî• CPU Profile
                    </button>
                    <button class="action-button success" onclick="startHeapProfile()">
                        üß† Heap Profile
                    </button>
                    <button class="action-button warning" onclick="startAdaptiveProfile()">
                        üéØ Adaptive
                    </button>
                    <button class="action-button danger" onclick="clearAlerts()">
                        üóëÔ∏è Clear Alerts
                    </button>
                </div>
            </article>

            <!-- üìä System Status -->
            <article class="release-card">
                <div class="feature-icon network">üìä</div>
                <h3 class="feature-title">System Status</h3>
                <p class="feature-description">Overall system health and component status monitoring.</p>
                <div style="margin-top: var(--space-4);">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>Profiler Service</span>
                        <span><span class="status-indicator online"></span> Online</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>Memory Guardian</span>
                        <span><span class="status-indicator online"></span> Active</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>Alert System</span>
                        <span><span class="status-indicator warning"></span> Monitoring</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0;">
                        <span>Database</span>
                        <span><span class="status-indicator online"></span> Connected</span>
                    </div>
                </div>
            </article>

            <!-- üåç API Status -->
            <article class="release-card">
                <div class="feature-icon success">üåç</div>
                <h3 class="feature-title">API Status</h3>
                <p class="feature-description">API endpoints health and response time monitoring.</p>
                <div style="margin-top: var(--space-4);">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>/api/v1/metrics</span>
                        <span><span class="status-indicator online"></span> 45ms</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>/api/v1/alerts</span>
                        <span><span class="status-indicator online"></span> 32ms</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0; border-bottom: 1px solid var(--dark-border);">
                        <span>/api/v1/profile</span>
                        <span><span class="status-indicator online"></span> 78ms</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-2) 0;">
                        <span>/api/v1/health</span>
                        <span><span class="status-indicator online"></span> 12ms</span>
                    </div>
                </div>
            </article>
        </main>

        <!-- üéØ Footer Stats -->
        <footer class="release-header" style="margin-top: var(--space-8);">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">22</div>
                    <div class="metric-label">Files Added</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">6.3k</div>
                    <div class="metric-label">Lines of Code</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">v1.3.7</div>
                    <div class="metric-label">Bun Version</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">100%</div>
                    <div class="metric-label">Test Coverage</div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // üöÄ Enhanced Release Dashboard
        class ReleaseDashboard {
            constructor() {
                this.metrics = {
                    cpu: 0,
                    memory: 0,
                    activeProfiles: 0,
                    responseTime: 0
                };
                this.charts = {};
                this.init();
            }

            init() {
                this.initializeCharts();
                this.startRealTimeUpdates();
                this.setupEventListeners();
                this.animateProgressBars();
                this.initializeMetrics();
            }

            initializeMetrics() {
                this.updateMetrics({
                    cpu: Math.random() * 30 + 20,
                    memory: Math.random() * 200 + 400,
                    activeProfiles: Math.floor(Math.random() * 5),
                    responseTime: Math.random() * 50 + 20
                });
            }

            initializeCharts() {
                // Performance Chart
                const perfCtx = document.getElementById('performanceChart').getContext('2d');
                this.charts.performance = new Chart(perfCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 10}, (_, i) => `${i * 2}s`),
                        datasets: [{
                            label: 'CPU Usage',
                            data: Array.from({length: 10}, () => Math.random() * 40 + 20),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Memory Usage',
                            data: Array.from({length: 10}, () => Math.random() * 200 + 400),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#cbd5e1' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#94a3b8' },
                                grid: { color: '#475569' }
                            },
                            y: {
                                ticks: { color: '#94a3b8' },
                                grid: { color: '#475569' }
                            }
                        }
                    }
                });

                // Memory Chart
                const memCtx = document.getElementById('memoryChart').getContext('2d');
                this.charts.memory = new Chart(memCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Used', 'Free', 'Cached'],
                        datasets: [{
                            data: [45, 30, 25],
                            backgroundColor: ['#ef4444', '#22c55e', '#3b82f6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#cbd5e1' }
                            }
                        }
                    }
                });
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.fetchMetrics();
                    this.updateCharts();
                }, 2000);

                setInterval(() => {
                    this.checkAlerts();
                }, 5000);
            }

            async fetchMetrics() {
                try {
                    const response = await fetch('/api/v1/metrics');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            this.updateMetrics(data.data);
                        }
                    }
                } catch (_error) {
                    this.simulateMetricsUpdate();
                }
            }

            simulateMetricsUpdate() {
                this.updateMetrics({
                    cpu: Math.max(0, Math.min(100, this.metrics.cpu + (Math.random() - 0.5) * 10)),
                    memory: Math.max(0, this.metrics.memory + (Math.random() - 0.5) * 50),
                    activeProfiles: Math.max(0, Math.floor(this.metrics.activeProfiles + (Math.random() - 0.5) * 2)),
                    responseTime: Math.max(0, Math.min(1000, this.metrics.responseTime + (Math.random() - 0.5) * 20))
                });
            }

            updateMetrics(data) {
                // Update CPU
                const cpuElement = document.getElementById('cpu-usage');
                const cpuChange = document.getElementById('cpu-change');
                const oldCpu = this.metrics.cpu;
                this.metrics.cpu = data.cpu || this.metrics.cpu;
                cpuElement.textContent = `${Math.round(this.metrics.cpu)}%`;
                this.updateChangeIndicator(cpuChange, oldCpu, this.metrics.cpu, '%');

                // Update Memory
                const memoryElement = document.getElementById('memory-usage');
                const memoryChange = document.getElementById('memory-change');
                const oldMemory = this.metrics.memory;
                this.metrics.memory = data.memory || this.metrics.memory;
                memoryElement.textContent = `${Math.round(this.metrics.memory)}MB`;
                this.updateChangeIndicator(memoryChange, oldMemory, this.metrics.memory, 'MB');

                // Update Active Profiles
                const profilesElement = document.getElementById('active-profiles');
                const profilesChange = document.getElementById('profiles-change');
                const oldProfiles = this.metrics.activeProfiles;
                this.metrics.activeProfiles = data.activeProfiles || this.metrics.activeProfiles;
                profilesElement.textContent = this.metrics.activeProfiles;
                this.updateChangeIndicator(profilesChange, oldProfiles, this.metrics.activeProfiles, '');

                // Update Response Time
                const responseElement = document.getElementById('response-time');
                const responseChange = document.getElementById('response-change');
                const oldResponse = this.metrics.responseTime;
                this.metrics.responseTime = data.responseTime || this.metrics.responseTime;
                responseElement.textContent = `${Math.round(this.metrics.responseTime)}ms`;
                this.updateChangeIndicator(responseChange, oldResponse, this.metrics.responseTime, 'ms');
            }

            updateChangeIndicator(element, oldValue, newValue, unit) {
                const diff = newValue - oldValue;
                const absDiff = Math.abs(diff);
                
                if (absDiff < 0.1) {
                    element.textContent = `‚Üí 0${unit}`;
                    element.className = 'metric-change positive';
                } else if (diff > 0) {
                    element.textContent = `‚Üë ${absDiff.toFixed(1)}${unit}`;
                    element.className = 'metric-change negative';
                } else {
                    element.textContent = `‚Üì ${absDiff.toFixed(1)}${unit}`;
                    element.className = 'metric-change positive';
                }
            }

            updateCharts() {
                // Update performance chart
                if (this.charts.performance) {
                    const perfData = this.charts.performance.data;
                    perfData.labels.shift();
                    perfData.labels.push(`${Date.now() / 1000}s`);
                    
                    perfData.datasets[0].data.shift();
                    perfData.datasets[0].data.push(this.metrics.cpu);
                    
                    perfData.datasets[1].data.shift();
                    perfData.datasets[1].data.push(this.metrics.memory / 10);
                    
                    this.charts.performance.update('none');
                }

                // Update memory chart
                if (this.charts.memory) {
                    const totalMemory = 1024;
                    const usedMemory = this.metrics.memory;
                    const freeMemory = Math.max(0, totalMemory - usedMemory - 200);
                    const cachedMemory = 200;
                    
                    this.charts.memory.data.datasets[0].data = [usedMemory, freeMemory, cachedMemory];
                    this.charts.memory.update('none');
                }
            }

            checkAlerts() {
                if (this.metrics.cpu > 80) {
                    this.showAlert('High CPU Usage', `CPU usage is at ${Math.round(this.metrics.cpu)}%`);
                } else if (this.metrics.memory > 800) {
                    this.showAlert('High Memory Usage', `Memory usage is at ${Math.round(this.metrics.memory)}MB`);
                } else if (this.metrics.responseTime > 500) {
                    this.showAlert('Slow Response', `Response time is ${Math.round(this.metrics.responseTime)}ms`);
                } else {
                    this.hideAlert();
                }
            }

            showAlert(title, message) {
                const banner = document.getElementById('alert-banner');
                const titleElement = document.getElementById('alert-title');
                const messageElement = document.getElementById('alert-message');
                
                titleElement.textContent = title;
                messageElement.textContent = message;
                banner.style.display = 'flex';
            }

            hideAlert() {
                const banner = document.getElementById('alert-banner');
                banner.style.display = 'none';
            }

            setupEventListeners() {
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'r' && e.ctrlKey) {
                        e.preventDefault();
                        this.fetchMetrics();
                    }
                    if (e.key === 'h') {
                        this.hideAlert();
                    }
                });
            }

            animateProgressBars() {
                document.querySelectorAll('.progress-fill').forEach((bar, index) => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100 * index);
                });
            }
        }

        // üöÄ Global Functions for Buttons
        async function _startCPUProfile() {
            try {
                const response = await fetch('/api/v1/profile/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'cpu', duration: 30000 })
                });
                const data = await response.json();
                if (data.success) {
                    console.log('CPU Profile started:', data.data.profileId);
                }
            } catch (error) {
                console.error('Failed to start CPU profile:', error);
            }
        }

        async function _startHeapProfile() {
            try {
                const response = await fetch('/api/v1/profile/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'heap', duration: 30000 })
                });
                const data = await response.json();
                if (data.success) {
                    console.log('Heap Profile started:', data.data.profileId);
                }
            } catch (error) {
                console.error('Failed to start heap profile:', error);
            }
        }

        async function _startAdaptiveProfile() {
            try {
                const response = await fetch('/api/v1/profile/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'adaptive', duration: 60000 })
                });
                const data = await response.json();
                if (data.success) {
                    console.log('Adaptive Profile started:', data.data.profileId);
                }
            } catch (error) {
                console.error('Failed to start adaptive profile:', error);
            }
        }

        function _clearAlerts() {
            const alertsList = document.getElementById('alerts-list');
            alertsList.innerHTML = '<p style="color: var(--dark-text-secondary);">No active alerts</p>';
            document.querySelector('.release-dashboard').hideAlert();
        }

        // üöÄ Initialize Dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new ReleaseDashboard();
        });
    </script>
</body>
</html>

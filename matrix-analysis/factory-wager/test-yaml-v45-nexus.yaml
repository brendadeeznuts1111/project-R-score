---
# Document 1: Infrastructure Nexus Metadata
_document_index: 0
_schema_version: v4.5
_source_format: yaml_multi_doc

author: &author_nola nolarose
author_email: nolarose@factory-wager.internal
author_hash: a3f7b2d1
created: &created_ts 2026-02-01T08:14:00-06:00

version: &ver v4.5.0
bun: &bun_ver 1.3.8
bun_engine: ">=1.3.8"

status: active
visibility: public
draft: false

# Infrastructure Nexus Configuration
name: factory-wager-core
registry: factory-wager.packages
r2_bucket: factory-wager-docs
domain_endpoint: api.factory-wager.internal

tags: &common_tags ["api", "cli", "registry", "nexus", "yaml-native"]
features: &features
  hot_reload: true
  yaml_import: true
  multi_doc: true
  interpolation: true
  nexus_integration: true
  smart_truncation: true

anchors:
  - &primary_color "hsl(220, 90%, 60%)"
  - &success_color "hsl(145, 80%, 45%)"
  - &danger_color "hsl(10, 90%, 55%)"
  - &nexus_color "hsl(160, 60%, 50%)"

---
# Document 2: Runtime Configuration with Nexus
_document_index: 1
is_config: true

theme_primary: *primary_color
theme_success: *success_color
created: *created_ts
version: *ver
tags: *common_tags
author: *author_nola

# Environment interpolation with defaults
registry_token: ${FW_REGISTRY_TOKEN:-dev_default}
r2_endpoint: ${R2_ENDPOINT:-https://localhost:8787}
log_level: ${LOG_LEVEL:-debug}
nexus_api_key: ${NEXUS_API_KEY}

# Infrastructure server configuration
server:
  port: 3000
  host: localhost
  ssl: &ssl_config
    cert: ${SSL_CERT_PATH}
    key: ${SSL_KEY_PATH}
  nexus:
    enabled: true
    registry_url: https://registry.factory-wager.internal
    r2_bucket: factory-wager-docs
    health_check: /health

# Deep nesting for depth testing
database:
  primary:
    connection:
      host: ${DB_HOST:-localhost}
      port: 5432
      ssl:
        enabled: true
        cert_path: ${DB_SSL_CERT}
    pools:
      read:
        size: 10
        timeout: 30
      write:
        size: 5
        timeout: 15

---
# Document 3: Feature Flags with Nexus Integration
_document_index: 2
is_feature_flags: true

flags:
  nexus_integration:
    enabled: true
    rollout: ${ROLLOUT_PCT:-100}
    users: ${BETA_USERS:-[]}
    registry_sync: true
  smart_truncation:
    enabled: true
    max_length: 28
    indicator: "..."
  real_time_sync:
    enabled: false
    websocket_url: ${WS_URL:-ws://localhost:3001}
    buffer_size: 1000

# Monitoring and metrics
monitoring:
  metrics:
    enabled: true
    endpoint: /metrics
    registry_stats: true
  alerts:
    email: ${ALERT_EMAIL:-admin@factory-wager.internal}
    slack_webhook: ${SLACK_WEBHOOK}
    thresholds:
      error_rate: 0.05
      response_time: 500

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnePay Enterprise Dashboard - Real-time Compliance & Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <!-- WindSurf Keyboard Shortcuts Integration -->
    <script src="shortcuts.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        @keyframes pulse-red {
            0%, 100% { background-color: rgb(239 68 68); }
            50% { background-color: rgb(220 38 38); }
        }
        @keyframes pulse-yellow {
            0%, 100% { background-color: rgb(250 204 21); }
            50% { background-color: rgb(234 179 8); }
        }
        @keyframes pulse-green {
            0%, 100% { background-color: rgb(34 197 94); }
            50% { background-color: rgb(22 163 74); }
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .alert-critical { animation: pulse-red 2s infinite; }
        .alert-warning { animation: pulse-yellow 2s infinite; }
        .alert-success { animation: pulse-green 2s infinite; }
        .metric-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            backdrop-filter: blur(10px);
        }
        .metric-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
        }
        .gdpr-compliant { border-left: 4px solid rgb(34 197 94); }
        .gdpr-at-risk { border-left: 4px solid rgb(250 204 21); }
        .gdpr-non-compliant { border-left: 4px solid rgb(239 68 68); }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: relative;
        }
        .status-indicator::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            opacity: 0.3;
            animation: ping 2s infinite;
        }
        .dark-mode {
            background: #0f172a;
            color: #e2e8f0;
        }
        .dark-mode .glass-effect {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col space-y-3">
        <!-- Enhanced Action Buttons -->
        <div class="flex items-center space-x-3">
            <!-- Dark Mode Toggle with Enhanced Feedback -->
            <button onclick="toggleDarkMode()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Toggle Dark Mode">
                <i class="fas fa-moon text-gray-700 transition-transform duration-300 group-hover:rotate-12" id="dark-mode-icon"></i>
                <span class="absolute -top-1 -right-1 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
            </button>
            
            <!-- Export Data with Multiple Options -->
            <div class="relative">
                <button onclick="toggleExportMenu()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Export Data">
                    <i class="fas fa-download text-blue-600 transition-transform duration-300 group-hover:scale-110"></i>
                    <span class="absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                </button>
                
                <!-- Export Dropdown Menu -->
                <div id="export-menu" class="hidden absolute top-full right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 z-50">
                    <button onclick="exportData()" class="w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2">
                        <i class="fas fa-file-export text-blue-600"></i>
                        <span>Export JSON</span>
                    </button>
                    <button onclick="exportCharts()" class="w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2">
                        <i class="fas fa-chart-line text-green-600"></i>
                        <span>Export Charts</span>
                    </button>
                    <button onclick="exportMetrics()" class="w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors duration-200 flex items-center space-x-2">
                        <i class="fas fa-tachometer-alt text-purple-600"></i>
                        <span>Export Metrics</span>
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Refresh with Status Indicator -->
            <button onclick="refreshDashboard()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Refresh Dashboard">
                <i class="fas fa-sync-alt text-green-600 transition-transform duration-300 group-hover:rotate-180" id="refresh-icon"></i>
                <span class="absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse" id="refresh-status"></span>
            </button>
            
            <!-- New: Settings Button -->
            <button onclick="openSettings()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Settings">
                <i class="fas fa-cog text-gray-600 transition-transform duration-300 group-hover:rotate-90"></i>
                <span class="absolute -top-1 -right-1 w-2 h-2 bg-yellow-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
            </button>
            
            <!-- New: Depth Control Button -->
            <button onclick="toggleDepthControl()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Depth Control">
                <i class="fas fa-layer-group text-indigo-600 transition-transform duration-300 group-hover:scale-110"></i>
                <span class="absolute -top-1 -right-1 w-3 h-3 bg-indigo-500 rounded-full text-white text-xs flex items-center justify-center font-bold" id="depth-badge">3</span>
            </button>
            
            <!-- New: Notifications Button -->
            <button onclick="toggleNotifications()" class="bg-white shadow-lg rounded-full p-3 hover:shadow-xl transition-all duration-300 tooltip relative group" data-tooltip="Notifications">
                <i class="fas fa-bell text-orange-600 transition-transform duration-300 group-hover:scale-110"></i>
                <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full text-white text-xs flex items-center justify-center" id="notification-badge">3</span>
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-xl relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="container mx-auto px-6 py-6 relative z-10">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="relative">
                        <i class="fas fa-shield-alt text-4xl"></i>
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight">OnePay Enterprise Dashboard</h1>
                        <p class="text-sm opacity-90 mt-1">Real-time Compliance & Performance Monitoring</p>
                        <div class="flex items-center space-x-4 mt-2 text-xs">
                            <span class="opacity-75">Last Updated: <span id="last-updated">Just now</span></span>
                            <span class="opacity-75">‚Ä¢</span>
                            <span class="opacity-75">Version 3.6.0</span>
                            <span class="opacity-75">‚Ä¢</span>
                            <span class="opacity-75">Environment: <span class="text-green-300">Production</span></span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="text-right">
                        <p class="text-sm opacity-90">System Status</p>
                        <div class="flex items-center space-x-2">
                            <p class="font-semibold text-lg transition-all duration-300" id="overall-status">HEALTHY</p>
                            <button onclick="toggleStatusDetails()" class="text-xs opacity-75 hover:opacity-100 transition-opacity cursor-pointer" title="Click for details">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <p class="text-xs opacity-75 mt-1">Uptime: <span id="uptime-percentage">99.9</span>%</p>
                    </div>
                    <div class="status-indicator bg-green-400 w-3 h-3 rounded-full animate-pulse" id="status-indicator"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Quick Actions Bar -->
        <section class="mb-8 animate-fade-in">
            <div class="glass-effect rounded-xl shadow-lg p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-lg font-semibold text-gray-800">Quick Actions</h3>
                        <div class="flex space-x-2">
                            <button onclick="runComplianceCheck()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                <i class="fas fa-shield-alt mr-2"></i>Run Compliance Check
                            </button>
                            <button onclick="generateReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                                <i class="fas fa-file-alt mr-2"></i>Generate Report
                            </button>
                            <button onclick="viewLogs()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                <i class="fas fa-list mr-2"></i>View Logs
                            </button>
                            <button onclick="showTelemetryViewer()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm">
                                <i class="fas fa-chart-line mr-2"></i>Telemetry
                            </button>
                            <button onclick="demonstrateStreamingDemo()" class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors text-sm">
                                <i class="fas fa-stream mr-2"></i>Streaming Demo
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-keyboard mr-2"></i>
                            Press <kbd class="px-2 py-1 bg-gray-200 rounded">Ctrl+R</kbd> to refresh
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Status Overview -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">System Health Overview</h2>
                <button onclick="toggleAutoRefresh()" class="text-sm text-blue-600 hover:text-blue-800">
                    <i class="fas fa-sync-alt mr-1"></i>
                    Auto-refresh: <span id="auto-refresh-status">ON</span>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Overall Status -->
                <div class="metric-card glass-effect rounded-xl shadow-lg p-6 animate-fade-in" id="overall-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <i class="fas fa-heartbeat text-3xl text-blue-500"></i>
                            <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-500 bg-blue-50 px-2 py-1 rounded">Overall</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="overall-health">HEALTHY</h3>
                    <p class="text-sm text-gray-600 mt-1">System Status</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Response Time</span>
                            <span class="font-semibold">2.3s</span>
                        </div>
                    </div>
                </div>

                <!-- GDPR Status -->
                <div class="metric-card glass-effect rounded-xl shadow-lg p-6 gdpr-compliant animate-fade-in" id="gdpr-card" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <i class="fas fa-shield-alt text-3xl text-green-500"></i>
                            <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-500 bg-green-50 px-2 py-1 rounded">GDPR</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="gdpr-health">COMPLIANT</h3>
                    <p class="text-sm text-gray-600 mt-1">Privacy Status</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Consent Rate</span>
                            <span class="font-semibold text-green-600">85%</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Status -->
                <div class="metric-card glass-effect rounded-xl shadow-lg p-6 animate-fade-in" id="performance-card" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <i class="fas fa-tachometer-alt text-3xl text-purple-500"></i>
                            <div class="absolute -top-1 -right-1 w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-500 bg-purple-50 px-2 py-1 rounded">Performance</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="performance-health">OPTIMAL</h3>
                    <p class="text-sm text-gray-600 mt-1">System Speed</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Throughput</span>
                            <span class="font-semibold text-purple-600">1.2k req/h</span>
                        </div>
                    </div>
                </div>

                <!-- Security Status -->
                <div class="metric-card glass-effect rounded-xl shadow-lg p-6 animate-fade-in" id="security-card" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="relative">
                            <i class="fas fa-lock text-3xl text-red-500"></i>
                            <div class="absolute -top-1 -right-1 w-2 h-2 bg-red-400 rounded-full animate-pulse"></div>
                        </div>
                        <span class="text-sm font-medium text-gray-500 bg-red-50 px-2 py-1 rounded">Security</span>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="security-health">SECURE</h3>
                    <p class="text-sm text-gray-600 mt-1">Threat Level</p>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Active Threats</span>
                            <span class="font-semibold text-red-600">3</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Key Metrics -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Key Performance Metrics</h2>
                <div class="flex space-x-2">
                    <button onclick="toggleMetricsView()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-chart-bar mr-1"></i>
                        <span id="metrics-view-text">Detailed View</span>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- GDPR Metrics -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-user-shield mr-3 text-green-500"></i>
                        GDPR Compliance
                        <span class="ml-auto text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Live</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Consent Rate</span>
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold text-green-600" id="consent-rate">85%</span>
                                <i class="fas fa-arrow-up text-xs text-green-500"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500" id="consent-bar" style="width: 85%"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 pt-2">
                            <div class="text-center p-2 bg-blue-50 rounded">
                                <p class="text-xs text-gray-600">Data Exports</p>
                                <p class="font-semibold text-blue-600" id="data-exports">0</p>
                            </div>
                            <div class="text-center p-2 bg-purple-50 rounded">
                                <p class="text-xs text-gray-600">Auto-Deletions</p>
                                <p class="font-semibold text-purple-600" id="auto-deletions">0</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t">
                            <span class="text-sm text-gray-600">User Objections</span>
                            <span class="font-semibold text-yellow-600" id="objections">0</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-rocket mr-3 text-purple-500"></i>
                        Performance
                        <span class="ml-auto text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">Real-time</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Approval Rate</span>
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold text-purple-600" id="approval-rate">95%</span>
                                <i class="fas fa-arrow-up text-xs text-green-500"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-3 rounded-full transition-all duration-500" id="approval-bar" style="width: 95%"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 pt-2">
                            <div class="text-center p-2 bg-green-50 rounded">
                                <p class="text-xs text-gray-600">Response Time</p>
                                <p class="font-semibold text-green-600" id="response-time">2.3s</p>
                            </div>
                            <div class="text-center p-2 bg-blue-50 rounded">
                                <p class="text-xs text-gray-600">Throughput</p>
                                <p class="font-semibold text-blue-600" id="throughput">1.2k</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t">
                            <span class="text-sm text-gray-600">Error Rate</span>
                            <span class="font-semibold text-green-600" id="error-rate">0.1%</span>
                        </div>
                    </div>
                </div>

                <!-- Security Metrics -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-shield-virus mr-3 text-red-500"></i>
                        Security
                        <span class="ml-auto text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">Monitored</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Threat Level</span>
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold text-yellow-600">MODERATE</span>
                                <i class="fas fa-shield-alt text-xs text-green-500"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-yellow-400 to-yellow-600 h-3 rounded-full transition-all duration-500" style="width: 35%"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 pt-2">
                            <div class="text-center p-2 bg-red-50 rounded">
                                <p class="text-xs text-gray-600">Fraud Detections</p>
                                <p class="font-semibold text-red-600" id="fraud-detections">3</p>
                            </div>
                            <div class="text-center p-2 bg-orange-50 rounded">
                                <p class="text-xs text-gray-600">Security Events</p>
                                <p class="font-semibold text-orange-600" id="security-events">12</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 pt-2 border-t">
                            <div class="text-center p-2 bg-green-50 rounded">
                                <p class="text-xs text-gray-600">Auth Failures</p>
                                <p class="font-semibold text-green-600" id="auth-failures">2</p>
                            </div>
                            <div class="text-center p-2 bg-blue-50 rounded">
                                <p class="text-xs text-gray-600">Encryption</p>
                                <p class="font-semibold text-blue-600" id="encryption-status">ACTIVE</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Real-time Analytics</h2>
                <div class="flex space-x-2">
                    <button onclick="toggleChartType()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-chart-line mr-1"></i>
                        <span id="chart-type-text">Switch View</span>
                    </button>
                    <button onclick="exportCharts()" class="text-sm text-green-600 hover:text-green-800">
                        <i class="fas fa-download mr-1"></i>
                        Export
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Verification Timeline -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Verification Timeline</h3>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Live</span>
                    </div>
                    <div class="relative h-64">
                        <canvas id="verification-chart" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Peak: 98 successful verifications</span>
                            <span>Average: 87% success rate</span>
                        </div>
                    </div>
                </div>

                <!-- GDPR Compliance Chart -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">GDPR Compliance Metrics</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Compliant</span>
                    </div>
                    <div class="relative h-64">
                        <canvas id="gdpr-chart" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Last audit: 2 days ago</span>
                            <span>Next review: 28 days</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Alerts Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Active Alerts</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full" id="alert-count">0 Active</span>
                    <button onclick="clearAllAlerts()" class="text-sm text-red-600 hover:text-red-800">
                        <i class="fas fa-trash mr-1"></i>
                        Clear All
                    </button>
                </div>
            </div>
            <div class="glass-effect rounded-xl shadow-lg">
                <div id="alerts-container" class="p-6">
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-4xl text-green-500 mb-3"></i>
                        <p class="text-gray-500">No active alerts - System operating normally</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Events -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Recent Events</h2>
                <div class="flex items-center space-x-2">
                    <button onclick="filterEvents('all')" class="text-xs px-2 py-1 bg-gray-100 text-gray-800 rounded hover:bg-gray-200">All</button>
                    <button onclick="filterEvents('security')" class="text-xs px-2 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200">Security</button>
                    <button onclick="filterEvents('performance')" class="text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded hover:bg-purple-200">Performance</button>
                    <button onclick="filterEvents('compliance')" class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded hover:bg-green-200">Compliance</button>
                </div>
            </div>
            <div class="glass-effect rounded-xl shadow-lg">
                <div class="p-6">
                    <div id="events-container" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Events will be populated here -->
                        <div class="text-center py-8">
                            <i class="fas fa-history text-4xl text-gray-400 mb-3"></i>
                            <p class="text-gray-500">No recent events</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Advanced Analytics Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Advanced Analytics</h2>
                <div class="flex space-x-2">
                    <button onclick="toggleAnalyticsView()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-chart-pie mr-1"></i>
                        <span id="analytics-view-text">Expand View</span>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Risk Assessment -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Risk Assessment</h3>
                        <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Live</span>
                    </div>
                    <div class="relative h-32">
                        <canvas id="risk-gauge" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-4 space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Overall Risk</span>
                            <span class="font-semibold text-yellow-600" id="overall-risk">MODERATE</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Risk Score</span>
                            <span class="font-semibold" id="risk-score">42/100</span>
                        </div>
                    </div>
                </div>

                <!-- Compliance Score -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Compliance Score</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Excellent</span>
                    </div>
                    <div class="relative h-32">
                        <canvas id="compliance-meter" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-4 space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">GDPR Compliance</span>
                            <span class="font-semibold text-green-600">98%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Security Standards</span>
                            <span class="font-semibold text-green-600">95%</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Trends -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Performance Trends</h3>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">7 Days</span>
                    </div>
                    <div class="relative h-32">
                        <canvas id="performance-sparkline" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-4 space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Avg Response</span>
                            <span class="font-semibold text-blue-600">2.1s</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Uptime</span>
                            <span class="font-semibold text-green-600">99.9%</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Enhanced System Information -->
        <section class="mb-8">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">System Infrastructure</h3>
                    <button onclick="refreshSystemInfo()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Refresh
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center group cursor-pointer" onclick="showSystemDetails('server')">
                        <div class="relative inline-block mb-2">
                            <i class="fas fa-server text-4xl text-blue-500 group-hover:scale-110 transition-transform"></i>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        <p class="text-sm text-gray-600 font-medium">Server Status</p>
                        <p class="font-semibold text-green-600" id="server-status">Online</p>
                        <p class="text-xs text-gray-500 mt-1">Load: 23%</p>
                    </div>
                    <div class="text-center group cursor-pointer" onclick="showSystemDetails('database')">
                        <div class="relative inline-block mb-2">
                            <i class="fas fa-database text-4xl text-purple-500 group-hover:scale-110 transition-transform"></i>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        <p class="text-sm text-gray-600 font-medium">Database</p>
                        <p class="font-semibold text-green-600" id="db-status">Connected</p>
                        <p class="text-xs text-gray-500 mt-1">QPS: 1,247</p>
                    </div>
                    <div class="text-center group cursor-pointer" onclick="showSystemDetails('cloud')">
                        <div class="relative inline-block mb-2">
                            <i class="fas fa-cloud text-4xl text-cyan-500 group-hover:scale-110 transition-transform"></i>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        <p class="text-sm text-gray-600 font-medium">Cloud Services</p>
                        <p class="font-semibold text-green-600" id="cloud-status">Operational</p>
                        <p class="text-xs text-gray-500 mt-1">Regions: 3</p>
                    </div>
                    <div class="text-center group cursor-pointer" onclick="showSystemDetails('users')">
                        <div class="relative inline-block mb-2">
                            <i class="fas fa-users text-4xl text-green-500 group-hover:scale-110 transition-transform"></i>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-blue-400 rounded-full animate-pulse"></div>
                        </div>
                        <p class="text-sm text-gray-600 font-medium">Active Users</p>
                        <p class="font-semibold text-blue-600" id="active-users">1,247</p>
                        <p class="text-xs text-gray-500 mt-1">+12% today</p>
                    </div>
                </div>
                
                <!-- System Performance Bar -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">System Performance</span>
                        <span class="text-sm text-gray-500" id="performance-percent">87%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div class="bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 h-3 rounded-full transition-all duration-1000" id="system-performance-bar" style="width: 87%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-2">
                        <span>CPU: 45%</span>
                        <span>Memory: 62%</span>
                        <span>Storage: 38%</span>
                        <span>Network: 91%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- üöÄ Enhanced AI-Powered Insights Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-brain mr-2 text-purple-600"></i>AI-Powered Insights
                </h2>
                <div class="flex space-x-2">
                    <button onclick="generateAIReport()" class="text-sm px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors">
                        <i class="fas fa-chart-line mr-1"></i>Generate Report
                    </button>
                    <button onclick="toggleAIInsights()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-expand mr-1"></i>
                        <span id="ai-insights-text">Expand</span>
                    </button>
                    <button onclick="runPredictiveMaintenance()" class="text-sm px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors">
                        <i class="fas fa-tools mr-1"></i>Predictive Maintenance
                    </button>
                    <button onclick="generateSecurityInsights()" class="text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">
                        <i class="fas fa-shield-alt mr-1"></i>Security Analysis
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Anomaly Detection -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Anomaly Detection</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Active</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Performance</span>
                            <span class="text-sm font-medium text-green-600" id="anomaly-performance">Normal</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Security</span>
                            <span class="text-sm font-medium text-green-600" id="anomaly-security">Clear</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Network</span>
                            <span class="text-sm font-medium text-yellow-600" id="anomaly-network">Warning</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Last scan: <span id="anomaly-last-scan">2 min ago</span></div>
                    </div>
                </div>

                <!-- Predictive Analytics -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Predictive Analytics</h3>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">ML</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Performance Trend</span>
                            <span class="text-sm font-medium text-blue-600" id="predictive-trend">Stable ‚ÜóÔ∏è</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Failure Risk</span>
                            <span class="text-sm font-medium text-green-600" id="failure-risk">Low (5%)</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Capacity (7d)</span>
                            <span class="text-sm font-medium text-yellow-600" id="capacity-forecast">78%</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Confidence: <span id="prediction-confidence">87%</span></div>
                    </div>
                </div>

                <!-- Behavioral Analysis -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Behavioral Analysis</h3>
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">AI</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Peak Hours</span>
                            <span class="text-sm font-medium text-purple-600" id="peak-hours">14-16</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Common Action</span>
                            <span class="text-sm font-medium text-purple-600" id="common-action">Login</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Unusual Patterns</span>
                            <span class="text-sm font-medium text-green-600" id="unusual-patterns">None</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Users analyzed: <span id="users-analyzed">1,247</span></div>
                    </div>
                </div>

                <!-- Risk Assessment -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Risk Assessment</h3>
                        <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full" id="risk-level-badge">Medium</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Overall Risk</span>
                            <span class="text-sm font-medium text-yellow-600" id="overall-risk">35%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Security</span>
                            <span class="text-sm font-medium text-green-600" id="security-risk">Low</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Performance</span>
                            <span class="text-sm font-medium text-yellow-600" id="performance-risk">Medium</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-400 via-yellow-400 to-red-400 h-2 rounded-full transition-all duration-1000" id="risk-bar" style="width: 35%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ü§ñ Enhanced User Behavior Insights -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-brain mr-2 text-indigo-600"></i>User Behavior Insights
                </h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">AI-Powered</span>
                    <button onclick="refreshBehaviorInsights()" class="text-sm text-indigo-600 hover:text-indigo-800">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Refresh
                    </button>
                    <button onclick="openBehaviorModal()" class="text-sm px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-chart-line mr-1"></i>View Details
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Current Behavior Status -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Current Behavior</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full" id="behavior-status">Normal</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Engagement</span>
                            <span class="text-sm font-medium text-green-600" id="current-engagement">High</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Risk Level</span>
                            <span class="text-sm font-medium text-yellow-600" id="current-risk">Low</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Session Activity</span>
                            <span class="text-sm font-medium text-blue-600" id="session-activity">Active</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Last updated: <span id="behavior-last-update">Just now</span></div>
                    </div>
                </div>

                <!-- Behavior Predictions -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Predictions</h3>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">ML</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Next Action</span>
                            <span class="text-sm font-medium text-blue-600" id="predicted-action">View Dashboard</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Confidence</span>
                            <span class="text-sm font-medium text-green-600" id="prediction-confidence">87%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Time Horizon</span>
                            <span class="text-sm font-medium text-purple-600" id="time-horizon">5 min</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Model: <span id="active-model">Sequential Predictor</span></div>
                    </div>
                </div>

                <!-- Behavioral Patterns -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Patterns Detected</h3>
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full" id="patterns-count">3</span>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Sequential</span>
                            <span class="text-sm font-medium text-purple-600" id="sequential-patterns">2</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Temporal</span>
                            <span class="text-sm font-medium text-indigo-600" id="temporal-patterns">1</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Associational</span>
                            <span class="text-sm font-medium text-pink-600" id="associational-patterns">0</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Analysis: <span id="pattern-analysis">Real-time</span></div>
                    </div>
                </div>

                <!-- Personalized Recommendations -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Recommendations</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full" id="recommendations-count">2</span>
                    </div>
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-lightbulb text-blue-500 mr-2 text-xs"></i>
                                <span class="text-xs font-medium text-gray-800">Engagement Boost</span>
                            </div>
                            <p class="text-xs text-gray-600">Try exploring new features</p>
                        </div>
                        <div class="p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-shield-alt text-green-500 mr-2 text-xs"></i>
                                <span class="text-xs font-medium text-gray-800">Security Check</span>
                            </div>
                            <p class="text-xs text-gray-600">Review security settings</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="text-xs text-gray-500">Updated: <span id="recommendations-update">2 min ago</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- üåê Real-time WebSocket Status -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-network-wired mr-2 text-cyan-600"></i>Real-time Connections
                </h2>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Status: <span id="websocket-status" class="font-medium text-green-600">Connected</span></span>
                    <button onclick="reconnectWebSocket()" class="text-sm px-3 py-1 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition-colors">
                        <i class="fas fa-sync mr-1"></i>Reconnect
                    </button>
                </div>
            </div>
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-cyan-600" id="real-time-latency">12ms</div>
                        <p class="text-sm text-gray-600 mt-1">Network Latency</p>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600" id="api-response-time">45ms</div>
                        <p class="text-sm text-gray-600 mt-1">API Response</p>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-600" id="active-connections">247</div>
                        <p class="text-sm text-gray-600 mt-1">Active Connections</p>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-orange-600" id="data-throughput">1.2MB/s</div>
                        <p class="text-sm text-gray-600 mt-1">Data Throughput</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real-time Activity Feed -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Real-time Activity Feed</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full animate-pulse">LIVE</span>
                    <button onclick="toggleActivityFeed()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-rss mr-1"></i>
                        <span id="activity-feed-text">Pause Feed</span>
                    </button>
                </div>
            </div>
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div id="activity-feed" class="space-y-3 max-h-64 overflow-y-auto">
                    <!-- Activity items will be populated here -->
                    <div class="text-center py-8">
                        <i class="fas fa-stream text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Activity feed loading...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Performance Metrics Grid -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Performance Metrics</h2>
                <div class="flex items-center space-x-2">
                    <select id="metrics-timeframe" onchange="updateMetricsTimeframe()" class="text-sm border border-gray-300 rounded px-2 py-1">
                        <option value="1h">Last Hour</option>
                        <option value="24h" selected>Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Response Time -->
                <div class="glass-effect rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">Response Time</span>
                        <i class="fas fa-clock text-blue-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800" id="response-time">2.1s</div>
                    <div class="text-xs text-green-600 mt-1">
                        <i class="fas fa-arrow-down mr-1"></i>12% from yesterday
                    </div>
                    <div class="mt-2 h-1 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500 rounded-full transition-all duration-1000" style="width: 65%"></div>
                    </div>
                </div>

                <!-- Throughput -->
                <div class="glass-effect rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">Throughput</span>
                        <i class="fas fa-tachometer-alt text-green-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800" id="throughput">1,247</div>
                    <div class="text-xs text-green-600 mt-1">
                        <i class="fas fa-arrow-up mr-1"></i>8% from yesterday
                    </div>
                    <div class="mt-2 h-1 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-green-500 rounded-full transition-all duration-1000" style="width: 78%"></div>
                    </div>
                </div>

                <!-- Error Rate -->
                <div class="glass-effect rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">Error Rate</span>
                        <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800" id="error-rate">0.23%</div>
                    <div class="text-xs text-green-600 mt-1">
                        <i class="fas fa-arrow-down mr-1"></i>5% from yesterday
                    </div>
                    <div class="mt-2 h-1 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-yellow-500 rounded-full transition-all duration-1000" style="width: 15%"></div>
                    </div>
                </div>

                <!-- Availability -->
                <div class="glass-effect rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-600">Availability</span>
                        <i class="fas fa-check-circle text-green-500"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800" id="availability">99.9%</div>
                    <div class="text-xs text-gray-600 mt-1">
                        <i class="fas fa-minus mr-1"></i>No change
                    </div>
                    <div class="mt-2 h-1 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-green-500 rounded-full transition-all duration-1000" style="width: 99%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Geographic Distribution -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Geographic Distribution</h2>
                <button onclick="refreshGeoData()" class="text-sm text-blue-600 hover:text-blue-800">
                    <i class="fas fa-sync-alt mr-1"></i>
                    Refresh
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- World Map Placeholder -->
                <div class="glass-effect rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Global Traffic</h3>
                    <div class="relative h-64 bg-gradient-to-br from-blue-50 to-green-50 rounded-lg flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas fa-globe-americas text-6xl text-blue-500 mb-4"></i>
                            <p class="text-gray-600">Interactive world map</p>
                            <p class="text-sm text-gray-500">Click regions for details</p>
                        </div>
                    </div>
                </div>

                <!-- Regional Stats -->
                <div class="glass-effect rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Regional Statistics</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                <div>
                                    <div class="font-medium text-gray-800">North America</div>
                                    <div class="text-sm text-gray-600">United States, Canada</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-blue-600">45%</div>
                                <div class="text-sm text-gray-500">562 users</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <div>
                                    <div class="font-medium text-gray-800">Europe</div>
                                    <div class="text-sm text-gray-600">UK, Germany, France</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-green-600">28%</div>
                                <div class="text-sm text-gray-500">349 users</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                                <div>
                                    <div class="font-medium text-gray-800">Asia Pacific</div>
                                    <div class="text-sm text-gray-600">Japan, Australia, Singapore</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-purple-600">18%</div>
                                <div class="text-sm text-gray-500">224 users</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                <div>
                                    <div class="font-medium text-gray-800">Other</div>
                                    <div class="text-sm text-gray-600">South America, Africa</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-yellow-600">9%</div>
                                <div class="text-sm text-gray-500">112 users</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">AI-Powered Insights</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">Beta</span>
                    <button onclick="refreshInsights()" class="text-sm text-purple-600 hover:text-purple-800">
                        <i class="fas fa-brain mr-1"></i>
                        Refresh Insights
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Predictive Analytics -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Predictive Analytics</h3>
                        <i class="fas fa-chart-line text-purple-500"></i>
                    </div>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-trending-up text-blue-500 mr-2"></i>
                                <span class="font-medium text-gray-800">Traffic Forecast</span>
                            </div>
                            <p class="text-sm text-gray-600">Expected 23% increase in user activity over the next 48 hours</p>
                            <div class="mt-2 text-xs text-blue-600">Confidence: 94%</div>
                        </div>
                        <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                                <span class="font-medium text-gray-800">Risk Alert</span>
                            </div>
                            <p class="text-sm text-gray-600">Potential compliance issues detected in EU region</p>
                            <div class="mt-2 text-xs text-yellow-600">Confidence: 78%</div>
                        </div>
                    </div>
                </div>

                <!-- Optimization Suggestions -->
                <div class="glass-effect rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Optimization Suggestions</h3>
                        <i class="fas fa-lightbulb text-yellow-500"></i>
                    </div>
                    <div class="space-y-4">
                        <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-rocket text-green-500 mr-2"></i>
                                <span class="font-medium text-gray-800">Performance Boost</span>
                            </div>
                            <p class="text-sm text-gray-600">Enable Redis caching to improve response times by 40%</p>
                            <button class="mt-2 text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Implement</button>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-shield-alt text-purple-500 mr-2"></i>
                                <span class="font-medium text-gray-800">Security Enhancement</span>
                            </div>
                            <p class="text-sm text-gray-600">Update encryption protocols to meet latest standards</p>
                            <button class="mt-2 text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">Review</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Security & Secrets Management Section -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Security & Secrets Management</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Bun Secrets</span>
                    <button onclick="refreshSecretsStatus()" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-key mr-1"></i>
                        Refresh Status
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Secrets Status -->
                <div class="glass-effect rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Secrets Status</h3>
                        <i class="fas fa-shield-alt text-green-500"></i>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800">Database Credentials</div>
                                    <div class="text-sm text-gray-600">Stored securely in Windows Credential Manager</div>
                                </div>
                            </div>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Secure</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800">API Keys</div>
                                    <div class="text-sm text-gray-600">Encrypted and managed by Bun</div>
                                </div>
                            </div>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Secure</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                                <div>
                                    <div class="font-medium text-gray-800">JWT Secret</div>
                                    <div class="text-sm text-gray-600">Will expire in 7 days</div>
                                </div>
                            </div>
                            <button onclick="rotateSecret('jwt')" class="text-xs bg-yellow-600 text-white px-2 py-1 rounded hover:bg-yellow-700">Rotate</button>
                        </div>
                    </div>
                </div>

                <!-- Security Actions -->
                <div class="glass-effect rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Security Actions</h3>
                        <i class="fas fa-lock text-blue-500"></i>
                    </div>
                    <div class="space-y-3">
                        <button onclick="testSecretsIntegration()" class="w-full p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plug mr-2"></i>
                            Test Bun Secrets Integration
                        </button>
                        <button onclick="exportSecureConfig()" class="w-full p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-download mr-2"></i>
                            Export Secure Configuration
                        </button>
                        <button onclick="rotateAllSecrets()" class="w-full p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Rotate All Secrets
                        </button>
                        <button onclick="auditSecrets()" class="w-full p-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-clipboard-check mr-2"></i>
                            Audit Secrets Access
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Environment Configuration -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Environment Configuration</h2>
                <div class="flex items-center space-x-2">
                    <select id="environment-select" onchange="switchEnvironment()" class="text-sm border border-gray-300 rounded px-2 py-1">
                        <option value="development">Development</option>
                        <option value="staging">Staging</option>
                        <option value="production">Production</option>
                    </select>
                </div>
            </div>
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-database text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-1">Database</h4>
                        <p class="text-sm text-gray-600" id="db-config">PostgreSQL: localhost</p>
                        <p class="text-xs text-green-600 mt-1">Connected via Bun secrets</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-cloud text-green-600 text-xl"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-1">Cloud Services</h4>
                        <p class="text-sm text-gray-600" id="cloud-config">AWS: us-east-1</p>
                        <p class="text-xs text-green-600 mt-1">IAM roles configured</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-api text-purple-600 text-xl"></i>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-1">External APIs</h4>
                        <p class="text-sm text-gray-600" id="api-config">3 services active</p>
                        <p class="text-xs text-green-600 mt-1">Keys managed by Bun</p>
                    </div>
                </div>
                
                <!-- Environment Variables Status -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-gray-700">Environment Variables</span>
                        <span class="text-sm text-green-600" id="env-count">12 variables loaded</span>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-1"></i>
                            <span>DATABASE_URL</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-1"></i>
                            <span>API_SECRET_KEY</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-1"></i>
                            <span>JWT_SECRET</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-check text-green-500 mr-1"></i>
                            <span>REDIS_URL</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Enhanced Dashboard Controller
        class OnePayDashboard {
            constructor() {
                this.metrics = {
                    gdpr: {
                        consentRate: 85,
                        dataExports: 0,
                        autoDeletions: 0,
                        objections: 0
                    },
                    performance: {
                        approvalRate: 95,
                        responseTime: 2.3,
                        throughput: 1250,
                        errorRate: 0.1
                    },
                    security: {
                        fraudDetections: 3,
                        securityEvents: 12,
                        authFailures: 2,
                        encryptionStatus: 'ACTIVE'
                    }
                };
                
                // Initialize abort controller for cleanup
                this.abortController = new AbortController();
                this.watchers = new Map();
                
                this.alerts = [];
                this.events = [];
                this.charts = {};
                this.autoRefresh = true;
                this.darkMode = false;
                this.currentEventFilter = 'all';
                
                this.init();
            }

            // üîê PII Scrubbing Utility with Enhanced Security
            scrubPath(path) {
                return path
                    .replace(/^.*?\/Users\//, '/Users/~')
                    .replace(/\/Users\/[^/]+/g, '/Users/~')
                    .replace(/\/home\/[^/]+/g, '/home/~')
                    .replace(/C:\\Users\\[^\\]+/g, 'C:\\Users\\~');
            }

            // üîê Enhanced logging with PII protection and UUIDv7 trace IDs
            logSecure(message, data = null) {
                const traceId = Bun.randomUUIDv7();
                const sanitizedData = data ? this.scrubPII(data) : null;
                console.log(`[OnePay Dashboard] [${traceId}] ${message}`, sanitizedData);
                return traceId;
            }

            // üöÄ High-Res Performance Metrics with nanosecond precision
            startHighResTimer() {
                return Bun.nanoseconds();
            }

            endHighResTimer(startTime) {
                const durationNanos = Bun.nanoseconds() - startTime;
                return {
                    nanoseconds: durationNanos,
                    milliseconds: durationNanos / 1e6,
                    microseconds: durationNanos / 1e3
                };
            }

            // üîê Fast Crypto Hashing with Bun.CryptoHasher
            fastHash(data) {
                const hasher = new Bun.CryptoHasher("sha256");
                if (typeof data === 'string') {
                    hasher.update(data);
                } else if (data instanceof Blob) {
                    // For Blobs, convert to buffer first
                    hasher.update(data);
                } else {
                    hasher.update(JSON.stringify(data));
                }
                return hasher.digest("hex");
            }

            // üì¶ Efficient Buffer Building with Bun.ArrayBufferSink and DataView
            buildSarifBuffer(issues) {
                const sink = new Bun.ArrayBufferSink();
                const decoder = new TextDecoder();
                
                // Write SARIF header
                const header = '{"version": "2.1.0", "runs": [{"tool": {"driver": {"name": "OnePay Dashboard Scanner"}}, "results": [';
                sink.write(header);
                
                // Process issues efficiently
                issues.forEach((issue, index) => {
                    const result = {
                        ruleId: issue.ruleId,
                        message: { text: issue.message },
                        level: issue.level,
                        locations: [{
                            physicalLocation: {
                                artifactLocation: { uri: this.scrubPath(issue.file) },
                                region: { startLine: issue.line, startColumn: issue.column }
                            }
                        }]
                    };
                    
                    // Convert to buffer and decode for efficient processing
                    const resultBuffer = new TextEncoder().encode(JSON.stringify(result));
                    const dv = new DataView(resultBuffer);
                    const str = decoder.decode(dv);
                    
                    sink.write(str);
                    if (index < issues.length - 1) sink.write(',');
                });
                
                // Write SARIF footer
                const footer = ']}]}';
                sink.write(footer);
                
                // Get final buffer and demonstrate DataView usage
                const finalBuffer = sink.end();
                const finalDv = new DataView(finalBuffer);
                
                // Demonstrate DataView operations
                const bufferInfo = {
                    byteLength: finalBuffer.byteLength,
                    firstByte: finalDv.getUint8(0),
                    bufferType: finalBuffer.constructor.name,
                    dataViewByteLength: finalDv.byteLength,
                    firstBytes: Array.from(new Uint8Array(finalBuffer.slice(0, 16))).map(b => b.toString(16).padStart(2, '0')).join(' ')
                };
                
                // Log buffer metadata with DataView information
                this.logSecure('SARIF buffer built with DataView', bufferInfo);
                
                return finalBuffer;
            }

            // üóúÔ∏è Native Gzip Compression
            async compressAndUpload(key, data) {
                const start = this.startHighResTimer();
                
                try {
                    // Convert to buffer if needed
                    const buffer = data instanceof ArrayBuffer ? data : 
                                  data instanceof Blob ? await data.arrayBuffer() :
                                  new TextEncoder().encode(JSON.stringify(data));
                    
                    // Compress with native gzip
                    const compressed = Bun.gzipSync(buffer, { level: 9 });
                    
                    // Upload compressed data
                    const result = await this.uploadWithTimeout(key, new Blob([compressed]));
                    
                    const duration = this.endHighResTimer(start);
                    this.logSecure('Compressed and uploaded successfully', {
                        key,
                        originalSize: buffer.byteLength,
                        compressedSize: compressed.byteLength,
                        compressionRatio: (compressed.byteLength / buffer.byteLength).toFixed(2),
                        uploadTime: `${duration.milliseconds.toFixed(2)}ms`
                    });
                    
                    return result;
                } catch (error) {
                    this.logSecure('Compression/upload failed', { error: error.message, key });
                    throw error;
                }
            }

            // üõ°Ô∏è Config Hot Reload with Bun.deepEquals
            checkConfigChanges(oldConfig, newConfig) {
                if (!Bun.deepEquals(oldConfig, newConfig)) {
                    this.logSecure('Configuration changed, reloading');
                    this.notifyConfigReload(newConfig);
                    return true;
                }
                return false;
            }

            notifyConfigReload(newConfig) {
                // Apply new configuration
                if (newConfig.theme !== this.darkMode) {
                    this.toggleDarkMode();
                }
                if (newConfig.autoRefresh !== this.autoRefresh) {
                    this.toggleAutoRefresh();
                }
                this.addEvent('CONFIG', 'Configuration reloaded', 'info');
            }

            // üõ†Ô∏è Tool Detection with Bun.which
            checkToolAvailability(tool) {
                const toolPath = Bun.which(tool);
                if (!toolPath) {
                    this.logSecure(`Tool not found: ${tool}`, { fallback: true });
                    return null;
                }
                this.logSecure(`Tool found: ${tool}`, { path: this.scrubPath(toolPath) });
                return toolPath;
            }

            // üéØ Semver Checking for Rule Compatibility
            checkRuleCompatibility(rule) {
                if (!rule.bunVersionRange) {
                    return true; // No version constraint
                }
                
                const isCompatible = Bun.semver.satisfies(Bun.version, rule.bunVersionRange);
                this.logSecure(`Rule compatibility check`, {
                    ruleId: rule.id,
                    requiredVersion: rule.bunVersionRange,
                    currentVersion: Bun.version,
                    compatible: isCompatible
                });
                
                return isCompatible;
            }

            // üîÑ Stream Conversion for S3 with Enhanced ReadableStream
            async streamToBytes(stream) {
                try {
                    const bytes = await Bun.readableStreamToBytes(stream);
                    this.logSecure('Stream converted to bytes', { size: bytes.byteLength });
                    return bytes;
                } catch (error) {
                    this.logSecure('Stream conversion failed', { error: error.message });
                    throw error;
                }
            }

            // üåä Uint8Array to ReadableStream Conversion
            uint8ArrayToStream(uint8Array, chunkSize = 1024) {
                // Method 1: Direct ReadableStream constructor (naive approach)
                const naiveStream = new ReadableStream({
                    start(controller) {
                        controller.enqueue(uint8Array);
                        controller.close();
                    },
                });

                // Method 2: Blob.stream() (recommended for larger chunks)
                const blob = new Blob([uint8Array]);
                const optimizedStream = blob.stream(chunkSize);

                this.logSecure('Uint8Array to ReadableStream conversion', {
                    originalSize: uint8Array.byteLength,
                    chunkSize: chunkSize,
                    methods: ['naive', 'blob-optimized']
                });

                return {
                    naive: naiveStream,
                    optimized: optimizedStream,
                    metadata: {
                        byteLength: uint8Array.byteLength,
                        chunkSize: chunkSize,
                        type: 'Uint8Array-to-ReadableStream'
                    }
                };
            }

            // üåä Enhanced Streaming Demo - Multiple Patterns
            async demonstrateStreaming() {
                const testData = new Uint8Array(64);
                // Fill with test data
                for (let i = 0; i < testData.length; i++) {
                    testData[i] = i % 256;
                }

                // Convert to streams using different patterns
                const streams = this.uint8ArrayToStream(testData, 16); // Small chunk size for demo

                // Pattern 1: Naive Uint8Array approach
                let naiveResult = null;
                try {
                    const naiveBytes = await Bun.readableStreamToBytes(streams.naive);
                    naiveResult = {
                        success: true,
                        bytes: naiveBytes.byteLength,
                        hexPreview: Array.from(naiveBytes.slice(0, 8))
                            .map(b => b.toString(16).padStart(2, '0'))
                            .join(' '),
                        method: 'naive-uint8array'
                    };
                    console.log('üåä Naive Uint8Array stream converted:', naiveBytes.byteLength, 'bytes');
                } catch (error) {
                    naiveResult = {
                        success: false,
                        error: error.message,
                        method: 'naive-uint8array'
                    };
                    console.log('‚ùå Naive Uint8Array stream failed:', error.message);
                }

                // Pattern 2: Optimized Blob approach
                let optimizedResult = null;
                try {
                    const optimizedBytes = await Bun.readableStreamToBytes(streams.optimized);
                    optimizedResult = {
                        success: true,
                        bytes: optimizedBytes.byteLength,
                        hexPreview: Array.from(optimizedBytes.slice(0, 8))
                            .map(b => b.toString(16).padStart(2, '0'))
                            .join(' '),
                        method: 'blob-optimized'
                    };
                    console.log('üöÄ Optimized Blob stream converted:', optimizedBytes.byteLength, 'bytes');
                    
                    // Show first few bytes as hex
                    const hexPreview = Array.from(optimizedBytes.slice(0, 8))
                        .map(b => b.toString(16).padStart(2, '0'))
                        .join(' ');
                    console.log('üîç Hex preview:', hexPreview);
                    
                } catch (error) {
                    optimizedResult = {
                        success: false,
                        error: error.message,
                        method: 'blob-optimized'
                    };
                    console.log('‚ùå Optimized Blob stream failed:', error.message);
                }

                // Pattern 3: String-based ReadableStream (Node.js style)
                let stringResult = null;
                try {
                    // Create ReadableStream from string array (Node.js Readable.from equivalent)
                    const stringStream = new ReadableStream({
                        start(controller) {
                            const chunks = ["Hello, ", "world!"];
                            chunks.forEach(chunk => {
                                controller.enqueue(new TextEncoder().encode(chunk));
                            });
                            controller.close();
                        }
                    });
                    
                    const stringBytes = await Bun.readableStreamToBytes(stringStream);
                    const stringText = new TextDecoder().decode(stringBytes);
                    
                    stringResult = {
                        success: true,
                        bytes: stringBytes.byteLength,
                        text: stringText,
                        method: 'string-stream',
                        chunks: ["Hello, ", "world!"]
                    };
                    console.log('üìù String stream converted:', stringText);
                } catch (error) {
                    stringResult = {
                        success: false,
                        error: error.message,
                        method: 'string-stream'
                    };
                    console.log('‚ùå String stream failed:', error.message);
                }

                // Pattern 4: Response.bytes() style (Official Bun pattern)
                let responseBytesResult = null;
                try {
                    // Official Bun pattern: new Response(stream).bytes()
                    const responseStream = new ReadableStream({
                        start(controller) {
                            const chunks = ["Hello, ", "world!"];
                            chunks.forEach(chunk => {
                                controller.enqueue(new TextEncoder().encode(chunk));
                            });
                            controller.close();
                        }
                    });
                    
                    // Use official Bun bytes() method instead of arrayBuffer()
                    const responseUint8Array = await new Response(responseStream).bytes();
                    const responseText = new TextDecoder().decode(responseUint8Array);
                    
                    responseBytesResult = {
                        success: true,
                        bytes: responseUint8Array.byteLength,
                        text: responseText,
                        method: 'response-bytes',
                        api: 'new Response(stream).bytes()',
                        dataType: 'Uint8Array',
                        officialPattern: true
                    };
                    console.log('ü¶ä Response.bytes() converted:', responseText);
                    console.log('üìä Uint8Array length:', responseUint8Array.length);
                } catch (error) {
                    responseBytesResult = {
                        success: false,
                        error: error.message,
                        method: 'response-bytes'
                    };
                    console.log('‚ùå Response.bytes() failed:', error.message);
                }

                // Pattern 5: Response.arrayBuffer() style (Web API pattern)
                let responseArrayResult = null;
                try {
                    // Simulate Response.arrayBuffer() pattern with Bun
                    const responseStream = new ReadableStream({
                        start(controller) {
                            const responseData = new TextEncoder().encode('Response data from stream');
                            controller.enqueue(responseData);
                            controller.close();
                        }
                    });
                    
                    // Create a Response object and get ArrayBuffer
                    const response = new Response(responseStream);
                    const responseBuffer = await response.arrayBuffer();
                    const responseText = new TextDecoder().decode(responseBuffer);
                    
                    responseArrayResult = {
                        success: true,
                        bytes: responseBuffer.byteLength,
                        text: responseText,
                        method: 'response-arraybuffer',
                        api: 'Response.arrayBuffer()',
                        dataType: 'ArrayBuffer',
                        officialPattern: false
                    };
                    console.log('üåê Response.arrayBuffer() converted:', responseText);
                } catch (error) {
                    responseArrayResult = {
                        success: false,
                        error: error.message,
                        method: 'response-arraybuffer'
                    };
                    console.log('‚ùå Response.arrayBuffer() failed:', error.message);
                }

                // Create comprehensive streaming report
                const streamingReport = {
                    timestamp: new Date().toISOString(),
                    testConfiguration: {
                        originalSize: testData.byteLength,
                        chunkSize: 16,
                        testDataPattern: 'sequential (0-63)',
                        methods: ['naive-uint8array', 'blob-optimized', 'string-stream', 'response-bytes', 'response-arraybuffer'],
                        officialBunPattern: 'new Response(stream).bytes()'
                    },
                    results: {
                        naive: naiveResult,
                        optimized: optimizedResult,
                        string: stringResult,
                        responseBytes: responseBytesResult,
                        responseArray: responseArrayResult
                    },
                    performance: {
                        naiveTime: naiveResult?.success ? '< 5ms' : 'failed',
                        optimizedTime: optimizedResult?.success ? '< 3ms' : 'failed',
                        stringTime: stringResult?.success ? '< 2ms' : 'failed',
                        responseBytesTime: responseBytesResult?.success ? '< 1ms' : 'failed',
                        responseArrayTime: responseArrayResult?.success ? '< 4ms' : 'failed',
                        recommendation: 'Use new Response(stream).bytes() for official Bun pattern, blob.stream() for binary data'
                    },
                    patterns: {
                        uint8Array: 'Direct binary data streaming',
                        blob: 'Chunked binary streaming with configurable size',
                        string: 'Text-based streaming like Node.js Readable.from',
                        responseBytes: 'Official Bun pattern - returns Uint8Array directly',
                        responseArray: 'Web API Response pattern - returns ArrayBuffer'
                    },
                    comparison: {
                        'Uint8Array vs ArrayBuffer': 'Response.bytes() returns Uint8Array, Response.arrayBuffer() returns ArrayBuffer',
                        'Official Pattern': 'new Response(stream).bytes() is the recommended Bun approach',
                        'Node.js Compatibility': 'Both patterns work with Node.js-style Readable streams',
                        'Performance': 'bytes() is slightly faster than arrayBuffer() in Bun'
                    },
                    metadata: streams.metadata
                };

                // Display in enhanced JSON modal
                if (typeof displayJSONReport === 'function') {
                    displayJSONReport(streamingReport, 'Official Bun Streaming Demo - 5 Patterns Including Response.bytes()');
                }

                this.addEvent('STREAMING', 'Enhanced streaming demo with multiple patterns completed', 'success');
                return streamingReport;
            }

            // üë• Worker Pool for Parallel Processing
            async initWorkerPool() {
                this.workers = [];
                this.workerBusy = new Array(4).fill(false); // 4 worker threads
                
                for (let i = 0; i < 4; i++) {
                    try {
                        // Create inline worker for dashboard tasks
                        const workerCode = `
                            self.onmessage = function(e) {
                                const { type, data } = e.data;
                                
                                if (type === 'HASH') {
                                    // Fast hashing in worker
                                    const hasher = new Bun.CryptoHasher("sha256");
                                    hasher.update(data);
                                    const hash = hasher.digest("hex");
                                    self.postMessage({ type: 'HASH_RESULT', hash, id: data.id });
                                } else if (type === 'PROCESS_BATCH') {
                                    // Process data batch
                                    const results = data.items.map(item => ({
                                        ...item,
                                        processed: true,
                                        timestamp: Date.now()
                                    }));
                                    self.postMessage({ type: 'BATCH_RESULT', results, id: data.id });
                                }
                            };
                        `;
                        
                        const blob = new Blob([workerCode], { type: 'application/javascript' });
                        const worker = new Worker(URL.createObjectURL(blob));
                        
                        this.workers.push(worker);
                        this.logSecure(`Worker ${i} initialized`);
                    } catch (error) {
                        this.logSecure(`Failed to initialize worker ${i}`, { error: error.message });
                    }
                }
            }

            async processWithWorker(type, data) {
                return new Promise((resolve, reject) => {
                    // Find available worker
                    const workerIndex = this.workerBusy.findIndex(busy => !busy);
                    
                    if (workerIndex === -1) {
                        // All workers busy, process in main thread
                        this.logSecure('All workers busy, using main thread');
                        resolve(this.processInMainThread(type, data));
                        return;
                    }
                    
                    this.workerBusy[workerIndex] = true;
                    const worker = this.workers[workerIndex];
                    
                    const timeout = setTimeout(() => {
                        reject(new Error('Worker timeout'));
                    }, 10000);
                    
                    const handleMessage = (e) => {
                        clearTimeout(timeout);
                        this.workerBusy[workerIndex] = false;
                        worker.removeEventListener('message', handleMessage);
                        
                        if (e.data.type === `${type}_RESULT`) {
                            resolve(e.data);
                        } else {
                            reject(new Error('Unexpected worker response'));
                        }
                    };
                    
                    worker.addEventListener('message', handleMessage);
                    worker.postMessage({ type, data });
                });
            }

            processInMainThread(type, data) {
                if (type === 'HASH') {
                    return { hash: this.fastHash(data), id: data.id };
                } else if (type === 'PROCESS_BATCH') {
                    return {
                        results: data.items.map(item => ({
                            ...item,
                            processed: true,
                            timestamp: Date.now()
                        })),
                        id: data.id
                    };
                }
            }

            // üõ°Ô∏è Resource Management with AbortController
            async startFileWatcher(path) {
                try {
                    // Clean up existing watcher
                    if (this.watchers.has(path)) {
                        this.watchers.get(path).abort();
                    }

                    // Create new watcher with abort signal
                    const watcher = setInterval(() => {
                        this.checkFileChanges(path);
                    }, 5000);

                    // Store watcher for cleanup
                    this.watchers.set(path, { 
                        interval: watcher, 
                        abort: () => {
                            clearInterval(watcher);
                            this.watchers.delete(path);
                        }
                    });

                    this.logSecure(`Started file watcher for: ${this.scrubPath(path)}`);
                    return watcher;

                } catch (error) {
                    this.logSecure('Failed to start file watcher', { error: error.message, path });
                    throw error;
                }
            }

            async checkFileChanges(path) {
                // Simulate file change detection
                const hasChanges = Math.random() > 0.8;
                if (hasChanges) {
                    this.addEvent('SYSTEM', `File change detected in ${this.scrubPath(path)}`, 'info');
                }
            }

            // üöÄ S3 Upload with Timeout
            async uploadWithTimeout(key, data, timeoutMs = 30000) {
                const uploadPromise = this.simulateS3Upload(key, data);
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('S3 upload timeout')), timeoutMs);
                });

                try {
                    const result = await Promise.race([uploadPromise, timeoutPromise]);
                    this.logSecure(`S3 upload successful: ${key}`);
                    return result;
                } catch (error) {
                    this.logSecure('S3 upload failed', { error: error.message, key });
                    throw error;
                }
            }

            async simulateS3Upload(key, data) {
                // Simulate S3 upload with realistic delay
                return new Promise((resolve) => {
                    const uploadTime = Math.random() * 20000 + 5000; // 5-25 seconds
                    setTimeout(() => {
                        resolve({
                            key,
                            url: `https://dashboard-uploads.s3.amazonaws.com/${key}`,
                            size: data.size || 1024,
                            uploadedAt: new Date().toISOString()
                        });
                    }, uploadTime);
                });
            }

            // üßπ Cleanup Method
            cleanup() {
                this.logSecure('Cleaning up dashboard resources...');
                
                // Abort all operations
                this.abortController.abort();
                
                // Clear all watchers
                this.watchers.forEach(watcher => {
                    watcher.abort();
                });
                this.watchers.clear();
                
                // Clear intervals
                if (this.activityFeedInterval) clearInterval(this.activityFeedInterval);
                if (this.performanceInterval) clearInterval(this.performanceInterval);
                if (this.systemInterval) clearInterval(this.systemInterval);
                if (this.insightsInterval) clearInterval(this.insightsInterval);
                if (this.secretsInterval) clearInterval(this.secretsInterval);
                
                this.logSecure('Dashboard cleanup completed');
            }

            init() {
                this.initCharts();
                this.initAdvancedCharts();
                this.startRealTimeUpdates();
                this.updateUI();
                this.setupKeyboardShortcuts();
                this.loadSavedPreferences();
                this.updateLastRefreshTime();
                this.startSystemMonitoring();
                this.startActivityFeed();
                this.initPerformanceMetrics();
                this.initSecretsManagement();
                
                // üöÄ Initialize high-performance features
                this.initWorkerPool();
                this.demonstrateBunOptimizations();
                this.demonstrateStreaming();
            }

            // üöÄ Demonstrate all Bun API optimizations
            async demonstrateBunOptimizations() {
                // 1. UUIDv7 Trace IDs
                this.logSecure('Demonstrating Bun API optimizations');
                const traceId2 = Bun.randomUUIDv7();
                console.log(`üÜî UUIDv7 Trace ID: ${traceId2} (sortable, collision-resistant)`);
                
                // 2. High-Res Timing
                const timerStart = this.startHighResTimer();
                await new Promise(resolve => setTimeout(resolve, 10)); // Simulate work
                const timing = this.endHighResTimer(timerStart);
                console.log(`‚è±Ô∏è High-res timing: ${timing.microseconds.toFixed(2)}Œºs`);
                
                // 3. Fast Crypto Hashing
                const testData = 'OnePay Dashboard Performance Test';
                const hashStart = this.startHighResTimer();
                const hash = this.fastHash(testData);
                const hashTime = this.endHighResTimer(hashStart);
                console.log(`üîê Fast hash: ${hash} (${hashTime.microseconds.toFixed(2)}Œºs)`);
                
                // 4. Tool Detection
                const toolResults = {
                    vim: this.checkToolAvailability('vim'),
                    git: this.checkToolAvailability('git'),
                    node: this.checkToolAvailability('node')
                };
                console.log('üõ†Ô∏è Tool detection results:', toolResults);
                
                // 5. Semver Checking
                const testRule = {
                    id: 'dashboard-security',
                    bunVersionRange: '>=1.0.0'
                };
                const isCompatible = this.checkRuleCompatibility(testRule);
                console.log(`üéØ Rule compatibility: ${isCompatible}`);
                
                // 6. Worker Pool Processing
                let workerResult = null;
                let workerTime = null;
                if (this.workers.length > 0) {
                    const workerStart = this.startHighResTimer();
                    workerResult = await this.processWithWorker('HASH', {
                        data: testData,
                        id: 'demo-hash'
                    });
                    workerTime = this.endHighResTimer(workerStart);
                    console.log(`üë• Worker hash: ${workerResult.hash} (${workerTime.microseconds.toFixed(2)}Œºs)`);
                }
                
                // 7. Buffer Building
                const issues = [
                    { ruleId: 'SEC001', message: 'Potential security issue', level: 'warning', file: '/Users/test/app.js', line: 42, column: 15 },
                    { ruleId: 'PERF001', message: 'Performance optimization needed', level: 'info', file: '/Users/test/utils.js', line: 128, column: 8 }
                ];
                const sarifBuffer = this.buildSarifBuffer(issues);
                console.log(`üì¶ SARIF buffer built: ${sarifBuffer.byteLength} bytes`);
                
                // 8. Compression and Upload
                let uploadSuccess = false;
                try {
                    await this.compressAndUpload('dashboard-sarif.json', {
                        timestamp: new Date().toISOString(),
                        issues: issues,
                        performance: {
                            hashTime: hashTime.microseconds,
                            workerTime: workerTime?.microseconds || 0
                        }
                    });
                    uploadSuccess = true;
                } catch (uploadError) {
                    console.log('üì§ Compression/upload demo completed (simulated)', uploadError.message);
                    uploadSuccess = false;
                }
                
                // 9. Config Hot Reload Demo
                const oldConfig = { theme: false, autoRefresh: true };
                const newConfig = { theme: true, autoRefresh: false };
                this.checkConfigChanges(oldConfig, newConfig);
                
                // Log comprehensive results
                this.logSecure('Bun API optimization demo completed', {
                    traceId: traceId2,
                    timing: timing.microseconds,
                    hash: hash,
                    hashTime: hashTime.microseconds,
                    tools: toolResults,
                    ruleCompatibility: isCompatible,
                    workerResult: workerResult?.hash,
                    workerTime: workerTime?.microseconds,
                    sarifSize: sarifBuffer.byteLength,
                    uploadSuccess: uploadSuccess
                });
                
                this.addEvent('PERFORMANCE', 'Bun API optimizations demonstrated', 'success');
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Enhanced keyboard shortcut handling with safeguards
                    try {
                        if (e.ctrlKey && e.key === 'r') {
                            e.preventDefault();
                            e.stopImmediatePropagation(); // Prevent event bubbling
                            console.log('‚å®Ô∏è Keyboard shortcut: Ctrl+R triggered');
                            refreshDashboard(); // Call global function, not this.refreshDashboard()
                        }
                        if (e.ctrlKey && e.key === 'e') {
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            console.log('‚å®Ô∏è Keyboard shortcut: Ctrl+E triggered');
                            this.exportData();
                        }
                        if (e.ctrlKey && e.key === 'd') {
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            console.log('‚å®Ô∏è Keyboard shortcut: Ctrl+D triggered');
                            toggleDarkMode(); // Call global function
                        }
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            console.log('‚å®Ô∏è Keyboard shortcut: Escape triggered');
                            clearAllAlerts(); // Call global function
                        }
                    } catch (error) {
                        // Enhanced error logging for keyboard shortcuts
                        const errorDetails = error instanceof Error ? {
                            name: error.name,
                            message: error.message,
                            stack: error.stack,
                            key: e.key,
                            ctrlKey: e.ctrlKey,
                            metaKey: e.metaKey
                        } : {
                            error: JSON.stringify(error, Object.getOwnPropertyNames(error)),
                            key: e.key
                        };
                        
                        console.error('‚ùå Keyboard shortcut error:', errorDetails);
                        this.addEvent('SYSTEM', `Keyboard shortcut failed: ${errorDetails.message}`, 'error');
                    }
                });
            }

            loadSavedPreferences() {
                const savedDarkMode = localStorage.getItem('dashboard-dark-mode');
                if (savedDarkMode === 'true') {
                    this.toggleDarkMode();
                }
                
                const savedAutoRefresh = localStorage.getItem('dashboard-auto-refresh');
                if (savedAutoRefresh === 'false') {
                    this.toggleAutoRefresh();
                }
            }

            updateLastRefreshTime() {
                const now = new Date();
                document.getElementById('last-updated').textContent = now.toLocaleTimeString();
            }

            initAdvancedCharts() {
                // Risk Gauge Chart
                const riskCtx = document.getElementById('risk-gauge').getContext('2d');
                this.charts.riskGauge = new Chart(riskCtx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [42, 58],
                            backgroundColor: [
                                'rgb(250, 204, 21)',
                                'rgb(229, 231, 235)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        rotation: -90,
                        circumference: 180,
                        cutout: '70%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });

                // Compliance Meter Chart
                const complianceCtx = document.getElementById('compliance-meter').getContext('2d');
                this.charts.complianceMeter = new Chart(complianceCtx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [96, 4],
                            backgroundColor: [
                                'rgb(34, 197, 94)',
                                'rgb(229, 231, 235)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        rotation: -90,
                        circumference: 180,
                        cutout: '70%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });

                // Performance Sparkline Chart
                const sparklineCtx = document.getElementById('performance-sparkline').getContext('2d');
                this.charts.performanceSparkline = new Chart(sparklineCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            data: [2.3, 2.1, 2.4, 2.0, 2.2, 2.1, 2.1],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }

            initCharts() {
                // Enhanced Verification Timeline Chart
                const verificationCtx = document.getElementById('verification-chart').getContext('2d');
                this.charts.verification = new Chart(verificationCtx, {
                    type: 'line',
                    data: {
                        labels: this.generateTimeLabels(12),
                        datasets: [{
                            label: 'Successful Verifications',
                            data: this.generateRandomData(12, 80, 100),
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Failed Verifications',
                            data: this.generateRandomData(12, 0, 20),
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });

                // Enhanced GDPR Compliance Chart
                const gdprCtx = document.getElementById('gdpr-chart').getContext('2d');
                this.charts.gdpr = new Chart(gdprCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Consent Granted', 'Consent Denied', 'Data Exported', 'Auto-Deleted'],
                        datasets: [{
                            data: [85, 15, 45, 23],
                            backgroundColor: [
                                'rgb(34, 197, 94)',
                                'rgb(239, 68, 68)',
                                'rgb(59, 130, 246)',
                                'rgb(250, 204, 21)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff',
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 12,
                                cornerRadius: 8,
                                callbacks: {
                                    label: (context) => {
                                        return `${context.label}: ${context.parsed}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            generateTimeLabels(count) {
                const labels = [];
                const now = new Date();
                for (let i = count - 1; i >= 0; i--) {
                    const time = new Date(now - i * 5 * 60 * 1000);
                    labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                }
                return labels;
            }

            generateRandomData(count, min, max) {
                return Array.from({ length: count }, () => 
                    Math.floor(Math.random() * (max - min + 1)) + min
                );
            }

            startActivityFeed() {
                this.activityFeedActive = true;
                this.activityFeedInterval = setInterval(() => {
                    if (this.activityFeedActive && this.autoRefresh) {
                        this.addActivityItem();
                    }
                }, 3000);
                
                // Initialize with some activities
                setTimeout(() => {
                    this.addActivityItem();
                    this.addActivityItem();
                    this.addActivityItem();
                }, 1000);
            }

            addActivityItem() {
                const activityTypes = [
                    { type: 'USER', message: 'New user registration from United States', icon: 'fa-user-plus', color: 'blue' },
                    { type: 'TRANSACTION', message: 'Payment processed successfully - $247.50', icon: 'fa-dollar-sign', color: 'green' },
                    { type: 'SECURITY', message: 'Security scan completed - no threats found', icon: 'fa-shield-alt', color: 'green' },
                    { type: 'PERFORMANCE', message: 'Database optimization completed', icon: 'fa-tachometer-alt', color: 'purple' },
                    { type: 'COMPLIANCE', message: 'GDPR compliance check passed', icon: 'fa-check-circle', color: 'green' },
                    { type: 'ALERT', message: 'High traffic detected on EU servers', icon: 'fa-exclamation-triangle', color: 'yellow' },
                    { type: 'SYSTEM', message: 'Automatic backup completed', icon: 'fa-save', color: 'blue' },
                    { type: 'API', message: 'API rate limit updated to 10,000/hr', icon: 'fa-code', color: 'purple' }
                ];

                const activity = activityTypes[Math.floor(Math.random() * activityTypes.length)];
                const feedContainer = document.getElementById('activity-feed');
                
                // Remove loading message if it exists
                const loadingMessage = feedContainer.querySelector('.text-center.py-8');
                if (loadingMessage) {
                    loadingMessage.remove();
                }

                const activityElement = document.createElement('div');
                activityElement.className = 'flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors animate-fade-in';
                activityElement.innerHTML = `
                    <div class="flex-shrink-0 w-10 h-10 bg-${activity.color}-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fas ${activity.icon} text-${activity.color}-600"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-800">${activity.type}</span>
                            <span class="text-xs text-gray-500">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">${activity.message}</p>
                    </div>
                `;

                // Add to top of feed
                feedContainer.insertBefore(activityElement, feedContainer.firstChild);

                // Keep only last 10 activities
                const activityItems = feedContainer.children;
                if (activityItems.length > 10) {
                    feedContainer.removeChild(activityItems[activityItems.length - 1]);
                }
            }

            initPerformanceMetrics() {
                // Initialize performance metrics with random variations
                this.updatePerformanceMetrics();
                
                // Update metrics every 10 seconds
                this.performanceInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.updatePerformanceMetrics();
                    }
                }, 10000);
            }

            updatePerformanceMetrics() {
                // Response Time
                const responseTime = (Math.random() * 1.5 + 1.5).toFixed(1);
                document.getElementById('response-time').textContent = `${responseTime}s`;

                // Throughput
                const throughput = Math.floor(Math.random() * 500 + 1000);
                document.getElementById('throughput').textContent = throughput.toLocaleString();

                // Error Rate
                const errorRate = (Math.random() * 0.3 + 0.1).toFixed(2);
                document.getElementById('error-rate').textContent = `${errorRate}%`;

                // Availability stays high
                const availability = (Math.random() * 0.1 + 99.9).toFixed(1);
                document.getElementById('availability').textContent = `${availability}%`;

                // Update progress bars with random variations
                const bars = document.querySelectorAll('.grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4 .h-1.bg-gray-200 .bg-blue-500, .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4 .h-1.bg-gray-200 .bg-green-500, .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4 .h-1.bg-gray-200 .bg-yellow-500');
                bars.forEach(bar => {
                    if (bar) {
                        const width = Math.floor(Math.random() * 30 + 60);
                        bar.style.width = `${width}%`;
                    }
                });
            }

            initSecretsManagement() {
                // Initialize secrets status
                this.updateSecretsStatus();
                
                // Check environment variables
                this.checkEnvironmentVariables();
                
                // Set up periodic secrets health check
                this.secretsInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.updateSecretsStatus();
                    }
                }, 60000); // Check every minute
            }

            updateSecretsStatus() {
                // Simulate checking Bun secrets and Windows Credential Manager
                const secretsStatus = {
                    database: { secure: true, source: 'Windows Credential Manager', lastChecked: new Date().toLocaleString() },
                    apiKeys: { secure: true, source: 'Bun Secrets', lastChecked: new Date().toLocaleString() },
                    jwt: { secure: true, expires: '7 days', lastRotated: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toLocaleDateString() }
                };

                // Log the secrets status for debugging/monitoring
                console.log('Secrets status checked:', secretsStatus);

                // Update UI with secrets status
                this.addEvent('SECURITY', 'Secrets status verified - all secure', 'success');
            }

            checkEnvironmentVariables() {
                // Simulate checking environment variables loaded via Bun
                const envVars = [
                    'DATABASE_URL', 'API_SECRET_KEY', 'JWT_SECRET', 
                    'REDIS_URL', 'AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY',
                    'STRIPE_SECRET_KEY', 'SENTRY_DSN', 'SMTP_PASSWORD',
                    'ENCRYPTION_KEY', 'OAUTH_CLIENT_SECRET', 'WEBHOOK_SECRET'
                ];

                document.getElementById('env-count').textContent = `${envVars.length} variables loaded`;
                
                // Add environment check event
                this.addEvent('ENVIRONMENT', `Loaded ${envVars.length} environment variables via Bun`, 'info');
            }

            // Bun Secrets integration methods
            async testBunSecretsIntegration() {
                try {
                    // Simulate testing Bun secrets integration
                    const testResults = {
                        windowsCredentialManager: 'Connected',
                        bunSecrets: 'Operational',
                        encryption: 'AES-256',
                        keyRotation: 'Automated'
                    };

                    this.addEvent('SECURITY', 'Bun secrets integration test passed', 'success');
                    
                    // Show results in a modal or alert
                    alert('Bun Secrets Integration Test Results:\n\n' + 
                          Object.entries(testResults)
                                .map(([key, value]) => `${key}: ${value}`)
                                .join('\n'));
                    
                } catch (error) {
                    console.error('Bun secrets integration test failed:', error);
                    this.addEvent('SECURITY', 'Bun secrets integration test failed', 'error');
                    alert('Bun Secrets integration test failed. Please check your configuration.');
                }
            }

            async exportSecureConfig() {
                try {
                    // Simulate exporting secure configuration
                    const config = {
                        timestamp: new Date().toISOString(),
                        environment: document.getElementById('environment-select').value,
                        secretsManaged: {
                            database: 'Windows Credential Manager',
                            apiKeys: 'Bun Secrets',
                            jwt: 'Automated rotation'
                        },
                        securityLevel: 'Enterprise'
                    };

                    // Create and download configuration file
                    const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `secure-config-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);

                    console.log('Secure configuration exported:', config);
                    this.addEvent('SECURITY', 'Secure configuration exported', 'success');
                    
                } catch (error) {
                    console.error('Failed to export secure configuration:', error);
                    this.addEvent('SECURITY', 'Failed to export secure configuration', 'error');
                    alert('Failed to export secure configuration. Please try again.');
                }
            }

            async rotateSecret(secretType) {
                try {
                    // Simulate secret rotation
                    this.addEvent('SECURITY', `${secretType.toUpperCase()} secret rotation initiated`, 'info');
                    
                    // Simulate rotation process
                    setTimeout(() => {
                        console.log(`${secretType} secret rotated successfully`);
                        this.addEvent('SECURITY', `${secretType.toUpperCase()} secret rotated successfully`, 'success');
                        alert(`${secretType.toUpperCase()} secret has been rotated successfully.`);
                    }, 2000);
                    
                } catch (error) {
                    console.error(`Failed to rotate ${secretType} secret:`, error);
                    this.addEvent('SECURITY', `Failed to rotate ${secretType} secret`, 'error');
                    alert(`Failed to rotate ${secretType} secret. Please try again.`);
                }
            }

            async rotateAllSecrets() {
                if (confirm('Are you sure you want to rotate all secrets? This will invalidate all existing tokens and may cause service disruption.')) {
                    try {
                        this.addEvent('SECURITY', 'Full secret rotation initiated', 'warning');
                        
                        // Simulate rotating all secrets
                        setTimeout(() => {
                            console.log('All secrets rotated successfully');
                            this.addEvent('SECURITY', 'All secrets rotated successfully', 'success');
                            alert('All secrets have been rotated. Please update any dependent services.');
                        }, 3000);
                        
                    } catch (error) {
                        console.error('Failed to rotate all secrets:', error);
                        this.addEvent('SECURITY', 'Failed to rotate all secrets', 'error');
                        alert('Failed to rotate all secrets. Please check the logs for details.');
                    }
                }
            }

            async auditSecrets() {
                try {
                    // Simulate secrets audit
                    const auditResults = {
                        totalSecrets: 12,
                        secureSecrets: 12,
                        expiringSoon: 1,
                        lastAccessed: {
                            database: new Date().toISOString(),
                            apiKeys: new Date(Date.now() - 3600000).toISOString(),
                            jwt: new Date(Date.now() - 1800000).toISOString()
                        },
                        accessLog: [
                            { timestamp: new Date().toISOString(), action: 'READ', secret: 'DATABASE_URL', user: 'system' },
                            { timestamp: new Date(Date.now() - 3600000).toISOString(), action: 'READ', secret: 'API_SECRET_KEY', user: 'dashboard' },
                            { timestamp: new Date(Date.now() - 7200000).toISOString(), action: 'ROTATE', secret: 'JWT_SECRET', user: 'system' }
                        ]
                    };

                    console.log('Secrets audit completed:', auditResults);
                    this.addEvent('SECURITY', 'Secrets audit completed', 'success');
                    
                    // Show audit results
                    alert(`Secrets Audit Results:\n\n` +
                          `Total Secrets: ${auditResults.totalSecrets}\n` +
                          `Secure Secrets: ${auditResults.secureSecrets}\n` +
                          `Expiring Soon: ${auditResults.expiringSoon}\n\n` +
                          `Recent Access:\n` +
                          auditResults.accessLog.slice(0, 3)
                                .map(log => `${log.timestamp.split('T')[1].split('.')[0]} - ${log.action} ${log.secret}`)
                                .join('\n'));
                    
                } catch (error) {
                    console.error('Failed to audit secrets:', error);
                    this.addEvent('SECURITY', 'Failed to audit secrets', 'error');
                    alert('Failed to audit secrets. Please try again.');
                }
            }

            startSystemMonitoring() {
                // Update system performance every 3 seconds
                this.systemInterval = setInterval(() => {
                    this.updateSystemMetrics();
                }, 3000);

                // Update AI insights every 30 seconds
                this.insightsInterval = setInterval(() => {
                    this.updateAIInsights();
                }, 30000);
            }

            updateSystemMetrics() {
                // Simulate system performance changes
                const performance = Math.floor(Math.random() * 15) + 80;
                document.getElementById('performance-percent').textContent = `${performance}%`;
                document.getElementById('system-performance-bar').style.width = `${performance}%`;

                // Update individual metrics
                const cpu = Math.floor(Math.random() * 30) + 35;
                const memory = Math.floor(Math.random() * 25) + 50;
                const storage = Math.floor(Math.random() * 20) + 30;
                const network = Math.floor(Math.random() * 10) + 85;

                // Update the metric displays
                const metricsContainer = document.querySelector('.flex.justify-between.text-xs.text-gray-500.mt-2');
                if (metricsContainer) {
                    metricsContainer.innerHTML = `
                        <span>CPU: ${cpu}%</span>
                        <span>Memory: ${memory}%</span>
                        <span>Storage: ${storage}%</span>
                        <span>Network: ${network}%</span>
                    `;
                }

                // Update risk score
                const riskScore = Math.floor(Math.random() * 20) + 35;
                document.getElementById('risk-score').textContent = `${riskScore}/100`;
                
                // Update risk gauge
                if (this.charts.riskGauge) {
                    this.charts.riskGauge.data.datasets[0].data = [riskScore, 100 - riskScore];
                    this.charts.riskGauge.update('none');
                }

                // Update active users
                const activeUsers = Math.floor(Math.random() * 200) + 1150;
                document.getElementById('active-users').textContent = activeUsers.toLocaleString();
            }

            updateAIInsights() {
                // Simulate AI insight updates
                const insights = [
                    {
                        type: 'Traffic Forecast',
                        message: `Expected ${Math.floor(Math.random() * 10) + 15}% increase in user activity`,
                        confidence: Math.floor(Math.random() * 10) + 85,
                        color: 'blue'
                    },
                    {
                        type: 'Security Alert',
                        message: 'Unusual login patterns detected in Asia Pacific region',
                        confidence: Math.floor(Math.random() * 15) + 70,
                        color: 'yellow'
                    },
                    {
                        type: 'Performance Opportunity',
                        message: 'Database optimization could improve response times by 25%',
                        confidence: Math.floor(Math.random() * 10) + 80,
                        color: 'green'
                    }
                ];

                // Update first insight
                const firstInsight = insights[Math.floor(Math.random() * insights.length)];
                const insightElements = document.querySelectorAll('.p-4.bg-blue-50, .p-4.bg-yellow-50');
                if (insightElements[0]) {
                    insightElements[0].querySelector('.font-medium').textContent = firstInsight.type;
                    insightElements[0].querySelector('p').textContent = firstInsight.message;
                    insightElements[0].querySelector('.text-xs').textContent = `Confidence: ${firstInsight.confidence}%`;
                }
            }

            startRealTimeUpdates() {
                // Update metrics every 5 seconds
                this.metricsInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.updateMetrics();
                    }
                }, 5000);
                
                // Update charts every 10 seconds
                this.chartsInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.updateCharts();
                    }
                }, 10000);
                
                // Add random events
                this.eventsInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.addRandomEvent();
                    }
                }, 8000);

                // Update refresh time every minute
                this.refreshTimeInterval = setInterval(() => {
                    this.updateLastRefreshTime();
                }, 60000);
            }

            // Enhanced update methods with animations
            updateMetrics() {
                // Simulate metric changes with smooth transitions
                this.metrics.gdpr.consentRate = Math.max(70, Math.min(95, 
                    this.metrics.gdpr.consentRate + (Math.random() - 0.5) * 2));
                
                this.metrics.performance.approvalRate = Math.max(85, Math.min(98, 
                    this.metrics.performance.approvalRate + (Math.random() - 0.5) * 1));
                
                this.metrics.performance.responseTime = Math.max(1.5, Math.min(5, 
                    this.metrics.performance.responseTime + (Math.random() - 0.5) * 0.5));
                
                this.metrics.security.fraudDetections = Math.max(0, 
                    this.metrics.security.fraudDetections + Math.floor(Math.random() * 3) - 1);
                
                // Random events with better probability
                if (Math.random() < 0.15) {
                    this.metrics.gdpr.dataExports++;
                    this.addEvent('DATA_EXPORT', 'User data exported', 'info');
                }
                
                if (Math.random() < 0.08) {
                    this.metrics.gdpr.autoDeletions++;
                    this.addEvent('AUTO_DELETION', 'Auto-deletion executed', 'success');
                }
                
                if (Math.random() < 0.12) {
                    this.metrics.gdpr.objections++;
                    this.addEvent('USER_OBJECTION', 'User objected to processing', 'warning');
                }
                
                if (Math.random() < 0.05) {
                    this.metrics.security.securityEvents++;
                    this.addEvent('SECURITY', 'Security event detected', 'error');
                }
                
                this.updateUI();
                this.updateLastRefreshTime();
            }

            updateCharts() {
                // Update verification chart
                const verificationData = this.charts.verification.data.datasets[0].data;
                verificationData.shift();
                verificationData.push(Math.floor(Math.random() * 20) + 80);
                
                const failedData = this.charts.verification.data.datasets[1].data;
                failedData.shift();
                failedData.push(Math.floor(Math.random() * 20));
                
                this.charts.verification.update('none');
                
                // Update GDPR chart
                this.charts.gdpr.data.datasets[0].data = [
                    this.metrics.gdpr.consentRate,
                    100 - this.metrics.gdpr.consentRate,
                    Math.min(this.metrics.gdpr.dataExports * 2, 50),
                    Math.min(this.metrics.gdpr.autoDeletions * 3, 30)
                ];
                this.charts.gdpr.update('none');
            }

            // Enhanced UI update methods
            updateUI() {
                // Update status cards with animations
                this.updateStatusCard('overall', 'HEALTHY');
                this.updateStatusCard('gdpr', 'COMPLIANT');
                this.updateStatusCard('performance', 'OPTIMAL');
                this.updateStatusCard('security', 'SECURE');
                
                // Update metrics with smooth transitions
                this.updateMetricDisplay();
                
                // Update alerts and events
                this.updateAlerts();
                this.updateEvents();
                
                // Update alert count
                document.getElementById('alert-count').textContent = `${this.alerts.length} Active`;
            }

            updateMetricDisplay() {
                // GDPR Metrics
                document.getElementById('consent-rate').textContent = `${this.metrics.gdpr.consentRate.toFixed(1)}%`;
                document.getElementById('consent-bar').style.width = `${this.metrics.gdpr.consentRate}%`;
                document.getElementById('data-exports').textContent = this.metrics.gdpr.dataExports;
                document.getElementById('auto-deletions').textContent = this.metrics.gdpr.autoDeletions;
                document.getElementById('objections').textContent = this.metrics.gdpr.objections;
                
                // Performance Metrics
                document.getElementById('approval-rate').textContent = `${this.metrics.performance.approvalRate.toFixed(1)}%`;
                document.getElementById('approval-bar').style.width = `${this.metrics.performance.approvalRate}%`;
                document.getElementById('response-time').textContent = `${this.metrics.performance.responseTime.toFixed(1)}s`;
                document.getElementById('throughput').textContent = `${(this.metrics.performance.throughput / 1000).toFixed(1)}k`;
                document.getElementById('error-rate').textContent = `${this.metrics.performance.errorRate.toFixed(1)}%`;
                
                // Security Metrics
                document.getElementById('fraud-detections').textContent = this.metrics.security.fraudDetections;
                document.getElementById('security-events').textContent = this.metrics.security.securityEvents;
                document.getElementById('auth-failures').textContent = this.metrics.security.authFailures;
                document.getElementById('encryption-status').textContent = this.metrics.security.encryptionStatus;
            }

            updateStatusCard(type, status) {
                const card = document.getElementById(`${type}-card`);
                const health = document.getElementById(`${type}-health`);
                
                // Remove existing status classes
                card.classList.remove('gdpr-compliant', 'gdpr-at-risk', 'gdpr-non-compliant');
                
                // Add appropriate class and color
                if (type === 'gdpr') {
                    if (this.metrics.gdpr.consentRate < 70) {
                        card.classList.add('gdpr-non-compliant');
                        health.textContent = 'NON_COMPLIANT';
                    } else if (this.metrics.gdpr.consentRate < 80) {
                        card.classList.add('gdpr-at-risk');
                        health.textContent = 'AT_RISK';
                    } else {
                        card.classList.add('gdpr-compliant');
                        health.textContent = 'COMPLIANT';
                    }
                } else {
                    health.textContent = status;
                }
            }

            addEvent(type, message, level = 'info') {
                const event = {
                    id: Date.now(),
                    type,
                    message,
                    level,
                    timestamp: new Date().toLocaleTimeString()
                };
                
                this.events.unshift(event);
                if (this.events.length > 10) {
                    this.events.pop();
                }
            }

            addRandomEvent() {
                const events = [
                    { type: 'VERIFICATION', message: 'User verification completed', level: 'success' },
                    { type: 'CONSENT', message: 'User granted consent', level: 'info' },
                    { type: 'SECURITY', message: 'Security scan completed', level: 'success' },
                    { type: 'PERFORMANCE', message: 'Performance metrics updated', level: 'info' }
                ];
                
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                this.addEvent(randomEvent.type, randomEvent.message, randomEvent.level);
            }

            // Enhanced alerts system
            updateAlerts() {
                const container = document.getElementById('alerts-container');
                
                // Check for conditions that should trigger alerts
                const alerts = [];
                
                if (this.metrics.gdpr.consentRate < 70) {
                    alerts.push({
                        type: 'CRITICAL',
                        message: 'GDPR consent rate below 70%',
                        icon: 'fas fa-exclamation-triangle',
                        color: 'text-red-500',
                        bg: 'bg-red-50',
                        border: 'border-red-500'
                    });
                }
                
                if (this.metrics.performance.responseTime > 4) {
                    alerts.push({
                        type: 'WARNING',
                        message: 'Response time above 4 seconds',
                        icon: 'fas fa-clock',
                        color: 'text-yellow-500',
                        bg: 'bg-yellow-50',
                        border: 'border-yellow-500'
                    });
                }
                
                if (this.metrics.security.fraudDetections > 10) {
                    alerts.push({
                        type: 'ALERT',
                        message: 'High fraud detection rate',
                        icon: 'fas fa-shield-virus',
                        color: 'text-orange-500',
                        bg: 'bg-orange-50',
                        border: 'border-orange-500'
                    });
                }
                
                this.alerts = alerts;
                
                if (alerts.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-check-circle text-4xl text-green-500 mb-3"></i>
                            <p class="text-gray-500">No active alerts - System operating normally</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = alerts.map(alert => `
                        <div class="flex items-center justify-between p-4 border-l-4 ${alert.border} ${alert.bg} rounded-lg mb-3 animate-slide-in">
                            <div class="flex items-center">
                                <i class="${alert.icon} ${alert.color} mr-3 text-lg"></i>
                                <div>
                                    <p class="font-medium text-gray-800">${alert.type}</p>
                                    <p class="text-sm text-gray-600">${alert.message}</p>
                                </div>
                            </div>
                            <button onclick="dashboard.dismissAlert(${alerts.indexOf(alert)})" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `).join('');
                }
            }

            dismissAlert(index) {
                this.alerts.splice(index, 1);
                this.updateAlerts();
            }

            clearAllAlerts() {
                this.alerts = [];
                this.updateAlerts();
            }

            // Enhanced events system with filtering
            updateEvents() {
                const container = document.getElementById('events-container');
                
                let filteredEvents = this.events;
                if (this.currentEventFilter !== 'all') {
                    filteredEvents = this.events.filter(event => {
                        if (this.currentEventFilter === 'security') return ['SECURITY', 'FRAUD_DETECTION'].includes(event.type);
                        if (this.currentEventFilter === 'performance') return ['PERFORMANCE', 'VERIFICATION'].includes(event.type);
                        if (this.currentEventFilter === 'compliance') return ['DATA_EXPORT', 'AUTO_DELETION', 'USER_OBJECTION', 'CONSENT'].includes(event.type);
                        return true;
                    });
                }
                
                if (filteredEvents.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-history text-4xl text-gray-400 mb-3"></i>
                            <p class="text-gray-500">No recent events</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = filteredEvents.map(event => {
                        const colors = {
                            success: 'text-green-500',
                            warning: 'text-yellow-500',
                            error: 'text-red-500',
                            info: 'text-blue-500'
                        };
                        
                        const icons = {
                            success: 'fas fa-check-circle',
                            warning: 'fas fa-exclamation-triangle',
                            error: 'fas fa-times-circle',
                            info: 'fas fa-info-circle'
                        };
                        
                        const bgColors = {
                            success: 'bg-green-50',
                            warning: 'bg-yellow-50',
                            error: 'bg-red-50',
                            info: 'bg-blue-50'
                        };
                        
                        return `
                            <div class="flex items-center justify-between p-3 ${bgColors[event.level]} rounded-lg hover:shadow-md transition-all animate-fade-in">
                                <div class="flex items-center">
                                    <i class="${icons[event.level]} ${colors[event.level]} mr-3"></i>
                                    <div>
                                        <p class="text-sm font-medium text-gray-800">${event.type}</p>
                                        <p class="text-xs text-gray-600">${event.message}</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">${event.timestamp}</span>
                            </div>
                        `;
                    }).join('');
                }
            }

            filterEvents(filter) {
                this.currentEventFilter = filter;
                this.updateEvents();
            }
        }

        // Global functions for button handlers
        let dashboard;

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function toggleAutoRefresh() {
            dashboard.autoRefresh = !dashboard.autoRefresh;
            document.getElementById('auto-refresh-status').textContent = dashboard.autoRefresh ? 'ON' : 'OFF';
            localStorage.setItem('dashboard-auto-refresh', dashboard.autoRefresh.toString());
        }

        // Global refresh debounce to prevent rapid-fire calls
        let isRefreshing = false;
        let refreshAttempts = 0;
        const MAX_REFRESH_ATTEMPTS = 5;
        const REFRESH_COOLDOWN = 1000; // 1 second

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick refresh button
        function refreshDashboard() {
            // Prevent rapid-fire calls
            if (isRefreshing) {
                refreshAttempts++;
                console.warn(`Refresh already in progress (attempt ${refreshAttempts}/${MAX_REFRESH_ATTEMPTS})`);
                
                if (refreshAttempts >= MAX_REFRESH_ATTEMPTS) {
                    console.error('Max refresh attempts reached - stopping to prevent infinite loop');
                    dashboard.addEvent('SYSTEM', 'Refresh throttled - max attempts reached', 'error');
                    return;
                }
                return;
            }

            isRefreshing = true;
            refreshAttempts = 0;
            
            try {
                console.log('üîÑ Starting dashboard refresh...');
                dashboard.addEvent('MANUAL', 'Manual refresh triggered', 'info');
                
                // Enhanced visual feedback
                const refreshButton = document.querySelector('[onclick="refreshDashboard()"]');
                const refreshIcon = document.getElementById('refresh-icon');
                const refreshStatus = document.getElementById('refresh-status');
                
                if (refreshButton) {
                    refreshButton.classList.add('scale-95');
                    if (refreshIcon) {
                        refreshIcon.classList.add('fa-spin');
                        refreshIcon.classList.remove('text-green-600');
                        refreshIcon.classList.add('text-blue-600');
                    }
                    if (refreshStatus) {
                        refreshStatus.classList.remove('bg-green-400');
                        refreshStatus.classList.add('bg-blue-400');
                    }
                }
                
                // Perform comprehensive refresh
                dashboard.updateMetrics();
                dashboard.updateCharts();
                dashboard.updateUI();
                
                // Refresh additional components
                dashboard.updateSystemMetrics();
                dashboard.updatePerformanceMetrics();
                
                // Show completion feedback
                setTimeout(() => {
                    if (refreshButton) {
                        refreshButton.classList.remove('scale-95');
                        if (refreshIcon) {
                            refreshIcon.classList.remove('fa-spin');
                            refreshIcon.classList.remove('text-blue-600');
                            refreshIcon.classList.add('text-green-600');
                        }
                        if (refreshStatus) {
                            refreshStatus.classList.remove('bg-blue-400');
                            refreshStatus.classList.add('bg-green-400');
                        }
                    }
                    dashboard.addEvent('MANUAL', 'Manual refresh completed', 'success');
                    console.log('‚úÖ Dashboard refresh completed successfully');
                    
                    // Add success pulse effect
                    if (refreshStatus) {
                        refreshStatus.classList.add('animate-ping');
                        setTimeout(() => {
                            refreshStatus.classList.remove('animate-ping');
                        }, 1000);
                    }
                }, 1000);
                
            } catch (error) {
                // Enhanced error logging as suggested
                const errorDetails = error instanceof Error ? {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                } : {
                    error: JSON.stringify(error, Object.getOwnPropertyNames(error))
                };
                
                console.error('‚ùå Dashboard refresh failed:', errorDetails);
                dashboard.addEvent('SYSTEM', `Refresh failed: ${errorDetails.message}`, 'error');
                
                // Show error state
                const refreshIcon = document.getElementById('refresh-icon');
                const refreshStatus = document.getElementById('refresh-status');
                if (refreshIcon) {
                    refreshIcon.classList.remove('text-blue-600');
                    refreshIcon.classList.add('text-red-600');
                }
                if (refreshStatus) {
                    refreshStatus.classList.remove('bg-blue-400');
                    refreshStatus.classList.add('bg-red-400');
                }
                
            } finally {
                // Reset cooldown after successful operation
                setTimeout(() => {
                    isRefreshing = false;
                    refreshAttempts = 0;
                }, REFRESH_COOLDOWN);
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick and keyboard shortcuts
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const darkModeIcon = document.getElementById('dark-mode-icon');
            
            if (document.body.classList.contains('dark')) {
                darkModeIcon.classList.remove('fa-moon');
                darkModeIcon.classList.add('fa-sun');
                darkModeIcon.classList.remove('text-gray-700');
                darkModeIcon.classList.add('text-yellow-400');
            } else {
                darkModeIcon.classList.remove('fa-sun');
                darkModeIcon.classList.add('fa-moon');
                darkModeIcon.classList.remove('text-yellow-400');
                darkModeIcon.classList.add('text-gray-700');
            }
            
            // Add haptic feedback simulation
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function toggleExportMenu() {
            const menu = document.getElementById('export-menu');
            menu.classList.toggle('hidden');
            
            // Close menu when clicking outside
            if (!menu.classList.contains('hidden')) {
                setTimeout(() => {
                    document.addEventListener('click', closeExportMenu);
                }, 100);
            }
        }

        function closeExportMenu(event) {
            const menu = document.getElementById('export-menu');
            if (!menu.contains(event.target) && !event.target.closest('[onclick="toggleExportMenu()"]')) {
                menu.classList.add('hidden');
                document.removeEventListener('click', closeExportMenu);
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function exportMetrics() {
            const metricsData = {
                timestamp: new Date().toISOString(),
                systemMetrics: dashboard.metrics,
                performanceMetrics: {
                    responseTime: Math.floor(Math.random() * 50) + 20 + 'ms',
                    errorRate: (Math.random() * 0.1).toFixed(3) + '%',
                    throughput: Math.floor(Math.random() * 1000) + 500 + ' req/min',
                    activeConnections: Math.floor(Math.random() * 100) + 50
                },
                uptime: document.getElementById('uptime-percentage').textContent,
                status: document.getElementById('overall-status').textContent
            };
            
            displayJSONReport(metricsData, 'System Metrics Export');
            dashboard.addEvent('EXPORT', 'System metrics exported', 'success');
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function openSettings() {
            const settingsData = {
                dashboard: {
                    theme: document.body.classList.contains('dark') ? 'dark' : 'light',
                    autoRefresh: dashboard.autoRefresh,
                    notifications: true,
                    animations: true
                },
                display: {
                    charts: {
                        type: 'line',
                        animated: true,
                        grid: true
                    },
                    metrics: {
                        compact: false,
                        showTrends: true,
                        showPercentages: true
                    }
                },
                performance: {
                    updateInterval: 5000,
                    maxDataPoints: 100,
                    enableAnimations: true
                }
            };
            
            displayJSONReport(settingsData, 'Dashboard Settings');
            dashboard.addEvent('SETTINGS', 'Settings panel opened', 'info');
        }

        // Global depth control system
        let currentDepth = 3;
        const MAX_DEPTH = 10;
        const MIN_DEPTH = 1;

        function getDepthConfiguration(depth) {
            const configs = {
                1: { name: 'Overview', refreshInterval: 30000, dataPoints: 10, complexity: 'Low' },
                2: { name: 'Standard', refreshInterval: 15000, dataPoints: 25, complexity: 'Medium' },
                3: { name: 'Deep', refreshInterval: 10000, dataPoints: 50, complexity: 'High' },
                4: { name: 'Expert', refreshInterval: 5000, dataPoints: 100, complexity: 'Very High' },
                5: { name: 'Research', refreshInterval: 3000, dataPoints: 200, complexity: 'Maximum' }
            };
            
            // For depths beyond 5, scale the configuration
            if (depth > 5) {
                const baseConfig = configs[5];
                return {
                    ...baseConfig,
                    name: `Ultra Research (${depth})`,
                    refreshInterval: Math.max(1000, 3000 - (depth - 5) * 400),
                    dataPoints: 200 + (depth - 5) * 50,
                    complexity: 'Ultra Maximum'
                };
            }
            
            return configs[depth] || configs[3];
        }

        function calculatePerformanceImpact(depth) {
            const baseImpact = depth * 15; // 15% per depth level
            const complexity = Math.min(95, baseImpact + (depth > 3 ? (depth - 3) * 10 : 0));
            return {
                cpuUsage: `${Math.min(90, depth * 12)}%`,
                memoryUsage: `${Math.min(85, depth * 10)}%`,
                responseTime: `${depth * 50}ms`,
                complexity: `${complexity}%`,
                recommendation: complexity > 80 ? 'High impact - consider reducing depth' : 'Acceptable performance'
            };
        }

        function calculateMemoryUsage(depth) {
            const baseMemory = 50; // Base 50MB
            const depthMemory = depth * 25; // 25MB per depth level
            const totalMemory = baseMemory + depthMemory;
            
            return {
                estimated: `${totalMemory}MB`,
                breakdown: {
                    base: `${baseMemory}MB`,
                    depthData: `${depthMemory}MB`,
                    cache: `${Math.min(100, depth * 10)}MB`,
                    buffer: `${Math.min(50, depth * 5)}MB`
                },
                recommendation: totalMemory > 200 ? 'High memory usage - monitor closely' : 'Memory usage within limits'
            };
        }

        function calculateNetworkLoad(depth) {
            const requestsPerMinute = depth * 10;
            const dataSizeKB = depth * 15;
            
            return {
                requestsPerMinute: requestsPerMinute,
                dataTransfer: `${dataSizeKB}KB/min`,
                bandwidthUsage: `${Math.min(95, depth * 8)}%`,
                recommendation: requestsPerMinute > 50 ? 'High network load - consider optimization' : 'Network load acceptable'
            };
        }

        function getDepthRecommendations(depth) {
            const recommendations = [];
            
            if (depth <= 2) {
                recommendations.push('Perfect for monitoring dashboards');
                recommendations.push('Low resource consumption');
                recommendations.push('Fast refresh rates');
            } else if (depth <= 4) {
                recommendations.push('Good balance of detail and performance');
                recommendations.push('Suitable for detailed analysis');
                recommendations.push('Moderate resource usage');
            } else {
                recommendations.push('Maximum detail for research');
                recommendations.push('High resource consumption');
                recommendations.push('Consider for offline analysis');
                recommendations.push('May impact real-time performance');
            }
            
            return recommendations;
        }

        function setDepth(newDepth) {
            if (newDepth < MIN_DEPTH || newDepth > MAX_DEPTH) {
                console.error(`Depth must be between ${MIN_DEPTH} and ${MAX_DEPTH}`);
                return;
            }
            
            const oldDepth = currentDepth;
            currentDepth = newDepth;
            
            // Update badge
            const badge = document.getElementById('depth-badge');
            if (badge) {
                badge.textContent = currentDepth;
            }
            
            // Apply depth configuration
            const config = getDepthConfiguration(currentDepth);
            applyDepthConfiguration(config);
            
            // Log the change
            dashboard.addEvent('DEPTH', `Depth changed from ${oldDepth} to ${currentDepth}`, 'info');
            console.log(`üîç Depth updated: ${oldDepth} ‚Üí ${currentDepth} (${config.name})`);
        }

        function applyDepthConfiguration(config) {
            // Update dashboard refresh interval
            if (dashboard.autoRefreshInterval) {
                clearInterval(dashboard.autoRefreshInterval);
            }
            
            if (dashboard.autoRefresh) {
                dashboard.autoRefreshInterval = setInterval(() => {
                    dashboard.updateMetrics();
                    dashboard.updateCharts();
                }, config.refreshInterval);
            }
            
            // Update data point limits
            dashboard.maxDataPoints = config.dataPoints;
            
            // Update chart granularity
            dashboard.updateChartGranularity(config.dataPoints);
            
            // Update performance monitoring
            dashboard.updatePerformanceMonitoring(config.complexity);
            
            // üîó NEW: Sync with Bun console depth
            syncBunConsoleDepth(currentDepth);
        }

        // üîó NEW: Sync dashboard depth with Bun console depth
        function syncBunConsoleDepth(depth) {
            try {
                // Store depth preference for Bun processes
                localStorage.setItem('bun-console-depth', depth.toString());
                
                // Update console logging depth for dashboard
                console.originalLog = console.originalLog || console.log;
                console.originalDir = console.originalDir || console.dir;
                
                // Override console methods with depth control
                console.log = function(...args) {
                    const depthLimitedArgs = args.map(arg => limitDepth(arg, depth));
                    console.originalLog.apply(console, depthLimitedArgs);
                };
                
                console.dir = function(obj, options = {}) {
                    const depthOptions = { ...options, depth: depth };
                    console.originalDir.call(console, obj, depthOptions);
                };
                
                // Log the synchronization
                console.originalLog(`üîó Console depth synchronized to level ${depth}`);
                dashboard.addEvent('DEPTH', `Console depth synchronized to ${depth}`, 'info');
                
            } catch (error) {
                console.warn('Failed to sync console depth:', error);
            }
        }

        // üîó NEW: Limit object depth for console output
        function limitDepth(obj, maxDepth) {
            if (maxDepth <= 0) return '[Object]';
            
            if (obj === null || typeof obj !== 'object') return obj;
            
            if (obj instanceof Date) return obj;
            if (Array.isArray(obj)) {
                return obj.map(item => limitDepth(item, maxDepth - 1));
            }
            
            const limited = {};
            for (const [key, value] of Object.entries(obj)) {
                if (maxDepth > 1) {
                    limited[key] = limitDepth(value, maxDepth - 1);
                } else {
                    limited[key] = typeof value === 'object' ? '[Object]' : value;
                }
            }
            
            return limited;
        }

        // üîó NEW: Get Bun-style console output
        function getBunConsoleOutput(data, depth = currentDepth) {
            const limited = limitDepth(data, depth);
            return JSON.stringify(limited, null, 2);
        }

        // üîó NEW: Enhanced depth control with Bun integration
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick depth control button
        function toggleDepthControl() {
            const depthData = {
                currentDepth: currentDepth,
                maxDepth: MAX_DEPTH,
                minDepth: MIN_DEPTH,
                bunIntegration: {
                    consoleDepth: currentDepth,
                    flag: `--console-depth ${currentDepth}`,
                    command: `bun --console-depth ${currentDepth} run index.tsx`,
                    description: "Controls how deeply nested objects are displayed in console.log() output"
                },
                availableDepths: Array.from({length: MAX_DEPTH}, (_, i) => i + 1),
                depthConfigurations: {
                    1: {
                        name: 'Overview',
                        description: 'High-level summary metrics',
                        dataPoints: 10,
                        refreshInterval: 30000,
                        detail: 'Basic system status and key performance indicators',
                        consoleOutput: 'Shows minimal object structure (like --console-depth 1)'
                    },
                    2: {
                        name: 'Standard',
                        description: 'Detailed operational data',
                        dataPoints: 25,
                        refreshInterval: 15000,
                        detail: 'Comprehensive metrics with trend analysis',
                        consoleOutput: 'Default Bun console depth (like --console-depth 2)'
                    },
                    3: {
                        name: 'Deep',
                        description: 'In-depth analytics',
                        dataPoints: 50,
                        refreshInterval: 10000,
                        detail: 'Advanced analytics with predictive insights',
                        consoleOutput: 'Enhanced object inspection (like --console-depth 3)'
                    },
                    4: {
                        name: 'Expert',
                        description: 'Expert-level analysis',
                        dataPoints: 100,
                        refreshInterval: 5000,
                        detail: 'Detailed technical metrics and diagnostics',
                        consoleOutput: 'Detailed nested properties (like --console-depth 4)'
                    },
                    5: {
                        name: 'Research',
                        description: 'Research-grade data',
                        dataPoints: 200,
                        refreshInterval: 3000,
                        detail: 'Comprehensive data for research and analysis',
                        consoleOutput: 'Maximum detail for debugging (like --console-depth 5)'
                    }
                },
                currentConfiguration: getDepthConfiguration(currentDepth),
                systemImpact: {
                    performance: calculatePerformanceImpact(currentDepth),
                    memory: calculateMemoryUsage(currentDepth),
                    network: calculateNetworkLoad(currentDepth),
                    recommendations: getDepthRecommendations(currentDepth)
                },
                consoleExamples: {
                    nested: { a: { b: { c: { d: "deep" } } } },
                    outputAtCurrentDepth: getBunConsoleOutput({ a: { b: { c: { d: "deep" } } } }, currentDepth),
                    outputAtDepth2: getBunConsoleOutput({ a: { b: { c: { d: "deep" } } } }, 2),
                    outputAtDepth4: getBunConsoleOutput({ a: { b: { c: { d: "deep" } } } }, 4)
                }
            };
            
            displayJSONReport(depthData, 'Depth Control Configuration - Bun Console Integration');
            dashboard.addEvent('DEPTH', `Depth control opened at level ${currentDepth} with Bun integration`, 'info');
        }

        // Add depth control keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.key === '=') {
                e.preventDefault();
                setDepth(Math.min(MAX_DEPTH, currentDepth + 1));
            } else if (e.altKey && e.key === '-') {
                e.preventDefault();
                setDepth(Math.max(MIN_DEPTH, currentDepth - 1));
            } else if (e.altKey && e.key === '0') {
                e.preventDefault();
                setDepth(3); // Reset to default
            }
        });

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function toggleNotifications() {
            const notifications = [
                {
                    id: 1,
                    type: 'success',
                    title: 'System Update',
                    message: 'Dashboard updated to v3.6.0',
                    timestamp: new Date().toISOString(),
                    read: false
                },
                {
                    id: 2,
                    type: 'warning',
                    title: 'High Memory Usage',
                    message: 'Memory usage at 78% capacity',
                    timestamp: new Date(Date.now() - 300000).toISOString(),
                    read: false
                },
                {
                    id: 3,
                    type: 'info',
                    title: 'Weekly Report Ready',
                    message: 'Your weekly performance report is available',
                    timestamp: new Date(Date.now() - 600000).toISOString(),
                    read: false
                }
            ];
            
            displayJSONReport(notifications, 'System Notifications');
            dashboard.addEvent('NOTIFICATIONS', 'Notification panel opened', 'info');
            
            // Clear badge after opening
            const badge = document.getElementById('notification-badge');
            if (badge) {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from keyboard shortcuts
        function clearAllAlerts() {
            dashboard.clearAllAlerts();
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                metrics: dashboard.metrics,
                alerts: dashboard.alerts,
                events: dashboard.events.slice(0, 10)
            };
            
            // Display in enhanced JSON modal
            displayJSONReport(data, 'Dashboard Export Data');
            
            // Also provide download option
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            dashboard.addEvent('EXPORT', 'Dashboard data exported with enhanced preview', 'success');
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick export menu
        function exportCharts() {
            // Create a canvas to combine charts
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // White background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add title
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 24px Inter';
            ctx.fillText('OnePay Dashboard Report', 50, 40);
            ctx.font = '16px Inter';
            ctx.fillText(`Generated: ${new Date().toLocaleString()}`, 50, 70);
            
            // Download the image
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dashboard-charts-${new Date().toISOString().split('T')[0]}.png`;
                a.click();
                URL.revokeObjectURL(url);
            });
            
            dashboard.addEvent('EXPORT', 'Charts exported as image', 'success');
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute
        function runComplianceCheck() {
            dashboard.addEvent('COMPLIANCE', 'Running compliance check...', 'info');
            
            // Simulate compliance check
            setTimeout(() => {
                const issues = Math.floor(Math.random() * 3);
                if (issues === 0) {
                    dashboard.addEvent('COMPLIANCE', 'Compliance check passed - No issues found', 'success');
                } else {
                    dashboard.addEvent('COMPLIANCE', `Compliance check found ${issues} minor issues`, 'warning');
                }
            }, 2000);
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from advanced dashboard extensions
        function generateReport() {
            dashboard.addEvent('REPORT', 'Generating comprehensive report...', 'info');
            
            // Simulate report generation
            setTimeout(() => {
                dashboard.addEvent('REPORT', 'Report generated successfully', 'success');
                exportData();
            }, 1500);
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for system log viewing
        function viewLogs() {
            dashboard.addEvent('LOGS', 'Opening system logs...', 'info');
            // In a real implementation, this would open a logs modal or navigate to logs page
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for metrics view switching
        function toggleMetricsView() {
            const buttonText = document.getElementById('metrics-view-text');
            if (buttonText.textContent === 'Detailed View') {
                buttonText.textContent = 'Simple View';
                dashboard.addEvent('VIEW', 'Switched to detailed metrics view', 'info');
            } else {
                buttonText.textContent = 'Detailed View';
                dashboard.addEvent('VIEW', 'Switched to simple metrics view', 'info');
            }
        }

        function toggleChartType() {
            // Toggle between line and bar chart for verification chart
            const currentType = dashboard.charts.verification.config.type;
            const newType = currentType === 'line' ? 'bar' : 'line';
            dashboard.charts.verification.config.type = newType;
            dashboard.charts.verification.update();
            
            document.getElementById('chart-type-text').textContent = newType === 'line' ? 'Bar Chart' : 'Line Chart';
            dashboard.addEvent('CHART', `Switched to ${newType} chart`, 'info');
        }

        function filterEvents(filter) {
            dashboard.filterEvents(filter);
        }

        // üöÄ Advanced Features Functions
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute (line 174)
        function generateAIReport() {
            if (window.advancedExtensions) {
                const report = window.advancedExtensions.generateReport();
                dashboard.addEvent('AI', 'Comprehensive AI report generated', 'success');
                console.log('üìä AI Report Generated:', report);
                
                // Display report in enhanced code block with telemetry and copy
                displayJSONReport(report, 'AI Analytics Report');
                
                // Update UI with latest insights
                updateAIInsightsUI(report);
            } else {
                dashboard.addEvent('AI', 'Advanced extensions not yet initialized', 'warning');
            }
        }

        // üìä Enhanced JSON Display with Telemetry and Copy Functionality
        function displayJSONReport(data, title = 'JSON Report') {
            // Create modal container
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                    <div class="flex items-center justify-between p-4 border-b bg-gray-50">
                        <div class="flex items-center space-x-3">
                            <h3 class="text-lg font-semibold text-gray-800">${title}</h3>
                            <div class="flex items-center space-x-2 text-sm text-gray-500">
                                <i class="fas fa-clock"></i>
                                <span id="report-timestamp">${new Date().toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="copyJSONToClipboard()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors flex items-center space-x-1">
                                <i class="fas fa-copy"></i>
                                <span>Copy</span>
                            </button>
                            <button onclick="downloadJSONReport()" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors flex items-center space-x-1">
                                <i class="fas fa-download"></i>
                                <span>Download</span>
                            </button>
                            <button onclick="closeJSONModal()" class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-database"></i>
                                    <span>Size: <span id="json-size">${formatBytes(JSON.stringify(data).length)}</span></span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-code"></i>
                                    <span>Lines: <span id="json-lines">${JSON.stringify(data, null, 2).split('\n').length}</span></span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Depth: <span id="json-depth">${getJSONDepth(data)}</span></span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="formatJSON('compact')" class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Compact</button>
                                <button onclick="formatJSON('expanded')" class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Expanded</button>
                            </div>
                        </div>
                        <div class="relative bg-gray-900 rounded-lg overflow-hidden">
                            <div class="absolute top-2 right-2 z-10">
                                <div class="bg-green-500 text-white text-xs px-2 py-1 rounded flex items-center space-x-1">
                                    <i class="fas fa-check-circle"></i>
                                    <span>JSON Valid</span>
                                </div>
                            </div>
                            <pre class="text-sm text-gray-300 p-4 overflow-x-auto max-h-96"><code id="json-content">${JSON.stringify(data, null, 2)}</code></pre>
                        </div>
                    </div>
                </div>
            `;
            
            // Store data globally for copy/download functions
            window.currentJSONData = data;
            window.currentJSONTitle = title;
            
            // Add to page
            document.body.appendChild(modal);
            
            // Add escape key listener
            document.addEventListener('keydown', handleEscapeKey);
            
            // Log telemetry
            dashboard.addEvent('TELEMETRY', `JSON report displayed: ${title}`, 'info');
        }

        // üîß Utility Functions for JSON Display
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
        }

        function getJSONDepth(obj) {
            if (typeof obj !== 'object' || obj === null) return 0;
            let depth = 1;
            for (const key in obj) {
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    depth = Math.max(depth, 1 + getJSONDepth(obj[key]));
                }
            }
            return depth;
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for JSON display formatting
        function formatJSON(style) {
            const content = document.getElementById('json-content');
            if (style === 'compact') {
                content.textContent = JSON.stringify(window.currentJSONData);
            } else {
                content.textContent = JSON.stringify(window.currentJSONData, null, 2);
            }
        }

        // üìã Copy and Download Functions
        // biome-ignore lint/correctness/noUnusedVariables: Available for JSON clipboard operations
        async function copyJSONToClipboard() {
            try {
                const jsonString = JSON.stringify(window.currentJSONData, null, 2);
                await navigator.clipboard.writeText(jsonString);
                
                // Show success feedback
                const button = event.target.closest('button');
                const originalContent = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
                
                dashboard.addEvent('TELEMETRY', 'JSON report copied to clipboard', 'success');
            } catch (error) {
                dashboard.addEvent('TELEMETRY', 'Failed to copy JSON to clipboard', 'error');
                console.error('Failed to copy:', error);
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for JSON download operations
        function downloadJSONReport() {
            try {
                const jsonString = JSON.stringify(window.currentJSONData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${window.currentJSONTitle.toLowerCase().replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                dashboard.addEvent('TELEMETRY', `JSON report downloaded: ${window.currentJSONTitle}`, 'success');
            } catch (error) {
                dashboard.addEvent('TELEMETRY', 'Failed to download JSON report', 'error');
                console.error('Failed to download:', error);
            }
        }

        function closeJSONModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) {
                modal.remove();
                document.removeEventListener('keydown', handleEscapeKey);
                dashboard.addEvent('TELEMETRY', 'JSON report modal closed', 'info');
            }
        }

        function handleEscapeKey(event) {
            if (event.key === 'Escape') {
                closeJSONModal();
            }
        }

        // üéØ Enhanced Console Logging with Telemetry
        function enhanceConsoleLogging() {
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                logToTelemetry('LOG', args);
            };
            
            console.error = function(...args) {
                originalError.apply(console, args);
                logToTelemetry('ERROR', args);
            };
            
            console.warn = function(...args) {
                originalWarn.apply(console, args);
                logToTelemetry('WARN', args);
            };
        }

        function logToTelemetry(level, args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            // Create telemetry entry
            const telemetryEntry = {
                timestamp: new Date().toISOString(),
                level: level,
                message: message,
                args: args.map(arg => typeof arg === 'object' ? '[Object]' : arg),
                url: window.location.href,
                userAgent: navigator.userAgent
            };
            
            // Store in local storage for debugging
            const telemetry = JSON.parse(localStorage.getItem('dashboard-telemetry') || '[]');
            telemetry.push(telemetryEntry);
            
            // Keep only last 100 entries
            if (telemetry.length > 100) {
                telemetry.shift();
            }
            
            localStorage.setItem('dashboard-telemetry', JSON.stringify(telemetry));
        }

        // üìä Enhanced Telemetry Viewer
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute (line 181)
        function showTelemetryViewer() {
            const telemetry = JSON.parse(localStorage.getItem('dashboard-telemetry') || '[]');
            
            // Enhanced telemetry analysis
            const analysis = analyzeTelemetry(telemetry);
            
            const enhancedTelemetry = {
                summary: {
                    totalEvents: telemetry.length,
                    errorCount: analysis.errorCount,
                    warningCount: analysis.warningCount,
                    infoCount: analysis.infoCount,
                    timeRange: {
                        start: telemetry.length > 0 ? telemetry[0].timestamp : null,
                        end: telemetry.length > 0 ? telemetry[telemetry.length - 1].timestamp : null
                    },
                    depth: currentDepth,
                    consoleDepth: localStorage.getItem('bun-console-depth') || '3'
                },
                errorAnalysis: {
                    dashboardRefreshErrors: analysis.dashboardRefreshErrors,
                    mostFrequentErrors: analysis.mostFrequentErrors,
                    errorRate: `${((analysis.errorCount / telemetry.length) * 100).toFixed(2)}%`,
                    status: analysis.errorCount > 0 ? 'Needs Attention' : 'Healthy'
                },
                performanceMetrics: {
                    averageEventInterval: analysis.averageInterval,
                    peakErrorFrequency: analysis.peakFrequency,
                    systemStability: analysis.systemStability
                },
                recommendations: generateTelemetryRecommendations(analysis),
                rawData: telemetry,
                filteredData: {
                    errorsOnly: telemetry.filter(event => event.level === 'ERROR'),
                    warningsOnly: telemetry.filter(event => event.level === 'WARNING'),
                    recent: telemetry.slice(-10)
                }
            };
            
            displayJSONReport(enhancedTelemetry, 'Enhanced Console Telemetry Analysis');
            dashboard.addEvent('TELEMETRY', 'Enhanced telemetry analysis completed', 'info');
        }

        function analyzeTelemetry(telemetry) {
            const errorCount = telemetry.filter(event => event.level === 'ERROR').length;
            const warningCount = telemetry.filter(event => event.level === 'WARNING').length;
            const infoCount = telemetry.filter(event => event.level === 'INFO').length;
            
            // Count dashboard.refresh errors specifically
            const dashboardRefreshErrors = telemetry.filter(event => 
                event.message?.includes('dashboard.refresh')
            ).length;
            
            // Find most frequent errors
            const errorMessages = {};
            telemetry.filter(event => event.level === 'ERROR').forEach(event => {
                const message = event.message || 'Unknown error';
                errorMessages[message] = (errorMessages[message] || 0) + 1;
            });
            
            const mostFrequentErrors = Object.entries(errorMessages)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([message, count]) => ({ message, count }));
            
            // Calculate average interval between events
            let averageInterval = 0;
            if (telemetry.length > 1) {
                const intervals = [];
                for (let i = 1; i < telemetry.length; i++) {
                    const prev = new Date(telemetry[i-1].timestamp);
                    const curr = new Date(telemetry[i].timestamp);
                    intervals.push(curr - prev);
                }
                averageInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
            }
            
            // Calculate peak error frequency
            const errorTimestamps = telemetry
                .filter(event => event.level === 'ERROR')
                .map(event => new Date(event.timestamp).getTime());
            
            let peakFrequency = 0;
            if (errorTimestamps.length > 1) {
                const intervals = [];
                for (let i = 1; i < errorTimestamps.length; i++) {
                    intervals.push(errorTimestamps[i] - errorTimestamps[i-1]);
                }
                const minInterval = Math.min(...intervals);
                peakFrequency = minInterval < 1000 ? 'High' : minInterval < 5000 ? 'Medium' : 'Low';
            }
            
            // System stability assessment
            const systemStability = errorCount === 0 ? 'Excellent' : 
                                  errorCount < 5 ? 'Good' : 
                                  errorCount < 20 ? 'Fair' : 'Poor';
            
            return {
                errorCount,
                warningCount,
                infoCount,
                dashboardRefreshErrors,
                mostFrequentErrors,
                averageInterval: Math.round(averageInterval),
                peakFrequency,
                systemStability
            };
        }

        function generateTelemetryRecommendations(analysis) {
            const recommendations = [];
            
            if (analysis.dashboardRefreshErrors > 0) {
                recommendations.push({
                    priority: 'HIGH',
                    issue: 'Dashboard refresh errors detected',
                    solution: 'Keyboard shortcut system was fixed - errors should be resolved',
                    action: 'Monitor for any recurring refresh issues'
                });
            }
            
            if (analysis.errorCount > analysis.infoCount) {
                recommendations.push({
                    priority: 'MEDIUM',
                    issue: 'High error-to-info ratio',
                    solution: 'Review error patterns and implement preventive measures',
                    action: 'Consider adding more robust error handling'
                });
            }
            
            if (analysis.averageInterval < 1000) {
                recommendations.push({
                    priority: 'LOW',
                    issue: 'High frequency of events',
                    solution: 'Events are generating frequently, which is expected for active debugging',
                    action: 'Normal behavior for development environment'
                });
            }
            
            if (analysis.systemStability === 'Excellent') {
                recommendations.push({
                    priority: 'INFO',
                    issue: 'System operating normally',
                    solution: 'No issues detected - system is performing well',
                    action: 'Continue monitoring'
                });
            }
            
            return recommendations;
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for telemetry management
        function clearTelemetryData() {
            if (confirm('Are you sure you want to clear all telemetry data?')) {
                localStorage.removeItem('dashboard-telemetry');
                dashboard.addEvent('TELEMETRY', 'Telemetry data cleared', 'info');
                showTelemetryViewer(); // Refresh the view
            }
        }

        // üìä Telemetry Viewer
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute (line 181)
        function showTelemetryViewerLegacy() {
            const telemetry = JSON.parse(localStorage.getItem('dashboard-telemetry') || '[]');
            
            if (telemetry.length === 0) {
                alert('No telemetry data available.');
                return;
            }
            
            displayJSONReport(telemetry, 'Console Telemetry Data');
        }

        // üåä Streaming Demo Function
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute (line 182)
        async function demonstrateStreamingDemo() {
            try {
                dashboard.addEvent('STREAMING', 'Starting Uint8Array to ReadableStream demo', 'info');
                await dashboard.demonstrateStreaming();
                
                // The modal will be displayed automatically by the enhanced function
                dashboard.addEvent('STREAMING', 'Streaming demo completed successfully', 'success');
            } catch (error) {
                dashboard.addEvent('STREAMING', `Streaming demo failed: ${error.message}`, 'error');
                console.error('Streaming demo error:', error);
            }
        }

        // üìä Enhanced Status Management
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick attribute (line 154)
        function toggleStatusDetails() {
            const statusDetails = {
                current: document.getElementById('overall-status').textContent,
                uptime: document.getElementById('uptime-percentage').textContent,
                lastCheck: new Date().toLocaleString(),
                components: {
                    api: 'OPERATIONAL',
                    database: 'OPERATIONAL', 
                    cache: 'OPERATIONAL',
                    storage: 'OPERATIONAL',
                    monitoring: 'OPERATIONAL'
                },
                metrics: {
                    responseTime: Math.floor(Math.random() * 50) + 20 + 'ms',
                    errorRate: (Math.random() * 0.1).toFixed(3) + '%',
                    throughput: Math.floor(Math.random() * 1000) + 500 + ' req/min',
                    activeConnections: Math.floor(Math.random() * 100) + 50
                }
            };
            
            displayJSONReport(statusDetails, 'System Status Details');
        }

        function updateSystemStatus(status = 'HEALTHY', details = {}) {
            const statusElement = document.getElementById('overall-status');
            const indicatorElement = document.getElementById('status-indicator');
            const uptimeElement = document.getElementById('uptime-percentage');
            
            // Update status text with color coding
            statusElement.textContent = status;
            statusElement.className = 'font-semibold text-lg transition-all duration-300';
            
            // Update colors based on status
            switch (status.toUpperCase()) {
                case 'HEALTHY':
                    statusElement.classList.add('text-green-400');
                    indicatorElement.className = 'status-indicator bg-green-400 w-3 h-3 rounded-full animate-pulse';
                    break;
                case 'WARNING':
                    statusElement.classList.add('text-yellow-400');
                    indicatorElement.className = 'status-indicator bg-yellow-400 w-3 h-3 rounded-full animate-pulse';
                    break;
                case 'CRITICAL':
                    statusElement.classList.add('text-red-400');
                    indicatorElement.className = 'status-indicator bg-red-400 w-3 h-3 rounded-full animate-pulse';
                    break;
                case 'MAINTENANCE':
                    statusElement.classList.add('text-blue-400');
                    indicatorElement.className = 'status-indicator bg-blue-400 w-3 h-3 rounded-full';
                    break;
                default:
                    statusElement.classList.add('text-gray-400');
                    indicatorElement.className = 'status-indicator bg-gray-400 w-3 h-3 rounded-full';
            }
            
            // Update uptime if provided
            if (details.uptime) {
                uptimeElement.textContent = details.uptime;
            }
            
            // Log status change
            dashboard.addEvent('SYSTEM', `System status changed to ${status}`, 'info');
        }

        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick AI insights button
        function toggleAIInsights() {
            const buttonText = document.getElementById('ai-insights-text');
            if (buttonText.textContent === 'Expand') {
                buttonText.textContent = 'Collapse';
                dashboard.addEvent('AI', 'AI insights expanded', 'info');
            } else {
                buttonText.textContent = 'Expand';
                dashboard.addEvent('AI', 'AI insights collapsed', 'info');
            }
        }

        // biome-ignore lint/correctness/noUnusedVariables: Available for WebSocket reconnection
        function reconnectWebSocket() {
            if (window.advancedExtensions) {
                dashboard.addEvent('WEBSOCKET', 'Attempting to reconnect...', 'info');
                window.advancedExtensions.initializeWebSocket();
            } else {
                dashboard.addEvent('WEBSOCKET', 'Advanced extensions not yet initialized', 'warning');
            }
        }

        // üöÄ Advanced AI Functions - Predictive Maintenance
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick predictive maintenance button
        function runPredictiveMaintenance() {
            dashboard.addEvent('AI', 'Running predictive maintenance analysis...', 'info');

            // Simulate comprehensive predictive maintenance analysis
            const maintenanceAnalysis = {
                timestamp: new Date().toISOString(),
                systemHealth: {
                    overall: 'GOOD',
                    components: {
                        database: { health: 92, predictedFailure: '45 days', maintenance: 'Low priority' },
                        api: { health: 87, predictedFailure: '23 days', maintenance: 'Medium priority' },
                        cache: { health: 95, predictedFailure: '67 days', maintenance: 'Low priority' },
                        storage: { health: 78, predictedFailure: '12 days', maintenance: 'High priority' }
                    }
                },
                predictiveInsights: {
                    failurePredictions: [
                        {
                            component: 'Storage Cluster',
                            probability: 0.78,
                            timeToFailure: '12 days',
                            cause: 'Disk space utilization > 85%',
                            recommendation: 'Increase storage capacity or implement data archiving',
                            impact: 'High - Could cause data loss',
                            mitigation: 'Immediate action required'
                        },
                        {
                            component: 'API Gateway',
                            probability: 0.45,
                            timeToFailure: '23 days',
                            cause: 'Memory leak in request handler',
                            recommendation: 'Deploy patch v2.1.4 and restart services',
                            impact: 'Medium - Service degradation',
                            mitigation: 'Schedule maintenance window'
                        },
                        {
                            component: 'Database Connection Pool',
                            probability: 0.23,
                            timeToFailure: '45 days',
                            cause: 'Connection pool exhaustion under load',
                            recommendation: 'Increase max connections from 100 to 150',
                            impact: 'Low - Performance impact',
                            mitigation: 'Monitor and scale as needed'
                        }
                    ],
                    performanceOptimization: [
                        {
                            type: 'Database Query Optimization',
                            potentialGain: '35% faster response time',
                            implementation: 'Add composite indexes on user_id, created_at columns',
                            effort: 'Medium',
                            risk: 'Low'
                        },
                        {
                            type: 'Caching Strategy Enhancement',
                            potentialGain: '50% reduction in API calls',
                            implementation: 'Implement Redis caching for user sessions',
                            effort: 'High',
                            risk: 'Medium'
                        },
                        {
                            type: 'Load Balancing Optimization',
                            potentialGain: '25% better resource utilization',
                            implementation: 'Distribute load across 3 additional servers',
                            effort: 'High',
                            risk: 'Low'
                        }
                    ]
                },
                maintenanceSchedule: {
                    immediate: [
                        'Storage capacity expansion - Due: Today',
                        'Security patch deployment - Due: Tomorrow',
                        'Database backup verification - Due: This week'
                    ],
                    shortTerm: [
                        'API Gateway patch deployment - Due: 2 weeks',
                        'Load balancer configuration - Due: 3 weeks',
                        'Monitoring system upgrade - Due: 4 weeks'
                    ],
                    longTerm: [
                        'Infrastructure migration to cloud-native - Due: 3 months',
                        'Microservices architecture refactoring - Due: 6 months',
                        'AI/ML model retraining - Due: 9 months'
                    ]
                },
                costOptimization: {
                    currentSpend: '$12,450/month',
                    potentialSavings: '$3,200/month',
                    recommendations: [
                        {
                            action: 'Rightsize EC2 instances',
                            savings: '$1,200/month',
                            effort: 'Low',
                            impact: 'Immediate'
                        },
                        {
                            action: 'Implement auto-scaling',
                            savings: '$950/month',
                            effort: 'Medium',
                            impact: 'High'
                        },
                        {
                            action: 'Optimize data storage tier',
                            savings: '$1,050/month',
                            effort: 'Medium',
                            impact: 'Medium'
                        }
                    ]
                },
                riskAssessment: {
                    overallRisk: 'Medium',
                    riskFactors: [
                        { factor: 'Storage capacity', level: 'High', mitigation: 'In progress' },
                        { factor: 'API performance', level: 'Medium', mitigation: 'Planned' },
                        { factor: 'Security vulnerabilities', level: 'Low', mitigation: 'Complete' }
                    ],
                    recommendations: [
                        'Implement automated monitoring alerts',
                        'Establish regular maintenance windows',
                        'Create incident response playbooks',
                        'Conduct quarterly architecture reviews'
                    ]
                }
            };

            displayJSONReport(maintenanceAnalysis, 'Predictive Maintenance Analysis Report');
            dashboard.addEvent('AI', 'Predictive maintenance analysis completed', 'success');
        }

        // üõ°Ô∏è Advanced AI Functions - Security Analysis
        // biome-ignore lint/correctness/noUnusedVariables: Called from HTML onclick security analysis button
        function generateSecurityInsights() {
            dashboard.addEvent('AI', 'Generating advanced security insights...', 'info');

            // Simulate comprehensive security analysis
            const securityAnalysis = {
                timestamp: new Date().toISOString(),
                threatLandscape: {
                    currentThreatLevel: 'MODERATE',
                    activeThreats: 3,
                    monitoredIPs: 1247,
                    blockedIPs: 23,
                    threatIntelligence: {
                        knownVulnerabilities: 2,
                        zeroDayExposures: 0,
                        complianceViolations: 1
                    }
                },
                anomalyDetection: {
                    behavioralAnomalies: [
                        {
                            type: 'Unusual Login Pattern',
                            severity: 'Medium',
                            description: 'Multiple failed login attempts from 3 different countries in 1 hour',
                            affectedUsers: 12,
                            mitigation: 'Implemented geo-blocking and rate limiting',
                            status: 'Resolved'
                        },
                        {
                            type: 'Data Export Spike',
                            severity: 'Low',
                            description: '45% increase in data export requests from single user',
                            affectedUsers: 1,
                            mitigation: 'Enhanced monitoring and audit logging',
                            status: 'Monitoring'
                        },
                        {
                            type: 'API Abuse Pattern',
                            severity: 'High',
                            description: 'Automated script attempting to brute-force API endpoints',
                            affectedUsers: 0,
                            mitigation: 'IP blocking and WAF rule deployment',
                            status: 'Active Mitigation'
                        }
                    ],
                    networkAnomalies: [
                        {
                            type: 'DDoS Attempt',
                            severity: 'Critical',
                            description: 'Coordinated attack from botnet (50,000 requests/min)',
                            source: 'Multiple IPs across 12 countries',
                            mitigation: 'Cloudflare protection activated, traffic filtered',
                            status: 'Mitigated'
                        },
                        {
                            type: 'Data Exfiltration',
                            severity: 'High',
                            description: 'Large data transfer to unauthorized external IP',
                            dataVolume: '2.3GB',
                            mitigation: 'Connection terminated, forensic analysis initiated',
                            status: 'Investigation'
                        }
                    ]
                },
                vulnerabilityAssessment: {
                    critical: 0,
                    high: 2,
                    medium: 7,
                    low: 15,
                    vulnerabilities: [
                        {
                            id: 'CVE-2024-1234',
                            severity: 'High',
                            component: 'API Gateway',
                            description: 'Authentication bypass vulnerability',
                            cvss: 8.2,
                            status: 'Patch Available',
                            dueDate: '2024-02-01',
                            impact: 'Unauthorized access to user data'
                        },
                        {
                            id: 'CVE-2024-5678',
                            severity: 'High',
                            component: 'Database Server',
                            description: 'SQL injection vulnerability',
                            cvss: 7.8,
                            status: 'In Progress',
                            dueDate: '2024-01-28',
                            impact: 'Potential data breach'
                        }
                    ]
                },
                complianceAnalysis: {
                    gdpr: {
                        status: 'Compliant',
                        lastAudit: '2024-01-15',
                        nextAudit: '2024-07-15',
                        issues: 0,
                        recommendations: [
                            'Implement automated consent management',
                            'Enhance data subject access request processing',
                            'Strengthen data encryption standards'
                        ]
                    },
                    soc2: {
                        status: 'Compliant',
                        lastAudit: '2024-01-10',
                        nextAudit: '2024-07-10',
                        issues: 1,
                        recommendations: [
                            'Improve access control logging',
                            'Enhance incident response procedures'
                        ]
                    },
                    pci: {
                        status: 'Compliant',
                        lastAudit: '2024-01-20',
                        nextAudit: '2024-04-20',
                        issues: 0,
                        recommendations: [
                            'Regular security awareness training',
                            'Annual penetration testing'
                        ]
                    }
                },
                securityRecommendations: {
                    immediate: [
                        {
                            priority: 'Critical',
                            action: 'Deploy security patches for CVE-2024-1234 and CVE-2024-5678',
                            deadline: '2024-01-28',
                            owner: 'Security Team',
                            impact: 'Prevents potential data breaches'
                        },
                        {
                            priority: 'High',
                            action: 'Implement advanced threat detection for API endpoints',
                            deadline: '2024-02-05',
                            owner: 'DevOps Team',
                            impact: 'Reduces attack surface'
                        }
                    ],
                    shortTerm: [
                        {
                            priority: 'Medium',
                            action: 'Conduct comprehensive security audit',
                            deadline: '2024-03-01',
                            owner: 'External Auditors',
                            impact: 'Ensures compliance and identifies gaps'
                        },
                        {
                            priority: 'Medium',
                            action: 'Implement zero-trust architecture',
                            deadline: '2024-04-01',
                            owner: 'Architecture Team',
                            impact: 'Enhances overall security posture'
                        }
                    ],
                    longTerm: [
                        {
                            priority: 'Low',
                            action: 'Deploy AI-powered threat detection',
                            deadline: '2024-06-01',
                            owner: 'Security Team',
                            impact: 'Proactive threat identification'
                        },
                        {
                            priority: 'Low',
                            action: 'Implement quantum-resistant encryption',
                            deadline: '2024-12-01',
                            owner: 'Security Team',
                            impact: 'Future-proofs encryption standards'
                        }
                    ]
                },
                securityMetrics: {
                    mtd: '45 days', // Mean Time to Detect
                    mtr: '2 hours', // Mean Time to Respond
                    mttf: '120 days', // Mean Time to Failure
                    mttr: '4 hours', // Mean Time to Recover
                    availability: '99.97%',
                    securityIncidents: {
                        thisMonth: 3,
                        lastMonth: 7,
                        trend: 'Improving',
                        categories: {
                            authentication: 1,
                            authorization: 1,
                            dataExfiltration: 1
                        }
                    }
                },
                aiPoweredInsights: {
                    threatPrediction: {
                        next30Days: 'Low risk of major incidents',
                        confidence: 0.82,
                        factors: [
                            'Recent security improvements',
                            'Stable threat landscape',
                            'Effective monitoring in place'
                        ]
                    },
                    behavioralAnalysis: {
                        userPatterns: 'Normal activity patterns detected',
                        anomalies: 2,
                        recommendations: [
                            'Monitor unusual login locations',
                            'Implement adaptive authentication'
                        ]
                    },
                    riskAssessment: {
                        overallRisk: 'Medium',
                        riskScore: 42,
                        riskFactors: [
                            { factor: 'Unpatched vulnerabilities', weight: 0.3, score: 25 },
                            { factor: 'Access control', weight: 0.2, score: 15 },
                            { factor: 'Network security', weight: 0.2, score: 10 },
                            { factor: 'Data protection', weight: 0.3, score: 20 }
                        ]
                    }
                }
            };

            displayJSONReport(securityAnalysis, 'Advanced Security Analysis Report');
            dashboard.addEvent('AI', 'Advanced security analysis completed', 'success');
        }

        function updateAIInsightsUI(report) {
            // Update anomaly detection
            const anomalies = report.aiInsights.anomalies;
            document.getElementById('anomaly-performance').textContent = 
                anomalies.filter(a => a.type === 'performance').length > 0 ? 'Warning' : 'Normal';
            document.getElementById('anomaly-security').textContent = 
                anomalies.filter(a => a.type === 'security').length > 0 ? 'Alert' : 'Clear';
            document.getElementById('anomaly-last-scan').textContent = 'Just now';
            
            // Update predictive analytics
            const predictions = report.aiInsights.predictions;
            if (predictions.predictions && predictions.predictions.length > 0) {
                const trend = predictions.trend;
                const trendIcon = trend === 'increasing' ? '‚ÜóÔ∏è' : trend === 'decreasing' ? '‚ÜòÔ∏è' : '‚Üí';
                document.getElementById('predictive-trend').textContent = `Stable ${trendIcon}`;
                document.getElementById('prediction-confidence').textContent = 
                    `${Math.round(predictions.predictions[0].confidence * 100)}%`;
            }
            
            // Update risk assessment
            const riskAssessment = report.security.riskAssessment;
            document.getElementById('overall-risk').textContent = `${riskAssessment.score}%`;
            document.getElementById('risk-bar').style.width = `${riskAssessment.score}%`;
            
            // Update risk level badge
            const riskBadge = document.getElementById('risk-level-badge');
            riskBadge.textContent = riskAssessment.level.toUpperCase();
            riskBadge.className = `text-xs px-2 py-1 rounded-full ${
                riskAssessment.level === 'critical' ? 'bg-red-100 text-red-800' :
                riskAssessment.level === 'high' ? 'bg-orange-100 text-orange-800' :
                riskAssessment.level === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                'bg-green-100 text-green-800'
            }`;
            
            // Update real-time metrics
            const metrics = report.realTimeMetrics;
            document.getElementById('real-time-latency').textContent = `${metrics.networkLatency || 12}ms`;
            document.getElementById('api-response-time').textContent = `${metrics.apiResponseTime || 45}ms`;
            
            dashboard.addEvent('AI', 'UI updated with latest AI insights', 'success');
        }

        // Simulate real-time updates for AI insights
        function simulateAIInsightsUpdates() {
            setInterval(() => {
                if (window.advancedExtensions && dashboard.autoRefresh) {
                    // Update anomaly detection with random variations
                    const anomalies = ['Normal', 'Warning', 'Alert'];
                    const randomAnomaly = anomalies[Math.floor(Math.random() * anomalies.length)];
                    document.getElementById('anomaly-network').textContent = randomAnomaly;
                    
                    // Update predictive analytics
                    const risks = ['Low (5%)', 'Medium (15%)', 'High (25%)'];
                    const randomRisk = risks[Math.floor(Math.random() * risks.length)];
                    document.getElementById('failure-risk').textContent = randomRisk;
                    
                    // Update behavioral analysis
                    const actions = ['Login', 'Upload', 'Download', 'Search'];
                    const randomAction = actions[Math.floor(Math.random() * actions.length)];
                    document.getElementById('common-action').textContent = randomAction;
                    
                    // Update real-time metrics
                    const latency = Math.floor(Math.random() * 50) + 10;
                    const responseTime = Math.floor(Math.random() * 100) + 30;
                    const connections = Math.floor(Math.random() * 200) + 150;
                    const throughput = (Math.random() * 2 + 0.5).toFixed(1);
                    
                    document.getElementById('real-time-latency').textContent = `${latency}ms`;
                    document.getElementById('api-response-time').textContent = `${responseTime}ms`;
                    document.getElementById('active-connections').textContent = connections;
                    document.getElementById('data-throughput').textContent = `${throughput}MB/s`;
                }
            }, 5000); // Update every 5 seconds
        }

        // New functions for enhanced features
        function toggleAnalyticsView() {
            const buttonText = document.getElementById('analytics-view-text');
            if (buttonText.textContent === 'Expand View') {
                buttonText.textContent = 'Compact View';
                dashboard.addEvent('VIEW', 'Switched to expanded analytics view', 'info');
            } else {
                buttonText.textContent = 'Expand View';
                dashboard.addEvent('VIEW', 'Switched to compact analytics view', 'info');
            }
        }

        function refreshSystemInfo() {
            dashboard.updateSystemMetrics();
            dashboard.addEvent('SYSTEM', 'System information refreshed', 'info');
        }

        function showSystemDetails(component) {
            dashboard.addEvent('SYSTEM', `Viewing ${component} details`, 'info');
            // In a real implementation, this would show a modal with detailed information
            alert(`${component.charAt(0).toUpperCase() + component.slice(1)} Details:\n\nStatus: Operational\nLast Updated: ${new Date().toLocaleString()}\nPerformance: Excellent\nUptime: 99.9%`);
        }

        function refreshInsights() {
            dashboard.updateAIInsights();
            dashboard.addEvent('AI', 'AI insights refreshed', 'info');
        }

        // Functions for new features
        function toggleActivityFeed() {
            dashboard.activityFeedActive = !dashboard.activityFeedActive;
            const feedText = document.getElementById('activity-feed-text');
            if (dashboard.activityFeedActive) {
                feedText.textContent = 'Pause Feed';
                dashboard.addEvent('FEED', 'Activity feed resumed', 'info');
            } else {
                feedText.textContent = 'Resume Feed';
                dashboard.addEvent('FEED', 'Activity feed paused', 'info');
            }
        }

        // ü§ñ User Behavior Insights Functions
        function refreshBehaviorInsights() {
            dashboard.addEvent('BEHAVIOR', 'Refreshing behavior insights...', 'info');

            // Simulate behavior insights update
            const behaviors = ['Normal', 'Active', 'Engaged', 'Low Activity'];
            const engagements = ['High', 'Medium', 'Low'];
            const risks = ['Low', 'Medium', 'High'];
            const actions = ['View Dashboard', 'Transfer Funds', 'Check Balance', 'Update Profile'];

            // Update current behavior
            document.getElementById('behavior-status').textContent = behaviors[Math.floor(Math.random() * behaviors.length)];
            document.getElementById('current-engagement').textContent = engagements[Math.floor(Math.random() * engagements.length)];
            document.getElementById('current-risk').textContent = risks[Math.floor(Math.random() * risks.length)];
            document.getElementById('session-activity').textContent = ['Active', 'Idle', 'Very Active'][Math.floor(Math.random() * 3)];
            document.getElementById('behavior-last-update').textContent = 'Just now';

            // Update predictions
            document.getElementById('predicted-action').textContent = actions[Math.floor(Math.random() * actions.length)];
            document.getElementById('prediction-confidence').textContent = `${Math.floor(Math.random() * 30) + 70}%`;
            document.getElementById('time-horizon').textContent = `${Math.floor(Math.random() * 10) + 1} min`;
            document.getElementById('active-model').textContent = ['Sequential Predictor', 'Engagement Model', 'Risk Classifier'][Math.floor(Math.random() * 3)];

            // Update patterns
            document.getElementById('patterns-count').textContent = Math.floor(Math.random() * 5) + 1;
            document.getElementById('sequential-patterns').textContent = Math.floor(Math.random() * 3) + 1;
            document.getElementById('temporal-patterns').textContent = Math.floor(Math.random() * 2);
            document.getElementById('associational-patterns').textContent = Math.floor(Math.random() * 2);
            document.getElementById('pattern-analysis').textContent = 'Real-time';

            // Update recommendations
            document.getElementById('recommendations-count').textContent = Math.floor(Math.random() * 3) + 1;
            document.getElementById('recommendations-update').textContent = 'Just now';

            dashboard.addEvent('BEHAVIOR', 'Behavior insights refreshed', 'success');
        }

        function openBehaviorModal() {
            const behaviorData = {
                timestamp: new Date().toISOString(),
                currentSession: {
                    userId: 'user_' + Math.floor(Math.random() * 1000),
                    sessionId: 'session_' + Date.now(),
                    startTime: new Date(Date.now() - Math.random() * 3600000).toISOString(),
                    duration: Math.floor(Math.random() * 1800) + 300, // 5-35 minutes
                    pageViews: Math.floor(Math.random() * 20) + 5,
                    actionsPerformed: Math.floor(Math.random() * 15) + 3
                },
                behaviorMetrics: {
                    engagement: {
                        score: Math.floor(Math.random() * 40) + 60,
                        level: ['High', 'Medium', 'Low'][Math.floor(Math.random() * 3)],
                        factors: [
                            'Time spent on dashboard',
                            'Feature interactions',
                            'Navigation patterns'
                        ]
                    },
                    risk: {
                        score: Math.floor(Math.random() * 30) + 20,
                        level: ['Low', 'Medium', 'High'][Math.floor(Math.random() * 3)],
                        indicators: [
                            'Login frequency',
                            'Unusual access times',
                            'Geographic consistency'
                        ]
                    },
                    activity: {
                        level: ['Very Active', 'Active', 'Moderate', 'Low'][Math.floor(Math.random() * 4)],
                        patterns: [
                            'Regular login times',
                            'Consistent feature usage',
                            'Predictable behavior'
                        ]
                    }
                },
                predictions: {
                    nextActions: [
                        {
                            action: 'view_accounts',
                            probability: Math.random() * 0.4 + 0.6,
                            timeHorizon: Math.floor(Math.random() * 15) + 5,
                            confidence: Math.random() * 0.3 + 0.7
                        },
                        {
                            action: 'transfer_funds',
                            probability: Math.random() * 0.3 + 0.4,
                            timeHorizon: Math.floor(Math.random() * 30) + 10,
                            confidence: Math.random() * 0.4 + 0.6
                        },
                        {
                            action: 'security_check',
                            probability: Math.random() * 0.2 + 0.1,
                            timeHorizon: Math.floor(Math.random() * 60) + 30,
                            confidence: Math.random() * 0.5 + 0.5
                        }
                    ],
                    trends: {
                        engagement: ['increasing', 'stable', 'decreasing'][Math.floor(Math.random() * 3)],
                        risk: ['decreasing', 'stable', 'increasing'][Math.floor(Math.random() * 3)],
                        activity: ['stable', 'increasing', 'decreasing'][Math.floor(Math.random() * 3)]
                    }
                },
                patterns: {
                    detected: Math.floor(Math.random() * 5) + 1,
                    types: {
                        sequential: Math.floor(Math.random() * 3) + 1,
                        temporal: Math.floor(Math.random() * 2),
                        associational: Math.floor(Math.random() * 2)
                    },
                    examples: [
                        {
                            type: 'sequential',
                            pattern: ['login', 'view_dashboard', 'check_balance'],
                            frequency: Math.floor(Math.random() * 10) + 5,
                            confidence: Math.random() * 0.3 + 0.7
                        },
                        {
                            type: 'temporal',
                            pattern: 'business_hours_activity',
                            frequency: Math.floor(Math.random() * 8) + 3,
                            confidence: Math.random() * 0.4 + 0.6
                        }
                    ]
                },
                recommendations: [
                    {
                        id: 'rec_' + Date.now(),
                        type: 'engagement',
                        title: 'Boost Account Activity',
                        description: 'We noticed lower activity. Try exploring new features to maximize your OnePay experience.',
                        confidence: Math.random() * 0.3 + 0.7,
                        impact: 'high',
                        actionable: true,
                        category: 'engagement'
                    },
                    {
                        id: 'rec_' + (Date.now() + 1),
                        type: 'security',
                        title: 'Enhanced Security',
                        description: 'Consider enabling additional security features for better protection.',
                        confidence: Math.random() * 0.4 + 0.6,
                        impact: 'medium',
                        actionable: true,
                        category: 'security'
                    },
                    {
                        id: 'rec_' + (Date.now() + 2),
                        type: 'personalization',
                        title: 'Personalized Experience',
                        description: 'We\'ve optimized your dashboard based on your usage patterns.',
                        confidence: Math.random() * 0.5 + 0.5,
                        impact: 'low',
                        actionable: false,
                        category: 'personalization'
                    }
                ],
                insights: {
                    summary: 'User behavior analysis completed with AI-powered predictions and personalized recommendations.',
                    keyFindings: [
                        'Consistent login patterns during business hours',
                        'High engagement with account management features',
                        'Low risk indicators across all security metrics',
                        'Potential for increased feature adoption'
                    ],
                    nextSteps: [
                        'Monitor for changes in behavior patterns',
                        'Consider personalized feature recommendations',
                        'Track engagement metrics over time'
                    ]
                }
            };

            displayJSONReport(behaviorData, 'User Behavior Insights - AI-Powered Analysis');
            dashboard.addEvent('BEHAVIOR', 'Behavior insights modal opened', 'info');
        }

        function updateMetricsTimeframe() {
            const timeframe = document.getElementById('metrics-timeframe').value;
            dashboard.addEvent('METRICS', `Timeframe changed to ${timeframe}`, 'info');
            dashboard.updatePerformanceMetrics();
        }

        function refreshGeoData() {
            dashboard.addEvent('GEO', 'Geographic data refreshed', 'info');
            // Simulate geo data refresh with random variations
            const regions = document.querySelectorAll('.text-right .font-semibold');
            regions.forEach(region => {
                if (region?.textContent?.includes('%')) {
                    const currentPercent = parseInt(region.textContent, 10);
                    const newPercent = Math.floor(Math.random() * 10) + currentPercent - 5;
                    region.textContent = `${Math.max(5, Math.min(50, newPercent))}%`;
                }
            });
        }

        // Functions for Bun Secrets Management
        function refreshSecretsStatus() {
            dashboard.updateSecretsStatus();
            dashboard.addEvent('SECURITY', 'Secrets status refreshed', 'info');
        }

        function testSecretsIntegration() {
            dashboard.testBunSecretsIntegration();
        }

        function exportSecureConfig() {
            dashboard.exportSecureConfig();
        }

        function rotateSecret(secretType) {
            dashboard.rotateSecret(secretType);
        }

        function rotateAllSecrets() {
            dashboard.rotateAllSecrets();
        }

        function auditSecrets() {
            dashboard.auditSecrets();
        }

        function switchEnvironment() {
            const env = document.getElementById('environment-select').value;
            dashboard.addEvent('ENVIRONMENT', `Switched to ${env} environment`, 'info');
            
            // Update environment-specific configurations
            const configs = {
                development: {
                    database: 'PostgreSQL: localhost',
                    cloud: 'AWS: us-east-1 (dev)',
                    api: '3 services active (dev)'
                },
                staging: {
                    database: 'PostgreSQL: staging-db.example.com',
                    cloud: 'AWS: us-west-2 (staging)',
                    api: '5 services active (staging)'
                },
                production: {
                    database: 'PostgreSQL: prod-cluster.example.com',
                    cloud: 'AWS: us-east-1 (prod)',
                    api: '8 services active (prod)'
                }
            };
            
            const config = configs[env];
            document.getElementById('db-config').textContent = config.database;
            document.getElementById('cloud-config').textContent = config.cloud;
            document.getElementById('api-config').textContent = config.api;
            
            // Re-check environment variables for new environment
            dashboard.checkEnvironmentVariables();
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new OnePayDashboard();
            
            // Add some initial events for demonstration
            setTimeout(() => {
                dashboard.addEvent('SYSTEM', 'Dashboard initialized successfully', 'success');
                dashboard.addEvent('SECURITY', 'Security protocols activated', 'info');
                dashboard.addEvent('PERFORMANCE', 'Performance monitoring started', 'info');
                
                // Demonstrate PII scrubbing
                const testPath = '/Users/johnsmith/Documents/secret-file.txt';
                dashboard.logSecure('Testing PII scrubbing', { originalPath: testPath, scrubbedPath: dashboard.scrubPath(testPath) });
                
                // Demonstrate file watching
                dashboard.startFileWatcher('/Users/test/monitor');
                
                // Demonstrate S3 upload with timeout
                dashboard.uploadWithTimeout('test-config.json', new Blob(['test data'], { type: 'application/json' }))
                    .then(() => {
                        dashboard.addEvent('STORAGE', `Configuration uploaded successfully`, 'success');
                    })
                    .catch(error => {
                        dashboard.addEvent('STORAGE', `Configuration upload failed: ${error.message}`, 'error');
                    });
                
                // Demonstrate Uint8Array to ReadableStream conversion
                dashboard.demonstrateStreaming();
                    
            }, 1000);
            
            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                dashboard.cleanup();
            });
        });

        // üöÄ Advanced Dashboard Enhancements
        class AdvancedDashboardExtensions {
            constructor(dashboard) {
                this.dashboard = dashboard;
                this.websocket = null;
                this.aiInsights = new Map();
                this.performanceCache = new Map();
                this.realTimeMetrics = {
                    networkLatency: 0,
                    apiResponseTime: 0,
                    memoryUsage: 0,
                    cpuUsage: 0
                };
                this.predictiveAnalytics = {
                    failurePrediction: 0,
                    performanceTrend: 'stable',
                    capacityForecast: 0
                };
            }

            // üåê Real-time WebSocket Connection
            initializeWebSocket() {
                try {
                    this.websocket = new WebSocket('ws://localhost:3227/ws');
                    
                    this.websocket.onopen = () => {
                        this.dashboard.addEvent('WEBSOCKET', 'Real-time connection established', 'success');
                        this.startRealTimeDataStream();
                    };
                    
                    this.websocket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.processRealTimeData(data);
                    };
                    
                    this.websocket.onerror = (error) => {
                        this.dashboard.addEvent('WEBSOCKET', `Connection error: ${error.message}`, 'error');
                    };
                    
                    this.websocket.onclose = () => {
                        this.dashboard.addEvent('WEBSOCKET', 'Connection closed', 'warning');
                        // Attempt reconnection after 5 seconds
                        setTimeout(() => this.initializeWebSocket(), 5000);
                    };
                } catch (error) {
                    this.dashboard.addEvent('WEBSOCKET', `Failed to initialize: ${error.message}`, 'error');
                }
            }

            // üìä AI-Powered Analytics Engine
            initializeAIAnalytics() {
                this.aiInsights.set('performance', {
                    anomalyDetection: this.detectAnomalies.bind(this),
                    trendAnalysis: this.analyzeTrends.bind(this),
                    predictiveModeling: this.predictPerformance.bind(this)
                });

                this.aiInsights.set('security', {
                    threatDetection: this.detectThreats.bind(this),
                    riskAssessment: this.assessRisk.bind(this),
                    behavioralAnalysis: this.analyzeBehavior.bind(this)
                });

                this.dashboard.addEvent('AI', 'AI analytics engine initialized', 'success');
            }

            // üîç Anomaly Detection Algorithm
            detectAnomalies(metrics) {
                const thresholds = {
                    responseTime: 5000, // 5 seconds
                    errorRate: 5, // 5%
                    memoryUsage: 90 // 90%
                };

                const anomalies = [];
                
                if (metrics.responseTime > thresholds.responseTime) {
                    anomalies.push({
                        type: 'performance',
                        severity: 'high',
                        message: `Response time (${metrics.responseTime}ms) exceeds threshold`,
                        recommendation: 'Consider scaling resources or optimizing queries'
                    });
                }
                
                if (metrics.errorRate > thresholds.errorRate) {
                    anomalies.push({
                        type: 'reliability',
                        severity: 'medium',
                        message: `Error rate (${metrics.errorRate}%) exceeds threshold`,
                        recommendation: 'Review recent deployments and error logs'
                    });
                }

                return anomalies;
            }

            // üìà Trend Analysis
            analyzeTrends(historicalData) {
                if (historicalData.length < 10) return { trend: 'insufficient_data' };
                
                const recent = historicalData.slice(-10);
                const older = historicalData.slice(-20, -10);
                
                const recentAvg = recent.reduce((sum, item) => sum + item.value, 0) / recent.length;
                const olderAvg = older.reduce((sum, item) => sum + item.value, 0) / older.length;
                
                const change = ((recentAvg - olderAvg) / olderAvg) * 100;
                
                let trend, confidence;
                if (Math.abs(change) < 5) {
                    trend = 'stable';
                    confidence = 'high';
                } else if (change > 0) {
                    trend = 'increasing';
                    confidence = change > 15 ? 'high' : 'medium';
                } else {
                    trend = 'decreasing';
                    confidence = change < -15 ? 'high' : 'medium';
                }
                
                return { trend, change, confidence };
            }

            // üîÆ Predictive Performance Modeling
            predictPerformance(_currentMetrics, historicalData) {
                // Simple linear regression for prediction
                const dataPoints = historicalData.slice(-50).map((item, index) => ({
                    x: index,
                    y: item.value
                }));
                
                if (dataPoints.length < 10) {
                    return { prediction: 'insufficient_data', confidence: 0 };
                }
                
                // Calculate linear regression
                const n = dataPoints.length;
                const sumX = dataPoints.reduce((sum, point) => sum + point.x, 0);
                const sumY = dataPoints.reduce((sum, point) => sum + point.y, 0);
                const sumXY = dataPoints.reduce((sum, point) => sum + point.x * point.y, 0);
                const sumX2 = dataPoints.reduce((sum, point) => sum + point.x * point.x, 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                // Predict next 10 time periods
                const predictions = [];
                for (let i = 1; i <= 10; i++) {
                    const predictedValue = slope * (n + i) + intercept;
                    predictions.push({
                        time: i,
                        value: Math.max(0, predictedValue),
                        confidence: Math.max(0.1, 1 - (i * 0.08)) // Decreasing confidence
                    });
                }
                
                return { predictions, trend: slope > 0 ? 'increasing' : 'decreasing' };
            }

            // üõ°Ô∏è Advanced Threat Detection
            detectThreats(securityEvents) {
                const threats = [];
                const recentEvents = securityEvents.slice(-100);
                
                // Detect unusual patterns
                const failedAuths = recentEvents.filter(e => e.type === 'auth_failure').length;
                const suspiciousIPs = this.detectSuspiciousIPs(recentEvents);
                
                if (failedAuths > 10) {
                    threats.push({
                        type: 'brute_force',
                        severity: 'high',
                        count: failedAuths,
                        recommendation: 'Implement rate limiting and IP blocking'
                    });
                }
                
                if (suspiciousIPs.length > 0) {
                    threats.push({
                        type: 'suspicious_activity',
                        severity: 'medium',
                        ips: suspiciousIPs,
                        recommendation: 'Review IP access patterns and consider geo-blocking'
                    });
                }
                
                return threats;
            }

            // üîç Suspicious IP Detection
            detectSuspiciousIPs(events) {
                const ipCounts = {};
                events.forEach(event => {
                    const ip = event.ip || 'unknown';
                    ipCounts[ip] = (ipCounts[ip] || 0) + 1;
                });
                
                return Object.keys(ipCounts).filter(ip => 
                    ipCounts[ip] > 20 && ip !== 'unknown'
                );
            }

            // üìä Risk Assessment Algorithm
            assessRisk(metrics, threats, anomalies) {
                let riskScore = 0;
                const factors = [];
                
                // Performance risk
                if (metrics.responseTime > 3000) {
                    riskScore += 25;
                    factors.push('High response time');
                }
                
                // Security risk
                threats.forEach(threat => {
                    if (threat.severity === 'high') riskScore += 30;
                    else if (threat.severity === 'medium') riskScore += 15;
                    factors.push(`Security: ${threat.type}`);
                });
                
                // Reliability risk
                anomalies.forEach(anomaly => {
                    if (anomaly.severity === 'high') riskScore += 20;
                    else if (anomaly.severity === 'medium') riskScore += 10;
                    factors.push(`Reliability: ${anomaly.type}`);
                });
                
                const riskLevel = riskScore > 70 ? 'critical' : 
                                riskScore > 40 ? 'high' : 
                                riskScore > 20 ? 'medium' : 'low';
                
                return { score: Math.min(100, riskScore), level: riskLevel, factors };
            }

            // üß† Behavioral Analysis
            analyzeBehavior(userActivity) {
                const patterns = {
                    peakHours: this.identifyPeakHours(userActivity),
                    commonActions: this.identifyCommonActions(userActivity),
                    unusualPatterns: this.detectUnusualPatterns(userActivity)
                };
                
                return patterns;
            }

            // üïê Peak Hours Identification
            identifyPeakHours(activity) {
                const hourlyCounts = new Array(24).fill(0);
                activity.forEach(event => {
                    const hour = new Date(event.timestamp).getHours();
                    hourlyCounts[hour]++;
                });
                
                const maxCount = Math.max(...hourlyCounts);
                const peakHours = hourlyCounts
                    .map((count, hour) => ({ hour, count }))
                    .filter(item => item.count > maxCount * 0.8)
                    .map(item => item.hour);
                
                return peakHours;
            }

            // üîß Common Actions Identification
            identifyCommonActions(activity) {
                const actionCounts = {};
                activity.forEach(event => {
                    actionCounts[event.type] = (actionCounts[event.type] || 0) + 1;
                });
                
                return Object.entries(actionCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([action, count]) => ({ action, count }));
            }

            // ‚ö†Ô∏è Unusual Pattern Detection
            detectUnusualPatterns(activity) {
                const recent = activity.slice(-50);
                const unusual = [];
                
                // Detect spikes in activity
                const hourlyActivity = this.groupByHour(recent);
                const avgActivity = Object.values(hourlyActivity).reduce((a, b) => a + b, 0) / Object.keys(hourlyActivity).length;
                
                Object.entries(hourlyActivity).forEach(([hour, count]) => {
                    if (count > avgActivity * 3) {
                        unusual.push({
                            type: 'activity_spike',
                            hour: parseInt(hour, 10),
                            count,
                            expected: Math.round(avgActivity)
                        });
                    }
                });
                
                return unusual;
            }

            // üìä Group by Hour Helper
            groupByHour(events) {
                const grouped = {};
                events.forEach(event => {
                    const hour = new Date(event.timestamp).getHours();
                    grouped[hour] = (grouped[hour] || 0) + 1;
                });
                return grouped;
            }

            // üåä Real-time Data Stream Processing
            startRealTimeDataStream() {
                if (!this.websocket || this.websocket.readyState !== WebSocket.OPEN) {
                    return;
                }
                
                // Subscribe to real-time metrics
                this.websocket.send(JSON.stringify({
                    type: 'subscribe',
                    channels: ['metrics', 'security', 'performance']
                }));
            }

            // üì® Process Real-time Data
            processRealTimeData(data) {
                switch (data.type) {
                    case 'metrics':
                        this.updateRealTimeMetrics(data.payload);
                        break;
                    case 'security':
                        this.handleSecurityEvent(data.payload);
                        break;
                    case 'performance':
                        this.updatePerformanceMetrics(data.payload);
                        break;
                    default:
                        console.log('Unknown data type:', data.type);
                }
            }

            // üìä Update Real-time Metrics
            updateRealTimeMetrics(metrics) {
                this.realTimeMetrics = { ...this.realTimeMetrics, ...metrics };
                this.dashboard.updateSystemMetrics();
                
                // Trigger anomaly detection
                const anomalies = this.detectAnomalies(metrics);
                if (anomalies.length > 0) {
                    anomalies.forEach(anomaly => {
                        this.dashboard.addEvent('ANOMALY', anomaly.message, 'error');
                    });
                }
            }

            // üõ°Ô∏è Handle Security Events
            handleSecurityEvent(event) {
                this.dashboard.addEvent('SECURITY', `${event.type}: ${event.description}`, 'warning');
                
                // Run threat detection
                const threats = this.detectThreats([event]);
                if (threats.length > 0) {
                    threats.forEach(threat => {
                        this.dashboard.addEvent('THREAT', `${threat.type} detected`, 'error');
                    });
                }
            }

            // üìà Update Performance Metrics
            updatePerformanceMetrics(metrics) {
                this.performanceCache.set(Date.now(), metrics);
                
                // Keep only last 100 entries
                if (this.performanceCache.size > 100) {
                    const oldestKey = Math.min(...this.performanceCache.keys());
                    this.performanceCache.delete(oldestKey);
                }
                
                // Run trend analysis
                const historicalData = Array.from(this.performanceCache.entries())
                    .map(([timestamp, value]) => ({ timestamp, value: value.responseTime || 0 }));
                
                const trends = this.analyzeTrends(historicalData);
                this.predictiveAnalytics.performanceTrend = trends.trend;
            }

            // üéØ Generate Comprehensive Report
            generateReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    realTimeMetrics: this.realTimeMetrics,
                    predictiveAnalytics: this.predictiveAnalytics,
                    aiInsights: {
                        anomalies: this.detectAnomalies(this.realTimeMetrics),
                        trends: this.analyzeTrends(Array.from(this.performanceCache.values())),
                        predictions: this.predictPerformance(this.realTimeMetrics, Array.from(this.performanceCache.values()))
                    },
                    security: {
                        threats: this.detectThreats(this.dashboard.events.filter(e => e.type.includes('SECURITY'))),
                        riskAssessment: this.assessRisk(this.realTimeMetrics, [], [])
                    }
                };
                
                this.dashboard.logSecure('Comprehensive report generated', report);
                return report;
            }
        }

        // üöÄ Initialize Advanced Extensions
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize enhanced status system
            updateSystemStatus('HEALTHY', { uptime: '99.9' });
        
            // Simulate status changes periodically
            setInterval(() => {
                const statuses = ['HEALTHY', 'HEALTHY', 'HEALTHY', 'WARNING'];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const uptime = (Math.random() * 2 + 98).toFixed(1);
                updateSystemStatus(randomStatus, { uptime });
            }, 30000); // Every 30 seconds
            
            const advancedExtensions = new AdvancedDashboardExtensions(dashboard);
                    
            // Initialize advanced features
            advancedExtensions.initializeWebSocket();
            advancedExtensions.initializeAIAnalytics();
                    
            // Add global access
            window.advancedExtensions = advancedExtensions;
                    
            // Start AI insights simulation
            simulateAIInsightsUpdates();
                    
            // Generate initial report after 5 seconds
            setTimeout(() => {
                const report = advancedExtensions.generateReport();
                console.log('üìä Advanced Dashboard Report:', report);
                updateAIInsightsUI(report);
            }, 5000);
        });
    </script>
</body>
</html>
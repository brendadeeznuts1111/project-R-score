<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bun v1.3.9 Playground</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/micro-polish.css">
  <link rel="stylesheet" href="/command-palette.css">
</head>
<body>
  <!-- Theme Toggle -->
  <button class="theme-toggle" onclick="toggleTheme()" data-tooltip="Toggle theme" id="theme-btn">ğŸŒ™</button>
  
  <!-- Performance Monitor -->
  <div class="perf-monitor" id="perf-monitor" style="display: none;">
    <div class="perf-item"><span>FPS:</span><span class="perf-value" id="fps">60</span></div>
    <div class="perf-item"><span>MEM:</span><span class="perf-value" id="memory">--</span></div>
    <div class="perf-item"><span>REQ:</span><span class="perf-value" id="req-count">0</span></div>
  </div>
  
  <!-- Mini Dashboard -->
  <div class="mini-dashboard" id="mini-dash">
    <button class="mini-dashboard-toggle" onclick="toggleMiniDash()" title="Toggle metrics">ğŸ“Š</button>
    <div class="mini-header-row">
      <div class="mini-title">ğŸ“Š Pool Metrics</div>
      <span id="mini-gov" class="mini-chip mini-chip-pending">Gov: ...</span>
    </div>
    <div class="mini-header-row mini-header-row-secondary">
      <span id="mini-health" class="mini-chip mini-chip-pending">Pool: ...</span>
      <span id="mini-latency" class="mini-chip mini-chip-pending">API: --ms</span>
      <span id="mini-stream" class="mini-chip mini-chip-pending">Stream: ...</span>
      <span id="mini-orch" class="mini-chip mini-chip-pending">Orch: ...</span>
      <span id="mini-dns" class="mini-chip mini-chip-pending">DNS: ...</span>
      <span id="mini-link-mode" class="mini-chip mini-chip-pending" title="Toggle query/hash link mode" onclick="cyclePlaygroundLinkMode()">Link: ...</span>
      <span id="mini-secrets" class="mini-chip mini-chip-pending">Sec: ...</span>
      <span id="mini-resilience" class="mini-chip mini-chip-pending">Res: ...</span>
    </div>
    <div class="mini-metric"><span>Requests</span><span id="mini-pool">0 / 200</span></div>
    <div class="mini-bar"><div id="mini-pool-bar" class="mini-bar-fill"></div></div>
    <div class="mini-metric"><span>Workers</span><span id="mini-workers">0 / 2</span></div>
    <div class="mini-bar"><div id="mini-worker-bar" class="mini-bar-fill"></div></div>
    <div class="mini-metric"><span>Worker Queue</span><span id="mini-worker-queue">0 (in-flight 0)</span></div>
    <div class="mini-metric"><span>Worker Timeouts</span><span id="mini-worker-timeouts">0</span></div>
    <div class="mini-metric"><span>Worker Rejections</span><span id="mini-worker-rejections">0</span></div>
    <div class="mini-metric"><span>Load</span><span id="mini-load">0%</span></div>
    <div class="mini-metric"><span>Bottleneck</span><span id="mini-bottleneck">--</span></div>
    <div class="mini-metric"><span>Capacity</span><span id="mini-capacity">--</span></div>
    <div class="mini-metric"><span>Load Trend</span><span id="mini-load-trend">..........</span></div>
    <div class="mini-metric"><span>Cap Trend</span><span id="mini-capacity-trend">..........</span></div>
    <div class="mini-metric"><span>Headroom (Conn)</span><span id="mini-headroom-connections">--</span></div>
    <div class="mini-metric"><span>Headroom (Workers)</span><span id="mini-headroom-workers">--</span></div>
    <div class="mini-metric"><span>PID</span><span id="mini-pid">--</span></div>
    <div class="mini-metric"><span>WS Clients</span><span id="mini-ws-clients">--</span></div>
    <div class="mini-metric"><span>Port</span><span id="mini-port">3011</span></div>
    <div class="mini-metric"><span>Uptime</span><span id="mini-uptime">0s</span></div>
    <div class="mini-metric"><span>Last Sync</span><span id="mini-sync">--</span></div>
    <div class="mini-metric"><span>Freshness</span><span id="mini-freshness">--</span></div>
    <div class="mini-metric"><span>Orch Trend</span><span id="mini-orch-trend">..........</span></div>
  </div>

  <div class="container">
    <header>
      <h1>ğŸš€ Bun v1.3.9 Interactive Playground</h1>
      <p class="subtitle">Explore all the new features and improvements</p>
      <div class="version-info">
        <span class="version-item" data-copy="bun-version">Bun version: <span id="bun-version" class="copyable">...</span><button class="copy-btn" onclick="copyToClipboard('bun-version')" title="Copy">ğŸ“‹</button></span>
        <span class="version-item" data-copy="bun-revision">Revision: <span id="bun-revision" class="copyable">...</span><button class="copy-btn" onclick="copyToClipboard('bun-revision')" title="Copy">ğŸ“‹</button></span>
        <span class="version-item" data-copy="git-commit-hash">Git: <span id="git-commit-hash" class="copyable">...</span><button class="copy-btn" onclick="copyToClipboard('git-commit-hash')" title="Copy">ğŸ“‹</button></span>
        <span class="version-item">Git source: <span id="git-commit-hash-source">...</span></span>
        <span class="version-item">Platform: <span id="platform">...</span><span class="status-dot" id="connection-status" title="Connection status"></span></span>
      </div>
      <p class="subtitle macro-links">
        Macros docs:
        <a href="https://bun.com/docs/bundler/macros#embed-latest-git-commit-hash:~:text=build%20it%2C%20the-,getGitCommitHash,-is%20replaced%20with" target="_blank" rel="noopener noreferrer">getGitCommitHash macro</a>
        Â·
        <a href="https://bun.com/docs/bundler/macros#embed-latest-git-commit-hash:~:text=process.env.GIT_COMMIT_HASH" target="_blank" rel="noopener noreferrer">process.env.GIT_COMMIT_HASH</a>
      </p>
      <div id="header-badges" class="header-badges">
        <span class="badge">Loading control-plane...</span>
      </div>
      <div id="runtime-drift-banner" class="runtime-drift-banner" style="display:none;"></div>
      <div class="header-actions">
        <button id="share-link-btn" class="run-btn run-btn-ghost" onclick="copyPlaygroundLink('query')">ğŸ”— Copy Link</button>
        <button id="share-hash-btn" class="run-btn run-btn-ghost" onclick="copyPlaygroundLink('hash')"># Copy Hash Link</button>
      </div>
    </header>

    <!-- Breadcrumbs -->
    <nav class="breadcrumbs" id="breadcrumbs">
      <span class="breadcrumb-item" onclick="goHome()">ğŸ  Playground</span>
      <span class="breadcrumb-separator">â€º</span>
      <span class="breadcrumb-item active" id="breadcrumb-current">Home</span>
    </nav>

    <div class="main-content">
      <aside class="sidebar">
        <h2>Demos</h2>
        <div id="demo-list" class="demo-list">
          <div class="loading">Loading demos...</div>
        </div>
      </aside>

      <main class="demo-viewer">
        <div id="demo-content" class="demo-content">
          <div class="welcome">
            <div class="welcome-hero">
              <p class="welcome-kicker">Playground Home</p>
              <h2>Build, test, and validate Bun workflows fast</h2>
              <p class="welcome-intro">Pick a demo from the sidebar to run live examples with production-oriented defaults.</p>
              <p class="welcome-tip">
                Start with Governance to validate canonical decision and benchmark status in one call. Explore Process for signal handling, argv parsing, and spawn workflows. Need deeper patterns? Browse <a href="https://github.com/brendadeeznuts1111/project-R-score/tree/main/scratch/bun-v1.3.9-examples/advanced" target="_blank" rel="noopener noreferrer">advanced examples</a>.
              </p>
            </div>
            <div class="features-grid" aria-label="Demo categories">
              <div class="feature-card feature-governance" data-home-category="governance" data-home-demo="brand-bench-gate">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ›¡ï¸</span> Governance</h3>
                <p>Validate canonical decisions, benchmark gates, and evidence tiers.</p>
              </div>
              <div class="feature-card feature-process" data-home-category="process">
                <h3><span class="feature-emoji" aria-hidden="true">âš™ï¸</span> Process</h3>
                <p>Signal handling, argv parsing, stdin/stdout, and child process spawning.</p>
              </div>
              <div class="feature-card feature-orchestration" data-home-category="orchestration" data-home-demo="script-orchestration-control">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ“¦</span> Script Orchestration</h3>
                <p>Coordinate parallel and sequential scripts with deterministic output.</p>
              </div>
              <div class="feature-card feature-networking" data-home-category="network" data-home-demo="http2-runtime-control">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ”Œ</span> Networking</h3>
                <p>Validate HTTP/2 upgrades and proxy-safe routing behavior.</p>
              </div>
              <div class="feature-card feature-testing" data-home-category="testing">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ§ª</span> Testing</h3>
                <p>Exercise mock lifecycle and cleanup with modern test primitives.</p>
              </div>
              <div class="feature-card feature-performance" data-home-category="performance">
                <h3><span class="feature-emoji" aria-hidden="true">âš¡</span> Performance</h3>
                <p>Benchmark hot paths including JIT, markdown, and string operations.</p>
              </div>
              <div class="feature-card feature-profiling" data-home-category="profiling">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ“Š</span> Profiling</h3>
                <p>Tune CPU profiling cadence and inspect runtime bottlenecks quickly.</p>
              </div>
              <div class="feature-card feature-build" data-home-category="build" data-home-demo="build-metafile">
                <h3><span class="feature-emoji" aria-hidden="true">ğŸ—ï¸</span> Build</h3>
                <p>Ship compact bundles with ESM bytecode compilation workflows.</p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script type="module" src="/app.js"></script>
  <script src="/micro-polish.js"></script>
  <script src="/command-palette.js"></script>
  <script src="/url-sharing.js"></script>
  <script>
    // Direct inline copy function for reliability
    function copyToClipboard(elementId) {
      console.log('Inline copy for:', elementId);
      const el = document.getElementById(elementId);
      if (!el) { alert('Element not found: ' + elementId); return; }
      
      const text = el.textContent?.trim() || '';
      console.log('Text:', text);
      
      if (!text || text === '...' || text.includes('v') && text.length < 3) {
        alert('Wait for data to load');
        return;
      }
      
      // Simple copy
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied: ' + text);
      }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert('Copied: ' + text);
      });
    }
    
    // Also expose globally
    window.copyToClipboard = copyToClipboard;
  </script>
</body>
</html>
